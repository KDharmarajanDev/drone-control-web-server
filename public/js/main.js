/*! For license information please see main.js.LICENSE.txt */
(()=>{var e={872:()=>{function e(){return Math.random()}var t=[{x:[new Date],y:[e],mode:"lines",line:{color:"#80CAF6"}}];Plotly.newPlot("plot",t);var i=0,r=setInterval((function(){var t=new Date,n={x:[[t]],y:[[e()]]},a={xaxis:{type:"date",range:[t.setMinutes(t.getMinutes()-1),t.setMinutes(t.getMinutes()+1)]}};Plotly.relayout("plot",a),Plotly.extendTraces("plot",n,[0]),100==++i&&clearInterval(r)}),1e3)},862:(e,t,i)=>{"use strict";var r=i(810);document.getElementById("test").addEventListener("click",(()=>{console.log("clicked!"),r.W.emit("test","test")})),document.getElementById("arm-button").addEventListener("click",(()=>{r.W.emit("arm","true")})),document.getElementById("fly-button").addEventListener("click",(()=>{r.W.emit("fly-home","true")}))},810:(e,t,i)=>{"use strict";i.d(t,{W:()=>r});var r=i(751)();r.on("connect",(()=>{document.getElementById("connection-status").innerHTML="Connected",document.getElementById("connection-status").style.color="green",console.log("Connected!"),r.on("disconnect",(()=>{document.getElementById("connection-status").innerHTML="Disconnected",document.getElementById("connection-status").style.color="red",console.log("Disconnected!")})),r.on("video",(e=>{document.getElementById("video-feed").src=`data:image/jpeg;base64,${e}`}))}))},108:(e,t,i)=>{"use strict";var r=i(810),n=(i(25),i(158)),a=null;const o={latitude:34.052235,longitude:-118.243683,altitude:0};var s=o;n.accessToken="pk.eyJ1Ijoia2RoYXJtYXJhamFuIiwiYSI6ImNraXIyMXg0bDFtMnAyemxpdG4wOHloZ2cifQ.4eWxFDwc1F0zscIOBBXnRw";var l=new n.Map({container:"map",style:"mapbox://styles/mapbox-map-design/ckhqrf2tz0dt119ny6azh975y",zoom:15.5,pitch:45,bearing:-17.6,center:[o.longitude,o.latitude],antialias:!0});function c(e){return[e.longitude,e.latitude,e.altitude]}l.on("load",(function(){var e=function(e){for(var t,i=e.getStyle().layers,r=0;r<i.length;r++)if("symbol"===i[r].type&&i[r].layout["text-field"]){t=i[r].id;break}return t}(l);l.addLayer({id:"3d-buildings",source:"composite","source-layer":"building",filter:["==","extrude","true"],type:"fill-extrusion",minzoom:10,paint:{"fill-extrusion-color":"#aaa","fill-extrusion-height":["interpolate",["linear"],["zoom"],10,0,10.05,["get","height"]],"fill-extrusion-base":["interpolate",["linear"],["zoom"],10,0,10.05,["get","min_height"]],"fill-extrusion-opacity":.6}},e),l.addLayer({id:"drone",type:"custom",renderingMode:"3d",onAdd:function(e,t){window.tb=new Threebox(e,t,{defaultLights:!0}),console.log(tb),tb.loadObj({type:"gltf",obj:"public/assets/drone.gltf",scale:.1,units:"meters",anchor:"bottom",rotation:{x:90,y:0,z:0}},(function(e){console.log("activated"),a=e.setCoords(c(o)),tb.add(a)}))},render:function(e,t){tb.update()}}),l.addSource("mapbox-dem",{type:"raster-dem",url:"mapbox://mapbox.mapbox-terrain-dem-v1",tileSize:512,maxzoom:14}),l.setTerrain({source:"mapbox-dem"})})),l.dragRotate.enable(),l.dragPan.enable(),l.addControl(new class{constructor(e,t,i){this.drone_object=e,this.zoom_level=t,this.speed=i}onAdd(e){return this.btn=document.createElement("button"),this.btn.className="drone-button",this.btn.onclick=t=>{var i=c(s);i[2]+=30,e.flyTo({center:i,zoom:this.zoom_level,speed:this.speed,curve:1,bearing:e.getBearing(),easing:e=>e,essential:!0})},this.container=document.createElement("div"),this.container.className="mapboxgl-ctrl-group mapboxgl-ctrl",this.container.appendChild(this.btn),this.container}onRemove(){this.container.parentNode.removeChild(this.container),this.map=void 0}}(a,19.5,1)),r.W.on("gps",(e=>{var t;t=c(s=e),a.setCoords(t)}))},10:e=>{function t(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}e.exports=t,t.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),i=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-i:e+i}return 0|Math.min(e,this.max)},t.prototype.reset=function(){this.attempts=0},t.prototype.setMin=function(e){this.ms=e},t.prototype.setMax=function(e){this.max=e},t.prototype.setJitter=function(e){this.jitter=e}},704:(e,t)=>{!function(e){"use strict";t.encode=function(t){var i,r=new Uint8Array(t),n=r.length,a="";for(i=0;i<n;i+=3)a+=e[r[i]>>2],a+=e[(3&r[i])<<4|r[i+1]>>4],a+=e[(15&r[i+1])<<2|r[i+2]>>6],a+=e[63&r[i+2]];return n%3==2?a=a.substring(0,a.length-1)+"=":n%3==1&&(a=a.substring(0,a.length-2)+"=="),a},t.decode=function(t){var i,r,n,a,o,s=.75*t.length,l=t.length,c=0;"="===t[t.length-1]&&(s--,"="===t[t.length-2]&&s--);var h=new ArrayBuffer(s),u=new Uint8Array(h);for(i=0;i<l;i+=4)r=e.indexOf(t[i]),n=e.indexOf(t[i+1]),a=e.indexOf(t[i+2]),o=e.indexOf(t[i+3]),u[c++]=r<<2|n>>4,u[c++]=(15&n)<<4|a>>2,u[c++]=(3&a)<<6|63&o;return h}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},767:e=>{function t(e){if(e)return function(e){for(var i in t.prototype)e[i]=t.prototype[i];return e}(e)}e.exports=t,t.prototype.on=t.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},t.prototype.once=function(e,t){function i(){this.off(e,i),t.apply(this,arguments)}return i.fn=t,this.on(e,i),this},t.prototype.off=t.prototype.removeListener=t.prototype.removeAllListeners=t.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var i,r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var n=0;n<r.length;n++)if((i=r[n])===t||i.fn===t){r.splice(n,1);break}return 0===r.length&&delete this._callbacks["$"+e],this},t.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),i=this._callbacks["$"+e],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(i){r=0;for(var n=(i=i.slice(0)).length;r<n;++r)i[r].apply(this,t)}return this},t.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},t.prototype.hasListeners=function(e){return!!this.listeners(e).length}},549:e=>{e.exports="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")()},983:(e,t,i)=>{const r=i(192);e.exports=(e,t)=>new r(e,t),e.exports.Socket=r,e.exports.protocol=r.protocol,e.exports.Transport=i(496),e.exports.transports=i(352),e.exports.parser=i(743)},192:(e,t,i)=>{const r=i(352),n=i(767),a=i(802)("engine.io-client:socket"),o=i(743),s=i(187),l=i(830);class c extends n{constructor(e,t={}){super(),e&&"object"==typeof e&&(t=e,e=null),e?(e=s(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=s(t.host).host),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?443:80),this.transports=t.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,jsonp:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+"/","string"==typeof this.opts.query&&(this.opts.query=l.decode(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&addEventListener("beforeunload",(()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())}),!1),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close")},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){a('creating transport "%s"',e);const t=function(e){const t={};for(let i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}(this.opts.query);t.EIO=o.protocol,t.transport=e,this.id&&(t.sid=this.id);const i=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return a("options: %j",i),new r[e](i)}open(){let e;if(this.opts.rememberUpgrade&&c.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void setTimeout((()=>{this.emit("error","No transports available")}),0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return a("error while creating transport: %s",e),this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}setTransport(e){a("setting transport %s",e.name),this.transport&&(a("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(()=>{this.onClose("transport close")}))}probe(e){a('probing transport "%s"',e);let t=this.createTransport(e,{probe:1}),i=!1;c.priorWebsocketSuccess=!1;const r=()=>{i||(a('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",(r=>{if(!i)if("pong"===r.type&&"probe"===r.data){if(a('probe transport "%s" pong',e),this.upgrading=!0,this.emit("upgrading",t),!t)return;c.priorWebsocketSuccess="websocket"===t.name,a('pausing current transport "%s"',this.transport.name),this.transport.pause((()=>{i||"closed"!==this.readyState&&(a("changing transport and sending upgrade packet"),u(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emit("upgrade",t),t=null,this.upgrading=!1,this.flush())}))}else{a('probe transport "%s" failed',e);const i=new Error("probe error");i.transport=t.name,this.emit("upgradeError",i)}})))};function n(){i||(i=!0,u(),t.close(),t=null)}const o=i=>{const r=new Error("probe error: "+i);r.transport=t.name,n(),a('probe transport "%s" failed because of error: %s',e,i),this.emit("upgradeError",r)};function s(){o("transport closed")}function l(){o("socket closed")}function h(e){t&&e.name!==t.name&&(a('"%s" works - aborting "%s"',e.name,t.name),n())}const u=()=>{t.removeListener("open",r),t.removeListener("error",o),t.removeListener("close",s),this.removeListener("close",l),this.removeListener("upgrading",h)};t.once("open",r),t.once("error",o),t.once("close",s),this.once("close",l),this.once("upgrading",h),t.open()}onOpen(){if(a("socket open"),this.readyState="open",c.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade&&this.transport.pause){a("starting upgrade probes");let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(a('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emit("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else a('packet received with socket readyState "%s"',this.readyState)}onHandshake(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){clearTimeout(this.pingTimeoutTimer),this.pingTimeoutTimer=setTimeout((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()}flush(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(a("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))}write(e,t,i){return this.sendPacket("message",e,t,i),this}send(e,t,i){return this.sendPacket("message",e,t,i),this}sendPacket(e,t,i,r){if("function"==typeof t&&(r=t,t=void 0),"function"==typeof i&&(r=i,i=null),"closing"===this.readyState||"closed"===this.readyState)return;(i=i||{}).compress=!1!==i.compress;const n={type:e,data:t,options:i};this.emit("packetCreate",n),this.writeBuffer.push(n),r&&this.once("flush",r),this.flush()}close(){const e=()=>{this.onClose("forced close"),a("socket closing - telling transport to close"),this.transport.close()},t=()=>{this.removeListener("upgrade",t),this.removeListener("upgradeError",t),e()},i=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?i():e()})):this.upgrading?i():e()),this}onError(e){a("socket error %j",e),c.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)}onClose(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(a('socket close with reason: "%s"',e),clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&removeEventListener("offline",this.offlineEventListener,!1),this.readyState="closed",this.id=null,this.emit("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let i=0;const r=e.length;for(;i<r;i++)~this.transports.indexOf(e[i])&&t.push(e[i]);return t}}c.priorWebsocketSuccess=!1,c.protocol=o.protocol,e.exports=c},496:(e,t,i)=>{const r=i(743),n=i(767),a=i(802)("engine.io-client:transport");e.exports=class extends n{constructor(e){super(),this.opts=e,this.query=e.query,this.readyState="",this.socket=e.socket}onError(e,t){const i=new Error(e);return i.type="TransportError",i.description=t,this.emit("error",i),this}open(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState?this.write(e):a("transport is not open, discarding packets")}onOpen(){this.readyState="open",this.writable=!0,this.emit("open")}onData(e){const t=r.decodePacket(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){this.emit("packet",e)}onClose(){this.readyState="closed",this.emit("close")}}},352:(e,t,i)=>{const r=i(777),n=i(416),a=i(785),o=i(442);t.polling=function(e){let t,i=!1,o=!1;const s=!1!==e.jsonp;if("undefined"!=typeof location){const t="https:"===location.protocol;let r=location.port;r||(r=t?443:80),i=e.hostname!==location.hostname||r!==e.port,o=e.secure!==t}if(e.xdomain=i,e.xscheme=o,t=new r(e),"open"in t&&!e.forceJSONP)return new n(e);if(!s)throw new Error("JSONP disabled");return new a(e)},t.websocket=o},785:(e,t,i)=>{const r=i(15),n=i(549),a=/\n/g,o=/\\n/g;let s;e.exports=class extends r{constructor(e){super(e),this.query=this.query||{},s||(s=n.___eio=n.___eio||[]),this.index=s.length,s.push(this.onData.bind(this)),this.query.j=this.index}get supportsBinary(){return!1}doClose(){this.script&&(this.script.onerror=()=>{},this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),super.doClose()}doPoll(){const e=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),e.async=!0,e.src=this.uri(),e.onerror=e=>{this.onError("jsonp poll error",e)};const t=document.getElementsByTagName("script")[0];t?t.parentNode.insertBefore(e,t):(document.head||document.body).appendChild(e),this.script=e,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout((function(){const e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)}),100)}doWrite(e,t){let i;if(!this.form){const e=document.createElement("form"),t=document.createElement("textarea"),i=this.iframeId="eio_iframe_"+this.index;e.className="socketio",e.style.position="absolute",e.style.top="-1000px",e.style.left="-1000px",e.target=i,e.method="POST",e.setAttribute("accept-charset","utf-8"),t.name="d",e.appendChild(t),document.body.appendChild(e),this.form=e,this.area=t}function r(){n(),t()}this.form.action=this.uri();const n=()=>{if(this.iframe)try{this.form.removeChild(this.iframe)}catch(e){this.onError("jsonp polling iframe removal error",e)}try{const e='<iframe src="javascript:0" name="'+this.iframeId+'">';i=document.createElement(e)}catch(e){i=document.createElement("iframe"),i.name=this.iframeId,i.src="javascript:0"}i.id=this.iframeId,this.form.appendChild(i),this.iframe=i};n(),e=e.replace(o,"\\\n"),this.area.value=e.replace(a,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=()=>{"complete"===this.iframe.readyState&&r()}:this.iframe.onload=r}}},416:(e,t,i)=>{const r=i(777),n=i(15),a=i(767),{pick:o}=i(839),s=i(549),l=i(802)("engine.io-client:polling-xhr");function c(){}const h=null!=new r({xdomain:!1}).responseType;class u extends a{constructor(e,t){super(),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=!1!==t.async,this.data=void 0!==t.data?t.data:null,this.create()}create(){const e=o(this.opts,"agent","enablesXDR","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const t=this.xhr=new r(e);try{l("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let e in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(e)&&t.setRequestHeader(e,this.opts.extraHeaders[e])}}catch(e){}if("POST"===this.method)try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),this.hasXDR()?(t.onload=()=>{this.onLoad()},t.onerror=()=>{this.onError(t.responseText)}):t.onreadystatechange=()=>{4===t.readyState&&(200===t.status||1223===t.status?this.onLoad():setTimeout((()=>{this.onError("number"==typeof t.status?t.status:0)}),0))},l("xhr data %s",this.data),t.send(this.data)}catch(e){return void setTimeout((()=>{this.onError(e)}),0)}"undefined"!=typeof document&&(this.index=u.requestsCount++,u.requests[this.index]=this)}onSuccess(){this.emit("success"),this.cleanup()}onData(e){this.emit("data",e),this.onSuccess()}onError(e){this.emit("error",e),this.cleanup(!0)}cleanup(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=c:this.xhr.onreadystatechange=c,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete u.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;null!==e&&this.onData(e)}hasXDR(){return"undefined"!=typeof XDomainRequest&&!this.xs&&this.enablesXDR}abort(){this.cleanup()}}function d(){for(let e in u.requests)u.requests.hasOwnProperty(e)&&u.requests[e].abort()}u.requestsCount=0,u.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",d):"function"==typeof addEventListener&&addEventListener("onpagehide"in s?"pagehide":"unload",d,!1)),e.exports=class extends n{constructor(e){if(super(e),"undefined"!=typeof location){const t="https:"===location.protocol;let i=location.port;i||(i=t?443:80),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||i!==e.port,this.xs=e.secure!==t}const t=e&&e.forceBase64;this.supportsBinary=h&&!t}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new u(this.uri(),e)}doWrite(e,t){const i=this.request({method:"POST",data:e});i.on("success",t),i.on("error",(e=>{this.onError("xhr post error",e)}))}doPoll(){l("xhr poll");const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(e=>{this.onError("xhr poll error",e)})),this.pollXhr=e}},e.exports.Request=u},15:(e,t,i)=>{const r=i(496),n=i(830),a=i(743),o=i(281),s=i(802)("engine.io-client:polling");e.exports=class extends r{get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{s("paused"),this.readyState="paused",e()};if(this.polling||!this.writable){let e=0;this.polling&&(s("we are currently polling - waiting to pause"),e++,this.once("pollComplete",(function(){s("pre-pause polling complete"),--e||t()}))),this.writable||(s("we are currently writing - waiting to pause"),e++,this.once("drain",(function(){s("pre-pause writing complete"),--e||t()})))}else t()}poll(){s("polling"),this.polling=!0,this.doPoll(),this.emit("poll")}onData(e){s("polling got data %s",e),a.decodePayload(e,this.socket.binaryType).forEach((e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose(),!1;this.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():s('ignoring poll - transport state "%s"',this.readyState))}doClose(){const e=()=>{s("writing close packet"),this.write([{type:"close"}])};"open"===this.readyState?(s("transport open - closing"),e()):(s("transport not open - deferring close"),this.once("open",e))}write(e){this.writable=!1,a.encodePayload(e,(e=>{this.doWrite(e,(()=>{this.writable=!0,this.emit("drain")}))}))}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let i="";return!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=o()),this.supportsBinary||e.sid||(e.b64=1),e=n.encode(e),this.opts.port&&("https"===t&&443!==Number(this.opts.port)||"http"===t&&80!==Number(this.opts.port))&&(i=":"+this.opts.port),e.length&&(e="?"+e),t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+i+this.opts.path+e}}},866:(e,t,i)=>{const r=i(549);e.exports={WebSocket:r.WebSocket||r.MozWebSocket,usingBrowserWebSocket:!0,defaultBinaryType:"arraybuffer"}},442:(e,t,i)=>{const r=i(496),n=i(743),a=i(830),o=i(281),{pick:s}=i(839),{WebSocket:l,usingBrowserWebSocket:c,defaultBinaryType:h}=i(866),u=i(802)("engine.io-client:websocket"),d="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class p extends r{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,i=d?{}:s(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(i.headers=this.opts.extraHeaders);try{this.ws=c&&!d?t?new l(e,t):new l(e):new l(e,t,i)}catch(e){return this.emit("error",e)}this.ws.binaryType=this.socket.binaryType||h,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=this.onClose.bind(this),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const i=e[t],r=t===e.length-1;n.encodePacket(i,this.supportsBinary,(e=>{const t={};!c&&(i.options&&(t.compress=i.options.compress),this.opts.perMessageDeflate)&&("string"==typeof e?Buffer.byteLength(e):e.length)<this.opts.perMessageDeflate.threshold&&(t.compress=!1);try{c?this.ws.send(e):this.ws.send(e,t)}catch(e){u("websocket closed before onclose event")}r&&setTimeout((()=>{this.writable=!0,this.emit("drain")}),0)}))}}onClose(){r.prototype.onClose.call(this)}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let i="";return this.opts.port&&("wss"===t&&443!==Number(this.opts.port)||"ws"===t&&80!==Number(this.opts.port))&&(i=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=o()),this.supportsBinary||(e.b64=1),e=a.encode(e),e.length&&(e="?"+e),t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+i+this.opts.path+e}check(){return!(!l||"__initialize"in l&&this.name===p.prototype.name)}}e.exports=p},839:e=>{e.exports.pick=(e,...t)=>t.reduce(((t,i)=>(e.hasOwnProperty(i)&&(t[i]=e[i]),t)),{})},777:(e,t,i)=>{const r=i(58),n=i(549);e.exports=function(e){const t=e.xdomain,i=e.xscheme,a=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||r))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!i&&a)return new XDomainRequest}catch(e){}if(!t)try{return new(n[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}},802:(e,t,i)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const i="color: "+this.color;t.splice(1,0,i,"color: inherit");let r=0,n=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(r++,"%c"===e&&(n=r))})),t.splice(n,0,i)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=i(804)(t);const{formatters:r}=e.exports;r.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},804:(e,t,i)=>{e.exports=function(e){function t(e){let i,n=null;function a(...e){if(!a.enabled)return;const r=a,n=Number(new Date),o=n-(i||n);r.diff=o,r.prev=i,r.curr=n,i=n,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((i,n)=>{if("%%"===i)return"%";s++;const a=t.formatters[n];if("function"==typeof a){const t=e[s];i=a.call(r,t),e.splice(s,1),s--}return i})),t.formatArgs.call(r,e),(r.log||t.log).apply(r,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=r,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null===n?t.enabled(e):n,set:e=>{n=e}}),"function"==typeof t.init&&t.init(a),a}function r(e,i){const r=t(this.namespace+(void 0===i?":":i)+e);return r.log=this.log,r}function n(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(n),...t.skips.map(n).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let i;t.save(e),t.names=[],t.skips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),n=r.length;for(i=0;i<n;i++)r[i]&&("-"===(e=r[i].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let i,r;for(i=0,r=t.skips.length;i<r;i++)if(t.skips[i].test(e))return!1;for(i=0,r=t.names.length;i<r;i++)if(t.names[i].test(e))return!0;return!1},t.humanize=i(209),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((i=>{t[i]=e[i]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let i=0;for(let t=0;t<e.length;t++)i=(i<<5)-i+e.charCodeAt(t),i|=0;return t.colors[Math.abs(i)%t.colors.length]},t.enable(t.load()),t}},209:e=>{var t=1e3,i=60*t,r=60*i,n=24*r;function a(e,t,i,r){var n=t>=1.5*i;return Math.round(e/i)+" "+r+(n?"s":"")}e.exports=function(e,o){o=o||{};var s,l,c=typeof e;if("string"===c&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(a){var o=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"weeks":case"week":case"w":return 6048e5*o;case"days":case"day":case"d":return o*n;case"hours":case"hour":case"hrs":case"hr":case"h":return o*r;case"minutes":case"minute":case"mins":case"min":case"m":return o*i;case"seconds":case"second":case"secs":case"sec":case"s":return o*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}}}(e);if("number"===c&&isFinite(e))return o.long?(s=e,(l=Math.abs(s))>=n?a(s,l,n,"day"):l>=r?a(s,l,r,"hour"):l>=i?a(s,l,i,"minute"):l>=t?a(s,l,t,"second"):s+" ms"):function(e){var a=Math.abs(e);return a>=n?Math.round(e/n)+"d":a>=r?Math.round(e/r)+"h":a>=i?Math.round(e/i)+"m":a>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},712:e=>{const t=Object.create(null);t.open="0",t.close="1",t.ping="2",t.pong="3",t.message="4",t.upgrade="5",t.noop="6";const i=Object.create(null);Object.keys(t).forEach((e=>{i[t[e]]=e})),e.exports={PACKET_TYPES:t,PACKET_TYPES_REVERSE:i,ERROR_PACKET:{type:"error",data:"parser error"}}},965:(e,t,i)=>{const{PACKET_TYPES_REVERSE:r,ERROR_PACKET:n}=i(712);let a;"function"==typeof ArrayBuffer&&(a=i(704));const o=(e,t)=>{if(a){const i=a.decode(e);return s(i,t)}return{base64:!0,data:e}},s=(e,t)=>{switch(t){case"blob":return e instanceof ArrayBuffer?new Blob([e]):e;case"arraybuffer":default:return e}};e.exports=(e,t)=>{if("string"!=typeof e)return{type:"message",data:s(e,t)};const i=e.charAt(0);return"b"===i?{type:"message",data:o(e.substring(1),t)}:r[i]?e.length>1?{type:r[i],data:e.substring(1)}:{type:r[i]}:n}},929:(e,t,i)=>{const{PACKET_TYPES:r}=i(712),n="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),a="function"==typeof ArrayBuffer,o=(e,t)=>{const i=new FileReader;return i.onload=function(){const e=i.result.split(",")[1];t("b"+e)},i.readAsDataURL(e)};e.exports=({type:e,data:t},i,s)=>{return n&&t instanceof Blob?i?s(t):o(t,s):a&&(t instanceof ArrayBuffer||(l=t,"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(l):l&&l.buffer instanceof ArrayBuffer))?i?s(t instanceof ArrayBuffer?t:t.buffer):o(new Blob([t]),s):s(r[e]+(t||""));var l}},743:(e,t,i)=>{const r=i(929),n=i(965),a=String.fromCharCode(30);e.exports={protocol:4,encodePacket:r,encodePayload:(e,t)=>{const i=e.length,n=new Array(i);let o=0;e.forEach(((e,s)=>{r(e,!1,(e=>{n[s]=e,++o===i&&t(n.join(a))}))}))},decodePacket:n,decodePayload:(e,t)=>{const i=e.split(a),r=[];for(let e=0;e<i.length;e++){const a=n(i[e],t);if(r.push(a),"error"===a.type)break}return r}}},58:e=>{try{e.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){e.exports=!1}},158:function(e){e.exports=function(){"use strict";var e,t,i;function r(r,n){if(e)if(t){var a="var sharedChunk = {}; ("+e+")(sharedChunk); ("+t+")(sharedChunk);",o={};e(o),i=n(o),"undefined"!=typeof window&&(i.workerUrl=window.URL.createObjectURL(new Blob([a],{type:"text/javascript"})))}else t=n;else e=n}return r(0,(function(e){var t=i;function i(e,t,i,r){this.cx=3*e,this.bx=3*(i-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(r-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=i,this.p2y=r}i.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},i.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},i.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},i.prototype.solveCurveX=function(e,t){var i,r,n,a,o;for(void 0===t&&(t=1e-6),n=e,o=0;o<8;o++){if(a=this.sampleCurveX(n)-e,Math.abs(a)<t)return n;var s=this.sampleCurveDerivativeX(n);if(Math.abs(s)<1e-6)break;n-=a/s}if((n=e)<(i=0))return i;if(n>(r=1))return r;for(;i<r;){if(a=this.sampleCurveX(n),Math.abs(a-e)<t)return n;e>a?i=n:r=n,n=.5*(r-i)+i}return n},i.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var r=n;function n(e,t){this.x=e,this.y=t}n.prototype={clone:function(){return new n(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,i=e.y-this.y;return t*t+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),i=Math.sin(e),r=i*this.x+t*this.y;return this.x=t*this.x-i*this.y,this.y=r,this},_rotateAround:function(e,t){var i=Math.cos(e),r=Math.sin(e),n=t.y+r*(this.x-t.x)+i*(this.y-t.y);return this.x=t.x+i*(this.x-t.x)-r*(this.y-t.y),this.y=n,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},n.convert=function(e){return e instanceof n?e:Array.isArray(e)?new n(e[0],e[1]):e};var a="undefined"!=typeof self?self:{};function o(e,t){if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!o(e[i],t[i]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==t){if("object"!=typeof t)return!1;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const i in e)if(!o(e[i],t[i]))return!1;return!0}return e===t}const s=Math.pow(2,53)-1,l=Math.PI/180,c=180/Math.PI;function h(e){return e*l}function u(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,i=t*e;return 4*(e<.5?i:3*(e-t)+i-.75)}function d(e,i,r,n){const a=new t(e,i,r,n);return function(e){return a.solve(e)}}const p=d(.25,.1,.25,1);function f(e,t,i){return Math.min(i,Math.max(t,e))}function m(e,t,i){const r=i-t,n=((e-t)%r+r)%r+t;return n===t?i:n}function g(e){const t=[];for(const i in e)t.push(e[i]);return t}function y(e,...t){for(const i of t)for(const t in i)e[t]=i[t];return e}let v=1;function _(){return v++}function x(){return function e(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function b(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function w(e,t){e.forEach((e=>{t[e]&&(t[e]=t[e].bind(t))}))}function M(e,t){return-1!==e.indexOf(t,e.length-t.length)}function T(e,t,i){const r={};for(const n in e)r[n]=t.call(i||this,e[n],n,e);return r}function S(e,t,i){const r={};for(const n in e)t.call(i||this,e[n],n,e)&&(r[n]=e[n]);return r}function E(e){return Array.isArray(e)?e.map(E):"object"==typeof e&&e?T(e,E):e}const A={};function C(e){A[e]||("undefined"!=typeof console&&console.warn(e),A[e]=!0)}function L(e,t,i){return(i.y-e.y)*(t.x-e.x)>(t.y-e.y)*(i.x-e.x)}function P(e){let t=0;for(let i,r,n=0,a=e.length,o=a-1;n<a;o=n++)i=e[n],r=e[o],t+=(r.x-i.x)*(i.y+r.y);return t}function I(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function R(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((e,i,r,n)=>{const a=r||n;return t[i]=!a||a.toLowerCase(),""})),t["max-age"]){const e=parseInt(t["max-age"],10);isNaN(e)?delete t["max-age"]:t["max-age"]=e}return t}let D,k,z=null;function O(e){if(null==z){const t=e.navigator?e.navigator.userAgent:null;z=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return z}function B(e){try{const t=a[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(e){return!1}}let F,N=!1;const U={now:()=>void 0!==F?F:a.performance.now(),setErrorState(){N=!0},setNow(e){F=e},restoreNow(){F=void 0},frame(e){if(N)return{cancel:()=>{}};const t=a.requestAnimationFrame(e);return{cancel:()=>a.cancelAnimationFrame(t)}},getImageData(e,t=0){const i=a.document.createElement("canvas"),r=i.getContext("2d");if(!r)throw new Error("failed to create canvas 2d context");return i.width=e.width,i.height=e.height,r.drawImage(e,0,0,e.width,e.height),r.getImageData(-t,-t,e.width+2*t,e.height+2*t)},resolveURL:e=>(D||(D=a.document.createElement("a")),D.href=e,D.href),get devicePixelRatio(){return a.devicePixelRatio},get prefersReducedMotion(){return!!a.matchMedia&&(null==k&&(k=a.matchMedia("(prefers-reduced-motion: reduce)")),k.matches)}};let j;const V={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==j){const e=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{j=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):e}catch(t){j=e}}return j},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},G={supported:!1,testSupport:function(e){!q&&W&&(Z?X(e):H=e)}};let H,W,q=!1,Z=!1;function X(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,W),e.isContextLost())return;G.supported=!0}catch(e){}e.deleteTexture(t),q=!0}a.document&&(W=a.document.createElement("img"),W.onload=function(){H&&X(H),H=null,Z=!0},W.onerror=function(){q=!0,H=null},W.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const $="01";function Y(e){return 0===e.indexOf("mapbox:")}function J(e){return V.API_URL_REGEX.test(e)}const K=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Q(e){const t=e.match(K);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function ee(e){const t=e.params.length?`?${e.params.join("&")}`:"";return`${e.protocol}://${e.authority}${e.path}${t}`}function te(e){if(!e)return null;const t=e.split(".");if(!t||3!==t.length)return null;try{return JSON.parse(decodeURIComponent(a.atob(t[1]).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join("")))}catch(e){return null}}class ie{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const t=te(V.ACCESS_TOKEN);let i="";return i=t&&t.u?a.btoa(encodeURIComponent(t.u).replace(/%([0-9A-F]{2})/g,((e,t)=>String.fromCharCode(Number("0x"+t))))):V.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${i}`:`mapbox.eventData:${i}`}fetchEventData(){const e=B("localStorage"),t=this.getStorageKey(),i=this.getStorageKey("uuid");if(e)try{const e=a.localStorage.getItem(t);e&&(this.eventData=JSON.parse(e));const r=a.localStorage.getItem(i);r&&(this.anonId=r)}catch(e){C("Unable to read from LocalStorage")}}saveEventData(){const e=B("localStorage"),t=this.getStorageKey(),i=this.getStorageKey("uuid");if(e)try{a.localStorage.setItem(i,this.anonId),Object.keys(this.eventData).length>=1&&a.localStorage.setItem(t,JSON.stringify(this.eventData))}catch(e){C("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,t,i,r){if(!V.EVENTS_URL)return;const n=Q(V.EVENTS_URL);n.params.push(`access_token=${r||V.ACCESS_TOKEN||""}`);const a={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.0.1",skuId:$,userId:this.anonId},o=t?y(a,t):a,s={url:ee(n),headers:{"Content-Type":"text/plain"},body:JSON.stringify([o])};this.pendingRequest=Me(s,(e=>{this.pendingRequest=null,i(e),this.saveEventData(),this.processRequests(r)}))}queueRequest(e,t){this.queue.push(e),this.processRequests(t)}}const re=new class extends ie{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(e,t){V.EVENTS_URL&&V.ACCESS_TOKEN&&Array.isArray(e)&&e.some((e=>Y(e)||J(e)))&&this.queueRequest(Date.now(),t)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=te(V.ACCESS_TOKEN),i=t?t.u:V.ACCESS_TOKEN;let r=i!==this.eventData.tokenU;b(this.anonId)||(this.anonId=x(),r=!0);const n=this.queue.shift();if(this.eventData.lastSuccess){const e=new Date(this.eventData.lastSuccess),t=new Date(n),i=(n-this.eventData.lastSuccess)/864e5;r=r||i>=1||i<-1||e.getDate()!==t.getDate()}else r=!0;if(!r)return this.processRequests();this.postEvent(n,{"enabled.telemetry":!1},(e=>{e||(this.eventData.lastSuccess=n,this.eventData.tokenU=i)}),e)}},ne=re.postTurnstileEvent.bind(re),ae=new class extends ie{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(e,t,i,r){this.skuToken=t,this.errorCb=r,V.EVENTS_URL&&(i||V.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},i):this.errorCb(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),b(this.anonId)||(this.anonId=x()),this.postEvent(i,{skuToken:this.skuToken},(e=>{e?this.errorCb(e):t&&(this.success[t]=!0)}),e))}},oe=ae.postMapLoadEvent.bind(ae),se=new class extends ie{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(e,t,i,r){if(!V.API_URL||!V.SESSION_PATH)return;const n=Q(V.API_URL+V.SESSION_PATH);n.params.push(`sku=${t||""}`),n.params.push(`access_token=${r||V.ACCESS_TOKEN||""}`);const a={url:ee(n),headers:{"Content-Type":"text/plain"}};this.pendingRequest=Te(a,(e=>{this.pendingRequest=null,i(e),this.saveEventData(),this.processRequests(r)}))}getSessionAPI(e,t,i,r){this.skuToken=t,this.errorCb=r,V.SESSION_PATH&&V.API_URL&&(i||V.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},i):this.errorCb(new Error("NO_ACCESS_TOKEN")))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||this.getSession(i,this.skuToken,(e=>{e?this.errorCb(e):t&&(this.success[t]=!0)}),e)}},le=se.getSessionAPI.bind(se);let ce,he,ue=500,de=50;function pe(){a.caches&&!ce&&(ce=a.caches.open("mapbox-tiles"))}function fe(e){const t=e.indexOf("?");return t<0?e:e.slice(0,t)}let me,ge=1/0;function ye(){return null==me&&(me=a.OffscreenCanvas&&new a.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof a.createImageBitmap),me}const ve={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(ve);class _e extends Error{constructor(e,t,i){401===t&&J(i)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=t,this.url=i}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const xe=I()?()=>self.worker&&self.worker.referrer:()=>("blob:"===a.location.protocol?a.parent:a).location.href,be=function(e,t){if(!(/^file:/.test(i=e.url)||/^file:/.test(xe())&&!/^\w+:/.test(i))){if(a.fetch&&a.Request&&a.AbortController&&a.Request.prototype.hasOwnProperty("signal"))return function(e,t){const i=new a.AbortController,r=new a.Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:xe(),signal:i.signal});let n=!1,o=!1;const s=(l=r.url).indexOf("sku=")>0&&J(l);var l;"json"===e.type&&r.headers.set("Accept","application/json");const c=(i,n,l)=>{if(o)return;if(i&&"SecurityError"!==i.message&&C(i),n&&l)return h(n);const c=Date.now();a.fetch(r).then((i=>{if(i.ok){const e=s?i.clone():null;return h(i,e,c)}return t(new _e(i.statusText,i.status,e.url))})).catch((e=>{20!==e.code&&t(new Error(e.message))}))},h=(i,s,l)=>{("arrayBuffer"===e.type?i.arrayBuffer():"json"===e.type?i.json():i.text()).then((e=>{o||(s&&l&&function(e,t,i){if(pe(),!ce)return;const r={status:t.status,statusText:t.statusText,headers:new a.Headers};t.headers.forEach(((e,t)=>r.headers.set(t,e)));const n=R(t.headers.get("Cache-Control")||"");n["no-store"]||(n["max-age"]&&r.headers.set("Expires",new Date(i+1e3*n["max-age"]).toUTCString()),new Date(r.headers.get("Expires")).getTime()-i<42e4||function(e,t){if(void 0===he)try{new Response(new ReadableStream),he=!0}catch(e){he=!1}he?t(e.body):e.blob().then(t)}(t,(t=>{const i=new a.Response(t,r);pe(),ce&&ce.then((t=>t.put(fe(e.url),i))).catch((e=>C(e.message)))})))}(r,s,l),n=!0,t(null,e,i.headers.get("Cache-Control"),i.headers.get("Expires")))})).catch((e=>{o||t(new Error(e.message))}))};return s?function(e,t){if(pe(),!ce)return t(null);const i=fe(e.url);ce.then((e=>{e.match(i).then((r=>{const n=function(e){if(!e)return!1;const t=new Date(e.headers.get("Expires")||0),i=R(e.headers.get("Cache-Control")||"");return t>Date.now()&&!i["no-cache"]}(r);e.delete(i),n&&e.put(i,r.clone()),t(null,r,n)})).catch(t)})).catch(t)}(r,c):c(null,null),{cancel:()=>{o=!0,n||i.abort()}}}(e,t);if(I()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var i;return function(e,t){const i=new a.XMLHttpRequest;i.open(e.method||"GET",e.url,!0),"arrayBuffer"===e.type&&(i.responseType="arraybuffer");for(const t in e.headers)i.setRequestHeader(t,e.headers[t]);return"json"===e.type&&(i.responseType="text",i.setRequestHeader("Accept","application/json")),i.withCredentials="include"===e.credentials,i.onerror=()=>{t(new Error(i.statusText))},i.onload=()=>{if((i.status>=200&&i.status<300||0===i.status)&&null!==i.response){let r=i.response;if("json"===e.type)try{r=JSON.parse(i.response)}catch(e){return t(e)}t(null,r,i.getResponseHeader("Cache-Control"),i.getResponseHeader("Expires"))}else t(new _e(i.statusText,i.status,e.url))},i.send(e.body),{cancel:()=>i.abort()}}(e,t)},we=function(e,t){return be(y(e,{type:"arrayBuffer"}),t)},Me=function(e,t){return be(y(e,{method:"POST"}),t)},Te=function(e,t){return be(y(e,{method:"GET"}),t)};function Se(e){const t=a.document.createElement("a");return t.href=e,t.protocol===a.document.location.protocol&&t.host===a.document.location.host}const Ee="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ae,Ce;Ae=[],Ce=0;const Le=function(e,t){if(G.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),Ce>=V.MAX_PARALLEL_IMAGE_REQUESTS){const i={requestParameters:e,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return Ae.push(i),i}Ce++;let i=!1;const r=()=>{if(!i)for(i=!0,Ce--;Ae.length&&Ce<V.MAX_PARALLEL_IMAGE_REQUESTS;){const e=Ae.shift(),{requestParameters:t,callback:i,cancelled:r}=e;r||(e.cancel=Le(t,i).cancel)}},n=we(e,((e,i,n,o)=>{r(),e?t(e):i&&(ye()?function(e,t){const i=new a.Blob([new Uint8Array(e)],{type:"image/png"});a.createImageBitmap(i).then((e=>{t(null,e)})).catch((e=>{t(new Error(`Could not load image because of ${e.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))}(i,t):function(e,t,i,r){const n=new a.Image,o=a.URL;n.onload=()=>{t(null,n),o.revokeObjectURL(n.src),n.onload=null,a.requestAnimationFrame((()=>{n.src=Ee}))},n.onerror=()=>t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const s=new a.Blob([new Uint8Array(e)],{type:"image/png"});n.cacheControl=i,n.expires=r,n.src=e.byteLength?o.createObjectURL(s):Ee}(i,t,n,o))}));return{cancel:()=>{n.cancel(),r()}}};function Pe(e,t,i){i[e]&&-1!==i[e].indexOf(t)||(i[e]=i[e]||[],i[e].push(t))}function Ie(e,t,i){if(i&&i[e]){const r=i[e].indexOf(t);-1!==r&&i[e].splice(r,1)}}class Re{constructor(e,t={}){y(this,t),this.type=e}}class De extends Re{constructor(e,t={}){super("error",y({error:e},t))}}class ke{on(e,t){return this._listeners=this._listeners||{},Pe(e,t,this._listeners),this}off(e,t){return Ie(e,t,this._listeners),Ie(e,t,this._oneTimeListeners),this}once(e,t){return this._oneTimeListeners=this._oneTimeListeners||{},Pe(e,t,this._oneTimeListeners),this}fire(e,t){"string"==typeof e&&(e=new Re(e,t||{}));const i=e.type;if(this.listens(i)){e.target=this;const t=this._listeners&&this._listeners[i]?this._listeners[i].slice():[];for(const i of t)i.call(this,e);const r=this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[];for(const t of r)Ie(i,t,this._oneTimeListeners),t.call(this,e);const n=this._eventedParent;n&&(y(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),n.fire(e))}else e instanceof De&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}var ze={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{},sky:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_sky:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number","property-type":"data-constant",default:1,minimum:0,maximum:1e3,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_sky:{"sky-type":{type:"enum",values:{gradient:{},atmosphere:{}},default:"atmosphere",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,transition:!1,requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],transition:!1,requires:[{"sky-type":"gradient"}],expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class Oe{constructor(e,t,i,r){this.message=(e?`${e}: `:"")+i,r&&(this.identifier=r),null!=t&&t.__line__&&(this.line=t.__line__)}}function Be(e){const t=e.value;return t?[new Oe(e.key,t,"constants have been deprecated as of v8")]:[]}function Fe(e,...t){for(const i of t)for(const t in i)e[t]=i[t];return e}function Ne(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Ue(e){if(Array.isArray(e))return e.map(Ue);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const i in e)t[i]=Ue(e[i]);return t}return Ne(e)}class je extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}class Ve{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[e,i]of t)this.bindings[e]=i}concat(e){return new Ve(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Ge={kind:"null"},He={kind:"number"},We={kind:"string"},qe={kind:"boolean"},Ze={kind:"color"},Xe={kind:"object"},$e={kind:"value"},Ye={kind:"collator"},Je={kind:"formatted"},Ke={kind:"resolvedImage"};function Qe(e,t){return{kind:"array",itemType:e,N:t}}function et(e){if("array"===e.kind){const t=et(e.itemType);return"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}const tt=[Ge,He,We,qe,Ze,Je,Xe,Qe($e),Ke];function it(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!it(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of tt)if(!it(e,t))return null}return`Expected ${et(e)} but found ${et(t)} instead.`}function rt(e,t){return t.some((t=>t.kind===e.kind))}function nt(e,t){return t.some((t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e))}function at(e,t){return e(t={exports:{}},t.exports),t.exports}var ot=at((function(e,t){var i={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(e){return(e=Math.round(e))<0?0:e>255?255:e}function n(e){return r("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function a(e){return(t="%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function o(e,t,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}try{t.parseCSSColor=function(e){var t,s=e.replace(/ /g,"").toLowerCase();if(s in i)return i[s].slice();if("#"===s[0])return 4===s.length?(t=parseInt(s.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===s.length&&(t=parseInt(s.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var l=s.indexOf("("),c=s.indexOf(")");if(-1!==l&&c+1===s.length){var h=s.substr(0,l),u=s.substr(l+1,c-(l+1)).split(","),d=1;switch(h){case"rgba":if(4!==u.length)return null;d=a(u.pop());case"rgb":return 3!==u.length?null:[n(u[0]),n(u[1]),n(u[2]),d];case"hsla":if(4!==u.length)return null;d=a(u.pop());case"hsl":if(3!==u.length)return null;var p=(parseFloat(u[0])%360+360)%360/360,f=a(u[1]),m=a(u[2]),g=m<=.5?m*(f+1):m+f-m*f,y=2*m-g;return[r(255*o(y,g,p+1/3)),r(255*o(y,g,p)),r(255*o(y,g,p-1/3)),d];default:return null}}return null}}catch(e){}})).parseCSSColor;class st{constructor(e,t,i,r=1){this.r=e,this.g=t,this.b=i,this.a=r}static parse(e){if(!e)return;if(e instanceof st)return e;if("string"!=typeof e)return;const t=ot(e);return t?new st(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3]):void 0}toString(){const[e,t,i,r]=this.toArray();return`rgba(${Math.round(e)},${Math.round(t)},${Math.round(i)},${r})`}toArray(){const{r:e,g:t,b:i,a:r}=this;return 0===r?[0,0,0,0]:[255*e/r,255*t/r,255*i/r,r]}}st.black=new st(0,0,0,1),st.white=new st(1,1,1,1),st.transparent=new st(0,0,0,0),st.red=new st(1,0,0,1),st.blue=new st(0,0,1,1);class lt{constructor(e,t,i){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ct{constructor(e,t,i,r,n){this.text=e,this.image=t,this.scale=i,this.fontStack=r,this.textColor=n}}class ht{constructor(e){this.sections=e}static fromString(e){return new ht([new ct(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((e=>0!==e.text.length||e.image&&0!==e.image.name.length))}static factory(e){return e instanceof ht?e:ht.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){e.push(["image",t.image.name]);continue}e.push(t.text);const i={};t.fontStack&&(i["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(i["font-scale"]=t.scale),t.textColor&&(i["text-color"]=["rgba"].concat(t.textColor.toArray())),e.push(i)}return e}}class ut{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new ut({name:e,available:!1}):null}serialize(){return["image",this.name]}}function dt(e,t,i,r){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:`Invalid rgba value [${[e,t,i,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof r?[e,t,i,r]:[e,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function pt(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof st)return!0;if(e instanceof lt)return!0;if(e instanceof ht)return!0;if(e instanceof ut)return!0;if(Array.isArray(e)){for(const t of e)if(!pt(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!pt(e[t]))return!1;return!0}return!1}function ft(e){if(null===e)return Ge;if("string"==typeof e)return We;if("boolean"==typeof e)return qe;if("number"==typeof e)return He;if(e instanceof st)return Ze;if(e instanceof lt)return Ye;if(e instanceof ht)return Je;if(e instanceof ut)return Ke;if(Array.isArray(e)){const t=e.length;let i;for(const t of e){const e=ft(t);if(i){if(i===e)continue;i=$e;break}i=e}return Qe(i||$e,t)}return Xe}function mt(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof st||e instanceof ht||e instanceof ut?e.toString():JSON.stringify(e)}class gt{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!pt(e[1]))return t.error("invalid value");const i=e[1];let r=ft(i);const n=t.expectedType;return"array"!==r.kind||0!==r.N||!n||"array"!==n.kind||"number"==typeof n.N&&0!==n.N||(r=n),new gt(r,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof st?["rgba"].concat(this.value.toArray()):this.value instanceof ht?this.value.serialize():this.value}}class yt{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const vt={string:We,number:He,boolean:qe,object:Xe};class _t{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let i,r=1;const n=e[0];if("array"===n){let n,a;if(e.length>2){const i=e[1];if("string"!=typeof i||!(i in vt)||"object"===i)return t.error('The item type argument of "array" must be one of string, number, boolean',1);n=vt[i],r++}else n=$e;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);a=e[2],r++}i=Qe(n,a)}else i=vt[n];const a=[];for(;r<e.length;r++){const i=t.parse(e[r],r,$e);if(!i)return null;a.push(i)}return new _t(i,a)}evaluate(e){for(let t=0;t<this.args.length;t++){const i=this.args[t].evaluate(e);if(!it(this.type,ft(i)))return i;if(t===this.args.length-1)throw new yt(`Expected value to be of type ${et(this.type)}, but found ${et(ft(i))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,t=[e.kind];if("array"===e.kind){const i=e.itemType;if("string"===i.kind||"number"===i.kind||"boolean"===i.kind){t.push(i.kind);const r=e.N;("number"==typeof r||this.args.length>1)&&t.push(r)}}return t.concat(this.args.map((e=>e.serialize())))}}class xt{constructor(e){this.type=Je,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=e[1];if(!Array.isArray(i)&&"object"==typeof i)return t.error("First argument must be an image or text section.");const r=[];let n=!1;for(let i=1;i<=e.length-1;++i){const a=e[i];if(n&&"object"==typeof a&&!Array.isArray(a)){n=!1;let e=null;if(a["font-scale"]&&(e=t.parse(a["font-scale"],1,He),!e))return null;let i=null;if(a["text-font"]&&(i=t.parse(a["text-font"],1,Qe(We)),!i))return null;let o=null;if(a["text-color"]&&(o=t.parse(a["text-color"],1,Ze),!o))return null;const s=r[r.length-1];s.scale=e,s.font=i,s.textColor=o}else{const a=t.parse(e[i],1,$e);if(!a)return null;const o=a.type.kind;if("string"!==o&&"value"!==o&&"null"!==o&&"resolvedImage"!==o)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");n=!0,r.push({content:a,scale:null,font:null,textColor:null})}}return new xt(r)}evaluate(e){return new ht(this.sections.map((t=>{const i=t.content.evaluate(e);return ft(i)===Ke?new ct("",i,null,null,null):new ct(mt(i),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)})))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const i={};t.scale&&(i["font-scale"]=t.scale.serialize()),t.font&&(i["text-font"]=t.font.serialize()),t.textColor&&(i["text-color"]=t.textColor.serialize()),e.push(i)}return e}}class bt{constructor(e){this.type=Ke,this.input=e}static parse(e,t){if(2!==e.length)return t.error("Expected two arguments.");const i=t.parse(e[1],1,We);return i?new bt(i):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),i=ut.fromString(t);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(t)>-1),i}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const wt={"to-boolean":qe,"to-color":Ze,"to-number":He,"to-string":We};class Mt{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=e[0];if(("to-boolean"===i||"to-string"===i)&&2!==e.length)return t.error("Expected one argument.");const r=wt[i],n=[];for(let i=1;i<e.length;i++){const r=t.parse(e[i],i,$e);if(!r)return null;n.push(r)}return new Mt(r,n)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let t,i;for(const r of this.args){if(t=r.evaluate(e),i=null,t instanceof st)return t;if("string"==typeof t){const i=e.parseColor(t);if(i)return i}else if(Array.isArray(t)&&(i=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:dt(t[0],t[1],t[2],t[3]),!i))return new st(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new yt(i||`Could not parse color from value '${"string"==typeof t?t:String(JSON.stringify(t))}'`)}if("number"===this.type.kind){let t=null;for(const i of this.args){if(t=i.evaluate(e),null===t)return 0;const r=Number(t);if(!isNaN(r))return r}throw new yt(`Could not convert ${JSON.stringify(t)} to number.`)}return"formatted"===this.type.kind?ht.fromString(mt(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?ut.fromString(mt(this.args[0].evaluate(e))):mt(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new xt([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new bt(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild((t=>{e.push(t.serialize())})),e}}const Tt=["Unknown","Point","LineString","Polygon"];class St{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Tt[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=st.parse(e)),t}}class Et{constructor(e,t,i,r){this.name=e,this.type=t,this._evaluate=i,this.args=r}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,t){const i=e[0],r=Et.definitions[i];if(!r)return t.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const n=Array.isArray(r)?r[0]:r.type,a=Array.isArray(r)?[[r[1],r[2]]]:r.overloads,o=a.filter((([t])=>!Array.isArray(t)||t.length===e.length-1));let s=null;for(const[r,a]of o){s=new Xt(t.registry,t.path,null,t.scope);const o=[];let l=!1;for(let t=1;t<e.length;t++){const i=e[t],n=Array.isArray(r)?r[t-1]:r.type,a=s.parse(i,1+o.length,n);if(!a){l=!0;break}o.push(a)}if(!l)if(Array.isArray(r)&&r.length!==o.length)s.error(`Expected ${r.length} arguments, but found ${o.length} instead.`);else{for(let e=0;e<o.length;e++){const t=Array.isArray(r)?r[e]:r.type,i=o[e];s.concat(e+1).checkSubtype(t,i.type)}if(0===s.errors.length)return new Et(i,n,a,o)}}if(1===o.length)t.errors.push(...s.errors);else{const i=(o.length?o:a).map((([e])=>{return t=e,Array.isArray(t)?`(${t.map(et).join(", ")})`:`(${et(t.type)}...)`;var t})).join(" | "),r=[];for(let i=1;i<e.length;i++){const n=t.parse(e[i],1+r.length);if(!n)return null;r.push(et(n.type))}t.error(`Expected arguments of type ${i}, but found (${r.join(", ")}) instead.`)}return null}static register(e,t){Et.definitions=t;for(const i in t)e[i]=Et}}class At{constructor(e,t,i){this.type=Ye,this.locale=i,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const i=e[1];if("object"!=typeof i||Array.isArray(i))return t.error("Collator options argument must be an object.");const r=t.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,qe);if(!r)return null;const n=t.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,qe);if(!n)return null;let a=null;return i.locale&&(a=t.parse(i.locale,1,We),!a)?null:new At(r,n,a)}evaluate(e){return new lt(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function Ct(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function Lt(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function Pt(e,t){const i=(180+e[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,n=Math.pow(2,t.z);return[Math.round(i*n*8192),Math.round(r*n*8192)]}function It(e,t,i){const r=e[0]-t[0],n=e[1]-t[1],a=e[0]-i[0],o=e[1]-i[1];return r*o-a*n==0&&r*a<=0&&n*o<=0}function Rt(e,t){let i=!1;for(let o=0,s=t.length;o<s;o++){const s=t[o];for(let t=0,o=s.length;t<o-1;t++){if(It(e,s[t],s[t+1]))return!1;(n=s[t])[1]>(r=e)[1]!=(a=s[t+1])[1]>r[1]&&r[0]<(a[0]-n[0])*(r[1]-n[1])/(a[1]-n[1])+n[0]&&(i=!i)}}var r,n,a;return i}function Dt(e,t){for(let i=0;i<t.length;i++)if(Rt(e,t[i]))return!0;return!1}function kt(e,t,i,r){const n=r[0]-i[0],a=r[1]-i[1],o=(e[0]-i[0])*a-n*(e[1]-i[1]),s=(t[0]-i[0])*a-n*(t[1]-i[1]);return o>0&&s<0||o<0&&s>0}function zt(e,t,i){for(const c of i)for(let i=0;i<c.length-1;++i)if(0!=(s=[(o=c[i+1])[0]-(a=c[i])[0],o[1]-a[1]])[0]*(l=[(n=t)[0]-(r=e)[0],n[1]-r[1]])[1]-s[1]*l[0]&&kt(r,n,a,o)&&kt(a,o,r,n))return!0;var r,n,a,o,s,l;return!1}function Ot(e,t){for(let i=0;i<e.length;++i)if(!Rt(e[i],t))return!1;for(let i=0;i<e.length-1;++i)if(zt(e[i],e[i+1],t))return!1;return!0}function Bt(e,t){for(let i=0;i<t.length;i++)if(Ot(e,t[i]))return!0;return!1}function Ft(e,t,i){const r=[];for(let n=0;n<e.length;n++){const a=[];for(let r=0;r<e[n].length;r++){const o=Pt(e[n][r],i);Ct(t,o),a.push(o)}r.push(a)}return r}function Nt(e,t,i){const r=[];for(let n=0;n<e.length;n++){const a=Ft(e[n],t,i);r.push(a)}return r}function Ut(e,t,i,r){if(e[0]<i[0]||e[0]>i[2]){const t=.5*r;let n=e[0]-i[0]>t?-r:i[0]-e[0]>t?r:0;0===n&&(n=e[0]-i[2]>t?-r:i[2]-e[0]>t?r:0),e[0]+=n}Ct(t,e)}function jt(e,t,i,r){const n=8192*Math.pow(2,r.z),a=[8192*r.x,8192*r.y],o=[];for(const r of e)for(const e of r){const r=[e.x+a[0],e.y+a[1]];Ut(r,t,i,n),o.push(r)}return o}function Vt(e,t,i,r){const n=8192*Math.pow(2,r.z),a=[8192*r.x,8192*r.y],o=[];for(const i of e){const e=[];for(const r of i){const i=[r.x+a[0],r.y+a[1]];Ct(t,i),e.push(i)}o.push(e)}if(t[2]-t[0]<=n/2){(s=t)[0]=s[1]=1/0,s[2]=s[3]=-1/0;for(const e of o)for(const r of e)Ut(r,t,i,n)}var s;return o}class Gt{constructor(e,t){this.type=qe,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(pt(e[1])){const t=e[1];if("FeatureCollection"===t.type)for(let e=0;e<t.features.length;++e){const i=t.features[e].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new Gt(t,t.features[e].geometry)}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new Gt(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new Gt(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const i=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],n=e.canonicalID();if("Polygon"===t.type){const a=Ft(t.coordinates,r,n),o=jt(e.geometry(),i,r,n);if(!Lt(i,r))return!1;for(const e of o)if(!Rt(e,a))return!1}if("MultiPolygon"===t.type){const a=Nt(t.coordinates,r,n),o=jt(e.geometry(),i,r,n);if(!Lt(i,r))return!1;for(const e of o)if(!Dt(e,a))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const i=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],n=e.canonicalID();if("Polygon"===t.type){const a=Ft(t.coordinates,r,n),o=Vt(e.geometry(),i,r,n);if(!Lt(i,r))return!1;for(const e of o)if(!Ot(e,a))return!1}if("MultiPolygon"===t.type){const a=Nt(t.coordinates,r,n),o=Vt(e.geometry(),i,r,n);if(!Lt(i,r))return!1;for(const e of o)if(!Bt(e,a))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Ht(e){if(e instanceof Et){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof Gt)return!1;let t=!0;return e.eachChild((e=>{t&&!Ht(e)&&(t=!1)})),t}function Wt(e){if(e instanceof Et&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild((e=>{t&&!Wt(e)&&(t=!1)})),t}function qt(e,t){if(e instanceof Et&&t.indexOf(e.name)>=0)return!1;let i=!0;return e.eachChild((e=>{i&&!qt(e,t)&&(i=!1)})),i}class Zt{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const i=e[1];return t.scope.has(i)?new Zt(i,t.scope.get(i)):t.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Xt{constructor(e,t=[],i,r=new Ve,n=[]){this.registry=e,this.path=t,this.key=t.map((e=>`[${e}]`)).join(""),this.scope=r,this.errors=n,this.expectedType=i}parse(e,t,i,r,n={}){return t?this.concat(t,i,r)._parse(e,n):this._parse(e,n)}_parse(e,t){function i(e,t,i){return"assert"===i?new _t(t,[e]):"coerce"===i?new Mt(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const r=e[0];if("string"!=typeof r)return this.error(`Expression name must be a string, but found ${typeof r} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const n=this.registry[r];if(n){let r=n.parse(e,this);if(!r)return null;if(this.expectedType){const e=this.expectedType,n=r.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==n.kind)if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==n.kind&&"string"!==n.kind){if(this.checkSubtype(e,n))return null}else r=i(r,e,t.typeAnnotation||"coerce");else r=i(r,e,t.typeAnnotation||"assert")}if(!(r instanceof gt)&&"resolvedImage"!==r.type.kind&&function e(t){if(t instanceof Zt)return e(t.boundExpression);if(t instanceof Et&&"error"===t.name)return!1;if(t instanceof At)return!1;if(t instanceof Gt)return!1;const i=t instanceof Mt||t instanceof _t;let r=!0;return t.eachChild((t=>{r=i?r&&e(t):r&&t instanceof gt})),!!r&&Ht(t)&&qt(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script"])}(r)){const t=new St;try{r=new gt(r.type,r.evaluate(t))}catch(e){return this.error(e.message),null}}return r}return this.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,t,i){const r="number"==typeof e?this.path.concat(e):this.path,n=i?this.scope.concat(i):this.scope;return new Xt(this.registry,r,t||null,n,this.errors)}error(e,...t){const i=`${this.key}${t.map((e=>`[${e}]`)).join("")}`;this.errors.push(new je(i,e))}checkSubtype(e,t){const i=it(e,t);return i&&this.error(i),i}}function $t(e,t){const i=e.length-1;let r,n,a=0,o=i,s=0;for(;a<=o;)if(s=Math.floor((a+o)/2),r=e[s],n=e[s+1],r<=t){if(s===i||t<n)return s;a=s+1}else{if(!(r>t))throw new yt("Input is not a number.");o=s-1}return 0}class Yt{constructor(e,t,i){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[e,t]of i)this.labels.push(e),this.outputs.push(t)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const i=t.parse(e[1],1,He);if(!i)return null;const r=[];let n=null;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);for(let i=1;i<e.length;i+=2){const a=1===i?-1/0:e[i],o=e[i+1],s=i,l=i+1;if("number"!=typeof a)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',s);if(r.length&&r[r.length-1][0]>=a)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',s);const c=t.parse(o,l,n);if(!c)return null;n=n||c.type,r.push([a,c])}return new Yt(n,i,r)}evaluate(e){const t=this.labels,i=this.outputs;if(1===t.length)return i[0].evaluate(e);const r=this.input.evaluate(e);if(r<=t[0])return i[0].evaluate(e);const n=t.length;return r>=t[n-1]?i[n-1].evaluate(e):i[$t(t,r)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}function Jt(e,t,i){return e*(1-i)+t*i}var Kt=Object.freeze({__proto__:null,number:Jt,color:function(e,t,i){return new st(Jt(e.r,t.r,i),Jt(e.g,t.g,i),Jt(e.b,t.b,i),Jt(e.a,t.a,i))},array:function(e,t,i){return e.map(((e,r)=>Jt(e,t[r],i)))}});const Qt=6/29*3*(6/29),ei=Math.PI/180,ti=180/Math.PI;function ii(e){return e>.008856451679035631?Math.pow(e,1/3):e/Qt+4/29}function ri(e){return e>6/29?e*e*e:Qt*(e-4/29)}function ni(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function ai(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function oi(e){const t=ai(e.r),i=ai(e.g),r=ai(e.b),n=ii((.4124564*t+.3575761*i+.1804375*r)/.95047),a=ii((.2126729*t+.7151522*i+.072175*r)/1);return{l:116*a-16,a:500*(n-a),b:200*(a-ii((.0193339*t+.119192*i+.9503041*r)/1.08883)),alpha:e.a}}function si(e){let t=(e.l+16)/116,i=isNaN(e.a)?t:t+e.a/500,r=isNaN(e.b)?t:t-e.b/200;return t=1*ri(t),i=.95047*ri(i),r=1.08883*ri(r),new st(ni(3.2404542*i-1.5371385*t-.4985314*r),ni(-.969266*i+1.8760108*t+.041556*r),ni(.0556434*i-.2040259*t+1.0572252*r),e.alpha)}function li(e,t,i){const r=t-e;return e+i*(r>180||r<-180?r-360*Math.round(r/360):r)}const ci={forward:oi,reverse:si,interpolate:function(e,t,i){return{l:Jt(e.l,t.l,i),a:Jt(e.a,t.a,i),b:Jt(e.b,t.b,i),alpha:Jt(e.alpha,t.alpha,i)}}},hi={forward:function(e){const{l:t,a:i,b:r}=oi(e),n=Math.atan2(r,i)*ti;return{h:n<0?n+360:n,c:Math.sqrt(i*i+r*r),l:t,alpha:e.a}},reverse:function(e){const t=e.h*ei,i=e.c;return si({l:e.l,a:Math.cos(t)*i,b:Math.sin(t)*i,alpha:e.alpha})},interpolate:function(e,t,i){return{h:li(e.h,t.h,i),c:Jt(e.c,t.c,i),l:Jt(e.l,t.l,i),alpha:Jt(e.alpha,t.alpha,i)}}};var ui=Object.freeze({__proto__:null,lab:ci,hcl:hi});class di{constructor(e,t,i,r,n){this.type=e,this.operator=t,this.interpolation=i,this.input=r,this.labels=[],this.outputs=[];for(const[e,t]of n)this.labels.push(e),this.outputs.push(t)}static interpolationFactor(e,i,r,n){let a=0;if("exponential"===e.name)a=pi(i,e.base,r,n);else if("linear"===e.name)a=pi(i,1,r,n);else if("cubic-bezier"===e.name){const o=e.controlPoints;a=new t(o[0],o[1],o[2],o[3]).solve(pi(i,1,r,n))}return a}static parse(e,t){let[i,r,n,...a]=e;if(!Array.isArray(r)||0===r.length)return t.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){const e=r[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:e}}else{if("cubic-bezier"!==r[0])return t.error(`Unknown interpolation type ${String(r[0])}`,1,0);{const e=r.slice(1);if(4!==e.length||e.some((e=>"number"!=typeof e||e<0||e>1)))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(n=t.parse(n,2,He),!n)return null;const o=[];let s=null;"interpolate-hcl"===i||"interpolate-lab"===i?s=Ze:t.expectedType&&"value"!==t.expectedType.kind&&(s=t.expectedType);for(let e=0;e<a.length;e+=2){const i=a[e],r=a[e+1],n=e+3,l=e+4;if("number"!=typeof i)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',n);if(o.length&&o[o.length-1][0]>=i)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',n);const c=t.parse(r,l,s);if(!c)return null;s=s||c.type,o.push([i,c])}return"number"===s.kind||"color"===s.kind||"array"===s.kind&&"number"===s.itemType.kind&&"number"==typeof s.N?new di(s,i,r,n,o):t.error(`Type ${et(s)} is not interpolatable.`)}evaluate(e){const t=this.labels,i=this.outputs;if(1===t.length)return i[0].evaluate(e);const r=this.input.evaluate(e);if(r<=t[0])return i[0].evaluate(e);const n=t.length;if(r>=t[n-1])return i[n-1].evaluate(e);const a=$t(t,r),o=di.interpolationFactor(this.interpolation,r,t[a],t[a+1]),s=i[a].evaluate(e),l=i[a+1].evaluate(e);return"interpolate"===this.operator?Kt[this.type.kind.toLowerCase()](s,l,o):"interpolate-hcl"===this.operator?hi.reverse(hi.interpolate(hi.forward(s),hi.forward(l),o)):ci.reverse(ci.interpolate(ci.forward(s),ci.forward(l),o))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let e=0;e<this.labels.length;e++)t.push(this.labels[e],this.outputs[e].serialize());return t}}function pi(e,t,i,r){const n=r-i,a=e-i;return 0===n?0:1===t?a/n:(Math.pow(t,a)-1)/(Math.pow(t,n)-1)}class fi{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let i=null;const r=t.expectedType;r&&"value"!==r.kind&&(i=r);const n=[];for(const r of e.slice(1)){const e=t.parse(r,1+n.length,i,void 0,{typeAnnotation:"omit"});if(!e)return null;i=i||e.type,n.push(e)}const a=r&&n.some((e=>it(r,e.type)));return new fi(a?$e:i,n)}evaluate(e){let t,i=null,r=0;for(const n of this.args)if(r++,i=n.evaluate(e),i&&i instanceof ut&&!i.available&&(t||(t=i.name),i=null,r===this.args.length&&(i=t)),null!==i)break;return i}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((t=>{e.push(t.serialize())})),e}}class mi{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const i=[];for(let r=1;r<e.length-1;r+=2){const n=e[r];if("string"!=typeof n)return t.error(`Expected string, but found ${typeof n} instead.`,r);if(/[^a-zA-Z0-9_]/.test(n))return t.error("Variable names must contain only alphanumeric characters or '_'.",r);const a=t.parse(e[r+1],r+1);if(!a)return null;i.push([n,a])}const r=t.parse(e[e.length-1],e.length-1,t.expectedType,i);return r?new mi(i,r):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,i]of this.bindings)e.push(t,i.serialize());return e.push(this.result.serialize()),e}}class gi{constructor(e,t,i){this.type=e,this.index=t,this.input=i}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,He),r=t.parse(e[2],2,Qe(t.expectedType||$e));return i&&r?new gi(r.type.itemType,i,r):null}evaluate(e){const t=this.index.evaluate(e),i=this.input.evaluate(e);if(t<0)throw new yt(`Array index out of bounds: ${t} < 0.`);if(t>=i.length)throw new yt(`Array index out of bounds: ${t} > ${i.length-1}.`);if(t!==Math.floor(t))throw new yt(`Array index must be an integer, but found ${t} instead.`);return i[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class yi{constructor(e,t){this.type=qe,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,$e),r=t.parse(e[2],2,$e);return i&&r?rt(i.type,[qe,We,He,Ge,$e])?new yi(i,r):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${et(i.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(!i)return!1;if(!nt(t,["boolean","string","number","null"]))throw new yt(`Expected first argument to be of type boolean, string, number or null, but found ${et(ft(t))} instead.`);if(!nt(i,["string","array"]))throw new yt(`Expected second argument to be of type array or string, but found ${et(ft(i))} instead.`);return i.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class vi{constructor(e,t,i){this.type=He,this.needle=e,this.haystack=t,this.fromIndex=i}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,$e),r=t.parse(e[2],2,$e);if(!i||!r)return null;if(!rt(i.type,[qe,We,He,Ge,$e]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${et(i.type)} instead`);if(4===e.length){const n=t.parse(e[3],3,He);return n?new vi(i,r,n):null}return new vi(i,r)}evaluate(e){const t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(!nt(t,["boolean","string","number","null"]))throw new yt(`Expected first argument to be of type boolean, string, number or null, but found ${et(ft(t))} instead.`);if(!nt(i,["string","array"]))throw new yt(`Expected second argument to be of type array or string, but found ${et(ft(i))} instead.`);if(this.fromIndex){const r=this.fromIndex.evaluate(e);return i.indexOf(t,r)}return i.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class _i{constructor(e,t,i,r,n,a){this.inputType=e,this.type=t,this.input=i,this.cases=r,this.outputs=n,this.otherwise=a}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let i,r;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);const n={},a=[];for(let o=2;o<e.length-1;o+=2){let s=e[o];const l=e[o+1];Array.isArray(s)||(s=[s]);const c=t.concat(o);if(0===s.length)return c.error("Expected at least one branch label.");for(const e of s){if("number"!=typeof e&&"string"!=typeof e)return c.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof e&&Math.floor(e)!==e)return c.error("Numeric branch labels must be integer values.");if(i){if(c.checkSubtype(i,ft(e)))return null}else i=ft(e);if(void 0!==n[String(e)])return c.error("Branch labels must be unique.");n[String(e)]=a.length}const h=t.parse(l,o,r);if(!h)return null;r=r||h.type,a.push(h)}const o=t.parse(e[1],1,$e);if(!o)return null;const s=t.parse(e[e.length-1],e.length-1,r);return s?"value"!==o.type.kind&&t.concat(1).checkSubtype(i,o.type)?null:new _i(i,r,o,n,a,s):null}evaluate(e){const t=this.input.evaluate(e);return(ft(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),i=[],r={};for(const e of t){const t=r[this.cases[e]];void 0===t?(r[this.cases[e]]=i.length,i.push([this.cases[e],[e]])):i[t][1].push(e)}const n=e=>"number"===this.inputType.kind?Number(e):e;for(const[t,r]of i)e.push(1===r.length?n(r[0]):r.map(n)),e.push(this.outputs[t].serialize());return e.push(this.otherwise.serialize()),e}}class xi{constructor(e,t,i){this.type=e,this.branches=t,this.otherwise=i}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let i;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);const r=[];for(let n=1;n<e.length-1;n+=2){const a=t.parse(e[n],n,qe);if(!a)return null;const o=t.parse(e[n+1],n+1,i);if(!o)return null;r.push([a,o]),i=i||o.type}const n=t.parse(e[e.length-1],e.length-1,i);return n?new xi(i,r,n):null}evaluate(e){for(const[t,i]of this.branches)if(t.evaluate(e))return i.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,i]of this.branches)e(t),e(i);e(this.otherwise)}outputDefined(){return this.branches.every((([e,t])=>t.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((t=>{e.push(t.serialize())})),e}}class bi{constructor(e,t,i,r){this.type=e,this.input=t,this.beginIndex=i,this.endIndex=r}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,$e),r=t.parse(e[2],2,He);if(!i||!r)return null;if(!rt(i.type,[Qe($e),We,$e]))return t.error(`Expected first argument to be of type array or string, but found ${et(i.type)} instead`);if(4===e.length){const n=t.parse(e[3],3,He);return n?new bi(i.type,i,r,n):null}return new bi(i.type,i,r)}evaluate(e){const t=this.input.evaluate(e),i=this.beginIndex.evaluate(e);if(!nt(t,["string","array"]))throw new yt(`Expected first argument to be of type array or string, but found ${et(ft(t))} instead.`);if(this.endIndex){const r=this.endIndex.evaluate(e);return t.slice(i,r)}return t.slice(i)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function wi(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function Mi(e,t,i,r){return 0===r.compare(t,i)}function Ti(e,t,i){const r="=="!==e&&"!="!==e;return class n{constructor(e,t,i){this.type=qe,this.lhs=e,this.rhs=t,this.collator=i,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const i=e[0];let a=t.parse(e[1],1,$e);if(!a)return null;if(!wi(i,a.type))return t.concat(1).error(`"${i}" comparisons are not supported for type '${et(a.type)}'.`);let o=t.parse(e[2],2,$e);if(!o)return null;if(!wi(i,o.type))return t.concat(2).error(`"${i}" comparisons are not supported for type '${et(o.type)}'.`);if(a.type.kind!==o.type.kind&&"value"!==a.type.kind&&"value"!==o.type.kind)return t.error(`Cannot compare types '${et(a.type)}' and '${et(o.type)}'.`);r&&("value"===a.type.kind&&"value"!==o.type.kind?a=new _t(o.type,[a]):"value"!==a.type.kind&&"value"===o.type.kind&&(o=new _t(a.type,[o])));let s=null;if(4===e.length){if("string"!==a.type.kind&&"string"!==o.type.kind&&"value"!==a.type.kind&&"value"!==o.type.kind)return t.error("Cannot use collator to compare non-string types.");if(s=t.parse(e[3],3,Ye),!s)return null}return new n(a,o,s)}evaluate(n){const a=this.lhs.evaluate(n),o=this.rhs.evaluate(n);if(r&&this.hasUntypedArgument){const t=ft(a),i=ft(o);if(t.kind!==i.kind||"string"!==t.kind&&"number"!==t.kind)throw new yt(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${t.kind}, ${i.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const e=ft(a),i=ft(o);if("string"!==e.kind||"string"!==i.kind)return t(n,a,o)}return this.collator?i(n,a,o,this.collator.evaluate(n)):t(n,a,o)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}serialize(){const t=[e];return this.eachChild((e=>{t.push(e.serialize())})),t}}}const Si=Ti("==",(function(e,t,i){return t===i}),Mi),Ei=Ti("!=",(function(e,t,i){return t!==i}),(function(e,t,i,r){return!Mi(0,t,i,r)})),Ai=Ti("<",(function(e,t,i){return t<i}),(function(e,t,i,r){return r.compare(t,i)<0})),Ci=Ti(">",(function(e,t,i){return t>i}),(function(e,t,i,r){return r.compare(t,i)>0})),Li=Ti("<=",(function(e,t,i){return t<=i}),(function(e,t,i,r){return r.compare(t,i)<=0}));class Pi{constructor(e,t,i,r,n){this.type=We,this.number=e,this.locale=t,this.currency=i,this.minFractionDigits=r,this.maxFractionDigits=n}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const i=t.parse(e[1],1,He);if(!i)return null;const r=e[2];if("object"!=typeof r||Array.isArray(r))return t.error("NumberFormat options argument must be an object.");let n=null;if(r.locale&&(n=t.parse(r.locale,1,We),!n))return null;let a=null;if(r.currency&&(a=t.parse(r.currency,1,We),!a))return null;let o=null;if(r["min-fraction-digits"]&&(o=t.parse(r["min-fraction-digits"],1,He),!o))return null;let s=null;return r["max-fraction-digits"]&&(s=t.parse(r["max-fraction-digits"],1,He),!s)?null:new Pi(i,n,a,o,s)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Ii{constructor(e){this.type=He,this.input=e}static parse(e,t){if(2!==e.length)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const i=t.parse(e[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?t.error(`Expected argument of type string or array, but found ${et(i.type)} instead.`):new Ii(i):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return t.length;if(Array.isArray(t))return t.length;throw new yt(`Expected value to be of type string or array, but found ${et(ft(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((t=>{e.push(t.serialize())})),e}}const Ri={"==":Si,"!=":Ei,">":Ci,"<":Ai,">=":Ti(">=",(function(e,t,i){return t>=i}),(function(e,t,i,r){return r.compare(t,i)>=0})),"<=":Li,array:_t,at:gi,boolean:_t,case:xi,coalesce:fi,collator:At,format:xt,image:bt,in:yi,"index-of":vi,interpolate:di,"interpolate-hcl":di,"interpolate-lab":di,length:Ii,let:mi,literal:gt,match:_i,number:_t,"number-format":Pi,object:_t,slice:bi,step:Yt,string:_t,"to-boolean":Mt,"to-color":Mt,"to-number":Mt,"to-string":Mt,var:Zt,within:Gt};function Di(e,[t,i,r,n]){t=t.evaluate(e),i=i.evaluate(e),r=r.evaluate(e);const a=n?n.evaluate(e):1,o=dt(t,i,r,a);if(o)throw new yt(o);return new st(t/255*a,i/255*a,r/255*a,a)}function ki(e,t){return e in t}function zi(e,t){const i=t[e];return void 0===i?null:i}function Oi(e){return{type:e}}function Bi(e){return{result:"success",value:e}}function Fi(e){return{result:"error",value:e}}function Ni(e){return"data-driven"===e["property-type"]||"cross-faded-data-driven"===e["property-type"]}function Ui(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function ji(e){return!!e.expression&&e.expression.interpolated}function Vi(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}function Gi(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function Hi(e){return e}function Wi(e,t,i){return void 0!==e?e:void 0!==t?t:void 0!==i?i:void 0}function qi(e,t,i,r,n){return Wi(typeof i===n?r[i]:void 0,e.default,t.default)}function Zi(e,t,i){if("number"!==Vi(i))return Wi(e.default,t.default);const r=e.stops.length;if(1===r)return e.stops[0][1];if(i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[r-1][0])return e.stops[r-1][1];const n=$t(e.stops.map((e=>e[0])),i);return e.stops[n][1]}function Xi(e,t,i){const r=void 0!==e.base?e.base:1;if("number"!==Vi(i))return Wi(e.default,t.default);const n=e.stops.length;if(1===n)return e.stops[0][1];if(i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[n-1][0])return e.stops[n-1][1];const a=$t(e.stops.map((e=>e[0])),i),o=function(e,t,i,r){const n=r-i,a=e-i;return 0===n?0:1===t?a/n:(Math.pow(t,a)-1)/(Math.pow(t,n)-1)}(i,r,e.stops[a][0],e.stops[a+1][0]),s=e.stops[a][1],l=e.stops[a+1][1];let c=Kt[t.type]||Hi;if(e.colorSpace&&"rgb"!==e.colorSpace){const t=ui[e.colorSpace];c=(e,i)=>t.reverse(t.interpolate(t.forward(e),t.forward(i),o))}return"function"==typeof s.evaluate?{evaluate(...e){const t=s.evaluate.apply(void 0,e),i=l.evaluate.apply(void 0,e);if(void 0!==t&&void 0!==i)return c(t,i,o)}}:c(s,l,o)}function $i(e,t,i){return"color"===t.type?i=st.parse(i):"formatted"===t.type?i=ht.fromString(i.toString()):"resolvedImage"===t.type?i=ut.fromString(i.toString()):Vi(i)===t.type||"enum"===t.type&&t.values[i]||(i=void 0),Wi(i,e.default,t.default)}Et.register(Ri,{error:[{kind:"error"},[We],(e,[t])=>{throw new yt(t.evaluate(e))}],typeof:[We,[$e],(e,[t])=>et(ft(t.evaluate(e)))],"to-rgba":[Qe(He,4),[Ze],(e,[t])=>t.evaluate(e).toArray()],rgb:[Ze,[He,He,He],Di],rgba:[Ze,[He,He,He,He],Di],has:{type:qe,overloads:[[[We],(e,[t])=>ki(t.evaluate(e),e.properties())],[[We,Xe],(e,[t,i])=>ki(t.evaluate(e),i.evaluate(e))]]},get:{type:$e,overloads:[[[We],(e,[t])=>zi(t.evaluate(e),e.properties())],[[We,Xe],(e,[t,i])=>zi(t.evaluate(e),i.evaluate(e))]]},"feature-state":[$e,[We],(e,[t])=>zi(t.evaluate(e),e.featureState||{})],properties:[Xe,[],e=>e.properties()],"geometry-type":[We,[],e=>e.geometryType()],id:[$e,[],e=>e.id()],zoom:[He,[],e=>e.globals.zoom],"heatmap-density":[He,[],e=>e.globals.heatmapDensity||0],"line-progress":[He,[],e=>e.globals.lineProgress||0],"sky-radial-progress":[He,[],e=>e.globals.skyRadialProgress||0],accumulated:[$e,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[He,Oi(He),(e,t)=>{let i=0;for(const r of t)i+=r.evaluate(e);return i}],"*":[He,Oi(He),(e,t)=>{let i=1;for(const r of t)i*=r.evaluate(e);return i}],"-":{type:He,overloads:[[[He,He],(e,[t,i])=>t.evaluate(e)-i.evaluate(e)],[[He],(e,[t])=>-t.evaluate(e)]]},"/":[He,[He,He],(e,[t,i])=>t.evaluate(e)/i.evaluate(e)],"%":[He,[He,He],(e,[t,i])=>t.evaluate(e)%i.evaluate(e)],ln2:[He,[],()=>Math.LN2],pi:[He,[],()=>Math.PI],e:[He,[],()=>Math.E],"^":[He,[He,He],(e,[t,i])=>Math.pow(t.evaluate(e),i.evaluate(e))],sqrt:[He,[He],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[He,[He],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[He,[He],(e,[t])=>Math.log(t.evaluate(e))],log2:[He,[He],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[He,[He],(e,[t])=>Math.sin(t.evaluate(e))],cos:[He,[He],(e,[t])=>Math.cos(t.evaluate(e))],tan:[He,[He],(e,[t])=>Math.tan(t.evaluate(e))],asin:[He,[He],(e,[t])=>Math.asin(t.evaluate(e))],acos:[He,[He],(e,[t])=>Math.acos(t.evaluate(e))],atan:[He,[He],(e,[t])=>Math.atan(t.evaluate(e))],min:[He,Oi(He),(e,t)=>Math.min(...t.map((t=>t.evaluate(e))))],max:[He,Oi(He),(e,t)=>Math.max(...t.map((t=>t.evaluate(e))))],abs:[He,[He],(e,[t])=>Math.abs(t.evaluate(e))],round:[He,[He],(e,[t])=>{const i=t.evaluate(e);return i<0?-Math.round(-i):Math.round(i)}],floor:[He,[He],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[He,[He],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[qe,[We,$e],(e,[t,i])=>e.properties()[t.value]===i.value],"filter-id-==":[qe,[$e],(e,[t])=>e.id()===t.value],"filter-type-==":[qe,[We],(e,[t])=>e.geometryType()===t.value],"filter-<":[qe,[We,$e],(e,[t,i])=>{const r=e.properties()[t.value],n=i.value;return typeof r==typeof n&&r<n}],"filter-id-<":[qe,[$e],(e,[t])=>{const i=e.id(),r=t.value;return typeof i==typeof r&&i<r}],"filter->":[qe,[We,$e],(e,[t,i])=>{const r=e.properties()[t.value],n=i.value;return typeof r==typeof n&&r>n}],"filter-id->":[qe,[$e],(e,[t])=>{const i=e.id(),r=t.value;return typeof i==typeof r&&i>r}],"filter-<=":[qe,[We,$e],(e,[t,i])=>{const r=e.properties()[t.value],n=i.value;return typeof r==typeof n&&r<=n}],"filter-id-<=":[qe,[$e],(e,[t])=>{const i=e.id(),r=t.value;return typeof i==typeof r&&i<=r}],"filter->=":[qe,[We,$e],(e,[t,i])=>{const r=e.properties()[t.value],n=i.value;return typeof r==typeof n&&r>=n}],"filter-id->=":[qe,[$e],(e,[t])=>{const i=e.id(),r=t.value;return typeof i==typeof r&&i>=r}],"filter-has":[qe,[$e],(e,[t])=>t.value in e.properties()],"filter-has-id":[qe,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[qe,[Qe(We)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[qe,[Qe($e)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[qe,[We,Qe($e)],(e,[t,i])=>i.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[qe,[We,Qe($e)],(e,[t,i])=>function(e,t,i,r){for(;i<=r;){const n=i+r>>1;if(t[n]===e)return!0;t[n]>e?r=n-1:i=n+1}return!1}(e.properties()[t.value],i.value,0,i.value.length-1)],all:{type:qe,overloads:[[[qe,qe],(e,[t,i])=>t.evaluate(e)&&i.evaluate(e)],[Oi(qe),(e,t)=>{for(const i of t)if(!i.evaluate(e))return!1;return!0}]]},any:{type:qe,overloads:[[[qe,qe],(e,[t,i])=>t.evaluate(e)||i.evaluate(e)],[Oi(qe),(e,t)=>{for(const i of t)if(i.evaluate(e))return!0;return!1}]]},"!":[qe,[qe],(e,[t])=>!t.evaluate(e)],"is-supported-script":[qe,[We],(e,[t])=>{const i=e.globals&&e.globals.isSupportedScript;return!i||i(t.evaluate(e))}],upcase:[We,[We],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[We,[We],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[We,Oi($e),(e,t)=>t.map((t=>mt(t.evaluate(e)))).join("")],"resolved-locale":[We,[Ye],(e,[t])=>t.evaluate(e).resolvedLocale()]});class Yi{constructor(e,t){this.expression=e,this._warningHistory={},this._evaluator=new St,this._defaultValue=t?function(e){return"color"===e.type&&Gi(e.default)?new st(0,0,0,0):"color"===e.type?st.parse(e.default)||null:void 0===e.default?null:e.default}(t):null,this._enumValues=t&&"enum"===t.type?t.values:null}evaluateWithoutErrorHandling(e,t,i,r,n,a){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=i,this._evaluator.canonical=r,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=a,this.expression.evaluate(this._evaluator)}evaluate(e,t,i,r,n,a){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=i||null,this._evaluator.canonical=r,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=a||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new yt(`Expected value to be one of ${Object.keys(this._enumValues).map((e=>JSON.stringify(e))).join(", ")}, but found ${JSON.stringify(e)} instead.`);return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}function Ji(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in Ri}function Ki(e,t){const i=new Xt(Ri,[],t?function(e){const t={color:Ze,string:We,number:He,enum:We,boolean:qe,formatted:Je,resolvedImage:Ke};return"array"===e.type?Qe(t[e.value]||$e,e.length):t[e.type]}(t):void 0),r=i.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return r?Bi(new Yi(r,t)):Fi(i.errors)}class Qi{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent="constant"!==e&&!Wt(t.expression)}evaluateWithoutErrorHandling(e,t,i,r,n,a){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,r,n,a)}evaluate(e,t,i,r,n,a){return this._styleExpression.evaluate(e,t,i,r,n,a)}}class er{constructor(e,t,i,r){this.kind=e,this.zoomStops=i,this._styleExpression=t,this.isStateDependent="camera"!==e&&!Wt(t.expression),this.interpolationType=r}evaluateWithoutErrorHandling(e,t,i,r,n,a){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,r,n,a)}evaluate(e,t,i,r,n,a){return this._styleExpression.evaluate(e,t,i,r,n,a)}interpolationFactor(e,t,i){return this.interpolationType?di.interpolationFactor(this.interpolationType,e,t,i):0}}function tr(e,t){if("error"===(e=Ki(e,t)).result)return e;const i=e.value.expression,r=Ht(i);if(!r&&!Ni(t))return Fi([new je("","data expressions not supported")]);const n=qt(i,["zoom"]);if(!n&&!Ui(t))return Fi([new je("","zoom expressions not supported")]);const a=function e(t){let i=null;if(t instanceof mi)i=e(t.result);else if(t instanceof fi){for(const r of t.args)if(i=e(r),i)break}else(t instanceof Yt||t instanceof di)&&t.input instanceof Et&&"zoom"===t.input.name&&(i=t);return i instanceof je||t.eachChild((t=>{const r=e(t);r instanceof je?i=r:!i&&r?i=new je("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&r&&i!==r&&(i=new je("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),i}(i);return a||n?a instanceof je?Fi([a]):a instanceof di&&!ji(t)?Fi([new je("",'"interpolate" expressions cannot be used with this property')]):Bi(a?new er(r?"camera":"composite",e.value,a.labels,a instanceof di?a.interpolation:void 0):new Qi(r?"constant":"source",e.value)):Fi([new je("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ir{constructor(e,t){this._parameters=e,this._specification=t,Fe(this,function e(t,i){const r="color"===i.type,n=t.stops&&"object"==typeof t.stops[0][0],a=n||!(n||void 0!==t.property),o=t.type||(ji(i)?"exponential":"interval");if(r&&((t=Fe({},t)).stops&&(t.stops=t.stops.map((e=>[e[0],st.parse(e[1])]))),t.default=st.parse(t.default?t.default:i.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!ui[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let s,l,c;if("exponential"===o)s=Xi;else if("interval"===o)s=Zi;else if("categorical"===o){s=qi,l=Object.create(null);for(const e of t.stops)l[e[0]]=e[1];c=typeof t.stops[0][0]}else{if("identity"!==o)throw new Error(`Unknown function type "${o}"`);s=$i}if(n){const r={},n=[];for(let e=0;e<t.stops.length;e++){const i=t.stops[e],a=i[0].zoom;void 0===r[a]&&(r[a]={zoom:a,type:t.type,property:t.property,default:t.default,stops:[]},n.push(a)),r[a].stops.push([i[0].value,i[1]])}const a=[];for(const t of n)a.push([r[t].zoom,e(r[t],i)]);const o={name:"linear"};return{kind:"composite",interpolationType:o,interpolationFactor:di.interpolationFactor.bind(void 0,o),zoomStops:a.map((e=>e[0])),evaluate:({zoom:e},r)=>Xi({stops:a,base:t.base},i,e).evaluate(e,r)}}if(a){const e="exponential"===o?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:e,interpolationFactor:di.interpolationFactor.bind(void 0,e),zoomStops:t.stops.map((e=>e[0])),evaluate:({zoom:e})=>s(t,i,e,l,c)}}return{kind:"source",evaluate(e,r){const n=r&&r.properties?r.properties[t.property]:void 0;return void 0===n?Wi(t.default,i.default):s(t,i,n,l,c)}}}(this._parameters,this._specification))}static deserialize(e){return new ir(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function rr(e){const t=e.key,i=e.value,r=e.valueSpec||{},n=e.objectElementValidators||{},a=e.style,o=e.styleSpec;let s=[];const l=Vi(i);if("object"!==l)return[new Oe(t,i,`object expected, ${l} found`)];for(const e in i){const l=e.split(".")[0],c=r[l]||r["*"];let h;if(n[l])h=n[l];else if(r[l])h=Lr;else if(n["*"])h=n["*"];else{if(!r["*"]){s.push(new Oe(t,i[e],`unknown property "${e}"`));continue}h=Lr}s=s.concat(h({key:(t?`${t}.`:t)+e,value:i[e],valueSpec:c,style:a,styleSpec:o,object:i,objectKey:e},i))}for(const e in r)n[e]||r[e].required&&void 0===r[e].default&&void 0===i[e]&&s.push(new Oe(t,i,`missing required property "${e}"`));return s}function nr(e){const t=e.value,i=e.valueSpec,r=e.style,n=e.styleSpec,a=e.key,o=e.arrayElementValidator||Lr;if("array"!==Vi(t))return[new Oe(a,t,`array expected, ${Vi(t)} found`)];if(i.length&&t.length!==i.length)return[new Oe(a,t,`array length ${i.length} expected, length ${t.length} found`)];if(i["min-length"]&&t.length<i["min-length"])return[new Oe(a,t,`array length at least ${i["min-length"]} expected, length ${t.length} found`)];let s={type:i.value,values:i.values};n.$version<7&&(s.function=i.function),"object"===Vi(i.value)&&(s=i.value);let l=[];for(let e=0;e<t.length;e++)l=l.concat(o({array:t,arrayIndex:e,value:t[e],valueSpec:s,style:r,styleSpec:n,key:`${a}[${e}]`}));return l}function ar(e){const t=e.key,i=e.value,r=e.valueSpec;let n=Vi(i);return"number"===n&&i!=i&&(n="NaN"),"number"!==n?[new Oe(t,i,`number expected, ${n} found`)]:"minimum"in r&&i<r.minimum?[new Oe(t,i,`${i} is less than the minimum value ${r.minimum}`)]:"maximum"in r&&i>r.maximum?[new Oe(t,i,`${i} is greater than the maximum value ${r.maximum}`)]:[]}function or(e){const t=e.valueSpec,i=Ne(e.value.type);let r,n,a,o={};const s="categorical"!==i&&void 0===e.value.property,l=!s,c="array"===Vi(e.value.stops)&&"array"===Vi(e.value.stops[0])&&"object"===Vi(e.value.stops[0][0]),h=rr({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===i)return[new Oe(e.key,e.value,'identity function may not have a "stops" property')];let t=[];const r=e.value;return t=t.concat(nr({key:e.key,value:r,valueSpec:e.valueSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:u})),"array"===Vi(r)&&0===r.length&&t.push(new Oe(e.key,r,"array must have at least one stop")),t},default:function(e){return Lr({key:e.key,value:e.value,valueSpec:t,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===i&&s&&h.push(new Oe(e.key,e.value,'missing required property "property"')),"identity"===i||e.value.stops||h.push(new Oe(e.key,e.value,'missing required property "stops"')),"exponential"===i&&e.valueSpec.expression&&!ji(e.valueSpec)&&h.push(new Oe(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(l&&!Ni(e.valueSpec)?h.push(new Oe(e.key,e.value,"property functions not supported")):s&&!Ui(e.valueSpec)&&h.push(new Oe(e.key,e.value,"zoom functions not supported"))),"categorical"!==i&&!c||void 0!==e.value.property||h.push(new Oe(e.key,e.value,'"property" property is required')),h;function u(e){let i=[];const r=e.value,s=e.key;if("array"!==Vi(r))return[new Oe(s,r,`array expected, ${Vi(r)} found`)];if(2!==r.length)return[new Oe(s,r,`array length 2 expected, length ${r.length} found`)];if(c){if("object"!==Vi(r[0]))return[new Oe(s,r,`object expected, ${Vi(r[0])} found`)];if(void 0===r[0].zoom)return[new Oe(s,r,"object stop key must have zoom")];if(void 0===r[0].value)return[new Oe(s,r,"object stop key must have value")];if(a&&a>Ne(r[0].zoom))return[new Oe(s,r[0].zoom,"stop zoom values must appear in ascending order")];Ne(r[0].zoom)!==a&&(a=Ne(r[0].zoom),n=void 0,o={}),i=i.concat(rr({key:`${s}[0]`,value:r[0],valueSpec:{zoom:{}},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:ar,value:d}}))}else i=i.concat(d({key:`${s}[0]`,value:r[0],valueSpec:{},style:e.style,styleSpec:e.styleSpec},r));return Ji(Ue(r[1]))?i.concat([new Oe(`${s}[1]`,r[1],"expressions are not allowed in function stops.")]):i.concat(Lr({key:`${s}[1]`,value:r[1],valueSpec:t,style:e.style,styleSpec:e.styleSpec}))}function d(e,a){const s=Vi(e.value),l=Ne(e.value),c=null!==e.value?e.value:a;if(r){if(s!==r)return[new Oe(e.key,c,`${s} stop domain type must match previous stop domain type ${r}`)]}else r=s;if("number"!==s&&"string"!==s&&"boolean"!==s)return[new Oe(e.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==s&&"categorical"!==i){let r=`number expected, ${s} found`;return Ni(t)&&void 0===i&&(r+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Oe(e.key,c,r)]}return"categorical"!==i||"number"!==s||isFinite(l)&&Math.floor(l)===l?"categorical"!==i&&"number"===s&&void 0!==n&&l<n?[new Oe(e.key,c,"stop domain values must appear in ascending order")]:(n=l,"categorical"===i&&l in o?[new Oe(e.key,c,"stop domain values must be unique")]:(o[l]=!0,[])):[new Oe(e.key,c,`integer expected, found ${l}`)]}}function sr(e){const t=("property"===e.expressionContext?tr:Ki)(Ue(e.value),e.valueSpec);if("error"===t.result)return t.value.map((t=>new Oe(`${e.key}${t.key}`,e.value,t.message)));const i=t.value.expression||t.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!i.outputDefined())return[new Oe(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===e.expressionContext&&"layout"===e.propertyType&&!Wt(i))return[new Oe(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext&&!Wt(i))return[new Oe(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!qt(i,["zoom","feature-state"]))return[new Oe(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!Ht(i))return[new Oe(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function lr(e){const t=e.key,i=e.value,r=e.valueSpec,n=[];return Array.isArray(r.values)?-1===r.values.indexOf(Ne(i))&&n.push(new Oe(t,i,`expected one of [${r.values.join(", ")}], ${JSON.stringify(i)} found`)):-1===Object.keys(r.values).indexOf(Ne(i))&&n.push(new Oe(t,i,`expected one of [${Object.keys(r.values).join(", ")}], ${JSON.stringify(i)} found`)),n}function cr(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!cr(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}const hr={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ur(e){if(null==e)return{filter:()=>!0,needGeometry:!1};cr(e)||(e=pr(e));const t=Ki(e,hr);if("error"===t.result)throw new Error(t.value.map((e=>`${e.key}: ${e.message}`)).join(", "));return{filter:(e,i,r)=>t.value.evaluate(e,i,{},r),needGeometry:function e(t){if(!Array.isArray(t))return!1;if("within"===t[0])return!0;for(let i=1;i<t.length;i++)if(e(t[i]))return!0;return!1}(e)}}function dr(e,t){return e<t?-1:e>t?1:0}function pr(e){if(!e)return!0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?fr(e[1],e[2],"=="):"!="===t?yr(fr(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?fr(e[1],e[2],t):"any"===t?(i=e.slice(1),["any"].concat(i.map(pr))):"all"===t?["all"].concat(e.slice(1).map(pr)):"none"===t?["all"].concat(e.slice(1).map(pr).map(yr)):"in"===t?mr(e[1],e.slice(2)):"!in"===t?yr(mr(e[1],e.slice(2))):"has"===t?gr(e[1]):"!has"===t?yr(gr(e[1])):"within"!==t||e;var i}function fr(e,t,i){switch(e){case"$type":return[`filter-type-${i}`,t];case"$id":return[`filter-id-${i}`,t];default:return[`filter-${i}`,e,t]}}function mr(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((e=>typeof e!=typeof t[0]))?["filter-in-large",e,["literal",t.sort(dr)]]:["filter-in-small",e,["literal",t]]}}function gr(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function yr(e){return["!",e]}function vr(e){return cr(Ue(e.value))?sr(Fe({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function e(t){const i=t.value,r=t.key;if("array"!==Vi(i))return[new Oe(r,i,`array expected, ${Vi(i)} found`)];const n=t.styleSpec;let a,o=[];if(i.length<1)return[new Oe(r,i,"filter array must have at least 1 element")];switch(o=o.concat(lr({key:`${r}[0]`,value:i[0],valueSpec:n.filter_operator,style:t.style,styleSpec:t.styleSpec})),Ne(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&"$type"===Ne(i[1])&&o.push(new Oe(r,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":3!==i.length&&o.push(new Oe(r,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(a=Vi(i[1]),"string"!==a&&o.push(new Oe(`${r}[1]`,i[1],`string expected, ${a} found`)));for(let e=2;e<i.length;e++)a=Vi(i[e]),"$type"===Ne(i[1])?o=o.concat(lr({key:`${r}[${e}]`,value:i[e],valueSpec:n.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==a&&"number"!==a&&"boolean"!==a&&o.push(new Oe(`${r}[${e}]`,i[e],`string, number, or boolean expected, ${a} found`));break;case"any":case"all":case"none":for(let n=1;n<i.length;n++)o=o.concat(e({key:`${r}[${n}]`,value:i[n],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":a=Vi(i[1]),2!==i.length?o.push(new Oe(r,i,`filter array for "${i[0]}" operator must have 2 elements`)):"string"!==a&&o.push(new Oe(`${r}[1]`,i[1],`string expected, ${a} found`));break;case"within":a=Vi(i[1]),2!==i.length?o.push(new Oe(r,i,`filter array for "${i[0]}" operator must have 2 elements`)):"object"!==a&&o.push(new Oe(`${r}[1]`,i[1],`object expected, ${a} found`))}return o}(e)}function _r(e,t){const i=e.key,r=e.style,n=e.styleSpec,a=e.value,o=e.objectKey,s=n[`${t}_${e.layerType}`];if(!s)return[];const l=o.match(/^(.*)-transition$/);if("paint"===t&&l&&s[l[1]]&&s[l[1]].transition)return Lr({key:i,value:a,valueSpec:n.transition,style:r,styleSpec:n});const c=e.valueSpec||s[o];if(!c)return[new Oe(i,a,`unknown property "${o}"`)];let h;if("string"===Vi(a)&&Ni(c)&&!c.tokens&&(h=/^{([^}]+)}$/.exec(a)))return[new Oe(i,a,`"${o}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(h[1])} }\`.`)];const u=[];return"symbol"===e.layerType&&("text-field"===o&&r&&!r.glyphs&&u.push(new Oe(i,a,'use of "text-field" requires a style "glyphs" property')),"text-font"===o&&Gi(Ue(a))&&"identity"===Ne(a.type)&&u.push(new Oe(i,a,'"text-font" does not support identity functions'))),u.concat(Lr({key:e.key,value:a,valueSpec:c,style:r,styleSpec:n,expressionContext:"property",propertyType:t,propertyKey:o}))}function xr(e){return _r(e,"paint")}function br(e){return _r(e,"layout")}function wr(e){let t=[];const i=e.value,r=e.key,n=e.style,a=e.styleSpec;i.type||i.ref||t.push(new Oe(r,i,'either "type" or "ref" is required'));let o=Ne(i.type);const s=Ne(i.ref);if(i.id){const a=Ne(i.id);for(let o=0;o<e.arrayIndex;o++){const e=n.layers[o];Ne(e.id)===a&&t.push(new Oe(r,i.id,`duplicate layer id "${i.id}", previously used at line ${e.id.__line__}`))}}if("ref"in i){let e;["type","source","source-layer","filter","layout"].forEach((e=>{e in i&&t.push(new Oe(r,i[e],`"${e}" is prohibited for ref layers`))})),n.layers.forEach((t=>{Ne(t.id)===s&&(e=t)})),e?e.ref?t.push(new Oe(r,i.ref,"ref cannot reference another ref layer")):o=Ne(e.type):t.push(new Oe(r,i.ref,`ref layer "${s}" not found`))}else if("background"!==o&&"sky"!==o)if(i.source){const e=n.sources&&n.sources[i.source],a=e&&Ne(e.type);e?"vector"===a&&"raster"===o?t.push(new Oe(r,i.source,`layer "${i.id}" requires a raster source`)):"raster"===a&&"raster"!==o?t.push(new Oe(r,i.source,`layer "${i.id}" requires a vector source`)):"vector"!==a||i["source-layer"]?"raster-dem"===a&&"hillshade"!==o?t.push(new Oe(r,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==o||!i.paint||!i.paint["line-gradient"]||"geojson"===a&&e.lineMetrics||t.push(new Oe(r,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Oe(r,i,`layer "${i.id}" must specify a "source-layer"`)):t.push(new Oe(r,i.source,`source "${i.source}" not found`))}else t.push(new Oe(r,i,'missing required property "source"'));return t=t.concat(rr({key:r,value:i,valueSpec:a.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Lr({key:`${r}.type`,value:i.type,valueSpec:a.layer.type,style:e.style,styleSpec:e.styleSpec,object:i,objectKey:"type"}),filter:vr,layout:e=>rr({layer:i,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>br(Fe({layerType:o},e))}}),paint:e=>rr({layer:i,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>xr(Fe({layerType:o},e))}})}})),t}function Mr(e){const t=e.value,i=e.key,r=Vi(t);return"string"!==r?[new Oe(i,t,`string expected, ${r} found`)]:[]}const Tr={promoteId:function({key:e,value:t}){if("string"===Vi(t))return Mr({key:e,value:t});{const i=[];for(const r in t)i.push(...Mr({key:`${e}.${r}`,value:t[r]}));return i}}};function Sr(e){const t=e.value,i=e.key,r=e.styleSpec,n=e.style;if(!t.type)return[new Oe(i,t,'"type" is required')];const a=Ne(t.type);let o;switch(a){case"vector":case"raster":case"raster-dem":return o=rr({key:i,value:t,valueSpec:r[`source_${a.replace("-","_")}`],style:e.style,styleSpec:r,objectElementValidators:Tr}),o;case"geojson":if(o=rr({key:i,value:t,valueSpec:r.source_geojson,style:n,styleSpec:r,objectElementValidators:Tr}),t.cluster)for(const e in t.clusterProperties){const[r,n]=t.clusterProperties[e],a="string"==typeof r?[r,["accumulated"],["get",e]]:r;o.push(...sr({key:`${i}.${e}.map`,value:n,expressionContext:"cluster-map"})),o.push(...sr({key:`${i}.${e}.reduce`,value:a,expressionContext:"cluster-reduce"}))}return o;case"video":return rr({key:i,value:t,valueSpec:r.source_video,style:n,styleSpec:r});case"image":return rr({key:i,value:t,valueSpec:r.source_image,style:n,styleSpec:r});case"canvas":return[new Oe(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return lr({key:`${i}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:n,styleSpec:r})}}function Er(e){const t=e.value,i=e.styleSpec,r=i.light,n=e.style;let a=[];const o=Vi(t);if(void 0===t)return a;if("object"!==o)return a=a.concat([new Oe("light",t,`object expected, ${o} found`)]),a;for(const e in t){const o=e.match(/^(.*)-transition$/);a=a.concat(o&&r[o[1]]&&r[o[1]].transition?Lr({key:e,value:t[e],valueSpec:i.transition,style:n,styleSpec:i}):r[e]?Lr({key:e,value:t[e],valueSpec:r[e],style:n,styleSpec:i}):[new Oe(e,t[e],`unknown property "${e}"`)])}return a}function Ar(e){const t=e.value,i=e.key,r=e.style,n=e.styleSpec,a=n.terrain;let o=[];const s=Vi(t);if(void 0===t)return o;if("object"!==s)return o=o.concat([new Oe("terrain",t,`object expected, ${s} found`)]),o;for(const e in t){const i=e.match(/^(.*)-transition$/);o=o.concat(i&&a[i[1]]&&a[i[1]].transition?Lr({key:e,value:t[e],valueSpec:n.transition,style:r,styleSpec:n}):a[e]?Lr({key:e,value:t[e],valueSpec:a[e],style:r,styleSpec:n}):[new Oe(e,t[e],`unknown property "${e}"`)])}if(t.source){const e=r.sources&&r.sources[t.source],n=e&&Ne(e.type);e?"raster-dem"!==n&&o.push(new Oe(i,t.source,`terrain cannot be used with a source of type ${n}, it only be used with a "raster-dem" source type`)):o.push(new Oe(i,t.source,`source "${t.source}" not found`))}else o.push(new Oe(i,t,'terrain is missing required property "source"'));return o}const Cr={"*":()=>[],array:nr,boolean:function(e){const t=e.value,i=e.key,r=Vi(t);return"boolean"!==r?[new Oe(i,t,`boolean expected, ${r} found`)]:[]},number:ar,color:function(e){const t=e.key,i=e.value,r=Vi(i);return"string"!==r?[new Oe(t,i,`color expected, ${r} found`)]:null===ot(i)?[new Oe(t,i,`color expected, "${i}" found`)]:[]},constants:Be,enum:lr,filter:vr,function:or,layer:wr,object:rr,source:Sr,light:Er,terrain:Ar,string:Mr,formatted:function(e){return 0===Mr(e).length?[]:sr(e)},resolvedImage:function(e){return 0===Mr(e).length?[]:sr(e)}};function Lr(e){const t=e.value,i=e.valueSpec,r=e.styleSpec;return i.expression&&Gi(Ne(t))?or(e):i.expression&&Ji(Ue(t))?sr(e):i.type&&Cr[i.type]?Cr[i.type](e):rr(Fe({},e,{valueSpec:i.type?r[i.type]:i}))}function Pr(e){const t=e.value,i=e.key,r=Mr(e);return r.length||(-1===t.indexOf("{fontstack}")&&r.push(new Oe(i,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&r.push(new Oe(i,t,'"glyphs" url must include a "{range}" token'))),r}function Ir(e,t=ze){let i=[];return i=i.concat(Lr({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:Pr,"*":()=>[]}})),e.constants&&(i=i.concat(Be({key:"constants",value:e.constants,style:e,styleSpec:t}))),Rr(i)}function Rr(e){return[].concat(e).sort(((e,t)=>e.line-t.line))}function Dr(e){return function(...t){return Rr(e.apply(this,t))}}Ir.source=Dr(Sr),Ir.light=Dr(Er),Ir.terrain=Dr(Ar),Ir.layer=Dr(wr),Ir.filter=Dr(vr),Ir.paintProperty=Dr(xr),Ir.layoutProperty=Dr(br);const kr=Ir,zr=kr.light,Or=kr.paintProperty,Br=kr.layoutProperty;function Fr(e,t){let i=!1;if(t&&t.length)for(const r of t)e.fire(new De(new Error(r.message))),i=!0;return i}var Nr=Ur;function Ur(e,t,i){var r=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var n=new Int32Array(this.arrayBuffer);e=n[0],this.d=(t=n[1])+2*(i=n[2]);for(var a=0;a<this.d*this.d;a++){var o=n[3+a],s=n[3+a+1];r.push(o===s?null:n.subarray(o,s))}var l=n[3+r.length+1];this.keys=n.subarray(n[3+r.length],l),this.bboxes=n.subarray(l),this.insert=this._insertReadonly}else{this.d=t+2*i;for(var c=0;c<this.d*this.d;c++)r.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=i,this.scale=t/e,this.uid=0;var h=i/t*e;this.min=-h,this.max=e+h}Ur.prototype.insert=function(e,t,i,r,n){this._forEachCell(t,i,r,n,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n)},Ur.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ur.prototype._insertCell=function(e,t,i,r,n,a){this.cells[n].push(a)},Ur.prototype.query=function(e,t,i,r,n){var a=this.min,o=this.max;if(e<=a&&t<=a&&o<=i&&o<=r&&!n)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(e,t,i,r,this._queryCell,s,{},n),s},Ur.prototype._queryCell=function(e,t,i,r,n,a,o,s){var l=this.cells[n];if(null!==l)for(var c=this.keys,h=this.bboxes,u=0;u<l.length;u++){var d=l[u];if(void 0===o[d]){var p=4*d;(s?s(h[p+0],h[p+1],h[p+2],h[p+3]):e<=h[p+2]&&t<=h[p+3]&&i>=h[p+0]&&r>=h[p+1])?(o[d]=!0,a.push(c[d])):o[d]=!1}}},Ur.prototype._forEachCell=function(e,t,i,r,n,a,o,s){for(var l=this._convertToCellCoord(e),c=this._convertToCellCoord(t),h=this._convertToCellCoord(i),u=this._convertToCellCoord(r),d=l;d<=h;d++)for(var p=c;p<=u;p++){var f=this.d*p+d;if((!s||s(this._convertFromCellCoord(d),this._convertFromCellCoord(p),this._convertFromCellCoord(d+1),this._convertFromCellCoord(p+1)))&&n.call(this,e,t,i,r,f,a,o,s))return}},Ur.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},Ur.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},Ur.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=3+this.cells.length+1+1,i=0,r=0;r<this.cells.length;r++)i+=this.cells[r].length;var n=new Int32Array(t+i+this.keys.length+this.bboxes.length);n[0]=this.extent,n[1]=this.n,n[2]=this.padding;for(var a=t,o=0;o<e.length;o++){var s=e[o];n[3+o]=a,n.set(s,a),a+=s.length}return n[3+e.length]=a,n.set(this.keys,a),n[3+e.length+1]=a+=this.keys.length,n.set(this.bboxes,a),a+=this.bboxes.length,n.buffer};const{ImageData:jr,ImageBitmap:Vr}=a,Gr={};function Hr(e,t,i={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),Gr[e]={klass:t,omit:i.omit||[],shallow:i.shallow||[]}}Hr("Object",Object),Nr.serialize=function(e,t){const i=e.toArrayBuffer();return t&&t.push(i),{buffer:i}},Nr.deserialize=function(e){return new Nr(e.buffer)},Hr("Grid",Nr),Hr("Color",st),Hr("Error",Error),Hr("ResolvedImage",ut),Hr("StylePropertyFunction",ir),Hr("StyleExpression",Yi,{omit:["_evaluator"]}),Hr("ZoomDependentExpression",er),Hr("ZoomConstantExpression",Qi),Hr("CompoundExpression",Et,{omit:["_evaluate"]});for(const e in Ri)Ri[e]._classRegistryKey||Hr(`Expression_${e}`,Ri[e]);function Wr(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function qr(e){return Vr&&e instanceof Vr}function Zr(e,t){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(Wr(e)||qr(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){const i=e;return t&&t.push(i.buffer),i}if(e instanceof jr)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){const i=[];for(const r of e)i.push(Zr(r,t));return i}if("object"==typeof e){const i=e.constructor,r=i._classRegistryKey;if(!r)throw new Error("can't serialize object of unregistered class");const n=i.serialize?i.serialize(e,t):{};if(!i.serialize){for(const i in e){if(!e.hasOwnProperty(i))continue;if(Gr[r].omit.indexOf(i)>=0)continue;const a=e[i];n[i]=Gr[r].shallow.indexOf(i)>=0?a:Zr(a,t)}e instanceof Error&&(n.message=e.message)}if(n.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==r&&(n.$name=r),n}throw new Error("can't serialize object of type "+typeof e)}function Xr(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||Wr(e)||qr(e)||ArrayBuffer.isView(e)||e instanceof jr)return e;if(Array.isArray(e))return e.map(Xr);if("object"==typeof e){const t=e.$name||"Object",{klass:i}=Gr[t];if(!i)throw new Error(`can't deserialize unregistered class ${t}`);if(i.deserialize)return i.deserialize(e);const r=Object.create(i.prototype);for(const i of Object.keys(e)){if("$name"===i)continue;const n=e[i];r[i]=Gr[t].shallow.indexOf(i)>=0?n:Xr(n)}return r}throw new Error("can't deserialize object of type "+typeof e)}class $r{constructor(){this.first=!0}update(e,t){const i=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=i,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=i,!0):(this.lastFloorZoom>i?(this.lastIntegerZoom=i+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<i&&(this.lastIntegerZoom=i,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=i,!0))}}const Yr={"Latin-1 Supplement":e=>e>=128&&e<=255,Arabic:e=>e>=1536&&e<=1791,"Arabic Supplement":e=>e>=1872&&e<=1919,"Arabic Extended-A":e=>e>=2208&&e<=2303,"Hangul Jamo":e=>e>=4352&&e<=4607,"Unified Canadian Aboriginal Syllabics":e=>e>=5120&&e<=5759,Khmer:e=>e>=6016&&e<=6143,"Unified Canadian Aboriginal Syllabics Extended":e=>e>=6320&&e<=6399,"General Punctuation":e=>e>=8192&&e<=8303,"Letterlike Symbols":e=>e>=8448&&e<=8527,"Number Forms":e=>e>=8528&&e<=8591,"Miscellaneous Technical":e=>e>=8960&&e<=9215,"Control Pictures":e=>e>=9216&&e<=9279,"Optical Character Recognition":e=>e>=9280&&e<=9311,"Enclosed Alphanumerics":e=>e>=9312&&e<=9471,"Geometric Shapes":e=>e>=9632&&e<=9727,"Miscellaneous Symbols":e=>e>=9728&&e<=9983,"Miscellaneous Symbols and Arrows":e=>e>=11008&&e<=11263,"CJK Radicals Supplement":e=>e>=11904&&e<=12031,"Kangxi Radicals":e=>e>=12032&&e<=12255,"Ideographic Description Characters":e=>e>=12272&&e<=12287,"CJK Symbols and Punctuation":e=>e>=12288&&e<=12351,Hiragana:e=>e>=12352&&e<=12447,Katakana:e=>e>=12448&&e<=12543,Bopomofo:e=>e>=12544&&e<=12591,"Hangul Compatibility Jamo":e=>e>=12592&&e<=12687,Kanbun:e=>e>=12688&&e<=12703,"Bopomofo Extended":e=>e>=12704&&e<=12735,"CJK Strokes":e=>e>=12736&&e<=12783,"Katakana Phonetic Extensions":e=>e>=12784&&e<=12799,"Enclosed CJK Letters and Months":e=>e>=12800&&e<=13055,"CJK Compatibility":e=>e>=13056&&e<=13311,"CJK Unified Ideographs Extension A":e=>e>=13312&&e<=19903,"Yijing Hexagram Symbols":e=>e>=19904&&e<=19967,"CJK Unified Ideographs":e=>e>=19968&&e<=40959,"Yi Syllables":e=>e>=40960&&e<=42127,"Yi Radicals":e=>e>=42128&&e<=42191,"Hangul Jamo Extended-A":e=>e>=43360&&e<=43391,"Hangul Syllables":e=>e>=44032&&e<=55215,"Hangul Jamo Extended-B":e=>e>=55216&&e<=55295,"Private Use Area":e=>e>=57344&&e<=63743,"CJK Compatibility Ideographs":e=>e>=63744&&e<=64255,"Arabic Presentation Forms-A":e=>e>=64336&&e<=65023,"Vertical Forms":e=>e>=65040&&e<=65055,"CJK Compatibility Forms":e=>e>=65072&&e<=65103,"Small Form Variants":e=>e>=65104&&e<=65135,"Arabic Presentation Forms-B":e=>e>=65136&&e<=65279,"Halfwidth and Fullwidth Forms":e=>e>=65280&&e<=65519};function Jr(e){for(const t of e)if(en(t.charCodeAt(0)))return!0;return!1}function Kr(e){for(const t of e)if(!Qr(t.charCodeAt(0)))return!1;return!0}function Qr(e){return!(Yr.Arabic(e)||Yr["Arabic Supplement"](e)||Yr["Arabic Extended-A"](e)||Yr["Arabic Presentation Forms-A"](e)||Yr["Arabic Presentation Forms-B"](e))}function en(e){return!(746!==e&&747!==e&&(e<4352||!(Yr["Bopomofo Extended"](e)||Yr.Bopomofo(e)||Yr["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||Yr["CJK Compatibility Ideographs"](e)||Yr["CJK Compatibility"](e)||Yr["CJK Radicals Supplement"](e)||Yr["CJK Strokes"](e)||!(!Yr["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||Yr["CJK Unified Ideographs Extension A"](e)||Yr["CJK Unified Ideographs"](e)||Yr["Enclosed CJK Letters and Months"](e)||Yr["Hangul Compatibility Jamo"](e)||Yr["Hangul Jamo Extended-A"](e)||Yr["Hangul Jamo Extended-B"](e)||Yr["Hangul Jamo"](e)||Yr["Hangul Syllables"](e)||Yr.Hiragana(e)||Yr["Ideographic Description Characters"](e)||Yr.Kanbun(e)||Yr["Kangxi Radicals"](e)||Yr["Katakana Phonetic Extensions"](e)||Yr.Katakana(e)&&12540!==e||!(!Yr["Halfwidth and Fullwidth Forms"](e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!Yr["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||Yr["Unified Canadian Aboriginal Syllabics"](e)||Yr["Unified Canadian Aboriginal Syllabics Extended"](e)||Yr["Vertical Forms"](e)||Yr["Yijing Hexagram Symbols"](e)||Yr["Yi Syllables"](e)||Yr["Yi Radicals"](e))))}function tn(e){return!(en(e)||function(e){return!!(Yr["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||Yr["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||Yr["Letterlike Symbols"](e)||Yr["Number Forms"](e)||Yr["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||Yr["Control Pictures"](e)&&9251!==e||Yr["Optical Character Recognition"](e)||Yr["Enclosed Alphanumerics"](e)||Yr["Geometric Shapes"](e)||Yr["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Yr["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Yr["CJK Symbols and Punctuation"](e)||Yr.Katakana(e)||Yr["Private Use Area"](e)||Yr["CJK Compatibility Forms"](e)||Yr["Small Form Variants"](e)||Yr["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}(e))}function rn(e){return e>=1424&&e<=2303||Yr["Arabic Presentation Forms-A"](e)||Yr["Arabic Presentation Forms-B"](e)}function nn(e,t){return!(!t&&rn(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||Yr.Khmer(e))}function an(e){for(const t of e)if(rn(t.charCodeAt(0)))return!0;return!1}let on=null,sn="unavailable",ln=null;const cn=function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(sn="error"),on&&on(e)};function hn(){un.fire(new Re("pluginStateChange",{pluginStatus:sn,pluginURL:ln}))}const un=new ke,dn=function(){return sn},pn=function(){if("deferred"!==sn||!ln)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");sn="loading",hn(),ln&&we({url:ln},(e=>{e?cn(e):(sn="loaded",hn())}))},fn={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>"loaded"===sn||null!=fn.applyArabicShaping,isLoading:()=>"loading"===sn,setState(e){sn=e.pluginStatus,ln=e.pluginURL},isParsed:()=>null!=fn.applyArabicShaping&&null!=fn.processBidirectionalText&&null!=fn.processStyledBidirectionalText,getPluginURL:()=>ln};class mn{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new $r,this.transition={})}isSupportedScript(e){return function(e,t){for(const i of e)if(!nn(i.charCodeAt(0),t))return!1;return!0}(e,fn.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,t=e-Math.floor(e),i=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*i}:{fromScale:.5,toScale:1,t:1-(1-i)*t}}}class gn{constructor(e,t){this.property=e,this.value=t,this.expression=function(e,t){if(Gi(e))return new ir(e,t);if(Ji(e)){const i=tr(e,t);if("error"===i.result)throw new Error(i.value.map((e=>`${e.key}: ${e.message}`)).join(", "));return i.value}{let i=e;return"string"==typeof e&&"color"===t.type&&(i=st.parse(e)),{kind:"constant",evaluate:()=>i}}}(void 0===t?e.specification.default:t,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,t,i){return this.property.possiblyEvaluate(this,e,t,i)}}class yn{constructor(e){this.property=e,this.value=new gn(e,void 0)}transitioned(e,t){return new _n(this.property,this.value,t,y({},e.transition,this.transition),e.now)}untransitioned(){return new _n(this.property,this.value,null,{},0)}}class vn{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return E(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new yn(this._values[e].property)),this._values[e].value=new gn(this._values[e].property,null===t?void 0:E(t))}getTransition(e){return E(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new yn(this._values[e].property)),this._values[e].transition=E(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const i=this.getValue(t);void 0!==i&&(e[t]=i);const r=this.getTransition(t);void 0!==r&&(e[`${t}-transition`]=r)}return e}transitioned(e,t){const i=new xn(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].transitioned(e,t._values[r]);return i}untransitioned(){const e=new xn(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class _n{constructor(e,t,i,r,n){this.property=e,this.value=t,this.begin=n+r.delay||0,this.end=this.begin+r.duration||0,e.specification.transition&&(r.delay||r.duration)&&(this.prior=i)}possiblyEvaluate(e,t,i){const r=e.now||0,n=this.value.possiblyEvaluate(e,t,i),a=this.prior;if(a){if(r>this.end)return this.prior=null,n;if(this.value.isDataDriven())return this.prior=null,n;if(r<this.begin)return a.possiblyEvaluate(e,t,i);{const o=(r-this.begin)/(this.end-this.begin);return this.property.interpolate(a.possiblyEvaluate(e,t,i),n,u(o))}}return n}}class xn{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,i){const r=new Mn(this._properties);for(const n of Object.keys(this._values))r._values[n]=this._values[n].possiblyEvaluate(e,t,i);return r}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class bn{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return E(this._values[e].value)}setValue(e,t){this._values[e]=new gn(this._values[e].property,null===t?void 0:E(t))}serialize(){const e={};for(const t of Object.keys(this._values)){const i=this.getValue(t);void 0!==i&&(e[t]=i)}return e}possiblyEvaluate(e,t,i){const r=new Mn(this._properties);for(const n of Object.keys(this._values))r._values[n]=this._values[n].possiblyEvaluate(e,t,i);return r}}class wn{constructor(e,t,i){this.property=e,this.value=t,this.parameters=i}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,i,r){return this.property.evaluate(this.value,this.parameters,e,t,i,r)}}class Mn{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Tn{constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,i){const r=Kt[this.specification.type];return r?r(e,t,i):e}}class Sn{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,i,r){return new wn(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},i,r)}:e.expression,t)}interpolate(e,t,i){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new wn(this,{kind:"constant",value:void 0},e.parameters);const r=Kt[this.specification.type];return r?new wn(this,{kind:"constant",value:r(e.value.value,t.value.value,i)},e.parameters):e}evaluate(e,t,i,r,n,a){return"constant"===e.kind?e.value:e.evaluate(t,i,r,n,a)}}class En extends Sn{possiblyEvaluate(e,t,i,r){if(void 0===e.value)return new wn(this,{kind:"constant",value:void 0},t);if("constant"===e.expression.kind){const n=e.expression.evaluate(t,null,{},i,r),a="resolvedImage"===e.property.specification.type&&"string"!=typeof n?n.name:n,o=this._calculate(a,a,a,t);return new wn(this,{kind:"constant",value:o},t)}if("camera"===e.expression.kind){const i=this._calculate(e.expression.evaluate({zoom:t.zoom-1}),e.expression.evaluate({zoom:t.zoom}),e.expression.evaluate({zoom:t.zoom+1}),t);return new wn(this,{kind:"constant",value:i},t)}return new wn(this,e.expression,t)}evaluate(e,t,i,r,n,a){if("source"===e.kind){const o=e.evaluate(t,i,r,n,a);return this._calculate(o,o,o,t)}return"composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(t.zoom)-1},i,r),e.evaluate({zoom:Math.floor(t.zoom)},i,r),e.evaluate({zoom:Math.floor(t.zoom)+1},i,r),t):e.value}_calculate(e,t,i,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:i,to:t}}interpolate(e){return e}}class An{constructor(e){this.specification=e}possiblyEvaluate(e,t,i,r){if(void 0!==e.value){if("constant"===e.expression.kind){const n=e.expression.evaluate(t,null,{},i,r);return this._calculate(n,n,n,t)}return this._calculate(e.expression.evaluate(new mn(Math.floor(t.zoom-1),t)),e.expression.evaluate(new mn(Math.floor(t.zoom),t)),e.expression.evaluate(new mn(Math.floor(t.zoom+1),t)),t)}}_calculate(e,t,i,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:i,to:t}}interpolate(e){return e}}class Cn{constructor(e){this.specification=e}possiblyEvaluate(e,t,i,r){return!!e.expression.evaluate(t,null,{},i,r)}interpolate(){return!1}}class Ln{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const t in e){const i=e[t];i.specification.overridable&&this.overridableProperties.push(t);const r=this.defaultPropertyValues[t]=new gn(i,void 0),n=this.defaultTransitionablePropertyValues[t]=new yn(i);this.defaultTransitioningPropertyValues[t]=n.untransitioned(),this.defaultPossiblyEvaluatedValues[t]=r.possiblyEvaluate({})}}}function Pn(e,t){return 256*(e=f(Math.floor(e),0,255))+f(Math.floor(t),0,255)}Hr("DataDrivenProperty",Sn),Hr("DataConstantProperty",Tn),Hr("CrossFadedDataDrivenProperty",En),Hr("CrossFadedProperty",An),Hr("ColorRampProperty",Cn);const In={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Rn{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Dn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function kn(e,t=1){let i=0,r=0;return{members:e.map((e=>{const n=In[e.type].BYTES_PER_ELEMENT,a=i=zn(i,Math.max(t,n)),o=e.components||1;return r=Math.max(r,n),i+=n*o,{name:e.name,type:e.type,components:o,offset:a}})),size:zn(i,Math.max(r,t)),alignment:t}}function zn(e,t){return Math.ceil(e/t)*t}class On extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const i=this.length;return this.resize(i+1),this.emplace(i,e,t)}emplace(e,t,i){const r=2*e;return this.int16[r+0]=t,this.int16[r+1]=i,e}}On.prototype.bytesPerElement=4,Hr("StructArrayLayout2i4",On);class Bn extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,i,r)}emplace(e,t,i,r,n){const a=4*e;return this.int16[a+0]=t,this.int16[a+1]=i,this.int16[a+2]=r,this.int16[a+3]=n,e}}Bn.prototype.bytesPerElement=8,Hr("StructArrayLayout4i8",Bn);class Fn extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,a,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,i,r,n,a,o)}emplace(e,t,i,r,n,a,o,s){const l=6*e,c=12*e,h=3*e;return this.int16[l+0]=t,this.int16[l+1]=i,this.uint8[c+4]=r,this.uint8[c+5]=n,this.uint8[c+6]=a,this.uint8[c+7]=o,this.float32[h+2]=s,e}}Fn.prototype.bytesPerElement=12,Hr("StructArrayLayout2i4ub1f12",Fn);class Nn extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const i=this.length;return this.resize(i+1),this.emplace(i,e,t)}emplace(e,t,i){const r=2*e;return this.float32[r+0]=t,this.float32[r+1]=i,e}}Nn.prototype.bytesPerElement=8,Hr("StructArrayLayout2f8",Nn);class Un extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,a,o,s,l,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,t,i,r,n,a,o,s,l,c)}emplace(e,t,i,r,n,a,o,s,l,c,h){const u=10*e;return this.uint16[u+0]=t,this.uint16[u+1]=i,this.uint16[u+2]=r,this.uint16[u+3]=n,this.uint16[u+4]=a,this.uint16[u+5]=o,this.uint16[u+6]=s,this.uint16[u+7]=l,this.uint16[u+8]=c,this.uint16[u+9]=h,e}}Un.prototype.bytesPerElement=20,Hr("StructArrayLayout10ui20",Un);class jn extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,a,o,s,l,c,h,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,t,i,r,n,a,o,s,l,c,h,u)}emplace(e,t,i,r,n,a,o,s,l,c,h,u,d){const p=12*e;return this.int16[p+0]=t,this.int16[p+1]=i,this.int16[p+2]=r,this.int16[p+3]=n,this.uint16[p+4]=a,this.uint16[p+5]=o,this.uint16[p+6]=s,this.uint16[p+7]=l,this.int16[p+8]=c,this.int16[p+9]=h,this.int16[p+10]=u,this.int16[p+11]=d,e}}jn.prototype.bytesPerElement=24,Hr("StructArrayLayout4i4ui4i24",jn);class Vn extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i)}emplace(e,t,i,r){const n=3*e;return this.float32[n+0]=t,this.float32[n+1]=i,this.float32[n+2]=r,e}}Vn.prototype.bytesPerElement=12,Hr("StructArrayLayout3f12",Vn);class Gn extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}Gn.prototype.bytesPerElement=4,Hr("StructArrayLayout1ul4",Gn);class Hn extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,a,o,s,l,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,t,i,r,n,a,o,s,l,c)}emplace(e,t,i,r,n,a,o,s,l,c,h){const u=16*e,d=8*e;return this.int16[u+0]=t,this.int16[u+1]=i,this.float32[d+1]=r,this.float32[d+2]=n,this.float32[d+3]=a,this.float32[d+4]=o,this.int16[u+10]=s,this.uint32[d+6]=l,this.uint16[u+14]=c,this.uint16[u+15]=h,e}}Hn.prototype.bytesPerElement=32,Hr("StructArrayLayout2i4f1i1ul2ui32",Hn);class Wn extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,a){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,i,r,n,a)}emplace(e,t,i,r,n,a,o){const s=6*e;return this.int16[s+0]=t,this.int16[s+1]=i,this.int16[s+2]=r,this.int16[s+3]=n,this.int16[s+4]=a,this.int16[s+5]=o,e}}Wn.prototype.bytesPerElement=12,Hr("StructArrayLayout2i2i2i12",Wn);class qn extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,i,r,n)}emplace(e,t,i,r,n,a){const o=4*e,s=8*e;return this.float32[o+0]=t,this.float32[o+1]=i,this.float32[o+2]=r,this.int16[s+6]=n,this.int16[s+7]=a,e}}qn.prototype.bytesPerElement=16,Hr("StructArrayLayout2f1f2i16",qn);class Zn extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,i,r)}emplace(e,t,i,r,n){const a=12*e,o=3*e;return this.uint8[a+0]=t,this.uint8[a+1]=i,this.float32[o+1]=r,this.float32[o+2]=n,e}}Zn.prototype.bytesPerElement=12,Hr("StructArrayLayout2ub2f12",Zn);class Xn extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i)}emplace(e,t,i,r){const n=3*e;return this.uint16[n+0]=t,this.uint16[n+1]=i,this.uint16[n+2]=r,e}}Xn.prototype.bytesPerElement=6,Hr("StructArrayLayout3ui6",Xn);class $n extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g)}emplace(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g,y){const v=24*e,_=12*e,x=48*e;return this.int16[v+0]=t,this.int16[v+1]=i,this.uint16[v+2]=r,this.uint16[v+3]=n,this.uint32[_+2]=a,this.uint32[_+3]=o,this.uint32[_+4]=s,this.uint16[v+10]=l,this.uint16[v+11]=c,this.uint16[v+12]=h,this.float32[_+7]=u,this.float32[_+8]=d,this.uint8[x+36]=p,this.uint8[x+37]=f,this.uint8[x+38]=m,this.uint32[_+10]=g,this.int16[v+22]=y,e}}$n.prototype.bytesPerElement=48,Hr("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",$n);class Yn extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g,y,v,_,x,b,w,M,T,S,E,A){const C=this.length;return this.resize(C+1),this.emplace(C,e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g,y,v,_,x,b,w,M,T,S,E,A)}emplace(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g,y,v,_,x,b,w,M,T,S,E,A,C){const L=34*e,P=17*e;return this.int16[L+0]=t,this.int16[L+1]=i,this.int16[L+2]=r,this.int16[L+3]=n,this.int16[L+4]=a,this.int16[L+5]=o,this.int16[L+6]=s,this.int16[L+7]=l,this.uint16[L+8]=c,this.uint16[L+9]=h,this.uint16[L+10]=u,this.uint16[L+11]=d,this.uint16[L+12]=p,this.uint16[L+13]=f,this.uint16[L+14]=m,this.uint16[L+15]=g,this.uint16[L+16]=y,this.uint16[L+17]=v,this.uint16[L+18]=_,this.uint16[L+19]=x,this.uint16[L+20]=b,this.uint16[L+21]=w,this.uint16[L+22]=M,this.uint32[P+12]=T,this.float32[P+13]=S,this.float32[P+14]=E,this.float32[P+15]=A,this.float32[P+16]=C,e}}Yn.prototype.bytesPerElement=68,Hr("StructArrayLayout8i15ui1ul4f68",Yn);class Jn extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}Jn.prototype.bytesPerElement=4,Hr("StructArrayLayout1f4",Jn);class Kn extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i)}emplace(e,t,i,r){const n=3*e;return this.int16[n+0]=t,this.int16[n+1]=i,this.int16[n+2]=r,e}}Kn.prototype.bytesPerElement=6,Hr("StructArrayLayout3i6",Kn);class Qn extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i)}emplace(e,t,i,r){const n=4*e;return this.uint32[2*e+0]=t,this.uint16[n+2]=i,this.uint16[n+3]=r,e}}Qn.prototype.bytesPerElement=8,Hr("StructArrayLayout1ul2ui8",Qn);class ea extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const i=this.length;return this.resize(i+1),this.emplace(i,e,t)}emplace(e,t,i){const r=2*e;return this.uint16[r+0]=t,this.uint16[r+1]=i,e}}ea.prototype.bytesPerElement=4,Hr("StructArrayLayout2ui4",ea);class ta extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}ta.prototype.bytesPerElement=2,Hr("StructArrayLayout1ui2",ta);class ia extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,i,r)}emplace(e,t,i,r,n){const a=4*e;return this.float32[a+0]=t,this.float32[a+1]=i,this.float32[a+2]=r,this.float32[a+3]=n,e}}ia.prototype.bytesPerElement=16,Hr("StructArrayLayout4f16",ia);class ra extends Rn{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.float32[this._pos4+1]}get y1(){return this._structArray.float32[this._pos4+2]}get x2(){return this._structArray.float32[this._pos4+3]}get y2(){return this._structArray.float32[this._pos4+4]}get padding(){return this._structArray.int16[this._pos2+10]}get featureIndex(){return this._structArray.uint32[this._pos4+6]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+14]}get bucketIndex(){return this._structArray.uint16[this._pos2+15]}get anchorPoint(){return new r(this.anchorPointX,this.anchorPointY)}}ra.prototype.size=32;class na extends Hn{get(e){return new ra(this,e)}}Hr("CollisionBoxArray",na);class aa extends Rn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}aa.prototype.size=48;class oa extends $n{get(e){return new aa(this,e)}}Hr("PlacedSymbolArray",oa);class sa extends Rn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}sa.prototype.size=68;class la extends Yn{get(e){return new sa(this,e)}}Hr("SymbolInstanceArray",la);class ca extends Jn{getoffsetX(e){return this.float32[1*e+0]}}Hr("GlyphOffsetArray",ca);class ha extends Kn{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Hr("SymbolLineVertexArray",ha);class ua extends Rn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ua.prototype.size=8;class da extends Qn{get(e){return new ua(this,e)}}Hr("FeatureIndexArray",da);const pa=kn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var fa=at((function(e){e.exports=function(e,t){var i,r,n,a,o,s,l,c;for(r=e.length-(i=3&e.length),n=t,o=3432918353,s=461845907,c=0;c<r;)l=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,n=27492+(65535&(a=5*(65535&(n=(n^=l=(65535&(l=(l=(65535&l)*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<13|n>>>19))+((5*(n>>>16)&65535)<<16)&4294967295))+((58964+(a>>>16)&65535)<<16);switch(l=0,i){case 3:l^=(255&e.charCodeAt(c+2))<<16;case 2:l^=(255&e.charCodeAt(c+1))<<8;case 1:n^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(c)))*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295}return n^=e.length,n=2246822507*(65535&(n^=n>>>16))+((2246822507*(n>>>16)&65535)<<16)&4294967295,n=3266489909*(65535&(n^=n>>>13))+((3266489909*(n>>>16)&65535)<<16)&4294967295,(n^=n>>>16)>>>0}})),ma=at((function(e){e.exports=function(e,t){for(var i,r=e.length,n=t^r,a=0;r>=4;)i=1540483477*(65535&(i=255&e.charCodeAt(a)|(255&e.charCodeAt(++a))<<8|(255&e.charCodeAt(++a))<<16|(255&e.charCodeAt(++a))<<24))+((1540483477*(i>>>16)&65535)<<16),n=1540483477*(65535&n)+((1540483477*(n>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),r-=4,++a;switch(r){case 3:n^=(255&e.charCodeAt(a+2))<<16;case 2:n^=(255&e.charCodeAt(a+1))<<8;case 1:n=1540483477*(65535&(n^=255&e.charCodeAt(a)))+((1540483477*(n>>>16)&65535)<<16)}return n=1540483477*(65535&(n^=n>>>13))+((1540483477*(n>>>16)&65535)<<16),(n^=n>>>15)>>>0}})),ga=fa,ya=ma;ga.murmur3=fa,ga.murmur2=ya;class va{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,t,i,r){this.ids.push(_a(e)),this.positions.push(t,i,r)}getPositions(e){const t=_a(e);let i=0,r=this.ids.length-1;for(;i<r;){const e=i+r>>1;this.ids[e]>=t?r=e:i=e+1}const n=[];for(;this.ids[i]===t;)n.push({index:this.positions[3*i],start:this.positions[3*i+1],end:this.positions[3*i+2]}),i++;return n}static serialize(e,t){const i=new Float64Array(e.ids),r=new Uint32Array(e.positions);return function e(t,i,r,n){for(;r<n;){const a=t[r+n>>1];let o=r-1,s=n+1;for(;;){do{o++}while(t[o]<a);do{s--}while(t[s]>a);if(o>=s)break;xa(t,o,s),xa(i,3*o,3*s),xa(i,3*o+1,3*s+1),xa(i,3*o+2,3*s+2)}s-r<n-s?(e(t,i,r,s),r=s+1):(e(t,i,s+1,n),n=s)}}(i,r,0,i.length-1),t&&t.push(i.buffer,r.buffer),{ids:i,positions:r}}static deserialize(e){const t=new va;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t}}function _a(e){const t=+e;return!isNaN(t)&&t<=s?t:ga(String(e))}function xa(e,t,i){const r=e[t];e[t]=e[i],e[i]=r}Hr("FeaturePositionMap",va);class ba{constructor(e,t){this.gl=e.gl,this.location=t}}class wa extends ba{constructor(e,t){super(e,t),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Ma extends ba{constructor(e,t){super(e,t),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Ta extends ba{constructor(e,t){super(e,t),this.current=st.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Sa=new Float32Array(16),Ea=new Float32Array(9);function Aa(e){return[Pn(255*e.r,255*e.g),Pn(255*e.b,255*e.a)]}class Ca{constructor(e,t,i){this.value=e,this.uniformNames=t.map((e=>`u_${e}`)),this.type=i}setUniform(e,t,i){e.set(i.constantOr(this.value))}getBinding(e,t,i){return"color"===this.type?new Ta(e,t):new wa(e,t)}}class La{constructor(e,t){this.uniformNames=t.map((e=>`u_${e}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,t){this.pixelRatioFrom=t.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=t.tlbr,this.patternTo=e.tlbr}setUniform(e,t,i,r){const n="u_pattern_to"===r?this.patternTo:"u_pattern_from"===r?this.patternFrom:"u_pixel_ratio_to"===r?this.pixelRatioTo:"u_pixel_ratio_from"===r?this.pixelRatioFrom:null;n&&e.set(n)}getBinding(e,t,i){return"u_pattern"===i.substr(0,9)?new Ma(e,t):new wa(e,t)}}class Pa{constructor(e,t,i,r){this.expression=e,this.type=i,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===i?2:1,offset:0}))),this.paintVertexArray=new r}populatePaintArray(e,t,i,r,n){const a=this.paintVertexArray.length,o=this.expression.evaluate(new mn(0),t,{},r,[],n);this.paintVertexArray.resize(e),this._setPaintValue(a,e,o)}updatePaintArray(e,t,i,r){const n=this.expression.evaluate({zoom:0},i,r);this._setPaintValue(e,t,n)}_setPaintValue(e,t,i){if("color"===this.type){const r=Aa(i);for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,r[0],r[1])}else{for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,i);this.maxValue=Math.max(this.maxValue,Math.abs(i))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ia{constructor(e,t,i,r,n,a){this.expression=e,this.uniformNames=t.map((e=>`u_${e}_t`)),this.type=i,this.useIntegerZoom=r,this.zoom=n,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===i?4:2,offset:0}))),this.paintVertexArray=new a}populatePaintArray(e,t,i,r,n){const a=this.expression.evaluate(new mn(this.zoom),t,{},r,[],n),o=this.expression.evaluate(new mn(this.zoom+1),t,{},r,[],n),s=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(s,e,a,o)}updatePaintArray(e,t,i,r){const n=this.expression.evaluate({zoom:this.zoom},i,r),a=this.expression.evaluate({zoom:this.zoom+1},i,r);this._setPaintValue(e,t,n,a)}_setPaintValue(e,t,i,r){if("color"===this.type){const n=Aa(i),a=Aa(r);for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,n[0],n[1],a[0],a[1])}else{for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,i,r);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(r))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t){const i=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,r=f(this.expression.interpolationFactor(i,this.zoom,this.zoom+1),0,1);e.set(r)}getBinding(e,t,i){return new wa(e,t)}}class Ra{constructor(e,t,i,r,n,a){this.expression=e,this.type=t,this.useIntegerZoom=i,this.zoom=r,this.layerId=a,this.zoomInPaintVertexArray=new n,this.zoomOutPaintVertexArray=new n}populatePaintArray(e,t,i){const r=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(r,e,t.patterns&&t.patterns[this.layerId],i)}updatePaintArray(e,t,i,r,n){this._setPaintValues(e,t,i.patterns&&i.patterns[this.layerId],n)}_setPaintValues(e,t,i,r){if(!r||!i)return;const{min:n,mid:a,max:o}=i,s=r[n],l=r[a],c=r[o];if(s&&l&&c)for(let i=e;i<t;i++)this.zoomInPaintVertexArray.emplace(i,l.tl[0],l.tl[1],l.br[0],l.br[1],s.tl[0],s.tl[1],s.br[0],s.br[1],l.pixelRatio,s.pixelRatio),this.zoomOutPaintVertexArray.emplace(i,l.tl[0],l.tl[1],l.br[0],l.br[1],c.tl[0],c.tl[1],c.br[0],c.br[1],l.pixelRatio,c.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,pa.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,pa.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Da{constructor(e,t,i=(()=>!0)){this.binders={},this._buffers=[];const r=[];for(const n in e.paint._values){if(!i(n))continue;const a=e.paint.get(n);if(!(a instanceof wn&&Ni(a.property.specification)))continue;const o=za(n,e.type),s=a.value,l=a.property.specification.type,c=a.property.useIntegerZoom,h=a.property.specification["property-type"],u="cross-faded"===h||"cross-faded-data-driven"===h;if("constant"===s.kind)this.binders[n]=u?new La(s.value,o):new Ca(s.value,o,l),r.push(`/u_${n}`);else if("source"===s.kind||u){const i=Oa(n,l,"source");this.binders[n]=u?new Ra(s,l,c,t,i,e.id):new Pa(s,o,l,i),r.push(`/a_${n}`)}else{const e=Oa(n,l,"composite");this.binders[n]=new Ia(s,o,l,c,t,e),r.push(`/z_${n}`)}}this.cacheKey=r.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof Pa||t instanceof Ia?t.maxValue:0}populatePaintArrays(e,t,i,r,n){for(const a in this.binders){const o=this.binders[a];(o instanceof Pa||o instanceof Ia||o instanceof Ra)&&o.populatePaintArray(e,t,i,r,n)}}setConstantPatternPositions(e,t){for(const i in this.binders){const r=this.binders[i];r instanceof La&&r.setConstantPatternPositions(e,t)}}updatePaintArrays(e,t,i,r,n){let a=!1;for(const o in e){const s=t.getPositions(o);for(const t of s){const s=i.feature(t.index);for(const i in this.binders){const l=this.binders[i];if((l instanceof Pa||l instanceof Ia||l instanceof Ra)&&!0===l.expression.isStateDependent){const c=r.paint.get(i);l.expression=c.value,l.updatePaintArray(t.start,t.end,s,e[o],n),a=!0}}}}return a}defines(){const e=[];for(const t in this.binders){const i=this.binders[t];(i instanceof Ca||i instanceof La)&&e.push(...i.uniformNames.map((e=>`#define HAS_UNIFORM_${e}`)))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const i=this.binders[t];if(i instanceof Pa||i instanceof Ia)for(let t=0;t<i.paintVertexAttributes.length;t++)e.push(i.paintVertexAttributes[t].name);else if(i instanceof Ra)for(let t=0;t<pa.members.length;t++)e.push(pa.members[t].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const i=this.binders[t];if(i instanceof Ca||i instanceof La||i instanceof Ia)for(const t of i.uniformNames)e.push(t)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,t){const i=[];for(const r in this.binders){const n=this.binders[r];if(n instanceof Ca||n instanceof La||n instanceof Ia)for(const a of n.uniformNames)if(t[a]){const o=n.getBinding(e,t[a],a);i.push({name:a,property:r,binding:o})}}return i}setUniforms(e,t,i,r){for(const{name:e,property:n,binding:a}of t)this.binders[n].setUniform(a,r,i.get(n),e)}updatePaintBuffers(e){this._buffers=[];for(const t in this.binders){const i=this.binders[t];if(e&&i instanceof Ra){const t=2===e.fromScale?i.zoomInPaintVertexBuffer:i.zoomOutPaintVertexBuffer;t&&this._buffers.push(t)}else(i instanceof Pa||i instanceof Ia)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const t in this.binders){const i=this.binders[t];(i instanceof Pa||i instanceof Ia||i instanceof Ra)&&i.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof Pa||t instanceof Ia||t instanceof Ra)&&t.destroy()}}}class ka{constructor(e,t,i=(()=>!0)){this.programConfigurations={};for(const r of e)this.programConfigurations[r.id]=new Da(r,t,i);this.needsUpload=!1,this._featureMap=new va,this._bufferOffset=0}populatePaintArrays(e,t,i,r,n,a){for(const i in this.programConfigurations)this.programConfigurations[i].populatePaintArrays(e,t,r,n,a);void 0!==t.id&&this._featureMap.add(t.id,i,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,i,r){for(const n of i)this.needsUpload=this.programConfigurations[n.id].updatePaintArrays(e,this._featureMap,t,n,r)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function za(e,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[e]||[e.replace(`${t}-`,"").replace(/-/g,"_")]}function Oa(e,t,i){const r={color:{source:Nn,composite:ia},number:{source:Jn,composite:Nn}},n=function(e){return{"line-pattern":{source:Un,composite:Un},"fill-pattern":{source:Un,composite:Un},"fill-extrusion-pattern":{source:Un,composite:Un}}[e]}(e);return n&&n[i]||r[t][i]}Hr("ConstantBinder",Ca),Hr("CrossFadedConstantBinder",La),Hr("SourceExpressionBinder",Pa),Hr("CrossFadedCompositeBinder",Ra),Hr("CompositeExpressionBinder",Ia),Hr("ProgramConfiguration",Da,{omit:["_buffers"]}),Hr("ProgramConfigurationSet",ka);class Ba extends ke{constructor(e,t){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==e.type&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),t.layout&&(this._unevaluatedLayout=new bn(t.layout)),t.paint)){this._transitionablePaint=new vn(t.paint);for(const t in e.paint)this.setPaintProperty(t,e.paint[t],{validate:!1});for(const t in e.layout)this.setLayoutProperty(t,e.layout[t],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Mn(t.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t,i={}){null!=t&&this._validate(Br,`layers.${this.id}.layout.${e}`,e,t,i)||("visibility"!==e?this._unevaluatedLayout.setValue(e,t):this.visibility=t)}getPaintProperty(e){return M(e,"-transition")?this._transitionablePaint.getTransition(e.slice(0,-"-transition".length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t,i={}){if(null!=t&&this._validate(Or,`layers.${this.id}.paint.${e}`,e,t,i))return!1;if(M(e,"-transition"))return this._transitionablePaint.setTransition(e.slice(0,-"-transition".length),t||void 0),!1;{const i=this._transitionablePaint._values[e],r="cross-faded-data-driven"===i.property.specification["property-type"],n=i.value.isDataDriven(),a=i.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);const o=this._transitionablePaint._values[e].value;return o.isDataDriven()||n||r||this._handleOverridablePaintPropertyUpdate(e,a,o)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,t,i){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),S(e,((e,t)=>!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length)))}_validate(e,t,i,r,n={}){return(!n||!1!==n.validate)&&Fr(this,e.call(kr,{key:t,layerType:this.type,objectKey:i,value:r,styleSpec:ze,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof wn&&Ni(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}return!1}}const Fa=kn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Na}=Fa;class Ua{constructor(e=[]){this.segments=e}prepareSegment(e,t,i,r){let n=this.segments[this.segments.length-1];return e>Ua.MAX_VERTEX_ARRAY_LENGTH&&C(`Max vertices per segment is ${Ua.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!n||n.vertexLength+e>Ua.MAX_VERTEX_ARRAY_LENGTH||n.sortKey!==r)&&(n={vertexOffset:t.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0},void 0!==r&&(n.sortKey=r),this.segments.push(n)),n}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,i,r){return new Ua([{vertexOffset:e,primitiveOffset:t,vertexLength:i,primitiveLength:r,vaos:{},sortKey:0}])}}Ua.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Hr("SegmentVector",Ua);const ja=Math.pow(2,14)-1,Va=-ja-1;function Ga(e){const t=8192/e.extent,i=e.loadGeometry();for(let e=0;e<i.length;e++){const r=i[e];for(let e=0;e<r.length;e++){const i=r[e],n=Math.round(i.x*t),a=Math.round(i.y*t);i.x=f(n,Va,ja),i.y=f(a,Va,ja),(n<i.x||n>i.x+1||a<i.y||a>i.y+1)&&C("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return i}function Ha(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Ga(e):[]}}function Wa(e,t,i,r,n){e.emplaceBack(2*t+(r+1)/2,2*i+(n+1)/2)}class qa{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new On,this.indexArray=new Xn,this.segments=new Ua,this.programConfigurations=new ka(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,i){const r=this.layers[0],n=[];let a=null;"circle"===r.type&&(a=r.layout.get("circle-sort-key"));for(const{feature:t,id:r,index:o,sourceLayerIndex:s}of e){const e=this.layers[0]._featureFilter.needGeometry,l=Ha(t,e);if(!this.layers[0]._featureFilter.filter(new mn(this.zoom),l,i))continue;const c=a?a.evaluate(l,{},i):void 0,h={id:r,properties:t.properties,type:t.type,sourceLayerIndex:s,index:o,geometry:e?l.geometry:Ga(t),patterns:{},sortKey:c};n.push(h)}a&&n.sort(((e,t)=>e.sortKey-t.sortKey));for(const r of n){const{geometry:n,index:a,sourceLayerIndex:o}=r,s=e[a].feature;this.addFeature(r,n,a,i),t.featureIndex.insert(s,n,a,o,this.index)}}update(e,t,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Na),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,i,r){for(const i of t)for(const t of i){const i=t.x,r=t.y;if(i<0||i>=8192||r<0||r>=8192)continue;const n=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),a=n.vertexLength;Wa(this.layoutVertexArray,i,r,-1,-1),Wa(this.layoutVertexArray,i,r,1,-1),Wa(this.layoutVertexArray,i,r,1,1),Wa(this.layoutVertexArray,i,r,-1,1),this.indexArray.emplaceBack(a,a+1,a+2),this.indexArray.emplaceBack(a,a+3,a+2),n.vertexLength+=4,n.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,{},r)}}function Za(e,t){for(let i=0;i<e.length;i++)if(io(t,e[i]))return!0;for(let i=0;i<t.length;i++)if(io(e,t[i]))return!0;return!!Ja(e,t)}function Xa(e,t,i){return!!io(e,t)||!!Qa(t,e,i)}function $a(e,t){if(1===e.length)return to(t,e[0]);for(let i=0;i<t.length;i++){const r=t[i];for(let t=0;t<r.length;t++)if(io(e,r[t]))return!0}for(let i=0;i<e.length;i++)if(to(t,e[i]))return!0;for(let i=0;i<t.length;i++)if(Ja(e,t[i]))return!0;return!1}function Ya(e,t,i){if(e.length>1){if(Ja(e,t))return!0;for(let r=0;r<t.length;r++)if(Qa(t[r],e,i))return!0}for(let r=0;r<e.length;r++)if(Qa(e[r],t,i))return!0;return!1}function Ja(e,t){if(0===e.length||0===t.length)return!1;for(let i=0;i<e.length-1;i++){const r=e[i],n=e[i+1];for(let e=0;e<t.length-1;e++)if(Ka(r,n,t[e],t[e+1]))return!0}return!1}function Ka(e,t,i,r){return L(e,i,r)!==L(t,i,r)&&L(e,t,i)!==L(e,t,r)}function Qa(e,t,i){const r=i*i;if(1===t.length)return e.distSqr(t[0])<r;for(let i=1;i<t.length;i++)if(eo(e,t[i-1],t[i])<r)return!0;return!1}function eo(e,t,i){const r=t.distSqr(i);if(0===r)return e.distSqr(t);const n=((e.x-t.x)*(i.x-t.x)+(e.y-t.y)*(i.y-t.y))/r;return e.distSqr(n<0?t:n>1?i:i.sub(t)._mult(n)._add(t))}function to(e,t){let i,r,n,a=!1;for(let o=0;o<e.length;o++){i=e[o];for(let e=0,o=i.length-1;e<i.length;o=e++)r=i[e],n=i[o],r.y>t.y!=n.y>t.y&&t.x<(n.x-r.x)*(t.y-r.y)/(n.y-r.y)+r.x&&(a=!a)}return a}function io(e,t){let i=!1;for(let r=0,n=e.length-1;r<e.length;n=r++){const a=e[r],o=e[n];a.y>t.y!=o.y>t.y&&t.x<(o.x-a.x)*(t.y-a.y)/(o.y-a.y)+a.x&&(i=!i)}return i}function ro(e,t,i,n,a){for(const r of e)if(t<=r.x&&i<=r.y&&n>=r.x&&a>=r.y)return!0;const o=[new r(t,i),new r(t,a),new r(n,a),new r(n,i)];if(e.length>2)for(const t of o)if(io(e,t))return!0;for(let t=0;t<e.length-1;t++)if(no(e[t],e[t+1],o))return!0;return!1}function no(e,t,i){const r=i[0],n=i[2];if(e.x<r.x&&t.x<r.x||e.x>n.x&&t.x>n.x||e.y<r.y&&t.y<r.y||e.y>n.y&&t.y>n.y)return!1;const a=L(e,t,i[0]);return a!==L(e,t,i[1])||a!==L(e,t,i[2])||a!==L(e,t,i[3])}function ao(e,t,i){const r=t.paint.get(e).value;return"constant"===r.kind?r.value:i.programConfigurations.get(t.id).getMaxValue(e)}function oo(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function so(e,t,i,n,a){if(!t[0]&&!t[1])return e;const o=r.convert(t)._mult(a);"viewport"===i&&o._rotate(-n);const s=[];for(let t=0;t<e.length;t++)s.push(e[t].sub(o));return s}function lo(e,t,i,n){const a=r.convert(e)._mult(n);return"viewport"===t&&a._rotate(-i),a}Hr("CircleBucket",qa,{omit:["layers"]});const co=new Ln({"circle-sort-key":new Sn(ze.layout_circle["circle-sort-key"])});var ho={paint:new Ln({"circle-radius":new Sn(ze.paint_circle["circle-radius"]),"circle-color":new Sn(ze.paint_circle["circle-color"]),"circle-blur":new Sn(ze.paint_circle["circle-blur"]),"circle-opacity":new Sn(ze.paint_circle["circle-opacity"]),"circle-translate":new Tn(ze.paint_circle["circle-translate"]),"circle-translate-anchor":new Tn(ze.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Tn(ze.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Tn(ze.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Sn(ze.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Sn(ze.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Sn(ze.paint_circle["circle-stroke-opacity"])}),layout:co},uo="undefined"!=typeof Float32Array?Float32Array:Array;function po(){var e=new uo(9);return uo!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function fo(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function mo(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],c=t[6],h=t[7],u=t[8],d=t[9],p=t[10],f=t[11],m=t[12],g=t[13],y=t[14],v=t[15],_=i[0],x=i[1],b=i[2],w=i[3];return e[0]=_*r+x*s+b*u+w*m,e[1]=_*n+x*l+b*d+w*g,e[2]=_*a+x*c+b*p+w*y,e[3]=_*o+x*h+b*f+w*v,e[4]=(_=i[4])*r+(x=i[5])*s+(b=i[6])*u+(w=i[7])*m,e[5]=_*n+x*l+b*d+w*g,e[6]=_*a+x*c+b*p+w*y,e[7]=_*o+x*h+b*f+w*v,e[8]=(_=i[8])*r+(x=i[9])*s+(b=i[10])*u+(w=i[11])*m,e[9]=_*n+x*l+b*d+w*g,e[10]=_*a+x*c+b*p+w*y,e[11]=_*o+x*h+b*f+w*v,e[12]=(_=i[12])*r+(x=i[13])*s+(b=i[14])*u+(w=i[15])*m,e[13]=_*n+x*l+b*d+w*g,e[14]=_*a+x*c+b*p+w*y,e[15]=_*o+x*h+b*f+w*v,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var go=mo;function yo(){var e=new uo(3);return uo!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function vo(e){var t=new uo(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function _o(e){return Math.hypot(e[0],e[1],e[2])}function xo(e,t,i){var r=new uo(3);return r[0]=e,r[1]=t,r[2]=i,r}function bo(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e}function wo(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function Mo(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function To(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e}function So(e,t){var i=t[0],r=t[1],n=t[2],a=i*i+r*r+n*n;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e}function Eo(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Ao(e,t,i){var r=t[0],n=t[1],a=t[2],o=i[0],s=i[1],l=i[2];return e[0]=n*l-a*s,e[1]=a*o-r*l,e[2]=r*s-n*o,e}function Co(e,t,i){var r=i[0],n=i[1],a=i[2],o=t[0],s=t[1],l=t[2],c=n*l-a*s,h=a*o-r*l,u=r*s-n*o,d=n*u-a*h,p=a*c-r*u,f=r*h-n*c,m=2*i[3];return h*=m,u*=m,p*=2,f*=2,e[0]=o+(c*=m)+(d*=2),e[1]=s+h+p,e[2]=l+u+f,e}var Lo,Po=wo,Io=_o;function Ro(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3];return e[0]=i[0]*r+i[4]*n+i[8]*a+i[12]*o,e[1]=i[1]*r+i[5]*n+i[9]*a+i[13]*o,e[2]=i[2]*r+i[6]*n+i[10]*a+i[14]*o,e[3]=i[3]*r+i[7]*n+i[11]*a+i[15]*o,e}function Do(){var e=new uo(4);return uo!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function ko(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function zo(e,t,i){i*=.5;var r=t[0],n=t[1],a=t[2],o=t[3],s=Math.sin(i),l=Math.cos(i);return e[0]=r*l+o*s,e[1]=n*l+a*s,e[2]=a*l-n*s,e[3]=o*l-r*s,e}yo(),Lo=new uo(4),uo!=Float32Array&&(Lo[0]=0,Lo[1]=0,Lo[2]=0,Lo[3]=0),yo(),xo(1,0,0),xo(0,1,0),Do(),Do(),po();class Oo{constructor(e,t){this.points=e,this.planes=t}static fromInvProjectionMatrix(e,t,i){const r=Math.pow(2,i),n=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((i=>{const n=Ro([],i,e),a=1/n[3]/t*r;return function(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e[3]=t[3]*i[3],e}(n,n,[a,a,1/n[3],a])})),a=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((e=>{const t=So([],Ao([],Po([],n[e[0]],n[e[1]]),Po([],n[e[2]],n[e[1]]))),i=-Eo(t,n[e[1]]);return t.concat(i)}));return new Oo(n,a)}}class Bo{constructor(e,t){this.min=e,this.max=t,this.center=Mo([],bo([],this.min,this.max),.5)}quadrant(e){const t=[e%2==0,e<2],i=vo(this.min),r=vo(this.max);for(let e=0;e<t.length;e++)i[e]=t[e]?this.min[e]:this.center[e],r[e]=t[e]?this.center[e]:this.max[e];return r[2]=this.max[2],new Bo(i,r)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}intersects(e){const t=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let i=!0;for(let a=0;a<e.planes.length;a++){const o=e.planes[a];let s=0;for(let e=0;e<t.length;e++)s+=(r=o)[0]*(n=t[e])[0]+r[1]*n[1]+r[2]*n[2]+r[3]*n[3]>=0;if(0===s)return 0;s!==t.length&&(i=!1)}var r,n;if(i)return 2;for(let t=0;t<3;t++){let i=Number.MAX_VALUE,r=-Number.MAX_VALUE;for(let n=0;n<e.points.length;n++){const a=e.points[n][t]-this.min[t];i=Math.min(i,a),r=Math.max(r,a)}if(r<0||i>this.max[t]-this.min[t])return 0}return 1}}function Fo(e,t,i){const n=Ro([],[e.x,e.y,t,1],i);return new r(n[0]/n[3],n[1]/n[3])}const No=xo(0,0,0),Uo=xo(0,0,1);function jo(e,t){const i=yo();return No[2]=t,e.intersectsPlane(No,Uo,i),new r(i[0],i[1])}class Vo extends qa{}function Go(e,{width:t,height:i},r,n){if(n){if(n instanceof Uint8ClampedArray)n=new Uint8Array(n.buffer);else if(n.length!==t*i*r)throw new RangeError("mismatched image size")}else n=new Uint8Array(t*i*r);return e.width=t,e.height=i,e.data=n,e}function Ho(e,{width:t,height:i},r){if(t===e.width&&i===e.height)return;const n=Go({},{width:t,height:i},r);Wo(e,n,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,t),height:Math.min(e.height,i)},r),e.width=t,e.height=i,e.data=n.data}function Wo(e,t,i,r,n,a){if(0===n.width||0===n.height)return t;if(n.width>e.width||n.height>e.height||i.x>e.width-n.width||i.y>e.height-n.height)throw new RangeError("out of range source coordinates for image copy");if(n.width>t.width||n.height>t.height||r.x>t.width-n.width||r.y>t.height-n.height)throw new RangeError("out of range destination coordinates for image copy");const o=e.data,s=t.data;for(let l=0;l<n.height;l++){const c=((i.y+l)*e.width+i.x)*a,h=((r.y+l)*t.width+r.x)*a;for(let e=0;e<n.width*a;e++)s[h+e]=o[c+e]}return t}Hr("HeatmapBucket",Vo,{omit:["layers"]});class qo{constructor(e,t){Go(this,e,1,t)}resize(e){Ho(this,e,1)}clone(){return new qo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,i,r,n){Wo(e,t,i,r,n,1)}}class Zo{constructor(e,t){Go(this,e,4,t)}resize(e){Ho(this,e,4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Zo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,i,r,n){Wo(e,t,i,r,n,4)}}Hr("AlphaImage",qo),Hr("RGBAImage",Zo);var Xo={paint:new Ln({"heatmap-radius":new Sn(ze.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Sn(ze.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Tn(ze.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Cn(ze.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Tn(ze.paint_heatmap["heatmap-opacity"])})};function $o(e){const t={},i=e.resolution||256,r=e.clips?e.clips.length:1,n=e.image||new Zo({width:i,height:r}),a=(i,r,a)=>{t[e.evaluationKey]=a;const o=e.expression.evaluate(t);n.data[i+r+0]=Math.floor(255*o.r/o.a),n.data[i+r+1]=Math.floor(255*o.g/o.a),n.data[i+r+2]=Math.floor(255*o.b/o.a),n.data[i+r+3]=Math.floor(255*o.a)};if(e.clips)for(let t=0,n=0;t<r;++t,n+=4*i)for(let r=0,o=0;r<i;r++,o+=4){const s=r/(i-1),{start:l,end:c}=e.clips[t];a(n,o,l*(1-s)+c*s)}else for(let e=0,t=0;e<i;e++,t+=4)a(0,t,e/(i-1));return n}var Yo={paint:new Ln({"hillshade-illumination-direction":new Tn(ze.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Tn(ze.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Tn(ze.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Tn(ze.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Tn(ze.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Tn(ze.paint_hillshade["hillshade-accent-color"])})};const Jo=kn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ko}=Jo;var Qo=ts,es=ts;function ts(e,t,i){i=i||2;var r,n,a,o,s,l,c,h=t&&t.length,u=h?t[0]*i:e.length,d=is(e,0,u,i,!0),p=[];if(!d||d.next===d.prev)return p;if(h&&(d=function(e,t,i,r){var n,a,o,s=[];for(n=0,a=t.length;n<a;n++)(o=is(e,t[n]*r,n<a-1?t[n+1]*r:e.length,r,!1))===o.next&&(o.steiner=!0),s.push(ps(o));for(s.sort(cs),n=0;n<s.length;n++)hs(s[n],i),i=rs(i,i.next);return i}(e,t,d,i)),e.length>80*i){r=a=e[0],n=o=e[1];for(var f=i;f<u;f+=i)(s=e[f])<r&&(r=s),(l=e[f+1])<n&&(n=l),s>a&&(a=s),l>o&&(o=l);c=0!==(c=Math.max(a-r,o-n))?1/c:0}return ns(d,p,i,r,n,c),p}function is(e,t,i,r,n){var a,o;if(n===Es(e,t,i,r)>0)for(a=t;a<i;a+=r)o=Ms(a,e[a],e[a+1],o);else for(a=i-r;a>=t;a-=r)o=Ms(a,e[a],e[a+1],o);return o&&ys(o,o.next)&&(Ts(o),o=o.next),o}function rs(e,t){if(!e)return e;t||(t=e);var i,r=e;do{if(i=!1,r.steiner||!ys(r,r.next)&&0!==gs(r.prev,r,r.next))r=r.next;else{if(Ts(r),(r=t=r.prev)===r.next)break;i=!0}}while(i||r!==t);return t}function ns(e,t,i,r,n,a,o){if(e){!o&&a&&function(e,t,i,r){var n=e;do{null===n.z&&(n.z=ds(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,i,r,n,a,o,s,l,c=1;do{for(i=e,e=null,a=null,o=0;i;){for(o++,r=i,s=0,t=0;t<c&&(s++,r=r.nextZ);t++);for(l=c;s>0||l>0&&r;)0!==s&&(0===l||!r||i.z<=r.z)?(n=i,i=i.nextZ,s--):(n=r,r=r.nextZ,l--),a?a.nextZ=n:e=n,n.prevZ=a,a=n;i=r}a.nextZ=null,c*=2}while(o>1)}(n)}(e,r,n,a);for(var s,l,c=e;e.prev!==e.next;)if(s=e.prev,l=e.next,a?os(e,r,n,a):as(e))t.push(s.i/i),t.push(e.i/i),t.push(l.i/i),Ts(e),e=l.next,c=l.next;else if((e=l)===c){o?1===o?ns(e=ss(rs(e),t,i),t,i,r,n,a,2):2===o&&ls(e,t,i,r,n,a):ns(rs(e),t,i,r,n,a,1);break}}}function as(e){var t=e.prev,i=e,r=e.next;if(gs(t,i,r)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(fs(t.x,t.y,i.x,i.y,r.x,r.y,n.x,n.y)&&gs(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function os(e,t,i,r){var n=e.prev,a=e,o=e.next;if(gs(n,a,o)>=0)return!1;for(var s=n.x>a.x?n.x>o.x?n.x:o.x:a.x>o.x?a.x:o.x,l=n.y>a.y?n.y>o.y?n.y:o.y:a.y>o.y?a.y:o.y,c=ds(n.x<a.x?n.x<o.x?n.x:o.x:a.x<o.x?a.x:o.x,n.y<a.y?n.y<o.y?n.y:o.y:a.y<o.y?a.y:o.y,t,i,r),h=ds(s,l,t,i,r),u=e.prevZ,d=e.nextZ;u&&u.z>=c&&d&&d.z<=h;){if(u!==e.prev&&u!==e.next&&fs(n.x,n.y,a.x,a.y,o.x,o.y,u.x,u.y)&&gs(u.prev,u,u.next)>=0)return!1;if(u=u.prevZ,d!==e.prev&&d!==e.next&&fs(n.x,n.y,a.x,a.y,o.x,o.y,d.x,d.y)&&gs(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;u&&u.z>=c;){if(u!==e.prev&&u!==e.next&&fs(n.x,n.y,a.x,a.y,o.x,o.y,u.x,u.y)&&gs(u.prev,u,u.next)>=0)return!1;u=u.prevZ}for(;d&&d.z<=h;){if(d!==e.prev&&d!==e.next&&fs(n.x,n.y,a.x,a.y,o.x,o.y,d.x,d.y)&&gs(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function ss(e,t,i){var r=e;do{var n=r.prev,a=r.next.next;!ys(n,a)&&vs(n,r,r.next,a)&&bs(n,a)&&bs(a,n)&&(t.push(n.i/i),t.push(r.i/i),t.push(a.i/i),Ts(r),Ts(r.next),r=e=a),r=r.next}while(r!==e);return rs(r)}function ls(e,t,i,r,n,a){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&ms(o,s)){var l=ws(o,s);return o=rs(o,o.next),l=rs(l,l.next),ns(o,t,i,r,n,a),void ns(l,t,i,r,n,a)}s=s.next}o=o.next}while(o!==e)}function cs(e,t){return e.x-t.x}function hs(e,t){if(t=function(e,t){var i,r=t,n=e.x,a=e.y,o=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var s=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=n&&s>o){if(o=s,s===n){if(a===r.y)return r;if(a===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!i)return null;if(n===o)return i;var l,c=i,h=i.x,u=i.y,d=1/0;r=i;do{n>=r.x&&r.x>=h&&n!==r.x&&fs(a<u?n:o,a,h,u,a<u?o:n,a,r.x,r.y)&&(l=Math.abs(a-r.y)/(n-r.x),bs(r,e)&&(l<d||l===d&&(r.x>i.x||r.x===i.x&&us(i,r)))&&(i=r,d=l)),r=r.next}while(r!==c);return i}(e,t)){var i=ws(t,e);rs(t,t.next),rs(i,i.next)}}function us(e,t){return gs(e.prev,e,t.prev)<0&&gs(t.next,e,e.next)<0}function ds(e,t,i,r,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function ps(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function fs(e,t,i,r,n,a,o,s){return(n-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(r-s)-(i-o)*(t-s)>=0&&(i-o)*(a-s)-(n-o)*(r-s)>=0}function ms(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&vs(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(bs(e,t)&&bs(t,e)&&function(e,t){var i=e,r=!1,n=(e.x+t.x)/2,a=(e.y+t.y)/2;do{i.y>a!=i.next.y>a&&i.next.y!==i.y&&n<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}(e,t)&&(gs(e.prev,e,t.prev)||gs(e,t.prev,t))||ys(e,t)&&gs(e.prev,e,e.next)>0&&gs(t.prev,t,t.next)>0)}function gs(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function ys(e,t){return e.x===t.x&&e.y===t.y}function vs(e,t,i,r){var n=xs(gs(e,t,i)),a=xs(gs(e,t,r)),o=xs(gs(i,r,e)),s=xs(gs(i,r,t));return n!==a&&o!==s||!(0!==n||!_s(e,i,t))||!(0!==a||!_s(e,r,t))||!(0!==o||!_s(i,e,r))||!(0!==s||!_s(i,t,r))}function _s(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function xs(e){return e>0?1:e<0?-1:0}function bs(e,t){return gs(e.prev,e,e.next)<0?gs(e,t,e.next)>=0&&gs(e,e.prev,t)>=0:gs(e,t,e.prev)<0||gs(e,e.next,t)<0}function ws(e,t){var i=new Ss(e.i,e.x,e.y),r=new Ss(t.i,t.x,t.y),n=e.next,a=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,a.next=r,r.prev=a,r}function Ms(e,t,i,r){var n=new Ss(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function Ts(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Ss(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Es(e,t,i,r){for(var n=0,a=t,o=i-r;a<i;a+=r)n+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return n}function As(e,t,i,r,n){!function e(t,i,r,n,a){for(;n>r;){if(n-r>600){var o=n-r+1,s=i-r+1,l=Math.log(o),c=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*c*(o-c)/o)*(s-o/2<0?-1:1);e(t,i,Math.max(r,Math.floor(i-s*c/o+h)),Math.min(n,Math.floor(i+(o-s)*c/o+h)),a)}var u=t[i],d=r,p=n;for(Cs(t,r,i),a(t[n],u)>0&&Cs(t,r,n);d<p;){for(Cs(t,d,p),d++,p--;a(t[d],u)<0;)d++;for(;a(t[p],u)>0;)p--}0===a(t[r],u)?Cs(t,r,p):Cs(t,++p,n),p<=i&&(r=p+1),i<=p&&(n=p-1)}}(e,t,i||0,r||e.length-1,n||Ls)}function Cs(e,t,i){var r=e[t];e[t]=e[i],e[i]=r}function Ls(e,t){return e<t?-1:e>t?1:0}function Ps(e,t){const i=e.length;if(i<=1)return[e];const r=[];let n,a;for(let t=0;t<i;t++){const i=P(e[t]);0!==i&&(e[t].area=Math.abs(i),void 0===a&&(a=i<0),a===i<0?(n&&r.push(n),n=[e[t]]):n.push(e[t]))}if(n&&r.push(n),t>1)for(let e=0;e<r.length;e++)r[e].length<=t||(As(r[e],t,1,r[e].length-1,Is),r[e]=r[e].slice(0,t));return r}function Is(e,t){return t.area-e.area}function Rs(e,t,i){const r=i.patternDependencies;let n=!1;for(const i of t){const t=i.paint.get(`${e}-pattern`);t.isConstant()||(n=!0);const a=t.constantOr(null);a&&(n=!0,r[a.to]=!0,r[a.from]=!0)}return n}function Ds(e,t,i,r,n){const a=n.patternDependencies;for(const o of t){const t=o.paint.get(`${e}-pattern`).value;if("constant"!==t.kind){let e=t.evaluate({zoom:r-1},i,{},n.availableImages),s=t.evaluate({zoom:r},i,{},n.availableImages),l=t.evaluate({zoom:r+1},i,{},n.availableImages);e=e&&e.name?e.name:e,s=s&&s.name?s.name:s,l=l&&l.name?l.name:l,a[e]=!0,a[s]=!0,a[l]=!0,i.patterns[o.id]={min:e,mid:s,max:l}}}return i}ts.deviation=function(e,t,i,r){var n=t&&t.length,a=Math.abs(Es(e,0,n?t[0]*i:e.length,i));if(n)for(var o=0,s=t.length;o<s;o++)a-=Math.abs(Es(e,t[o]*i,o<s-1?t[o+1]*i:e.length,i));var l=0;for(o=0;o<r.length;o+=3){var c=r[o]*i,h=r[o+1]*i,u=r[o+2]*i;l+=Math.abs((e[c]-e[u])*(e[h+1]-e[c+1])-(e[c]-e[h])*(e[u+1]-e[c+1]))}return 0===a&&0===l?0:Math.abs((l-a)/a)},ts.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},r=0,n=0;n<e.length;n++){for(var a=0;a<e[n].length;a++)for(var o=0;o<t;o++)i.vertices.push(e[n][a][o]);n>0&&i.holes.push(r+=e[n-1].length)}return i},Qo.default=es;class ks{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new On,this.indexArray=new Xn,this.indexArray2=new ea,this.programConfigurations=new ka(e.layers,e.zoom),this.segments=new Ua,this.segments2=new Ua,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,i){this.hasPattern=Rs("fill",this.layers,t);const r=this.layers[0].layout.get("fill-sort-key"),n=[];for(const{feature:a,id:o,index:s,sourceLayerIndex:l}of e){const e=this.layers[0]._featureFilter.needGeometry,c=Ha(a,e);if(!this.layers[0]._featureFilter.filter(new mn(this.zoom),c,i))continue;const h=r?r.evaluate(c,{},i,t.availableImages):void 0,u={id:o,properties:a.properties,type:a.type,sourceLayerIndex:l,index:s,geometry:e?c.geometry:Ga(a),patterns:{},sortKey:h};n.push(u)}r&&n.sort(((e,t)=>e.sortKey-t.sortKey));for(const r of n){const{geometry:n,index:a,sourceLayerIndex:o}=r;if(this.hasPattern){const e=Ds("fill",this.layers,r,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(r,n,a,i,{});t.featureIndex.insert(e[a].feature,n,a,o,this.index)}}update(e,t,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,i)}addFeatures(e,t,i){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ko),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,i,r,n){for(const e of Ps(t,500)){let t=0;for(const i of e)t+=i.length;const i=this.segments.prepareSegment(t,this.layoutVertexArray,this.indexArray),r=i.vertexLength,n=[],a=[];for(const t of e){if(0===t.length)continue;t!==e[0]&&a.push(n.length/2);const i=this.segments2.prepareSegment(t.length,this.layoutVertexArray,this.indexArray2),r=i.vertexLength;this.layoutVertexArray.emplaceBack(t[0].x,t[0].y),this.indexArray2.emplaceBack(r+t.length-1,r),n.push(t[0].x),n.push(t[0].y);for(let e=1;e<t.length;e++)this.layoutVertexArray.emplaceBack(t[e].x,t[e].y),this.indexArray2.emplaceBack(r+e-1,r+e),n.push(t[e].x),n.push(t[e].y);i.vertexLength+=t.length,i.primitiveLength+=t.length}const o=Qo(n,a);for(let e=0;e<o.length;e+=3)this.indexArray.emplaceBack(r+o[e],r+o[e+1],r+o[e+2]);i.vertexLength+=t,i.primitiveLength+=o.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,n,r)}}Hr("FillBucket",ks,{omit:["layers","patternFeatures"]});const zs=new Ln({"fill-sort-key":new Sn(ze.layout_fill["fill-sort-key"])});var Os={paint:new Ln({"fill-antialias":new Tn(ze.paint_fill["fill-antialias"]),"fill-opacity":new Sn(ze.paint_fill["fill-opacity"]),"fill-color":new Sn(ze.paint_fill["fill-color"]),"fill-outline-color":new Sn(ze.paint_fill["fill-outline-color"]),"fill-translate":new Tn(ze.paint_fill["fill-translate"]),"fill-translate-anchor":new Tn(ze.paint_fill["fill-translate-anchor"]),"fill-pattern":new En(ze.paint_fill["fill-pattern"])}),layout:zs};const Bs=kn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Fs=kn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:Ns}=Bs;var Us=js;function js(e,t,i,r,n){this.properties={},this.extent=i,this.type=0,this._pbf=e,this._geometry=-1,this._keys=r,this._values=n,e.readFields(Vs,this,t)}function Vs(e,t,i){1==e?t.id=i.readVarint():2==e?function(e,t){for(var i=e.readVarint()+e.pos;e.pos<i;){var r=t._keys[e.readVarint()],n=t._values[e.readVarint()];t.properties[r]=n}}(i,t):3==e?t.type=i.readVarint():4==e&&(t._geometry=i.pos)}function Gs(e){for(var t,i,r=0,n=0,a=e.length,o=a-1;n<a;o=n++)r+=((i=e[o]).x-(t=e[n]).x)*(t.y+i.y);return r}js.types=["Unknown","Point","LineString","Polygon"],js.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,i=e.readVarint()+e.pos,n=1,a=0,o=0,s=0,l=[];e.pos<i;){if(a<=0){var c=e.readVarint();n=7&c,a=c>>3}if(a--,1===n||2===n)o+=e.readSVarint(),s+=e.readSVarint(),1===n&&(t&&l.push(t),t=[]),t.push(new r(o,s));else{if(7!==n)throw new Error("unknown command "+n);t&&t.push(t[0].clone())}}return t&&l.push(t),l},js.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,i=1,r=0,n=0,a=0,o=1/0,s=-1/0,l=1/0,c=-1/0;e.pos<t;){if(r<=0){var h=e.readVarint();i=7&h,r=h>>3}if(r--,1===i||2===i)(n+=e.readSVarint())<o&&(o=n),n>s&&(s=n),(a+=e.readSVarint())<l&&(l=a),a>c&&(c=a);else if(7!==i)throw new Error("unknown command "+i)}return[o,l,s,c]},js.prototype.toGeoJSON=function(e,t,i){var r,n,a=this.extent*Math.pow(2,i),o=this.extent*e,s=this.extent*t,l=this.loadGeometry(),c=js.types[this.type];function h(e){for(var t=0;t<e.length;t++){var i=e[t];e[t]=[360*(i.x+o)/a-180,360/Math.PI*Math.atan(Math.exp((180-360*(i.y+s)/a)*Math.PI/180))-90]}}switch(this.type){case 1:var u=[];for(r=0;r<l.length;r++)u[r]=l[r][0];h(l=u);break;case 2:for(r=0;r<l.length;r++)h(l[r]);break;case 3:for(l=function(e){var t=e.length;if(t<=1)return[e];for(var i,r,n=[],a=0;a<t;a++){var o=Gs(e[a]);0!==o&&(void 0===r&&(r=o<0),r===o<0?(i&&n.push(i),i=[e[a]]):i.push(e[a]))}return i&&n.push(i),n}(l),r=0;r<l.length;r++)for(n=0;n<l[r].length;n++)h(l[r][n])}1===l.length?l=l[0]:c="Multi"+c;var d={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return"id"in this&&(d.id=this.id),d};var Hs=Ws;function Ws(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(qs,this,t),this.length=this._features.length}function qs(e,t,i){15===e?t.version=i.readVarint():1===e?t.name=i.readString():5===e?t.extent=i.readVarint():2===e?t._features.push(i.pos):3===e?t._keys.push(i.readString()):4===e&&t._values.push(function(e){for(var t=null,i=e.readVarint()+e.pos;e.pos<i;){var r=e.readVarint()>>3;t=1===r?e.readString():2===r?e.readFloat():3===r?e.readDouble():4===r?e.readVarint64():5===r?e.readVarint():6===r?e.readSVarint():7===r?e.readBoolean():null}return t}(i))}function Zs(e,t,i){if(3===e){var r=new Hs(i,i.readVarint()+i.pos);r.length&&(t[r.name]=r)}}Ws.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new Us(this._pbf,t,this.extent,this._keys,this._values)};var Xs={VectorTile:function(e,t){this.layers=e.readFields(Zs,{},t)},VectorTileFeature:Us,VectorTileLayer:Hs};const $s=Xs.VectorTileFeature.types,Ys=Math.pow(2,13);function Js(e,t,i,r,n,a,o,s){e.emplaceBack((t<<1)+o,(i<<1)+a,(Math.floor(r*Ys)<<1)+n,Math.round(s))}class Ks{constructor(){this.acc=new r(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new r(e.x,e.y),this.max=new r(e.x,e.y))}append(e,t){this.currentPolyCount.edges++,this.acc._add(e);let i=!!this.borders;const r=this.min,n=this.max;e.x<r.x?(r.x=e.x,i=!0):e.x>n.x&&(n.x=e.x,i=!0),e.y<r.y?(r.y=e.y,i=!0):e.y>n.y&&(n.y=e.y,i=!0),((0===e.x||8192===e.x)&&e.x===t.x)!=((0===e.y||8192===e.y)&&e.y===t.y)&&this.processBorderOverlap(e,t),i&&this.checkBorderIntersection(e,t)}checkBorderIntersection(e,t){t.x<0!=e.x<0&&this.addBorderIntersection(0,Jt(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>8192!=e.x>8192&&this.addBorderIntersection(1,Jt(t.y,e.y,(8192-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,Jt(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>8192!=e.y>8192&&this.addBorderIntersection(3,Jt(t.x,e.x,(8192-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const i=this.borders[e];t<i[0]&&(i[0]=t),t>i[1]&&(i[1]=t)}processBorderOverlap(e,t){if(e.x===t.x){if(e.y===t.y)return;const i=0===e.x?0:1;this.addBorderIntersection(i,t.y),this.addBorderIntersection(i,e.y)}else{const i=0===e.y?2:3;this.addBorderIntersection(i,t.x),this.addBorderIntersection(i,e.x)}}centroid(){const e=this.polyCount.reduce(((e,t)=>e+t.edges),0);return 0!==e?this.acc.div(e)._round():new r(0,0)}span(){return new r(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce(((e,t)=>e+ +(t[0]!==Number.MAX_VALUE)),0)}}class Qs{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Bn,this.centroidVertexArray=new ea,this.indexArray=new Xn,this.programConfigurations=new ka(e.layers,e.zoom),this.segments=new Ua,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.enableTerrain=e.enableTerrain}populate(e,t,i){this.features=[],this.hasPattern=Rs("fill-extrusion",this.layers,t),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(e){const t=Math.exp(Math.PI*(1-e.y/(1<<e.z)*2));return 80150034*t/(t*t+1)/8192/(1<<e.z)}(i);for(const{feature:r,id:n,index:a,sourceLayerIndex:o}of e){const e=this.layers[0]._featureFilter.needGeometry,s=Ha(r,e);if(!this.layers[0]._featureFilter.filter(new mn(this.zoom),s,i))continue;const l={id:n,sourceLayerIndex:o,index:a,geometry:e?s.geometry:Ga(r),properties:r.properties,type:r.type,patterns:{}};this.hasPattern?this.features.push(Ds("fill-extrusion",this.layers,l,this.zoom,t)):this.addFeature(l,l.geometry,a,i,{}),t.featureIndex.insert(r,l.geometry,a,o,this.index)}this.sortBorders()}addFeatures(e,t,i){for(const e of this.features){const{geometry:r}=e;this.addFeature(e,r,e.index,t,i)}this.sortBorders()}update(e,t,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ns),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Fs.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,i,r,n){const a=this.enableTerrain&&e.properties&&e.properties.hasOwnProperty("type")&&e.properties.hasOwnProperty("height")&&"Polygon"===$s[e.type]?new Ks:null;for(const i of Ps(t,500)){let t=0,r=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(0===i.length||(o=i[0]).every((e=>e.x<=0))||o.every((e=>e.x>=8192))||o.every((e=>e.y<=0))||o.every((e=>e.y>=8192)))continue;for(let e=0;e<i.length;e++){const n=i[e];if(0===n.length)continue;t+=n.length;let o=0;a&&a.startRing(n[0]);for(let e=0;e<n.length;e++){const t=n[e];if(e>=1){const i=n[e-1];if(!el(t,i)){a&&a.append(t,i),r.vertexLength+4>Ua.MAX_VERTEX_ARRAY_LENGTH&&(r=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const e=t.sub(i)._perp(),n=e.x/(Math.abs(e.x)+Math.abs(e.y)),s=e.y>0?1:0,l=i.dist(t);o+l>32768&&(o=0),Js(this.layoutVertexArray,t.x,t.y,n,s,0,0,o),Js(this.layoutVertexArray,t.x,t.y,n,s,0,1,o),o+=l,Js(this.layoutVertexArray,i.x,i.y,n,s,0,0,o),Js(this.layoutVertexArray,i.x,i.y,n,s,0,1,o);const c=r.vertexLength;this.indexArray.emplaceBack(c,c+2,c+1),this.indexArray.emplaceBack(c+1,c+2,c+3),r.vertexLength+=4,r.primitiveLength+=2}}}}if(r.vertexLength+t>Ua.MAX_VERTEX_ARRAY_LENGTH&&(r=this.segments.prepareSegment(t,this.layoutVertexArray,this.indexArray)),"Polygon"!==$s[e.type])continue;const n=[],s=[],l=r.vertexLength;for(let e=0;e<i.length;e++){const t=i[e];if(0!==t.length){t!==i[0]&&s.push(n.length/2);for(let e=0;e<t.length;e++){const i=t[e];Js(this.layoutVertexArray,i.x,i.y,0,0,1,1,0),n.push(i.x),n.push(i.y),a&&a.currentPolyCount.top++}}}const c=Qo(n,s);for(let e=0;e<c.length;e+=3)this.indexArray.emplaceBack(l+c[e],l+c[e+2],l+c[e+1]);r.primitiveLength+=c.length/3,r.vertexLength+=t}var o;if(a&&a.polyCount.length>0){if(a.borders){a.vertexArrayOffset=this.centroidVertexArray.length;const e=a.borders,t=this.featuresOnBorder.push(a)-1;for(let i=0;i<4;i++)e[i][0]!==Number.MAX_VALUE&&this.borders[i].push(t)}this.encodeCentroid(a.borders?void 0:a.centroid(),a)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,n,r)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort(((t,i)=>this.featuresOnBorder[t].borders[e][0]-this.featuresOnBorder[i].borders[e][0]))}encodeCentroid(e,t,i=!0){let r,n;if(e)if(0!==e.y){const i=t.span()._mult(this.tileToMeter);r=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(i.x/10)),n=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(i.y/10))}else r=Math.ceil(7.3*e.x),n=0;else r=0,n=+i;let a=i?this.centroidVertexArray.length:t.vertexArrayOffset;for(const e of t.polyCount){i&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*e.edges+e.top);for(let t=0;t<2*e.edges;t++)this.centroidVertexArray.emplace(a++,0,n),this.centroidVertexArray.emplace(a++,r,n);for(let t=0;t<e.top;t++)this.centroidVertexArray.emplace(a++,r,n)}}}function el(e,t){return e.x===t.x&&(e.x<0||e.x>8192)||e.y===t.y&&(e.y<0||e.y>8192)}Hr("FillExtrusionBucket",Qs,{omit:["layers","features"]}),Hr("PartMetadata",Ks);var tl={paint:new Ln({"fill-extrusion-opacity":new Tn(ze["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Sn(ze["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Tn(ze["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Tn(ze["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new En(ze["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Sn(ze["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Sn(ze["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Tn(ze["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function il(e,t){return e.x*t.x+e.y*t.y}function rl(e,t){if(1===e.length){let i=0;const r=t[i++];let n;for(;!n||r.equals(n);)if(n=t[i++],!n)return 1/0;for(;i<t.length;i++){const a=t[i],o=e[0],s=n.sub(r),l=a.sub(r),c=o.sub(r),h=il(s,s),u=il(s,l),d=il(l,l),p=il(c,s),f=il(c,l),m=h*d-u*u,g=(d*p-u*f)/m,y=(h*f-u*p)/m,v=r.z*(1-g-y)+n.z*g+a.z*y;if(isFinite(v))return v}return 1/0}{let e=1/0;for(const i of t)e=Math.min(e,i.z);return e}}const nl=kn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:al}=nl,ol=kn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:sl}=ol,ll=Xs.VectorTileFeature.types,cl=Math.cos(Math.PI/180*37.5);class hl{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((e=>{this.gradients[e.id]={}})),this.layoutVertexArray=new Fn,this.layoutVertexArray2=new Nn,this.indexArray=new Xn,this.programConfigurations=new ka(e.layers,e.zoom),this.segments=new Ua,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,i){this.hasPattern=Rs("line",this.layers,t);const r=this.layers[0].layout.get("line-sort-key"),n=[];for(const{feature:t,id:a,index:o,sourceLayerIndex:s}of e){const e=this.layers[0]._featureFilter.needGeometry,l=Ha(t,e);if(!this.layers[0]._featureFilter.filter(new mn(this.zoom),l,i))continue;const c=r?r.evaluate(l,{},i):void 0,h={id:a,properties:t.properties,type:t.type,sourceLayerIndex:s,index:o,geometry:e?l.geometry:Ga(t),patterns:{},sortKey:c};n.push(h)}r&&n.sort(((e,t)=>e.sortKey-t.sortKey));for(const r of n){const{geometry:n,index:a,sourceLayerIndex:o}=r;if(this.hasPattern){const e=Ds("line",this.layers,r,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(r,n,a,i,{});t.featureIndex.insert(e[a].feature,n,a,o,this.index)}}update(e,t,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,i)}addFeatures(e,t,i){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,sl)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,al),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,i,r,n){const a=this.layers[0].layout,o=a.get("line-join").evaluate(e,{}),s=a.get("line-cap"),l=a.get("line-miter-limit"),c=a.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const i of t)this.addLine(i,e,o,s,l,c);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,n,r)}addLine(e,t,i,r,n,a){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let t=0;t<e.length-1;t++)this.totalDistance+=e[t].dist(e[t+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const o="Polygon"===ll[t.type];let s=e.length;for(;s>=2&&e[s-1].equals(e[s-2]);)s--;let l=0;for(;l<s-1&&e[l].equals(e[l+1]);)l++;if(s<(o?3:2))return;"bevel"===i&&(n=1.05);const c=this.overscaling<=16?122880/(512*this.overscaling):0,h=this.segments.prepareSegment(10*s,this.layoutVertexArray,this.indexArray);let u,d,p,f,m;this.e1=this.e2=-1,o&&(u=e[s-2],m=e[l].sub(u)._unit()._perp());for(let t=l;t<s;t++){if(p=t===s-1?o?e[l+1]:void 0:e[t+1],p&&e[t].equals(p))continue;m&&(f=m),u&&(d=u),u=e[t],m=p?p.sub(u)._unit()._perp():f,f=f||m;let g=f.add(m);0===g.x&&0===g.y||g._unit();const y=f.x*m.x+f.y*m.y,v=g.x*m.x+g.y*m.y,_=0!==v?1/v:1/0,x=2*Math.sqrt(2-2*v),b=v<cl&&d&&p,w=f.x*m.y-f.y*m.x>0;if(b&&t>l){const e=u.dist(d);if(e>2*c){const t=u.sub(u.sub(d)._mult(c/e)._round());this.updateDistance(d,t),this.addCurrentVertex(t,f,0,0,h),d=t}}const M=d&&p;let T=M?i:o?"butt":r;if(M&&"round"===T&&(_<a?T="miter":_<=2&&(T="fakeround")),"miter"===T&&_>n&&(T="bevel"),"bevel"===T&&(_>2&&(T="flipbevel"),_<n&&(T="miter")),d&&this.updateDistance(d,u),"miter"===T)g._mult(_),this.addCurrentVertex(u,g,0,0,h);else if("flipbevel"===T){if(_>100)g=m.mult(-1);else{const e=_*f.add(m).mag()/f.sub(m).mag();g._perp()._mult(e*(w?-1:1))}this.addCurrentVertex(u,g,0,0,h),this.addCurrentVertex(u,g.mult(-1),0,0,h)}else if("bevel"===T||"fakeround"===T){const e=-Math.sqrt(_*_-1),t=w?e:0,i=w?0:e;if(d&&this.addCurrentVertex(u,f,t,i,h),"fakeround"===T){const e=Math.round(180*x/Math.PI/20);for(let t=1;t<e;t++){let i=t/e;if(.5!==i){const e=i-.5;i+=i*e*(i-1)*((1.0904+y*(y*(3.55645-1.43519*y)-3.2452))*e*e+(.848013+y*(.215638*y-1.06021)))}const r=m.sub(f)._mult(i)._add(f)._unit()._mult(w?-1:1);this.addHalfVertex(u,r.x,r.y,!1,w,0,h)}}p&&this.addCurrentVertex(u,m,-t,-i,h)}else if("butt"===T)this.addCurrentVertex(u,g,0,0,h);else if("square"===T){const e=d?1:-1;this.addCurrentVertex(u,g,e,e,h)}else"round"===T&&(d&&(this.addCurrentVertex(u,f,0,0,h),this.addCurrentVertex(u,f,1,1,h,!0)),p&&(this.addCurrentVertex(u,m,-1,-1,h,!0),this.addCurrentVertex(u,m,0,0,h)));if(b&&t<s-1){const e=u.dist(p);if(e>2*c){const t=u.add(p.sub(u)._mult(c/e)._round());this.updateDistance(u,t),this.addCurrentVertex(t,m,0,0,h),u=t}}}}addCurrentVertex(e,t,i,r,n,a=!1){const o=t.y*r-t.x,s=-t.y-t.x*r;this.addHalfVertex(e,t.x+t.y*i,t.y-t.x*i,a,!1,i,n),this.addHalfVertex(e,o,s,a,!0,-r,n)}addHalfVertex({x:e,y:t},i,r,n,a,o,s){this.layoutVertexArray.emplaceBack((e<<1)+(n?1:0),(t<<1)+(a?1:0),Math.round(63*i)+128,Math.round(63*r)+128,1+(0===o?0:o<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length);const l=s.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,l),s.primitiveLength++),a?this.e2=l:this.e1=l}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}Hr("LineBucket",hl,{omit:["layers","patternFeatures"]});const ul=new Ln({"line-cap":new Tn(ze.layout_line["line-cap"]),"line-join":new Sn(ze.layout_line["line-join"]),"line-miter-limit":new Tn(ze.layout_line["line-miter-limit"]),"line-round-limit":new Tn(ze.layout_line["line-round-limit"]),"line-sort-key":new Sn(ze.layout_line["line-sort-key"])});var dl={paint:new Ln({"line-opacity":new Sn(ze.paint_line["line-opacity"]),"line-color":new Sn(ze.paint_line["line-color"]),"line-translate":new Tn(ze.paint_line["line-translate"]),"line-translate-anchor":new Tn(ze.paint_line["line-translate-anchor"]),"line-width":new Sn(ze.paint_line["line-width"]),"line-gap-width":new Sn(ze.paint_line["line-gap-width"]),"line-offset":new Sn(ze.paint_line["line-offset"]),"line-blur":new Sn(ze.paint_line["line-blur"]),"line-dasharray":new An(ze.paint_line["line-dasharray"]),"line-pattern":new En(ze.paint_line["line-pattern"]),"line-gradient":new Cn(ze.paint_line["line-gradient"])}),layout:ul};const pl=new class extends Sn{possiblyEvaluate(e,t){return t=new mn(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,i,r){return t=y({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,i,r)}}(dl.paint.properties["line-width"].specification);function fl(e,t){return t>0?t+2*e:e}pl.useIntegerZoom=!0;const ml=kn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),gl=kn([{name:"a_projected_pos",components:3,type:"Float32"}],4),yl=(kn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),kn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),vl=kn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]),_l=(kn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),kn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),xl=kn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function bl(e,t){const{expression:i}=t;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new mn(e+1))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:t,interpolationType:r}=i;let n=0;for(;n<t.length&&t[n]<=e;)n++;n=Math.max(0,n-1);let a=n;for(;a<t.length&&t[a]<e+1;)a++;a=Math.min(t.length-1,a);const o=t[n],s=t[a];return"composite"===i.kind?{kind:"composite",minZoom:o,maxZoom:s,interpolationType:r}:{kind:"camera",minZoom:o,maxZoom:s,minSize:i.evaluate(new mn(o)),maxSize:i.evaluate(new mn(s)),interpolationType:r}}}function wl(e,{uSize:t,uSizeT:i},{lowerSize:r,upperSize:n}){return"source"===e.kind?r/128:"composite"===e.kind?Jt(r/128,n/128,i):t}function Ml(e,t){let i=0,r=0;if("constant"===e.kind)r=e.layoutSize;else if("source"!==e.kind){const{interpolationType:n,minZoom:a,maxZoom:o}=e,s=n?f(di.interpolationFactor(n,t,a,o),0,1):0;"camera"===e.kind?r=Jt(e.minSize,e.maxSize,s):i=s}return{uSizeT:i,uSize:r}}kn([{name:"triangle",components:3,type:"Uint16"}]),kn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),kn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),kn([{type:"Float32",name:"offsetX"}]),kn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Tl=Object.freeze({__proto__:null,getSizeData:bl,evaluateSizeForFeature:wl,evaluateSizeForZoom:Ml,SIZE_PACK_FACTOR:128});function Sl(e,t,i){return e.sections.forEach((e=>{e.text=function(e,t,i){const r=t.layout.get("text-transform").evaluate(i,{});return"uppercase"===r?e=e.toLocaleUpperCase():"lowercase"===r&&(e=e.toLocaleLowerCase()),fn.applyArabicShaping&&(e=fn.applyArabicShaping(e)),e}(e.text,t,i)})),e}const El={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Al=function(e,t,i,r,n){var a,o,s=8*n-r-1,l=(1<<s)-1,c=l>>1,h=-7,u=i?n-1:0,d=i?-1:1,p=e[t+u];for(u+=d,a=p&(1<<-h)-1,p>>=-h,h+=s;h>0;a=256*a+e[t+u],u+=d,h-=8);for(o=a&(1<<-h)-1,a>>=-h,h+=r;h>0;o=256*o+e[t+u],u+=d,h-=8);if(0===a)a=1-c;else{if(a===l)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,r),a-=c}return(p?-1:1)*o*Math.pow(2,a-r)},Cl=function(e,t,i,r,n,a){var o,s,l,c=8*a-n-1,h=(1<<c)-1,u=h>>1,d=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:a-1,f=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=h):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+u>=1?d/l:d*Math.pow(2,1-u))*l>=2&&(o++,l/=2),o+u>=h?(s=0,o=h):o+u>=1?(s=(t*l-1)*Math.pow(2,n),o+=u):(s=t*Math.pow(2,u-1)*Math.pow(2,n),o=0));n>=8;e[i+p]=255&s,p+=f,s/=256,n-=8);for(o=o<<n|s,c+=n;c>0;e[i+p]=255&o,p+=f,o/=256,c-=8);e[i+p-f]|=128*m},Ll=Pl;function Pl(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}Pl.Varint=0,Pl.Fixed64=1,Pl.Bytes=2,Pl.Fixed32=5;var Il="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Rl(e){return e.type===Pl.Bytes?e.readVarint()+e.pos:e.pos+1}function Dl(e,t,i){return i?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function kl(e,t,i){var r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(r);for(var n=i.pos-1;n>=e;n--)i.buf[n+r]=i.buf[n]}function zl(e,t){for(var i=0;i<e.length;i++)t.writeVarint(e[i])}function Ol(e,t){for(var i=0;i<e.length;i++)t.writeSVarint(e[i])}function Bl(e,t){for(var i=0;i<e.length;i++)t.writeFloat(e[i])}function Fl(e,t){for(var i=0;i<e.length;i++)t.writeDouble(e[i])}function Nl(e,t){for(var i=0;i<e.length;i++)t.writeBoolean(e[i])}function Ul(e,t){for(var i=0;i<e.length;i++)t.writeFixed32(e[i])}function jl(e,t){for(var i=0;i<e.length;i++)t.writeSFixed32(e[i])}function Vl(e,t){for(var i=0;i<e.length;i++)t.writeFixed64(e[i])}function Gl(e,t){for(var i=0;i<e.length;i++)t.writeSFixed64(e[i])}function Hl(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function Wl(e,t,i){e[i]=t,e[i+1]=t>>>8,e[i+2]=t>>>16,e[i+3]=t>>>24}function ql(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function Zl(e,t,i){1===e&&i.readMessage(Xl,t)}function Xl(e,t,i){if(3===e){const{id:e,bitmap:r,width:n,height:a,left:o,top:s,advance:l}=i.readMessage($l,{});t.push({id:e,bitmap:new qo({width:n+6,height:a+6},r),metrics:{width:n,height:a,left:o,top:s,advance:l}})}}function $l(e,t,i){1===e?t.id=i.readVarint():2===e?t.bitmap=i.readBytes():3===e?t.width=i.readVarint():4===e?t.height=i.readVarint():5===e?t.left=i.readSVarint():6===e?t.top=i.readSVarint():7===e&&(t.advance=i.readVarint())}function Yl(e){let t=0,i=0;for(const r of e)t+=r.w*r.h,i=Math.max(i,r.w);e.sort(((e,t)=>t.h-e.h));const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}];let n=0,a=0;for(const t of e)for(let e=r.length-1;e>=0;e--){const i=r[e];if(!(t.w>i.w||t.h>i.h)){if(t.x=i.x,t.y=i.y,a=Math.max(a,t.y+t.h),n=Math.max(n,t.x+t.w),t.w===i.w&&t.h===i.h){const t=r.pop();e<r.length&&(r[e]=t)}else t.h===i.h?(i.x+=t.w,i.w-=t.w):t.w===i.w?(i.y+=t.h,i.h-=t.h):(r.push({x:i.x+t.w,y:i.y,w:i.w-t.w,h:t.h}),i.y+=t.h,i.h-=t.h);break}}return{w:n,h:a,fill:t/(n*a)||0}}Pl.prototype={destroy:function(){this.buf=null},readFields:function(e,t,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),n=r>>3,a=this.pos;this.type=7&r,e(n,t,this),this.pos===a&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=Hl(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=ql(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=Hl(this.buf,this.pos)+4294967296*Hl(this.buf,this.pos+4);return this.pos+=8,e},readSFixed64:function(){var e=Hl(this.buf,this.pos)+4294967296*ql(this.buf,this.pos+4);return this.pos+=8,e},readFloat:function(){var e=Al(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Al(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,i,r=this.buf;return t=127&(i=r[this.pos++]),i<128?t:(t|=(127&(i=r[this.pos++]))<<7,i<128?t:(t|=(127&(i=r[this.pos++]))<<14,i<128?t:(t|=(127&(i=r[this.pos++]))<<21,i<128?t:function(e,t,i){var r,n,a=i.buf;if(r=(112&(n=a[i.pos++]))>>4,n<128)return Dl(e,r,t);if(r|=(127&(n=a[i.pos++]))<<3,n<128)return Dl(e,r,t);if(r|=(127&(n=a[i.pos++]))<<10,n<128)return Dl(e,r,t);if(r|=(127&(n=a[i.pos++]))<<17,n<128)return Dl(e,r,t);if(r|=(127&(n=a[i.pos++]))<<24,n<128)return Dl(e,r,t);if(r|=(1&(n=a[i.pos++]))<<31,n<128)return Dl(e,r,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(i=r[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&Il?function(e,t,i){return Il.decode(e.subarray(t,i))}(this.buf,t,e):function(e,t,i){for(var r="",n=t;n<i;){var a,o,s,l=e[n],c=null,h=l>239?4:l>223?3:l>191?2:1;if(n+h>i)break;1===h?l<128&&(c=l):2===h?128==(192&(a=e[n+1]))&&(c=(31&l)<<6|63&a)<=127&&(c=null):3===h?(o=e[n+2],128==(192&(a=e[n+1]))&&128==(192&o)&&((c=(15&l)<<12|(63&a)<<6|63&o)<=2047||c>=55296&&c<=57343)&&(c=null)):4===h&&(o=e[n+2],s=e[n+3],128==(192&(a=e[n+1]))&&128==(192&o)&&128==(192&s)&&((c=(15&l)<<18|(63&a)<<12|(63&o)<<6|63&s)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,h=1):c>65535&&(c-=65536,r+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),r+=String.fromCharCode(c),n+=h}return r}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==Pl.Bytes)return e.push(this.readVarint(t));var i=Rl(this);for(e=e||[];this.pos<i;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==Pl.Bytes)return e.push(this.readSVarint());var t=Rl(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==Pl.Bytes)return e.push(this.readBoolean());var t=Rl(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==Pl.Bytes)return e.push(this.readFloat());var t=Rl(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==Pl.Bytes)return e.push(this.readDouble());var t=Rl(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==Pl.Bytes)return e.push(this.readFixed32());var t=Rl(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==Pl.Bytes)return e.push(this.readSFixed32());var t=Rl(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==Pl.Bytes)return e.push(this.readFixed64());var t=Rl(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==Pl.Bytes)return e.push(this.readSFixed64());var t=Rl(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===Pl.Varint)for(;this.buf[this.pos++]>127;);else if(t===Pl.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Pl.Fixed32)this.pos+=4;else{if(t!==Pl.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),Wl(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),Wl(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),Wl(this.buf,-1&e,this.pos),Wl(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),Wl(this.buf,-1&e,this.pos),Wl(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var i,r;if(e>=0?(i=e%4294967296|0,r=e/4294967296|0):(r=~(-e/4294967296),4294967295^(i=~(-e%4294967296))?i=i+1|0:(i=0,r=r+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,i){i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,i.buf[i.pos]=127&(e>>>=7)}(i,0,t),function(e,t){var i=(7&e)<<4;t.buf[t.pos++]|=i|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(r,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,i){for(var r,n,a=0;a<t.length;a++){if((r=t.charCodeAt(a))>55295&&r<57344){if(!n){r>56319||a+1===t.length?(e[i++]=239,e[i++]=191,e[i++]=189):n=r;continue}if(r<56320){e[i++]=239,e[i++]=191,e[i++]=189,n=r;continue}r=n-55296<<10|r-56320|65536,n=null}else n&&(e[i++]=239,e[i++]=191,e[i++]=189,n=null);r<128?e[i++]=r:(r<2048?e[i++]=r>>6|192:(r<65536?e[i++]=r>>12|224:(e[i++]=r>>18|240,e[i++]=r>>12&63|128),e[i++]=r>>6&63|128),e[i++]=63&r|128)}return i}(this.buf,e,this.pos);var i=this.pos-t;i>=128&&kl(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(e){this.realloc(4),Cl(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),Cl(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=e[i]},writeRawMessage:function(e,t){this.pos++;var i=this.pos;e(t,this);var r=this.pos-i;r>=128&&kl(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(e,t,i){this.writeTag(e,Pl.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,zl,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,Ol,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,Nl,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,Bl,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,Fl,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,Ul,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,jl,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,Vl,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,Gl,t)},writeBytesField:function(e,t){this.writeTag(e,Pl.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,Pl.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,Pl.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,Pl.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,Pl.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,Pl.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,Pl.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,Pl.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,Pl.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,Pl.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};class Jl{constructor(e,{pixelRatio:t,version:i,stretchX:r,stretchY:n,content:a}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=r,this.stretchY=n,this.content=a,this.version=i}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Kl{constructor(e,t){const i={},r={};this.haveRenderCallbacks=[];const n=[];this.addImages(e,i,n),this.addImages(t,r,n);const{w:a,h:o}=Yl(n),s=new Zo({width:a||1,height:o||1});for(const t in e){const r=e[t],n=i[t].paddedRect;Zo.copy(r.data,s,{x:0,y:0},{x:n.x+1,y:n.y+1},r.data)}for(const e in t){const i=t[e],n=r[e].paddedRect,a=n.x+1,o=n.y+1,l=i.data.width,c=i.data.height;Zo.copy(i.data,s,{x:0,y:0},{x:a,y:o},i.data),Zo.copy(i.data,s,{x:0,y:c-1},{x:a,y:o-1},{width:l,height:1}),Zo.copy(i.data,s,{x:0,y:0},{x:a,y:o+c},{width:l,height:1}),Zo.copy(i.data,s,{x:l-1,y:0},{x:a-1,y:o},{width:1,height:c}),Zo.copy(i.data,s,{x:0,y:0},{x:a+l,y:o},{width:1,height:c})}this.image=s,this.iconPositions=i,this.patternPositions=r}addImages(e,t,i){for(const r in e){const n=e[r],a={x:0,y:0,w:n.data.width+2,h:n.data.height+2};i.push(a),t[r]=new Jl(a,n),n.hasRenderCallback&&this.haveRenderCallbacks.push(r)}}patchUpdatedImages(e,t){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const i in e.updatedImages)this.patchUpdatedImage(this.iconPositions[i],e.getImage(i),t),this.patchUpdatedImage(this.patternPositions[i],e.getImage(i),t)}patchUpdatedImage(e,t,i){if(!e||!t)return;if(e.version===t.version)return;e.version=t.version;const[r,n]=e.tl;i.update(t.data,void 0,{x:r,y:n})}}Hr("ImagePosition",Jl),Hr("ImageAtlas",Kl);const Ql={horizontal:1,vertical:2,horizontalOnly:3};class ec{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,t){const i=new ec;return i.scale=e||1,i.fontStack=t,i}static forImage(e){const t=new ec;return t.imageName=e,t}}class tc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t){const i=new tc;for(let r=0;r<e.sections.length;r++){const n=e.sections[r];n.image?i.addImageSection(n):i.addTextSection(n,t)}return i}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let t="";for(let i=0;i<e.length;i++){const r=e.charCodeAt(i+1)||null,n=e.charCodeAt(i-1)||null;t+=r&&tn(r)&&!El[e[i+1]]||n&&tn(n)&&!El[e[i-1]]||!El[e[i]]?e[i]:El[e[i]]}return t}(this.text)}trim(){let e=0;for(let t=0;t<this.text.length&&rc[this.text.charCodeAt(t)];t++)e++;let t=this.text.length;for(let i=this.text.length-1;i>=0&&i>=e&&rc[this.text.charCodeAt(i)];i--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const i=new tc;return i.text=this.text.substring(e,t),i.sectionIndex=this.sectionIndex.slice(e,t),i.sections=this.sections,i}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,t)=>Math.max(e,this.sections[t].scale)),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(ec.forText(e.scale,e.fontStack||t));const i=this.sections.length-1;for(let t=0;t<e.text.length;++t)this.sectionIndex.push(i)}addImageSection(e){const t=e.image?e.image.name:"";if(0===t.length)return void C("Can't add FormattedSection with an empty image.");const i=this.getNextImageSectionCharCode();i?(this.text+=String.fromCharCode(i),this.sections.push(ec.forImage(t)),this.sectionIndex.push(this.sections.length-1)):C("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ic(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m){const g=tc.fromFeature(e,n);let y;u===Ql.vertical&&g.verticalizePunctuation();const{processBidirectionalText:v,processStyledBidirectionalText:_}=fn;if(v&&1===g.sections.length){y=[];const e=v(g.toString(),cc(g,c,a,t,r,p,f));for(const t of e){const e=new tc;e.text=t,e.sections=g.sections;for(let i=0;i<t.length;i++)e.sectionIndex.push(0);y.push(e)}}else if(_){y=[];const e=_(g.text,g.sectionIndex,cc(g,c,a,t,r,p,f));for(const t of e){const e=new tc;e.text=t[0],e.sectionIndex=t[1],e.sections=g.sections,y.push(e)}}else y=function(e,t){const i=[],r=e.text;let n=0;for(const r of t)i.push(e.substring(n,r)),n=r;return n<r.length&&i.push(e.substring(n,r.length)),i}(g,cc(g,c,a,t,r,p,f));const x=[],b={positionedLines:x,text:g.toString(),top:h[1],bottom:h[1],left:h[0],right:h[0],writingMode:u,iconsInText:!1,verticalizable:!1};return function(e,t,i,r,n,a,o,s,l,c,h,u){let d=0,p=-17,f=0,m=0;const g="right"===s?1:"left"===s?0:.5;let y=0;for(const o of n){o.trim();const n=o.getMaxScale(),s=24*(n-1),_={positionedGlyphs:[],lineOffset:0};e.positionedLines[y]=_;const x=_.positionedGlyphs;let b=0;if(!o.length()){p+=a,++y;continue}for(let a=0;a<o.length();a++){const f=o.getSection(a),m=o.getSectionIndex(a),g=o.getCharCode(a);let y=0,_=null,w=null,M=null,T=24;const S=!(l===Ql.horizontal||!h&&!en(g)||h&&(rc[g]||(v=g,Yr.Arabic(v)||Yr["Arabic Supplement"](v)||Yr["Arabic Extended-A"](v)||Yr["Arabic Presentation Forms-A"](v)||Yr["Arabic Presentation Forms-B"](v))));if(f.imageName){const t=r[f.imageName];if(!t)continue;M=f.imageName,e.iconsInText=e.iconsInText||!0,w=t.paddedRect;const i=t.displaySize;f.scale=24*f.scale/u,_={width:i[0],height:i[1],left:1,top:-3,advance:S?i[1]:i[0]},y=s+(24-i[1]*f.scale),T=_.advance;const a=S?i[0]*f.scale-24*n:i[1]*f.scale-24*n;a>0&&a>b&&(b=a)}else{const e=i[f.fontStack],r=e&&e[g];if(r&&r.rect)w=r.rect,_=r.metrics;else{const e=t[f.fontStack],i=e&&e[g];if(!i)continue;_=i.metrics}y=24*(n-f.scale)}S?(e.verticalizable=!0,x.push({glyph:g,imageName:M,x:d,y:p+y,vertical:S,scale:f.scale,fontStack:f.fontStack,sectionIndex:m,metrics:_,rect:w}),d+=T*f.scale+c):(x.push({glyph:g,imageName:M,x:d,y:p+y,vertical:S,scale:f.scale,fontStack:f.fontStack,sectionIndex:m,metrics:_,rect:w}),d+=_.advance*f.scale+c)}0!==x.length&&(f=Math.max(d-c,f),uc(x,0,x.length-1,g,b)),d=0;const w=a*n+b;_.lineOffset=Math.max(b,s),p+=w,m=Math.max(w,m),++y}var v;const _=p- -17,{horizontalAlign:x,verticalAlign:b}=hc(o);(function(e,t,i,r,n,a,o,s,l){const c=(t-i)*n;let h=0;h=a!==o?-s*r- -17:(-r*l+.5)*o;for(const t of e)for(const e of t.positionedGlyphs)e.x+=c,e.y+=h})(e.positionedLines,g,x,b,f,m,a,_,n.length),e.top+=-b*_,e.bottom=e.top+_,e.left+=-x*f,e.right=e.left+f}(b,t,i,r,y,o,s,l,u,c,d,m),!function(e){for(const t of e)if(0!==t.positionedGlyphs.length)return!1;return!0}(x)&&b}const rc={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},nc={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function ac(e,t,i,r,n,a){if(t.imageName){const e=r[t.imageName];return e?e.displaySize[0]*t.scale*24/a+n:0}{const r=i[t.fontStack],a=r&&r[e];return a?a.metrics.advance*t.scale+n:0}}function oc(e,t,i,r){const n=Math.pow(e-t,2);return r?e<t?n/2:2*n:n+Math.abs(i)*i}function sc(e,t,i){let r=0;return 10===e&&(r-=1e4),i&&(r+=150),40!==e&&65288!==e||(r+=50),41!==t&&65289!==t||(r+=50),r}function lc(e,t,i,r,n,a){let o=null,s=oc(t,i,n,a);for(const e of r){const r=oc(t-e.x,i,n,a)+e.badness;r<=s&&(o=e,s=r)}return{index:e,x:t,priorBreak:o,badness:s}}function cc(e,t,i,r,n,a,o){if("point"!==a)return[];if(!e)return[];const s=[],l=function(e,t,i,r,n,a){let o=0;for(let i=0;i<e.length();i++){const s=e.getSection(i);o+=ac(e.getCharCode(i),s,r,n,t,a)}return o/Math.max(1,Math.ceil(o/i))}(e,t,i,r,n,o),c=e.text.indexOf("​")>=0;let h=0;for(let i=0;i<e.length();i++){const a=e.getSection(i),d=e.getCharCode(i);if(rc[d]||(h+=ac(d,a,r,n,t,o)),i<e.length()-1){const t=!((u=d)<11904||!(Yr["Bopomofo Extended"](u)||Yr.Bopomofo(u)||Yr["CJK Compatibility Forms"](u)||Yr["CJK Compatibility Ideographs"](u)||Yr["CJK Compatibility"](u)||Yr["CJK Radicals Supplement"](u)||Yr["CJK Strokes"](u)||Yr["CJK Symbols and Punctuation"](u)||Yr["CJK Unified Ideographs Extension A"](u)||Yr["CJK Unified Ideographs"](u)||Yr["Enclosed CJK Letters and Months"](u)||Yr["Halfwidth and Fullwidth Forms"](u)||Yr.Hiragana(u)||Yr["Ideographic Description Characters"](u)||Yr["Kangxi Radicals"](u)||Yr["Katakana Phonetic Extensions"](u)||Yr.Katakana(u)||Yr["Vertical Forms"](u)||Yr["Yi Radicals"](u)||Yr["Yi Syllables"](u)));(nc[d]||t||a.imageName)&&s.push(lc(i+1,h,l,s,sc(d,e.getCharCode(i+1),t&&c),!1))}}var u;return function e(t){return t?e(t.priorBreak).concat(t.index):[]}(lc(e.length(),h,l,s,0,!0))}function hc(e){let t=.5,i=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function uc(e,t,i,r,n){if(!r&&!n)return;const a=e[i],o=(e[i].x+a.metrics.advance*a.scale)*r;for(let r=t;r<=i;r++)e[r].x-=o,e[r].y+=n}function dc(e,t,i){const{horizontalAlign:r,verticalAlign:n}=hc(i),a=t[0]-e.displaySize[0]*r,o=t[1]-e.displaySize[1]*n;return{image:e,top:o,bottom:o+e.displaySize[1],left:a,right:a+e.displaySize[0]}}function pc(e,t,i,r,n,a){const o=e.image;let s;if(o.content){const e=o.content,t=o.pixelRatio||1;s=[e[0]/t,e[1]/t,o.displaySize[0]-e[2]/t,o.displaySize[1]-e[3]/t]}const l=t.left*a,c=t.right*a;let h,u,d,p;"width"===i||"both"===i?(p=n[0]+l-r[3],u=n[0]+c+r[1]):(p=n[0]+(l+c-o.displaySize[0])/2,u=p+o.displaySize[0]);const f=t.top*a,m=t.bottom*a;return"height"===i||"both"===i?(h=n[1]+f-r[0],d=n[1]+m+r[2]):(h=n[1]+(f+m-o.displaySize[1])/2,d=h+o.displaySize[1]),{image:o,top:h,right:u,bottom:d,left:p,collisionPadding:s}}class fc extends r{constructor(e,t,i,r){super(e,t),this.angle=i,void 0!==r&&(this.segment=r)}clone(){return new fc(this.x,this.y,this.angle,this.segment)}}function mc(e,t,i,r,n){if(void 0===t.segment)return!0;let a=t,o=t.segment+1,s=0;for(;s>-i/2;){if(o--,o<0)return!1;s-=e[o].dist(a),a=e[o]}s+=e[o].dist(e[o+1]),o++;const l=[];let c=0;for(;s<i/2;){const t=e[o],i=e[o+1];if(!i)return!1;let a=e[o-1].angleTo(t)-t.angleTo(i);for(a=Math.abs((a+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:s,angleDelta:a}),c+=a;s-l[0].distance>r;)c-=l.shift().angleDelta;if(c>n)return!1;o++,s+=t.dist(i)}return!0}function gc(e){let t=0;for(let i=0;i<e.length-1;i++)t+=e[i].dist(e[i+1]);return t}function yc(e,t,i){return e?.6*t*i:0}function vc(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function _c(e,t,i,r,n,a){const o=yc(i,n,a),s=vc(i,r)*a;let l=0;const c=gc(e)/2;for(let i=0;i<e.length-1;i++){const r=e[i],n=e[i+1],a=r.dist(n);if(l+a>c){const h=(c-l)/a,u=Jt(r.x,n.x,h),d=Jt(r.y,n.y,h),p=new fc(u,d,n.angleTo(r),i);return p._round(),!o||mc(e,p,s,o,t)?p:void 0}l+=a}}function xc(e,t,i,r,n,a,o,s,l){const c=yc(r,a,o),h=vc(r,n),u=h*o,d=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l;return t-u<t/4&&(t=u+t/4),function e(t,i,r,n,a,o,s,l,c){const h=o/2,u=gc(t);let d=0,p=i-r,f=[];for(let e=0;e<t.length-1;e++){const i=t[e],s=t[e+1],l=i.dist(s),m=s.angleTo(i);for(;p+r<d+l;){p+=r;const g=(p-d)/l,y=Jt(i.x,s.x,g),v=Jt(i.y,s.y,g);if(y>=0&&y<c&&v>=0&&v<c&&p-h>=0&&p+h<=u){const i=new fc(y,v,m,e);i._round(),n&&!mc(t,i,o,n,a)||f.push(i)}}d+=l}return l||f.length||s||(f=e(t,d/2,r,n,a,o,s,!0,c)),f}(e,d?t/2*s%t:(h/2+2*a)*o*s%t,t,c,i,u,d,!1,l)}function bc(e,t,i,n,a){const o=[];for(let s=0;s<e.length;s++){const l=e[s];let c;for(let e=0;e<l.length-1;e++){let s=l[e],h=l[e+1];s.x<t&&h.x<t||(s.x<t?s=new r(t,s.y+(t-s.x)/(h.x-s.x)*(h.y-s.y))._round():h.x<t&&(h=new r(t,s.y+(t-s.x)/(h.x-s.x)*(h.y-s.y))._round()),s.y<i&&h.y<i||(s.y<i?s=new r(s.x+(i-s.y)/(h.y-s.y)*(h.x-s.x),i)._round():h.y<i&&(h=new r(s.x+(i-s.y)/(h.y-s.y)*(h.x-s.x),i)._round()),s.x>=n&&h.x>=n||(s.x>=n?s=new r(n,s.y+(n-s.x)/(h.x-s.x)*(h.y-s.y))._round():h.x>=n&&(h=new r(n,s.y+(n-s.x)/(h.x-s.x)*(h.y-s.y))._round()),s.y>=a&&h.y>=a||(s.y>=a?s=new r(s.x+(a-s.y)/(h.y-s.y)*(h.x-s.x),a)._round():h.y>=a&&(h=new r(s.x+(a-s.y)/(h.y-s.y)*(h.x-s.x),a)._round()),c&&s.equals(c[c.length-1])||(c=[s],o.push(c)),c.push(h)))))}}return o}function wc(e,t,i,n){const a=[],o=e.image,s=o.pixelRatio,l=o.paddedRect.w-2,c=o.paddedRect.h-2,h=e.right-e.left,u=e.bottom-e.top,d=o.stretchX||[[0,l]],p=o.stretchY||[[0,c]],f=(e,t)=>e+t[1]-t[0],m=d.reduce(f,0),g=p.reduce(f,0),y=l-m,v=c-g;let _=0,x=m,b=0,w=g,M=0,T=y,S=0,E=v;if(o.content&&n){const e=o.content;_=Mc(d,0,e[0]),b=Mc(p,0,e[1]),x=Mc(d,e[0],e[2]),w=Mc(p,e[1],e[3]),M=e[0]-_,S=e[1]-b,T=e[2]-e[0]-x,E=e[3]-e[1]-w}const A=(n,a,l,c)=>{const d=Sc(n.stretch-_,x,h,e.left),p=Ec(n.fixed-M,T,n.stretch,m),f=Sc(a.stretch-b,w,u,e.top),y=Ec(a.fixed-S,E,a.stretch,g),v=Sc(l.stretch-_,x,h,e.left),A=Ec(l.fixed-M,T,l.stretch,m),C=Sc(c.stretch-b,w,u,e.top),L=Ec(c.fixed-S,E,c.stretch,g),P=new r(d,f),I=new r(v,f),R=new r(v,C),D=new r(d,C),k=new r(p/s,y/s),z=new r(A/s,L/s),O=t*Math.PI/180;if(O){const e=Math.sin(O),t=Math.cos(O),i=[t,-e,e,t];P._matMult(i),I._matMult(i),D._matMult(i),R._matMult(i)}const B=n.stretch+n.fixed,F=a.stretch+a.fixed;return{tl:P,tr:I,bl:D,br:R,tex:{x:o.paddedRect.x+1+B,y:o.paddedRect.y+1+F,w:l.stretch+l.fixed-B,h:c.stretch+c.fixed-F},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:k,pixelOffsetBR:z,minFontScaleX:T/s/h,minFontScaleY:E/s/u,isSDF:i}};if(n&&(o.stretchX||o.stretchY)){const e=Tc(d,y,m),t=Tc(p,v,g);for(let i=0;i<e.length-1;i++){const r=e[i],n=e[i+1];for(let e=0;e<t.length-1;e++)a.push(A(r,t[e],n,t[e+1]))}}else a.push(A({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:l+1},{fixed:0,stretch:c+1}));return a}function Mc(e,t,i){let r=0;for(const n of e)r+=Math.max(t,Math.min(i,n[1]))-Math.max(t,Math.min(i,n[0]));return r}function Tc(e,t,i){const r=[{fixed:-1,stretch:0}];for(const[t,i]of e){const e=r[r.length-1];r.push({fixed:t-e.stretch,stretch:e.stretch}),r.push({fixed:t-e.stretch,stretch:e.stretch+(i-t)})}return r.push({fixed:t+1,stretch:i}),r}function Sc(e,t,i,r){return e/t*i+r}function Ec(e,t,i,r){return e-t*i/r}Hr("Anchor",fc);class Ac{constructor(e=[],t=Cc){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this._down(e)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:i}=this,r=t[e];for(;e>0;){const n=e-1>>1,a=t[n];if(i(r,a)>=0)break;t[e]=a,e=n}t[e]=r}_down(e){const{data:t,compare:i}=this,r=this.length>>1,n=t[e];for(;e<r;){let r=1+(e<<1),a=t[r];const o=r+1;if(o<this.length&&i(t[o],a)<0&&(r=o,a=t[o]),i(a,n)>=0)break;t[e]=a,e=r}t[e]=n}}function Cc(e,t){return e<t?-1:e>t?1:0}function Lc(e,t=1,i=!1){let n=1/0,a=1/0,o=-1/0,s=-1/0;const l=e[0];for(let e=0;e<l.length;e++){const t=l[e];(!e||t.x<n)&&(n=t.x),(!e||t.y<a)&&(a=t.y),(!e||t.x>o)&&(o=t.x),(!e||t.y>s)&&(s=t.y)}const c=Math.min(o-n,s-a);let h=c/2;const u=new Ac([],Pc);if(0===c)return new r(n,a);for(let t=n;t<o;t+=c)for(let i=a;i<s;i+=c)u.push(new Ic(t+h,i+h,h,e));let d=function(e){let t=0,i=0,r=0;const n=e[0];for(let e=0,a=n.length,o=a-1;e<a;o=e++){const a=n[e],s=n[o],l=a.x*s.y-s.x*a.y;i+=(a.x+s.x)*l,r+=(a.y+s.y)*l,t+=3*l}return new Ic(i/t,r/t,0,e)}(e),p=u.length;for(;u.length;){const r=u.pop();(r.d>d.d||!d.d)&&(d=r,i&&console.log("found best %d after %d probes",Math.round(1e4*r.d)/1e4,p)),r.max-d.d<=t||(h=r.h/2,u.push(new Ic(r.p.x-h,r.p.y-h,h,e)),u.push(new Ic(r.p.x+h,r.p.y-h,h,e)),u.push(new Ic(r.p.x-h,r.p.y+h,h,e)),u.push(new Ic(r.p.x+h,r.p.y+h,h,e)),p+=4)}return i&&(console.log(`num probes: ${p}`),console.log(`best distance: ${d.d}`)),d.p}function Pc(e,t){return t.max-e.max}function Ic(e,t,i,n){this.p=new r(e,t),this.h=i,this.d=function(e,t){let i=!1,r=1/0;for(let n=0;n<t.length;n++){const a=t[n];for(let t=0,n=a.length,o=n-1;t<n;o=t++){const n=a[t],s=a[o];n.y>e.y!=s.y>e.y&&e.x<(s.x-n.x)*(e.y-n.y)/(s.y-n.y)+n.x&&(i=!i),r=Math.min(r,eo(e,n,s))}}return(i?1:-1)*Math.sqrt(r)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}const Rc=Number.POSITIVE_INFINITY;function Dc(e,t){return t[1]!==Rc?function(e,t,i){let r=0,n=0;switch(t=Math.abs(t),i=Math.abs(i),e){case"top-right":case"top-left":case"top":n=i-7;break;case"bottom-right":case"bottom-left":case"bottom":n=7-i}switch(e){case"top-right":case"bottom-right":case"right":r=-t;break;case"top-left":case"bottom-left":case"left":r=t}return[r,n]}(e,t[0],t[1]):function(e,t){let i=0,r=0;t<0&&(t=0);const n=t/Math.sqrt(2);switch(e){case"top-right":case"top-left":r=n-7;break;case"bottom-right":case"bottom-left":r=7-n;break;case"bottom":r=7-t;break;case"top":r=t-7}switch(e){case"top-right":case"bottom-right":i=-n;break;case"top-left":case"bottom-left":i=n;break;case"left":i=t;break;case"right":i=-t}return[i,r]}(e,t[0])}function kc(e,t,i,r,n,a,o,s){e.createArrays(),e.tilePixelRatio=8192/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;const l=e.layers[0].layout,c=e.layers[0]._unevaluatedLayout._values,h={};if("composite"===e.textSizeData.kind){const{minZoom:t,maxZoom:i}=e.textSizeData;h.compositeTextSizes=[c["text-size"].possiblyEvaluate(new mn(t),o),c["text-size"].possiblyEvaluate(new mn(i),o)]}if("composite"===e.iconSizeData.kind){const{minZoom:t,maxZoom:i}=e.iconSizeData;h.compositeIconSizes=[c["icon-size"].possiblyEvaluate(new mn(t),o),c["icon-size"].possiblyEvaluate(new mn(i),o)]}h.layoutTextSize=c["text-size"].possiblyEvaluate(new mn(s+1),o),h.layoutIconSize=c["icon-size"].possiblyEvaluate(new mn(s+1),o),h.textMaxSize=c["text-size"].possiblyEvaluate(new mn(18),o);const u=24*l.get("text-line-height"),d="map"===l.get("text-rotation-alignment")&&"point"!==l.get("symbol-placement"),p=l.get("text-keep-upright"),f=l.get("text-size");for(const a of e.features){const s=l.get("text-font").evaluate(a,{},o).join(","),c=f.evaluate(a,{},o),m=h.layoutTextSize.evaluate(a,{},o),g=(h.layoutIconSize.evaluate(a,{},o),{horizontal:{},vertical:void 0}),y=a.text;let v,_=[0,0];if(y){const r=y.toString(),h=24*l.get("text-letter-spacing").evaluate(a,{},o),f=Kr(r)?h:0,v=l.get("text-anchor").evaluate(a,{},o),x=l.get("text-variable-anchor");if(!x){const e=l.get("text-radial-offset").evaluate(a,{},o);_=e?Dc(v,[24*e,Rc]):l.get("text-offset").evaluate(a,{},o).map((e=>24*e))}let b=d?"center":l.get("text-justify").evaluate(a,{},o);const w=l.get("symbol-placement"),M="point"===w?24*l.get("text-max-width").evaluate(a,{},o):0,T=()=>{e.allowVerticalPlacement&&Jr(r)&&(g.vertical=ic(y,t,i,n,s,M,u,v,"left",f,_,Ql.vertical,!0,w,m,c))};if(!d&&x){const e="auto"===b?x.map((e=>zc(e))):[b];let r=!1;for(let a=0;a<e.length;a++){const o=e[a];if(!g.horizontal[o])if(r)g.horizontal[o]=g.horizontal[0];else{const e=ic(y,t,i,n,s,M,u,"center",o,f,_,Ql.horizontal,!1,w,m,c);e&&(g.horizontal[o]=e,r=1===e.positionedLines.length)}}T()}else{"auto"===b&&(b=zc(v));const e=ic(y,t,i,n,s,M,u,v,b,f,_,Ql.horizontal,!1,w,m,c);e&&(g.horizontal[b]=e),T(),Jr(r)&&d&&p&&(g.vertical=ic(y,t,i,n,s,M,u,v,b,f,_,Ql.vertical,!1,w,m,c))}}let x=!1;if(a.icon&&a.icon.name){const t=r[a.icon.name];t&&(v=dc(n[a.icon.name],l.get("icon-offset").evaluate(a,{},o),l.get("icon-anchor").evaluate(a,{},o)),x=t.sdf,void 0===e.sdfIcons?e.sdfIcons=t.sdf:e.sdfIcons!==t.sdf&&C("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(t.pixelRatio!==e.pixelRatio||0!==l.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0))}const b=Fc(g.horizontal)||g.vertical;e.iconsInText=!!b&&b.iconsInText,(b||v)&&Oc(e,a,g,v,r,h,m,0,_,x,o)}a&&e.generateCollisionDebugBuffers(s,e.collisionBoxArray)}function zc(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Oc(e,t,i,r,n,a,o,s,l,c,u){let d=a.textMaxSize.evaluate(t,{},u);void 0===d&&(d=o);const p=e.layers[0].layout,f=p.get("icon-offset").evaluate(t,{},u),m=Fc(i.horizontal),g=o/24,y=e.tilePixelRatio*g,v=e.tilePixelRatio*d/24,_=e.tilePixelRatio*p.get("symbol-spacing"),x=p.get("text-padding")*e.tilePixelRatio,b=p.get("icon-padding")*e.tilePixelRatio,w=h(p.get("text-max-angle")),M="map"===p.get("text-rotation-alignment")&&"point"!==p.get("symbol-placement"),T="map"===p.get("icon-rotation-alignment")&&"point"!==p.get("symbol-placement"),S=p.get("symbol-placement"),E=_/2,A=p.get("icon-text-fit");let L;r&&"none"!==A&&(e.allowVerticalPlacement&&i.vertical&&(L=pc(r,i.vertical,A,p.get("icon-text-fit-padding"),f,g)),m&&(r=pc(r,m,A,p.get("icon-text-fit-padding"),f,g)));const P=(s,h)=>{h.x<0||h.x>=8192||h.y<0||h.y>=8192||function(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g,y,v,_,x,b,w,M,T){const S=e.addToLineVertexArray(t,i);let E,A,L,P,I,R,D,k=0,z=0,O=0,B=0,F=-1,N=-1;const U={};let j=ga(""),V=0,G=0;if(void 0===s._unevaluatedLayout.getValue("text-radial-offset")?[V,G]=s.layout.get("text-offset").evaluate(x,{},M).map((e=>24*e)):(V=24*s.layout.get("text-radial-offset").evaluate(x,{},M),G=Rc),e.allowVerticalPlacement&&r.vertical){const e=r.vertical;if(f)R=Uc(e),o&&(D=Uc(o));else{const i=s.layout.get("text-rotate").evaluate(x,{},M)+90;L=Nc(l,t,c,h,u,e,0,p,i),o&&(P=Nc(l,t,c,h,u,o,0,y,i))}}if(n){const i=s.layout.get("icon-rotate").evaluate(x,{},M),r="none"!==s.layout.get("icon-text-fit"),a=wc(n,i,w,r),d=o?wc(o,i,w,r):void 0;A=Nc(l,t,c,h,u,n,0,y,i),k=4*a.length;const p=e.iconSizeData;let f=null;"source"===p.kind?(f=[128*s.layout.get("icon-size").evaluate(x,{},M)],f[0]>32640&&C(`${e.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===p.kind&&(f=[128*b.compositeIconSizes[0].evaluate(x,{},M),128*b.compositeIconSizes[1].evaluate(x,{},M)],(f[0]>32640||f[1]>32640)&&C(`${e.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),e.addSymbols(e.icon,a,f,_,v,x,!1,t,S.lineStartIndex,S.lineLength,-1,M),F=e.icon.placedSymbolArray.length-1,d&&(z=4*d.length,e.addSymbols(e.icon,d,f,_,v,x,Ql.vertical,t,S.lineStartIndex,S.lineLength,-1,M),N=e.icon.placedSymbolArray.length-1)}for(const i in r.horizontal){const n=r.horizontal[i];E||(j=ga(n.text),f?I=Uc(n):E=Nc(l,t,c,h,u,n,0,p,s.layout.get("text-rotate").evaluate(x,{},M)));const o=1===n.positionedLines.length;if(O+=Bc(e,t,n,a,s,f,x,m,S,r.vertical?Ql.horizontal:Ql.horizontalOnly,o?Object.keys(r.horizontal):[i],U,F,b,M),o)break}r.vertical&&(B+=Bc(e,t,r.vertical,a,s,f,x,m,S,Ql.vertical,["vertical"],U,N,b,M));let H=-1;const W=(e,t)=>e?Math.max(e,t):t;H=W(I,H),H=W(R,H),H=W(D,H);const q=H>-1?1:0;q&&(H*=T/24),e.glyphOffsetArray.length>=$c.MAX_GLYPHS&&C("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==x.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,x.sortKey),e.symbolInstances.emplaceBack(t.x,t.y,U.right>=0?U.right:-1,U.center>=0?U.center:-1,U.left>=0?U.left:-1,U.vertical||-1,F,N,j,void 0!==E?E:e.collisionBoxArray.length,void 0!==E?E+1:e.collisionBoxArray.length,void 0!==L?L:e.collisionBoxArray.length,void 0!==L?L+1:e.collisionBoxArray.length,void 0!==A?A:e.collisionBoxArray.length,void 0!==A?A+1:e.collisionBoxArray.length,P||e.collisionBoxArray.length,P?P+1:e.collisionBoxArray.length,c,O,B,k,z,q,0,d,V,G,H)}(e,h,s,i,r,n,L,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,y,x,M,l,0,b,T,f,t,a,c,u,o)};if("line"===S)for(const n of bc(t.geometry,0,0,8192,8192)){const t=xc(n,_,w,i.vertical||m,r,24,v,e.overscaling,8192);for(const i of t){const t=m;t&&jc(e,t.text,E,i)||P(n,i)}}else if("line-center"===S){for(const e of t.geometry)if(e.length>1){const t=_c(e,w,i.vertical||m,r,24,v);t&&P(e,t)}}else if("Polygon"===t.type)for(const e of Ps(t.geometry,0)){const t=Lc(e,16);P(e[0],new fc(t.x,t.y,0))}else if("LineString"===t.type)for(const e of t.geometry)P(e,new fc(e[0].x,e[0].y,0));else if("Point"===t.type)for(const e of t.geometry)for(const t of e)P([t],new fc(t.x,t.y,0))}function Bc(e,t,i,n,a,o,s,l,c,h,u,d,p,f,m){const g=function(e,t,i,n,a,o,s,l){const c=n.layout.get("text-rotate").evaluate(o,{})*Math.PI/180,h=[];for(const e of t.positionedLines)for(const n of e.positionedGlyphs){if(!n.rect)continue;const o=n.rect||{};let u=4,d=!0,p=1,f=0;const m=(a||l)&&n.vertical,g=n.metrics.advance*n.scale/2;if(l&&t.verticalizable){const t=24*(n.scale-1),i=(24-n.metrics.width*n.scale)/2;f=e.lineOffset/2-(n.imageName?-i:t)}if(n.imageName){const e=s[n.imageName];d=e.sdf,p=e.pixelRatio,u=1/p}const y=a?[n.x+g,n.y]:[0,0];let v=a?[0,0]:[n.x+g+i[0],n.y+i[1]-f],_=[0,0];m&&(_=v,v=[0,0]);const x=(n.metrics.left-u)*n.scale-g+v[0],b=(-n.metrics.top-u)*n.scale+v[1],w=x+o.w*n.scale/p,M=b+o.h*n.scale/p,T=new r(x,b),S=new r(w,b),E=new r(x,M),A=new r(w,M);if(m){const e=new r(-g,g- -17),t=-Math.PI/2,i=12-g,a=new r(22-i,-(n.imageName?i:0)),o=new r(..._);T._rotateAround(t,e)._add(a)._add(o),S._rotateAround(t,e)._add(a)._add(o),E._rotateAround(t,e)._add(a)._add(o),A._rotateAround(t,e)._add(a)._add(o)}if(c){const e=Math.sin(c),t=Math.cos(c),i=[t,-e,e,t];T._matMult(i),S._matMult(i),E._matMult(i),A._matMult(i)}const C=new r(0,0),L=new r(0,0);h.push({tl:T,tr:S,bl:E,br:A,tex:o,writingMode:t.writingMode,glyphOffset:y,sectionIndex:n.sectionIndex,isSDF:d,pixelOffsetTL:C,pixelOffsetBR:L,minFontScaleX:0,minFontScaleY:0})}return h}(0,i,l,a,o,s,n,e.allowVerticalPlacement),y=e.textSizeData;let v=null;"source"===y.kind?(v=[128*a.layout.get("text-size").evaluate(s,{},m)],v[0]>32640&&C(`${e.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===y.kind&&(v=[128*f.compositeTextSizes[0].evaluate(s,{},m),128*f.compositeTextSizes[1].evaluate(s,{},m)],(v[0]>32640||v[1]>32640)&&C(`${e.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),e.addSymbols(e.text,g,v,l,o,s,h,t,c.lineStartIndex,c.lineLength,p,m);for(const t of u)d[t]=e.text.placedSymbolArray.length-1;return 4*g.length}function Fc(e){for(const t in e)return e[t];return null}function Nc(e,t,i,n,a,o,s,l,c){let u=o.top,d=o.bottom,p=o.left,f=o.right;const m=o.collisionPadding;if(m&&(p-=m[0],u-=m[1],f+=m[2],d+=m[3]),c){const e=new r(p,u),t=new r(f,u),i=new r(p,d),n=new r(f,d),a=h(c);e._rotate(a),t._rotate(a),i._rotate(a),n._rotate(a),p=Math.min(e.x,t.x,i.x,n.x),f=Math.max(e.x,t.x,i.x,n.x),u=Math.min(e.y,t.y,i.y,n.y),d=Math.max(e.y,t.y,i.y,n.y)}return e.emplaceBack(t.x,t.y,p,u,f,d,l,i,n,a),e.length-1}function Uc(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);const t=e.bottom-e.top;return t>0?Math.max(10,t):null}function jc(e,t,i,r){const n=e.compareText;if(t in n){const e=n[t];for(let t=e.length-1;t>=0;t--)if(r.dist(e[t])<i)return!0}else n[t]=[];return n[t].push(r),!1}const Vc=Xs.VectorTileFeature.types,Gc=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Hc(e,t,i,r,n,a,o,s,l,c,h,u,d){const p=s?Math.min(32640,Math.round(s[0])):0,f=s?Math.min(32640,Math.round(s[1])):0;e.emplaceBack(t,i,Math.round(32*r),Math.round(32*n),a,o,(p<<1)+(l?1:0),f,16*c,16*h,256*u,256*d)}function Wc(e,t,i){e.emplaceBack(t.x,t.y,i),e.emplaceBack(t.x,t.y,i),e.emplaceBack(t.x,t.y,i),e.emplaceBack(t.x,t.y,i)}function qc(e){for(const t of e.sections)if(an(t.text))return!0;return!1}class Zc{constructor(e){this.layoutVertexArray=new jn,this.indexArray=new Xn,this.programConfigurations=e,this.segments=new Ua,this.dynamicLayoutVertexArray=new Vn,this.opacityVertexArray=new Gn,this.placedSymbolArray=new oa}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,t,i,r){this.isEmpty()||(i&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ml.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,gl.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Gc,!0),this.opacityVertexBuffer.itemSize=1),(i||r)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Hr("SymbolBuffers",Zc);class Xc{constructor(e,t,i){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new i,this.segments=new Ua,this.collisionVertexArray=new Zn,this.collisionVertexArrayExt=new Vn}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,yl.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,vl.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Hr("CollisionBuffers",Xc);class $c{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=fo([]),this.placementViewportMatrix=fo([]);const t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=bl(this.zoom,t["text-size"]),this.iconSizeData=bl(this.zoom,t["icon-size"]);const i=this.layers[0].layout,r=i.get("symbol-sort-key"),n=i.get("symbol-z-order");this.canOverlap=i.get("text-allow-overlap")||i.get("icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==n&&void 0!==r.constantOr(1),this.sortFeaturesByY=("viewport-y"===n||"auto"===n&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===i.get("symbol-placement")&&(this.writingModes=i.get("text-writing-mode").map((e=>Ql[e]))),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.sourceID=e.sourceID}createArrays(){this.text=new Zc(new ka(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new Zc(new ka(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new ca,this.lineVertexArray=new ha,this.symbolInstances=new la}calculateGlyphDependencies(e,t,i,r,n){for(let a=0;a<e.length;a++)if(t[e.charCodeAt(a)]=!0,(i||r)&&n){const i=El[e.charAt(a)];i&&(t[i.charCodeAt(0)]=!0)}}populate(e,t,i){const r=this.layers[0],n=r.layout,a=n.get("text-font"),o=n.get("text-field"),s=n.get("icon-image"),l=("constant"!==o.value.kind||o.value.value instanceof ht&&!o.value.value.isEmpty()||o.value.value.toString().length>0)&&("constant"!==a.value.kind||a.value.value.length>0),c="constant"!==s.value.kind||!!s.value.value||Object.keys(s.parameters).length>0,h=n.get("symbol-sort-key");if(this.features=[],!l&&!c)return;const u=t.iconDependencies,d=t.glyphDependencies,p=t.availableImages,f=new mn(this.zoom);for(const{feature:t,id:o,index:s,sourceLayerIndex:m}of e){const e=r._featureFilter.needGeometry,g=Ha(t,e);if(!r._featureFilter.filter(f,g,i))continue;let y,v;if(e||(g.geometry=Ga(t)),l){const e=r.getValueAndResolveTokens("text-field",g,i,p),t=ht.factory(e);qc(t)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===dn()||this.hasRTLText&&fn.isParsed())&&(y=Sl(t,r,g))}if(c){const e=r.getValueAndResolveTokens("icon-image",g,i,p);v=e instanceof ut?e:ut.fromString(e)}if(!y&&!v)continue;const _=this.sortFeaturesByKey?h.evaluate(g,{},i):void 0;if(this.features.push({id:o,text:y,icon:v,index:s,sourceLayerIndex:m,geometry:g.geometry,properties:t.properties,type:Vc[t.type],sortKey:_}),v&&(u[v.name]=!0),y){const e=a.evaluate(g,{},i).join(","),t="map"===n.get("text-rotation-alignment")&&"point"!==n.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ql.vertical)>=0;for(const i of y.sections)if(i.image)u[i.image.name]=!0;else{const r=Jr(y.toString()),n=i.fontStack||e,a=d[n]=d[n]||{};this.calculateGlyphDependencies(i.text,a,t,this.allowVerticalPlacement,r)}}}"line"===n.get("symbol-placement")&&(this.features=function(e){const t={},i={},r=[];let n=0;function a(t){r.push(e[t]),n++}function o(e,t,n){const a=i[e];return delete i[e],i[t]=a,r[a].geometry[0].pop(),r[a].geometry[0]=r[a].geometry[0].concat(n[0]),a}function s(e,i,n){const a=t[i];return delete t[i],t[e]=a,r[a].geometry[0].shift(),r[a].geometry[0]=n[0].concat(r[a].geometry[0]),a}function l(e,t,i){const r=i?t[0][t[0].length-1]:t[0][0];return`${e}:${r.x}:${r.y}`}for(let c=0;c<e.length;c++){const h=e[c],u=h.geometry,d=h.text?h.text.toString():null;if(!d){a(c);continue}const p=l(d,u),f=l(d,u,!0);if(p in i&&f in t&&i[p]!==t[f]){const e=s(p,f,u),n=o(p,f,r[e].geometry);delete t[p],delete i[f],i[l(d,r[n].geometry,!0)]=n,r[e].geometry=null}else p in i?o(p,f,u):f in t?s(p,f,u):(a(c),t[p]=n-1,i[f]=n-1)}return r.filter((e=>e.geometry))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((e,t)=>e.sortKey-t.sortKey))}update(e,t,i){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,i),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,i))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const i=this.lineVertexArray.length;if(void 0!==e.segment){let i=e.dist(t[e.segment+1]),r=e.dist(t[e.segment]);const n={};for(let r=e.segment+1;r<t.length;r++)n[r]={x:t[r].x,y:t[r].y,tileUnitDistanceFromAnchor:i},r<t.length-1&&(i+=t[r+1].dist(t[r]));for(let i=e.segment||0;i>=0;i--)n[i]={x:t[i].x,y:t[i].y,tileUnitDistanceFromAnchor:r},i>0&&(r+=t[i-1].dist(t[i]));for(let e=0;e<t.length;e++){const t=n[e];this.lineVertexArray.emplaceBack(t.x,t.y,t.tileUnitDistanceFromAnchor)}}return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}}addSymbols(e,t,i,r,n,a,o,s,l,c,h,u){const d=e.indexArray,p=e.layoutVertexArray,f=e.segments.prepareSegment(4*t.length,p,d,this.canOverlap?a.sortKey:void 0),m=this.glyphOffsetArray.length,g=f.vertexLength,y=this.allowVerticalPlacement&&o===Ql.vertical?Math.PI/2:0,v=a.text&&a.text.sections;for(let r=0;r<t.length;r++){const{tl:n,tr:o,bl:l,br:c,tex:h,pixelOffsetTL:m,pixelOffsetBR:g,minFontScaleX:_,minFontScaleY:x,glyphOffset:b,isSDF:w,sectionIndex:M}=t[r],T=f.vertexLength,S=b[1];Hc(p,s.x,s.y,n.x,S+n.y,h.x,h.y,i,w,m.x,m.y,_,x),Hc(p,s.x,s.y,o.x,S+o.y,h.x+h.w,h.y,i,w,g.x,m.y,_,x),Hc(p,s.x,s.y,l.x,S+l.y,h.x,h.y+h.h,i,w,m.x,g.y,_,x),Hc(p,s.x,s.y,c.x,S+c.y,h.x+h.w,h.y+h.h,i,w,g.x,g.y,_,x),Wc(e.dynamicLayoutVertexArray,s,y),d.emplaceBack(T,T+1,T+2),d.emplaceBack(T+1,T+2,T+3),f.vertexLength+=4,f.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(b[0]),r!==t.length-1&&M===t[r+1].sectionIndex||e.programConfigurations.populatePaintArrays(p.length,a,a.index,{},u,v&&v[M])}e.placedSymbolArray.emplaceBack(s.x,s.y,m,this.glyphOffsetArray.length-m,g,l,c,s.segment,i?i[0]:0,i?i[1]:0,r[0],r[1],o,0,!1,0,h)}_commitLayoutVertex(e,t,i,r,n){e.emplaceBack(t.x,t.y,i,r,Math.round(n.x),Math.round(n.y))}_addCollisionDebugVertices(e,t,i,n,a){const o=i.segments.prepareSegment(4,i.layoutVertexArray,i.indexArray),s=o.vertexLength,l=a.anchorX,c=a.anchorY;for(let e=0;e<4;e++)i.collisionVertexArray.emplaceBack(0,0,0,0);i.collisionVertexArrayExt.emplaceBack(t,-e.padding,-e.padding),i.collisionVertexArrayExt.emplaceBack(t,e.padding,-e.padding),i.collisionVertexArrayExt.emplaceBack(t,e.padding,e.padding),i.collisionVertexArrayExt.emplaceBack(t,-e.padding,e.padding),this._commitLayoutVertex(i.layoutVertexArray,n,l,c,new r(e.x1,e.y1)),this._commitLayoutVertex(i.layoutVertexArray,n,l,c,new r(e.x2,e.y1)),this._commitLayoutVertex(i.layoutVertexArray,n,l,c,new r(e.x2,e.y2)),this._commitLayoutVertex(i.layoutVertexArray,n,l,c,new r(e.x1,e.y2)),o.vertexLength+=4;const h=i.indexArray;h.emplaceBack(s,s+1),h.emplaceBack(s+1,s+2),h.emplaceBack(s+2,s+3),h.emplaceBack(s+3,s),o.primitiveLength+=4}_addTextDebugCollisionBoxes(e,t,i,r,n,a){for(let o=r;o<n;o++){const r=i.get(o),n=this.getSymbolInstanceTextSize(e,a,t,o);this._addCollisionDebugVertices(r,n,this.textCollisionBox,r.anchorPoint,a)}}_addIconDebugCollisionBoxes(e,t,i,r,n,a){for(let o=r;o<n;o++){const r=i.get(o),n=this.getSymbolInstanceIconSize(e,t,o);this._addCollisionDebugVertices(r,n,this.iconCollisionBox,r.anchorPoint,a)}}generateCollisionDebugBuffers(e,t){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Xc(Wn,_l.members,ea),this.iconCollisionBox=new Xc(Wn,_l.members,ea);const i=Ml(this.iconSizeData,e),r=Ml(this.textSizeData,e);for(let n=0;n<this.symbolInstances.length;n++){const a=this.symbolInstances.get(n);this._addTextDebugCollisionBoxes(r,e,t,a.textBoxStartIndex,a.textBoxEndIndex,a),this._addTextDebugCollisionBoxes(r,e,t,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a),this._addIconDebugCollisionBoxes(i,e,t,a.iconBoxStartIndex,a.iconBoxEndIndex,a),this._addIconDebugCollisionBoxes(i,e,t,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a)}}getSymbolInstanceTextSize(e,t,i,r){const n=this.text.placedSymbolArray.get(t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:r),a=wl(this.textSizeData,e,n)/24;return this.tilePixelRatio*a}getSymbolInstanceIconSize(e,t,i){const r=this.icon.placedSymbolArray.get(i),n=wl(this.iconSizeData,e,r);return this.tilePixelRatio*n}_commitDebugCollisionVertexUpdate(e,t,i){e.emplaceBack(t,-i,-i),e.emplaceBack(t,i,-i),e.emplaceBack(t,i,i),e.emplaceBack(t,-i,i)}_updateTextDebugCollisionBoxes(e,t,i,r,n,a){for(let o=r;o<n;o++){const r=i.get(o),n=this.getSymbolInstanceTextSize(e,a,t,o);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,n,r.padding)}}_updateIconDebugCollisionBoxes(e,t,i,r,n){for(let a=r;a<n;a++){const r=i.get(a),n=this.getSymbolInstanceIconSize(e,t,a);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,n,r.padding)}}updateCollisionDebugBuffers(e,t){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const i=Ml(this.iconSizeData,e),r=Ml(this.textSizeData,e);for(let n=0;n<this.symbolInstances.length;n++){const a=this.symbolInstances.get(n);this._updateTextDebugCollisionBoxes(r,e,t,a.textBoxStartIndex,a.textBoxEndIndex,a),this._updateTextDebugCollisionBoxes(r,e,t,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a),this._updateIconDebugCollisionBoxes(i,e,t,a.iconBoxStartIndex,a.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(i,e,t,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,t,i,r,n,a,o,s,l){const c={};for(let r=t;r<i;r++){const t=e.get(r);c.textBox={x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,padding:t.padding,anchorPointX:t.anchorPointX,anchorPointY:t.anchorPointY},c.textFeatureIndex=t.featureIndex;break}for(let t=r;t<n;t++){const i=e.get(t);c.verticalTextBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,padding:i.padding,anchorPointX:i.anchorPointX,anchorPointY:i.anchorPointY},c.verticalTextFeatureIndex=i.featureIndex;break}for(let t=a;t<o;t++){const i=e.get(t);c.iconBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,padding:i.padding,anchorPointX:i.anchorPointX,anchorPointY:i.anchorPointY},c.iconFeatureIndex=i.featureIndex;break}for(let t=s;t<l;t++){const i=e.get(t);c.verticalIconBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,padding:i.padding,anchorPointX:i.anchorPointX,anchorPointY:i.anchorPointY},c.verticalIconFeatureIndex=i.featureIndex;break}return c}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const i=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,i.textBoxStartIndex,i.textBoxEndIndex,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i.iconBoxStartIndex,i.iconBoxEndIndex,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,t){const i=e.placedSymbolArray.get(t),r=i.vertexStartIndex+4*i.numGlyphs;for(let t=i.vertexStartIndex;t<r;t+=4)e.indexArray.emplaceBack(t,t+1,t+2),e.indexArray.emplaceBack(t+1,t+2,t+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const t=Math.sin(e),i=Math.cos(e),r=[],n=[],a=[];for(let e=0;e<this.symbolInstances.length;++e){a.push(e);const o=this.symbolInstances.get(e);r.push(0|Math.round(t*o.anchorX+i*o.anchorY)),n.push(o.featureIndex)}return a.sort(((e,t)=>r[e]-r[t]||n[t]-n[e])),a}addToSortKeyRanges(e,t){const i=this.sortKeyRanges[this.sortKeyRanges.length-1];i&&i.sortKey===t?i.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of this.symbolInstanceIndexes){const t=this.symbolInstances.get(e);this.featureSortOrder.push(t.featureIndex),[t.rightJustifiedTextSymbolIndex,t.centerJustifiedTextSymbolIndex,t.leftJustifiedTextSymbolIndex].forEach(((e,t,i)=>{e>=0&&i.indexOf(e)===t&&this.addIndicesForPlacedSymbol(this.text,e)})),t.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,t.verticalPlacedTextSymbolIndex),t.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,t.placedIconSymbolIndex),t.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,t.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Hr("SymbolBucket",$c,{omit:["layers","collisionBoxArray","features","compareText"]}),$c.MAX_GLYPHS=65535,$c.addDynamicAttributes=Wc;const Yc=new Ln({"symbol-placement":new Tn(ze.layout_symbol["symbol-placement"]),"symbol-spacing":new Tn(ze.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Tn(ze.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Sn(ze.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Tn(ze.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Tn(ze.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Tn(ze.layout_symbol["icon-ignore-placement"]),"icon-optional":new Tn(ze.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Tn(ze.layout_symbol["icon-rotation-alignment"]),"icon-size":new Sn(ze.layout_symbol["icon-size"]),"icon-text-fit":new Tn(ze.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Tn(ze.layout_symbol["icon-text-fit-padding"]),"icon-image":new Sn(ze.layout_symbol["icon-image"]),"icon-rotate":new Sn(ze.layout_symbol["icon-rotate"]),"icon-padding":new Tn(ze.layout_symbol["icon-padding"]),"icon-keep-upright":new Tn(ze.layout_symbol["icon-keep-upright"]),"icon-offset":new Sn(ze.layout_symbol["icon-offset"]),"icon-anchor":new Sn(ze.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Tn(ze.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Tn(ze.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Tn(ze.layout_symbol["text-rotation-alignment"]),"text-field":new Sn(ze.layout_symbol["text-field"]),"text-font":new Sn(ze.layout_symbol["text-font"]),"text-size":new Sn(ze.layout_symbol["text-size"]),"text-max-width":new Sn(ze.layout_symbol["text-max-width"]),"text-line-height":new Tn(ze.layout_symbol["text-line-height"]),"text-letter-spacing":new Sn(ze.layout_symbol["text-letter-spacing"]),"text-justify":new Sn(ze.layout_symbol["text-justify"]),"text-radial-offset":new Sn(ze.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Tn(ze.layout_symbol["text-variable-anchor"]),"text-anchor":new Sn(ze.layout_symbol["text-anchor"]),"text-max-angle":new Tn(ze.layout_symbol["text-max-angle"]),"text-writing-mode":new Tn(ze.layout_symbol["text-writing-mode"]),"text-rotate":new Sn(ze.layout_symbol["text-rotate"]),"text-padding":new Tn(ze.layout_symbol["text-padding"]),"text-keep-upright":new Tn(ze.layout_symbol["text-keep-upright"]),"text-transform":new Sn(ze.layout_symbol["text-transform"]),"text-offset":new Sn(ze.layout_symbol["text-offset"]),"text-allow-overlap":new Tn(ze.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Tn(ze.layout_symbol["text-ignore-placement"]),"text-optional":new Tn(ze.layout_symbol["text-optional"])});var Jc={paint:new Ln({"icon-opacity":new Sn(ze.paint_symbol["icon-opacity"]),"icon-color":new Sn(ze.paint_symbol["icon-color"]),"icon-halo-color":new Sn(ze.paint_symbol["icon-halo-color"]),"icon-halo-width":new Sn(ze.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Sn(ze.paint_symbol["icon-halo-blur"]),"icon-translate":new Tn(ze.paint_symbol["icon-translate"]),"icon-translate-anchor":new Tn(ze.paint_symbol["icon-translate-anchor"]),"text-opacity":new Sn(ze.paint_symbol["text-opacity"]),"text-color":new Sn(ze.paint_symbol["text-color"],{runtimeType:Ze,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new Sn(ze.paint_symbol["text-halo-color"]),"text-halo-width":new Sn(ze.paint_symbol["text-halo-width"]),"text-halo-blur":new Sn(ze.paint_symbol["text-halo-blur"]),"text-translate":new Tn(ze.paint_symbol["text-translate"]),"text-translate-anchor":new Tn(ze.paint_symbol["text-translate-anchor"])}),layout:Yc};class Kc{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Ge,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Hr("FormatSectionOverride",Kc,{omit:["defaultValue"]});class Qc extends Ba{constructor(e){super(e,Jc)}recalculate(e,t){if(super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){const e=this.layout.get("text-writing-mode");if(e){const t=[];for(const i of e)t.indexOf(i)<0&&t.push(i);this.layout._values["text-writing-mode"]=t}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,t,i,r){const n=this.layout.get(e).evaluate(t,{},i,r),a=this._unevaluatedLayout._values[e];return a.isDataDriven()||Ji(a.value)||!n?n:function(e,t){return t.replace(/{([^{}]+)}/g,((t,i)=>i in e?String(e[i]):""))}(t.properties,n)}createBucket(e){return new $c(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Jc.paint.overridableProperties){if(!Qc.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),i=new Kc(t),r=new Yi(i,t.property.specification);let n=null;n="constant"===t.value.kind||"source"===t.value.kind?new Qi("source",r):new er("composite",r,t.value.zoomStops,t.value._interpolationType),this.paint._values[e]=new wn(t.property,n,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,i){return!(!this.layout||t.isDataDriven()||i.isDataDriven())&&Qc.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const i=e.get("text-field"),r=Jc.paint.properties[t];let n=!1;const a=e=>{for(const t of e)if(r.overrides&&r.overrides.hasOverride(t))return void(n=!0)};if("constant"===i.value.kind&&i.value.value instanceof ht)a(i.value.value.sections);else if("source"===i.value.kind){const e=t=>{n||(t instanceof gt&&ft(t.value)===Je?a(t.value.sections):t instanceof xt?a(t.sections):t.eachChild(e))},t=i.value;t._styleExpression&&e(t._styleExpression.expression)}return n}getProgramConfiguration(e){return new Da(this,e)}}var eh={paint:new Ln({"background-color":new Tn(ze.paint_background["background-color"]),"background-pattern":new An(ze.paint_background["background-pattern"]),"background-opacity":new Tn(ze.paint_background["background-opacity"])})},th={paint:new Ln({"raster-opacity":new Tn(ze.paint_raster["raster-opacity"]),"raster-hue-rotate":new Tn(ze.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Tn(ze.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Tn(ze.paint_raster["raster-brightness-max"]),"raster-saturation":new Tn(ze.paint_raster["raster-saturation"]),"raster-contrast":new Tn(ze.paint_raster["raster-contrast"]),"raster-resampling":new Tn(ze.paint_raster["raster-resampling"]),"raster-fade-duration":new Tn(ze.paint_raster["raster-fade-duration"])})};class ih extends Ba{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var rh={paint:new Ln({"sky-type":new Tn(ze.paint_sky["sky-type"]),"sky-atmosphere-sun":new Tn(ze.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Tn(ze.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Tn(ze.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Tn(ze.paint_sky["sky-gradient-radius"]),"sky-gradient":new Cn(ze.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Tn(ze.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Tn(ze.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Tn(ze.paint_sky["sky-opacity"])})};function nh(e,t,i){const r=xo(0,0,1),n=ko(Do());return function(e,t,i){i*=.5;var r=t[0],n=t[1],a=t[2],o=t[3],s=Math.sin(i),l=Math.cos(i);e[0]=r*l-a*s,e[1]=n*l+o*s,e[2]=a*l+r*s,e[3]=o*l-n*s}(n,n,i?-h(e)+Math.PI:h(e)),zo(n,n,-h(t)),Co(r,r,n),So(r,r)}const ah={circle:class extends Ba{constructor(e){super(e,ho)}createBucket(e){return new qa(e)}queryRadius(e){const t=e;return ao("circle-radius",this,t)+ao("circle-stroke-width",this,t)+oo(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,i,r,n,a,o,s){const l="map"===this.paint.get("circle-pitch-alignment");if(l&&e.queryGeometry.isAboveHorizon)return!1;const c=lo(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),h=this.paint.get("circle-radius").evaluate(t,i)+this.paint.get("circle-stroke-width").evaluate(t,i),u=l?h*e.pixelToTileUnitsFactor:h;for(const t of r)for(const i of t){const t=i.add(c),r=s&&a.elevation?a.elevation.exaggeration()*s.getElevationAt(t.x,t.y,!0):0,n=l?t:Fo(t,r,o),h=l?e.tilespaceRays.map((e=>jo(e,r))):e.queryGeometry.screenGeometry;let d=u;const p=Ro([],[i.x,i.y,r,1],o);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?d*=p[3]/a.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(d*=a.cameraToCenterDistance/p[3]),Xa(h,n,d))return!0}return!1}getProgramIds(){return["circle"]}getProgramConfiguration(e){return new Da(this,e)}},heatmap:class extends Ba{createBucket(e){return new Vo(e)}constructor(e){super(e,Xo),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=$o({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(e){return new Da(this,e)}},hillshade:class extends Ba{constructor(e){super(e,Yo)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(e){return new Da(this,e)}},fill:class extends Ba{constructor(e){super(e,Os)}getProgramIds(){const e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),i=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(e){return new Da(this,e)}recalculate(e,t){super.recalculate(e,t);const i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new ks(e)}queryRadius(){return oo(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,i,r,n,a){return!e.queryGeometry.isAboveHorizon&&$a(so(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),r)}isTileClipped(){return!0}},"fill-extrusion":class extends Ba{constructor(e){super(e,tl)}createBucket(e){return new Qs(e)}queryRadius(){return oo(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(e){return new Da(this,e)}queryIntersectsFeature(e,t,i,n,a,o,s){const l=lo(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),c=this.paint.get("fill-extrusion-height").evaluate(t,i),h=this.paint.get("fill-extrusion-base").evaluate(t,i),u=e.queryGeometry.screenGeometry,d=function(e,t,i,n,a){const o=[],s=[],l=a[8]*t,c=a[9]*t,h=a[10]*t,u=a[11]*t,d=a[8]*i,p=a[9]*i,f=a[10]*i,m=a[11]*i;for(const t of e){const e=[],i=[];for(const o of t){const t=o.x+n.x,s=o.y+n.y,g=a[0]*t+a[4]*s+a[12],y=a[1]*t+a[5]*s+a[13],v=a[2]*t+a[6]*s+a[14],_=a[3]*t+a[7]*s+a[15],x=v+h,b=_+u,w=g+d,M=y+p,T=v+f,S=_+m,E=new r((g+l)/b,(y+c)/b);E.z=x/b,e.push(E);const A=new r(w/S,M/S);A.z=T/S,i.push(A)}o.push(e),s.push(i)}return[o,s]}(n,h,c,l,s);return function(e,t,i){let r=1/0;$a(i,t)&&(r=rl(i,t[0]));for(let n=0;n<t.length;n++){const a=t[n],o=e[n];for(let e=0;e<a.length-1;e++){const t=a[e],n=[t,a[e+1],o[e+1],o[e],t];Za(i,n)&&(r=Math.min(r,rl(i,n)))}}return r!==1/0&&r}(d[0],d[1],u)}},line:class extends Ba{constructor(e){super(e,dl),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(e){"line-gradient"===e&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Yt,this.gradientVersion=(this.gradientVersion+1)%s)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=pl.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new hl(e)}getProgramIds(){const e=this.paint.get("line-dasharray"),t=this.paint.get("line-pattern").constantOr(1),i=this.paint.get("line-gradient");return[t?"linePattern":e?"lineSDF":i?"lineGradient":"line"]}getProgramConfiguration(e){return new Da(this,e)}queryRadius(e){const t=e,i=fl(ao("line-width",this,t),ao("line-gap-width",this,t)),r=ao("line-offset",this,t);return i/2+Math.abs(r)+oo(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,i,n,a,o){if(e.queryGeometry.isAboveHorizon)return!1;const s=so(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),l=e.pixelToTileUnitsFactor/2*fl(this.paint.get("line-width").evaluate(t,i),this.paint.get("line-gap-width").evaluate(t,i)),c=this.paint.get("line-offset").evaluate(t,i);return c&&(n=function(e,t){const i=[],n=new r(0,0);for(let r=0;r<e.length;r++){const a=e[r],o=[];for(let e=0;e<a.length;e++){const i=a[e-1],r=a[e],s=a[e+1],l=0===e?n:r.sub(i)._unit()._perp(),c=e===a.length-1?n:s.sub(r)._unit()._perp(),h=l._add(c)._unit();h._mult(1/(h.x*c.x+h.y*c.y)),o.push(h._mult(t)._add(r))}i.push(o)}return i}(n,c*e.pixelToTileUnitsFactor)),function(e,t,i){for(let r=0;r<t.length;r++){const n=t[r];if(e.length>=3)for(let t=0;t<n.length;t++)if(io(e,n[t]))return!0;if(Ya(e,n,i))return!0}return!1}(s,n,l)}isTileClipped(){return!0}},symbol:Qc,background:class extends Ba{constructor(e){super(e,eh)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Ba{constructor(e){super(e,th)}getProgramIds(){return["raster"]}},sky:class extends Ba{constructor(e){super(e,rh),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"sky-gradient"===e?this._updateColorRamp():"sky-atmosphere-sun"!==e&&"sky-atmosphere-halo-color"!==e&&"sky-atmosphere-color"!==e&&"sky-atmosphere-sun-intensity"!==e||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=$o({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}}getCenter(e,t){const i=this.paint.get("sky-type");if("atmosphere"===i){const i=this.paint.get("sky-atmosphere-sun"),r=!i,n=e.style.light,a=n.properties.get("position");return r&&"viewport"===n.properties.get("anchor")&&C("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),r?nh(a.azimuthal,90-a.polar,t):nh(i[0],90-i[1],t)}if("gradient"===i){const e=this.paint.get("sky-gradient-center");return nh(e[0],90-e[1],t)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const e=this.paint.get("sky-type");return"atmosphere"===e?["skyboxCapture","skybox"]:"gradient"===e?["skyboxGradient"]:null}}},{HTMLImageElement:oh,HTMLCanvasElement:sh,HTMLVideoElement:lh,ImageData:ch,ImageBitmap:hh}=a;class uh{constructor(e,t,i,r){this.context=e,this.format=i,this.texture=e.gl.createTexture(),this.update(t,r)}update(e,t,i){const{width:r,height:n}=e,a=!(this.size&&this.size[0]===r&&this.size[1]===n||i),{context:o}=this,{gl:s}=o;if(this.useMipmap=Boolean(t&&t.useMipmap),s.bindTexture(s.TEXTURE_2D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA&&(!t||!1!==t.premultiply)),a)this.size=[r,n],e instanceof oh||e instanceof sh||e instanceof lh||e instanceof ch||hh&&e instanceof hh?s.texImage2D(s.TEXTURE_2D,0,this.format,this.format,s.UNSIGNED_BYTE,e):s.texImage2D(s.TEXTURE_2D,0,this.format,r,n,0,this.format,s.UNSIGNED_BYTE,e.data);else{const{x:t,y:a}=i||{x:0,y:0};e instanceof oh||e instanceof sh||e instanceof lh||e instanceof ch||hh&&e instanceof hh?s.texSubImage2D(s.TEXTURE_2D,0,t,a,s.RGBA,s.UNSIGNED_BYTE,e):s.texSubImage2D(s.TEXTURE_2D,0,t,a,r,n,s.RGBA,s.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&s.generateMipmap(s.TEXTURE_2D)}bind(e,t,i){const{context:r}=this,{gl:n}=r;n.bindTexture(n.TEXTURE_2D,this.texture),i!==n.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(i=n.LINEAR),e!==this.filter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,i||e),this.filter=e),t!==this.wrap&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,t),this.wrap=t)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class dh{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){delete this._channel,this._callback=()=>{}}}const ph=a.performance;class fh{constructor(e){this._marks={start:[e.url,"start"].join("#"),end:[e.url,"end"].join("#"),measure:e.url.toString()},ph.mark(this._marks.start)}finish(){ph.mark(this._marks.end);let e=ph.getEntriesByName(this._marks.measure);return 0===e.length&&(ph.measure(this._marks.measure,this._marks.start,this._marks.end),e=ph.getEntriesByName(this._marks.measure),ph.clearMarks(this._marks.start),ph.clearMarks(this._marks.end),ph.clearMeasures(this._marks.measure)),e}}class mh{constructor(){this.tasks={},this.taskQueue=[],w(["process"],this),this.invoker=new dh(this.process),this.nextId=0}add(e,t){const i=this.nextId++;return this.tasks[i]={fn:e,metadata:t,priority:gh(t),id:i},this.taskQueue.push(i),this.invoker.trigger(),{cancel:()=>{delete this.tasks[i]}}}process(){I();try{if(this.taskQueue=this.taskQueue.filter((e=>!!this.tasks[e])),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const t=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!t)return;t.fn()}finally{}}pick(){let e=null,t=1/0;for(let i=0;i<this.taskQueue.length;i++){const r=this.tasks[this.taskQueue[i]];r.priority<t&&(t=r.priority,e=i)}if(null===e)return null;const i=this.taskQueue[e];return this.taskQueue.splice(e,1),i}remove(){this.invoker.remove()}}function gh({type:e,isSymbolTile:t,zoom:i}){return i=i||0,"message"===e?0:"maybePrepare"!==e||t?"parseTile"!==e||t?"parseTile"===e&&t?300-i:"maybePrepare"===e&&t?400-i:500:200-i:100-i}class yh{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof vh?new vh(e.lng,e.lat):vh.convert(e),this}setSouthWest(e){return this._sw=e instanceof vh?new vh(e.lng,e.lat):vh.convert(e),this}extend(e){const t=this._sw,i=this._ne;let r,n;if(e instanceof vh)r=e,n=e;else{if(!(e instanceof yh))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(yh.convert(e)):this.extend(vh.convert(e)):this;if(r=e._sw,n=e._ne,!r||!n)return this}return t||i?(t.lng=Math.min(r.lng,t.lng),t.lat=Math.min(r.lat,t.lat),i.lng=Math.max(n.lng,i.lng),i.lat=Math.max(n.lat,i.lat)):(this._sw=new vh(r.lng,r.lat),this._ne=new vh(n.lng,n.lat)),this}getCenter(){return new vh((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new vh(this.getWest(),this.getNorth())}getSouthEast(){return new vh(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:t,lat:i}=vh.convert(e);let r=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(r=this._sw.lng>=t&&t>=this._ne.lng),this._sw.lat<=i&&i<=this._ne.lat&&r}static convert(e){return!e||e instanceof yh?e:new yh(e)}}class vh{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new vh(m(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const t=Math.PI/180,i=this.lat*t,r=e.lat*t,n=Math.sin(i)*Math.sin(r)+Math.cos(i)*Math.cos(r)*Math.cos((e.lng-this.lng)*t);return 6371008.8*Math.acos(Math.min(n,1))}toBounds(e=0){const t=360*e/40075017,i=t/Math.cos(Math.PI/180*this.lat);return new yh(new vh(this.lng-i,this.lat-t),new vh(this.lng+i,this.lat+t))}static convert(e){if(e instanceof vh)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new vh(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new vh(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const _h=2*Math.PI*6371008.8;function xh(e){return _h*Math.cos(e*Math.PI/180)}function bh(e){return(180+e)/360}function wh(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function Mh(e,t){return e/xh(t)}function Th(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function Sh(e,t){return e*xh(Th(t))}class Eh{constructor(e,t,i=0){this.x=+e,this.y=+t,this.z=+i}static fromLngLat(e,t=0){const i=vh.convert(e);return new Eh(bh(i.lng),wh(i.lat),Mh(t,i.lat))}toLngLat(){return new vh(360*this.x-180,Th(this.y))}toAltitude(){return Sh(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/_h*(e=Th(this.y),1/Math.cos(e*Math.PI/180));var e}}function Ah(e,t,i){var r=2*Math.PI*6378137/256/Math.pow(2,i);return[e*r-2*Math.PI*6378137/2,t*r-2*Math.PI*6378137/2]}class Ch{constructor(e,t,i){this.z=e,this.x=t,this.y=i,this.key=Ih(0,e,e,t,i)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t){const i=(n=this.y,a=this.z,o=Ah(256*(r=this.x),256*(n=Math.pow(2,a)-n-1),a),s=Ah(256*(r+1),256*(n+1),a),o[0]+","+o[1]+","+s[0]+","+s[1]);var r,n,a,o,s;const l=function(e,t,i){let r,n="";for(let a=e;a>0;a--)r=1<<a-1,n+=(t&r?1:0)+(i&r?2:0);return n}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===t?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",i)}getTilePoint(e){const t=Math.pow(2,this.z);return new r(8192*(e.x*t-this.x),8192*(e.y*t-this.y))}getTileVec3(e){const t=Math.pow(2,this.z);return xo(8192*(e.x*t-this.x),8192*(e.y*t-this.y),Sh(e.z,e.y))}toString(){return`${this.z}/${this.x}/${this.y}`}}class Lh{constructor(e,t){this.wrap=e,this.canonical=t,this.key=Ih(e,t.z,t.z,t.x,t.y)}}class Ph{constructor(e,t,i,r,n){this.overscaledZ=e,this.wrap=t,this.canonical=new Ch(i,+r,+n),this.key=0===t&&e===i?this.canonical.key:Ih(t,e,i,r,n)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const t=this.canonical.z-e;return e>this.canonical.z?new Ph(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ph(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e,t=!0){if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return Ih(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);{const i=this.canonical.z-e;return Ih(this.wrap*+t,e,e,this.canonical.x>>i,this.canonical.y>>i)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new Ph(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,i=2*this.canonical.x,r=2*this.canonical.y;return[new Ph(t,this.wrap,t,i,r),new Ph(t,this.wrap,t,i+1,r),new Ph(t,this.wrap,t,i,r+1),new Ph(t,this.wrap,t,i+1,r+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Ph(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Ph(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Lh(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Eh(e.x-this.wrap,e.y))}getTileVec3(e){return this.canonical.getTileVec3(new Eh(e.x-this.wrap,e.y,e.z))}}function Ih(e,t,i,r,n){const a=1<<Math.min(i,22);let o=a*(n%a)+r%a;return e&&i<22&&(o+=a*a*((e<0?-2*e-1:2*e)%(1<<2*(22-i)))),16*(32*o+i)+(t-i)}Hr("CanonicalTileID",Ch),Hr("OverscaledTileID",Ph,{omit:["posMatrix"]});class Rh{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const i=e[t];this._stringToNumber[i]=t,this._numberToString[t]=i}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class Dh{constructor(e,t,i,r,n){this.type="Feature",this._vectorTileFeature=e,e._z=t,e._x=i,e._y=r,this.properties=e.properties,this.id=n}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const t in this)"_geometry"!==t&&"_vectorTileFeature"!==t&&(e[t]=this[t]);return e}}var kh=kn([{name:"a_pos",type:"Int16",components:2}]);class zh{constructor(e,t,i){this.tileID=e,this.uid=_(),this.uses=0,this.tileSize=t,this.tileZoom=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const t=e+this.timeAdded;t<U.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}loadVectorData(e,t,i){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(e,t){const i={};if(!t)return i;for(const r of e){const e=r.layerIds.map((e=>t.getLayer(e))).filter(Boolean);if(0!==e.length){r.layers=e,r.stateDependentLayerIds&&(r.stateDependentLayers=r.stateDependentLayerIds.map((t=>e.filter((e=>e.id===t))[0])));for(const t of e)i[t.id]=r}}return i}(e.buckets,t.style),this.hasSymbolBuckets=!1;for(const e in this.buckets){const t=this.buckets[e];if(t instanceof $c){if(this.hasSymbolBuckets=!0,!i)break;t.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const e in this.buckets){const t=this.buckets[e];if(t instanceof $c&&t.hasRTLText){this.hasRTLText=!0,fn.isLoading()||fn.isLoaded()||"deferred"!==dn()||pn();break}}this.queryPadding=0;for(const e in this.buckets){const i=this.buckets[e];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(e).queryRadius(i))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new na}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const t in this.buckets){const i=this.buckets[t];i.uploadPending()&&i.upload(e)}const t=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new uh(e,this.imageAtlas.image,t.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new uh(e,this.glyphAtlasImage,t.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,t,i,r,n,a,o,s){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:r,pixelPosMatrix:o,transform:a,params:n},e,t,i):{}}querySourceFeatures(e,t){const i=this.latestFeatureIndex;if(!i||!i.rawTileData)return;const r=i.loadVTLayers(),n=t?t.sourceLayer:"",a=r._geojsonTileLayer||r[n];if(!a)return;const o=ur(t&&t.filter),{z:s,x:l,y:c}=this.tileID.canonical,h={z:s,x:l,y:c};for(let t=0;t<a.length;t++){const r=a.feature(t);if(o.needGeometry){const e=Ha(r,!0);if(!o.filter(new mn(this.tileID.overscaledZ),e,this.tileID.canonical))continue}else if(!o.filter(new mn(this.tileID.overscaledZ),r))continue;const u=i.getId(r,n),d=new Dh(r,s,l,c,u);d.tile=h,e.push(d)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const t=this.expirationTime;if(e.cacheControl){const t=R(e.cacheControl);t["max-age"]&&(this.expirationTime=Date.now()+1e3*t["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const e=Date.now();let i=!1;if(this.expirationTime>e)i=!1;else if(t)if(this.expirationTime<t)i=!0;else{const r=this.expirationTime-t;r?this.expirationTime=e+Math.max(r,3e4):i=!0}else i=!0;i?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length)return;const i=this.latestFeatureIndex.loadVTLayers();for(const r in this.buckets){if(!t.style.hasLayer(r))continue;const n=this.buckets[r],a=n.layers[0].sourceLayer||"_geojsonTileLayer",o=i[a],s=e[a];if(!o||!s||0===Object.keys(s).length)continue;n.update(s,o,this.imageAtlas&&this.imageAtlas.patternPositions||{});const l=t&&t.style&&t.style.getLayer(r);l&&(this.queryPadding=Math.max(this.queryPadding,l.queryRadius(n)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<U.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=U.now()+e}setDependencies(e,t){const i={};for(const e of t)i[e]=!0;this.dependencies[e]=i}hasDependency(e,t){for(const i of e){const e=this.dependencies[i];if(e)for(const i of t)if(e[i])return!0}return!1}clearQueryDebugViz(){}}class Oh{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,t,i){const r=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][r]=this.stateChanges[e][r]||{},y(this.stateChanges[e][r],i),null===this.deletedStates[e]){this.deletedStates[e]={};for(const t in this.state[e])t!==r&&(this.deletedStates[e][t]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][r]){this.deletedStates[e][r]={};for(const t in this.state[e][r])i[t]||(this.deletedStates[e][r][t]=null)}else for(const t in i)this.deletedStates[e]&&this.deletedStates[e][r]&&null===this.deletedStates[e][r][t]&&delete this.deletedStates[e][r][t]}removeFeatureState(e,t,i){if(null===this.deletedStates[e])return;const r=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},i&&void 0!==t)null!==this.deletedStates[e][r]&&(this.deletedStates[e][r]=this.deletedStates[e][r]||{},this.deletedStates[e][r][i]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][r])for(i in this.deletedStates[e][r]={},this.stateChanges[e][r])this.deletedStates[e][r][i]=null;else this.deletedStates[e][r]=null;else this.deletedStates[e]=null}getState(e,t){const i=String(t),r=y({},(this.state[e]||{})[i],(this.stateChanges[e]||{})[i]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const i=this.deletedStates[e][t];if(null===i)return{};for(const e in i)delete r[e]}return r}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(e,t){const i={};for(const e in this.stateChanges){this.state[e]=this.state[e]||{};const t={};for(const i in this.stateChanges[e])this.state[e][i]||(this.state[e][i]={}),y(this.state[e][i],this.stateChanges[e][i]),t[i]=this.state[e][i];i[e]=t}for(const e in this.deletedStates){this.state[e]=this.state[e]||{};const t={};if(null===this.deletedStates[e])for(const i in this.state[e])t[i]={},this.state[e][i]={};else for(const i in this.deletedStates[e]){if(null===this.deletedStates[e][i])this.state[e][i]={};else for(const t of Object.keys(this.deletedStates[e][i]))delete this.state[e][i][t];t[i]=this.state[e][i]}i[e]=i[e]||{},y(i[e],t)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(i).length)for(const r in e)e[r].setFeatureState(i,t)}}class Bh{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,t){const i=this.toIdx(e,t);return{min:this.minimums[i],max:this.maximums[i]}}isLeaf(e,t){return this.leaves[this.toIdx(e,t)]}toIdx(e,t){return t*this.size+e}}function Fh(e,t,i,r){let n=0,a=Number.MAX_VALUE;for(let o=0;o<3;o++)if(Math.abs(r[o])<1e-15){if(i[o]<e[o]||i[o]>t[o])return null}else{const s=1/r[o];let l=(e[o]-i[o])*s,c=(t[o]-i[o])*s;if(l>c){const e=l;l=c,c=e}if(l>n&&(n=l),c<a&&(a=c),n>a)return null}return n}function Nh(e,t,i,r,n,a,o,s,l,c,h){const u=r-e,d=n-t,p=a-i,f=o-e,m=s-t,g=l-i,y=h[1]*g-h[2]*m,v=h[2]*f-h[0]*g,_=h[0]*m-h[1]*f,x=u*y+d*v+p*_;if(Math.abs(x)<1e-15)return null;const b=1/x,w=c[0]-e,M=c[1]-t,T=c[2]-i,S=(w*y+M*v+T*_)*b;if(S<0||S>1)return null;const E=M*p-T*d,A=T*u-w*p,C=w*d-M*u,L=(h[0]*E+h[1]*A+h[2]*C)*b;return L<0||S+L>1?null:(f*E+m*A+g*C)*b}function Uh(e,t,i){return(e-t)/(i-t)}function jh(e,t,i,r,n,a,o,s,l){const c=1<<i,h=a-r,u=o-n,d=(e+1)/c*h+r,p=(t+0)/c*u+n,f=(t+1)/c*u+n;s[0]=(e+0)/c*h+r,s[1]=p,l[0]=d,l[1]=f}class Vh{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const t=function(e){const t=Math.ceil(Math.log2(e.dim/8)),i=[];let r=Math.ceil(Math.pow(2,t));const n=1/r,a=(e,t,i,r,n)=>{const a=r?1:0,o=(e+1)*i-a,s=t*i,l=(t+1)*i-a;n[0]=e*i,n[1]=s,n[2]=o,n[3]=l};let o=new Bh(r);const s=[];for(let t=0;t<r*r;t++){a(t%r,Math.floor(t/r),n,!1,s);const i=Hh(s[0],s[1],e),l=Hh(s[2],s[1],e),c=Hh(s[2],s[3],e),h=Hh(s[0],s[3],e);o.minimums.push(Math.min(i,l,c,h)),o.maximums.push(Math.max(i,l,c,h)),o.leaves.push(1)}for(i.push(o),r/=2;r>=1;r/=2){const e=i[i.length-1];o=new Bh(r);for(let t=0;t<r*r;t++){a(t%r,Math.floor(t/r),2,!0,s);const i=e.getElevation(s[0],s[1]),n=e.getElevation(s[2],s[1]),l=e.getElevation(s[2],s[3]),c=e.getElevation(s[0],s[3]),h=e.isLeaf(s[0],s[1]),u=e.isLeaf(s[2],s[1]),d=e.isLeaf(s[2],s[3]),p=e.isLeaf(s[0],s[3]),f=Math.min(i.min,n.min,l.min,c.min),m=Math.max(i.max,n.max,l.max,c.max),g=h&&u&&d&&p;o.maximums.push(m),o.minimums.push(f),o.leaves.push(m-f<=5&&g?1:0)}i.push(o)}return i}(this.dem),i=t.length-1,r=t[i];this._addNode(r.minimums[0],r.maximums[0],r.leaves[0]),this._construct(t,0,0,i,0)}raycastRoot(e,t,i,r,n,a,o=1){return Fh([e,t,-100],[i,r,this.maximums[0]*o],n,a)}raycast(e,t,i,r,n,a,o=1){if(!this.nodeCount)return null;const s=this.raycastRoot(e,t,i,r,n,a,o);if(null==s)return null;const l=[],c=[],h=[],u=[],d=[{idx:0,t:s,nodex:0,nodey:0,depth:0}];for(;d.length>0;){const{idx:s,t:p,nodex:f,nodey:m,depth:g}=d.pop();if(this.leaves[s]){jh(f,m,g,e,t,i,r,h,u);const s=1<<g,l=(f+0)/s,c=(f+1)/s,d=(m+0)/s,y=(m+1)/s,v=Hh(l,d,this.dem)*o,_=Hh(c,d,this.dem)*o,x=Hh(c,y,this.dem)*o,b=Hh(l,y,this.dem)*o,w=Nh(h[0],h[1],v,u[0],h[1],_,u[0],u[1],x,n,a),M=Nh(u[0],u[1],x,h[0],u[1],b,h[0],h[1],v,n,a),T=Math.min(null!==w?w:Number.MAX_VALUE,null!==M?M:Number.MAX_VALUE);if(T!==Number.MAX_VALUE)return T;{const e=To([],n,a,p);if(Gh(v,_,b,x,Uh(e[0],h[0],u[0]),Uh(e[1],h[1],u[1]))>=e[2])return p}continue}let y=0;for(let d=0;d<this._siblingOffset.length;d++){jh((f<<1)+this._siblingOffset[d][0],(m<<1)+this._siblingOffset[d][1],g+1,e,t,i,r,h,u),h[2]=-100,u[2]=this.maximums[this.childOffsets[s]+d]*o;const p=Fh(h,u,n,a);if(null!=p){const e=p;l[d]=e;let t=!1;for(let i=0;i<y&&!t;i++)e>=l[c[i]]&&(c.splice(i,0,d),t=!0);t||(c[y]=d),y++}}for(let e=0;e<y;e++){const t=c[e];d.push({idx:this.childOffsets[s]+t,t:l[t],nodex:(f<<1)+this._siblingOffset[t][0],nodey:(m<<1)+this._siblingOffset[t][1],depth:g+1})}}return null}_addNode(e,t,i){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(i),this.childOffsets.push(0),this.nodeCount++}_construct(e,t,i,r,n){if(1===e[r].isLeaf(t,i))return;this.childOffsets[n]||(this.childOffsets[n]=this.nodeCount);const a=r-1,o=e[a];let s,l=0;for(let e=0;e<this._siblingOffset.length;e++){const r=2*t+this._siblingOffset[e][0],n=2*i+this._siblingOffset[e][1],a=o.getElevation(r,n),c=o.isLeaf(r,n),h=this._addNode(a.min,a.max,c);c&&(l|=1<<e),s||(s=h)}for(let r=0;r<this._siblingOffset.length;r++)l&1<<r||this._construct(e,2*t+this._siblingOffset[r][0],2*i+this._siblingOffset[r][1],a,s+r)}}function Gh(e,t,i,r,n,a){return Jt(Jt(e,i,a),Jt(t,r,a),n)}function Hh(e,t,i){const r=i.dim,n=f(e*r-.5,0,r-1),a=f(t*r-.5,0,r-1),o=Math.floor(n),s=Math.floor(a),l=Math.min(o+1,r-1),c=Math.min(s+1,r-1);return Gh(i.get(o,s),i.get(l,s),i.get(o,c),i.get(l,c),n-o,a-s)}const Wh={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class qh{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,t,i,r=!1,n=!1){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(i&&"mapbox"!==i&&"terrarium"!==i)return C(`"${i}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=t.height;const a=this.dim=t.height-2;if(this.data=new Uint32Array(t.data.buffer),this.encoding=i||"mapbox",this.borderReady=r,!r){for(let e=0;e<a;e++)this.data[this._idx(-1,e)]=this.data[this._idx(0,e)],this.data[this._idx(a,e)]=this.data[this._idx(a-1,e)],this.data[this._idx(e,-1)]=this.data[this._idx(e,0)],this.data[this._idx(e,a)]=this.data[this._idx(e,a-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(a,-1)]=this.data[this._idx(a-1,0)],this.data[this._idx(-1,a)]=this.data[this._idx(0,a-1)],this.data[this._idx(a,a)]=this.data[this._idx(a-1,a-1)],n&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Vh(this)}get(e,t){const i=new Uint8Array(this.data.buffer),r=4*this._idx(e,t);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(i[r],i[r+1],i[r+2])}static getUnpackVector(e){return Wh[e]}get unpackVector(){return Wh[this.encoding]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}_unpackMapbox(e,t,i){return(256*e*256+256*t+i)/10-1e4}_unpackTerrarium(e,t,i){return 256*e+t+i/256-32768}static pack(e,t){const i=[0,0,0,0],r=qh.getUnpackVector(t);let n=Math.floor((e+r[3])/r[2]);return i[2]=n%256,n=Math.floor(n/256),i[1]=n%256,n=Math.floor(n/256),i[0]=n,i}getPixels(){return new Zo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,t,i){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let r=t*this.dim,n=t*this.dim+this.dim,a=i*this.dim,o=i*this.dim+this.dim;switch(t){case-1:r=n-1;break;case 1:n=r+1}switch(i){case-1:a=o-1;break;case 1:o=a+1}const s=-t*this.dim,l=-i*this.dim;for(let t=a;t<o;t++)for(let i=r;i<n;i++)this.data[this._idx(i,t)]=e.data[this._idx(i+s,t+l)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}Hr("DEMData",qh),Hr("DemMinMaxQuadTree",Vh,{omit:["dem"]});class Zh{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,i){const r=e.wrapped().key;void 0===this.data[r]&&(this.data[r]=[]);const n={value:t,timeout:void 0};if(void 0!==i&&(n.timeout=setTimeout((()=>{this.remove(e,n)}),i)),this.data[r].push(n),this.order.push(r),this.order.length>this.max){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const i=e.wrapped().key,r=void 0===t?0:this.data[i].indexOf(t),n=this.data[i][r];return this.data[i].splice(r,1),n.timeout&&clearTimeout(n.timeout),0===this.data[i].length&&delete this.data[i],this.onRemove(n.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(e){const t=[];for(const i in this.data)for(const r of this.data[i])e(r.value)||t.push(r);for(const e of t)this.remove(e.value.tileID,e)}}class Xh{constructor(e,t,i){this.context=e;const r=e.gl;this.buffer=r.createBuffer(),this.dynamicDraw=Boolean(i),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete t.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const t=this.context.gl;this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const $h={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Yh{constructor(e,t,i,r){this.length=t.length,this.attributes=i,this.itemSize=t.bytesPerElement,this.dynamicDraw=r,this.context=e;const n=e.gl;this.buffer=n.createBuffer(),e.bindVertexBuffer.set(this.buffer),n.bufferData(n.ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||delete t.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){const t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,t){for(let i=0;i<this.attributes.length;i++){const r=t.attributes[this.attributes[i].name];void 0!==r&&e.enableVertexAttribArray(r)}}setVertexAttribPointers(e,t,i){for(let r=0;r<this.attributes.length;r++){const n=this.attributes[r],a=t.attributes[n.name];void 0!==a&&e.vertexAttribPointer(a,n.components,e[$h[n.type]],!1,this.itemSize,n.offset+this.itemSize*(i||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Jh{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Kh extends Jh{getDefault(){return st.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Qh extends Jh{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class eu extends Jh{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class tu extends Jh{getDefault(){return[!0,!0,!0,!0]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class iu extends Jh{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class ru extends Jh{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class nu extends Jh{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const t=this.current;(e.func!==t.func||e.ref!==t.ref||e.mask!==t.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class au extends Jh{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class ou extends Jh{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1}}class su extends Jh{getDefault(){return[0,1]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class lu extends Jh{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1}}class cu extends Jh{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class hu extends Jh{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1}}class uu extends Jh{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class du extends Jh{getDefault(){return st.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class pu extends Jh{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class fu extends Jh{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1}}class mu extends Jh{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class gu extends Jh{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class yu extends Jh{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class vu extends Jh{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class _u extends Jh{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class xu extends Jh{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class bu extends Jh{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class wu extends Jh{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Mu extends Jh{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Tu extends Jh{getDefault(){return null}set(e){const t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Su extends Jh{constructor(e){super(e),this.vao=e.extVertexArrayObject}getDefault(){return null}set(e){this.vao&&(e!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(e),this.current=e,this.dirty=!1)}}class Eu extends Jh{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Au extends Jh{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Cu extends Jh{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Lu extends Jh{constructor(e,t){super(e),this.context=e,this.parent=t}getDefault(){return null}}class Pu extends Lu{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Iu extends Lu{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,this.attachment(),t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Ru{constructor(e,t,i,r){this.context=e,this.width=t,this.height=i;const n=this.framebuffer=e.gl.createFramebuffer();this.colorAttachment=new Pu(e,n),r&&(this.depthAttachment=new Iu(e,n))}destroy(){const e=this.context.gl,t=this.colorAttachment.get();if(t&&e.deleteTexture(t),this.depthAttachment){const t=this.depthAttachment.get();t&&e.deleteRenderbuffer(t)}e.deleteFramebuffer(this.framebuffer)}}class Du{constructor(e,t,i){this.func=e,this.mask=t,this.range=i}}Du.ReadOnly=!1,Du.ReadWrite=!0,Du.disabled=new Du(519,Du.ReadOnly,[0,1]);class ku{constructor(e,t,i,r,n,a){this.test=e,this.ref=t,this.mask=i,this.fail=r,this.depthFail=n,this.pass=a}}ku.disabled=new ku({func:519,mask:0},0,0,7680,7680,7680);class zu{constructor(e,t,i){this.blendFunction=e,this.blendColor=t,this.mask=i}}zu.Replace=[1,0],zu.disabled=new zu(zu.Replace,st.transparent,[!1,!1,!1,!1]),zu.unblended=new zu(zu.Replace,st.transparent,[!0,!0,!0,!0]),zu.alphaBlended=new zu([1,771],st.transparent,[!0,!0,!0,!0]);class Ou{constructor(e,t,i){this.enable=e,this.mode=t,this.frontFace=i}}Ou.disabled=new Ou(!1,1029,2305),Ou.backCCW=new Ou(!0,1029,2305),Ou.backCW=new Ou(!0,1029,2304),Ou.frontCW=new Ou(!0,1028,2304),Ou.frontCCW=new Ou(!0,1028,2305);class Bu extends ke{constructor(e,t,i){super(),this.id=e,this._onlySymbols=i,t.on("data",(e=>{"source"===e.dataType&&"metadata"===e.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))})),t.on("error",(()=>{this._sourceErrored=!0})),this._source=t,this._tiles={},this._cache=new Zh(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Oh}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const e in this._tiles){const t=this._tiles[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,(()=>{}))}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,(()=>{}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const t in this._tiles){const i=this._tiles[t];i.upload(e),i.prepare(this.map.style.imageManager)}}getIds(){return g(this._tiles).map((e=>e.tileID)).sort(Fu).map((e=>e.key))}getRenderableIds(e){const t=[];for(const i in this._tiles)this._isIdRenderable(+i,e)&&t.push(this._tiles[i]);return e?t.sort(((e,t)=>{const i=e.tileID,n=t.tileID,a=new r(i.canonical.x,i.canonical.y)._rotate(this.transform.angle),o=new r(n.canonical.x,n.canonical.y)._rotate(this.transform.angle);return i.overscaledZ-n.overscaledZ||o.y-a.y||o.x-a.x})).map((e=>e.tileID.key)):t.map((e=>e.tileID)).sort(Fu).map((e=>e.key))}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,t){const i=this._tiles[e];i&&("loading"!==i.state&&(i.state=t),this._loadTile(i,this._tileLoaded.bind(this,i,e,t)))}_tileLoaded(e,t,i,r){if(r)return e.state="errored",void(404!==r.status?this._source.fire(new De(r,{tile:e})):this.update(this.transform));e.timeAdded=U.now(),"expired"===i&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(t,e),"raster-dem"===this.getSource().type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Re("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const t=this.getRenderableIds();for(let r=0;r<t.length;r++){const n=t[r];if(e.neighboringTiles&&e.neighboringTiles[n]){const t=this.getTileByID(n);i(e,t),i(t,e)}}function i(e,t){if(!e.dem||e.dem.borderReady)return;e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0;let i=t.tileID.canonical.x-e.tileID.canonical.x;const r=t.tileID.canonical.y-e.tileID.canonical.y,n=Math.pow(2,e.tileID.canonical.z),a=t.tileID.key;0===i&&0===r||Math.abs(r)>1||(Math.abs(i)>1&&(1===Math.abs(i+n)?i+=n:1===Math.abs(i-n)&&(i-=n)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,i,r),e.neighboringTiles&&e.neighboringTiles[a]&&(e.neighboringTiles[a].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,i,r){for(const n in this._tiles){let a=this._tiles[n];if(r[n]||!a.hasData()||a.tileID.overscaledZ<=t||a.tileID.overscaledZ>i)continue;let o=a.tileID;for(;a&&a.tileID.overscaledZ>t+1;){const e=a.tileID.scaledTo(a.tileID.overscaledZ-1);a=this._tiles[e.key],a&&a.hasData()&&(o=e)}let s=o;for(;s.overscaledZ>t;)if(s=s.scaledTo(s.overscaledZ-1),e[s.key]){r[o.key]=o;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const i=this._loadedParentTiles[e.key];return i&&i.tileID.overscaledZ>=t?i:null}for(let i=e.overscaledZ-1;i>=t;i--){const t=e.scaledTo(i),r=this._getLoadedTile(t);if(r)return r}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,t){t=t||this._source.tileSize;const i=Math.ceil(e.width/t)+1,r=Math.ceil(e.height/t)+1,n=Math.floor(i*r*5),a="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,n):n;this._cache.setMaxSize(a)}handleWrapJump(e){const t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){const e={};for(const i in this._tiles){const r=this._tiles[i];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+t),e[r.tileID.key]=r}this._tiles=e;for(const e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(const e in this._tiles)this._setTileReloadTimer(+e,this._tiles[e])}}update(e,t,i){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage)return;if(this.usedForTerrain&&!i)return;let r;this.updateCacheSize(e,t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?r=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((e=>new Ph(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y))):(r=e.coveringTiles({tileSize:t||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!i,reparseOverscaled:this._source.reparseOverscaled,useElevationData:!!this.transform.elevation&&!this.usedForTerrain}),this._source.hasTile&&(r=r.filter((e=>this._source.hasTile(e))))):r=[];const n=this._updateRetainedTiles(r);if(Nu(this._source.type)&&0!==r.length){const e={},t={},i=Object.keys(n);for(const r of i){const i=n[r],a=this._tiles[r];if(!a||a.fadeEndTime&&a.fadeEndTime<=U.now())continue;const o=this.findLoadedParent(i,Math.max(i.overscaledZ-Bu.maxOverzooming,this._source.minzoom));o&&(this._addTile(o.tileID),e[o.tileID.key]=o.tileID),t[r]=i}const a=r[r.length-1].overscaledZ;for(const e in this._tiles){const i=this._tiles[e];if(n[e]||!i.hasData())continue;let r=i.tileID;for(;r.overscaledZ>a;){r=r.scaledTo(r.overscaledZ-1);const a=this._tiles[r.key];if(a&&a.hasData()&&t[r.key]){n[e]=i.tileID;break}}}for(const t in e)n[t]||(this._coveredTiles[t]=!0,n[t]=e[t])}for(const e in n)this._tiles[e].clearFadeHold();const a=function(e,t){const i=[];for(const r in e)r in t||i.push(r);return i}(this._tiles,n);for(const e of a){const t=this._tiles[e];t.hasSymbolBuckets&&!t.holdingForFade()?t.setHoldDuration(this.map._fadeDuration):t.hasSymbolBuckets&&!t.symbolFadeFinished()||this._removeTile(+e)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const t={};if(0===e.length)return t;const i={},r=e[e.length-1].overscaledZ,n=e[0].overscaledZ,a=Math.max(n-Bu.maxOverzooming,this._source.minzoom),o=Math.max(n+Bu.maxUnderzooming,this._source.minzoom),s={};for(const i of e){const e=this._addTile(i);t[i.key]=i,e.hasData()||r<this._source.maxzoom&&(s[i.key]=i)}this._retainLoadedChildren(s,r,o,t);for(const r of e){let e=this._tiles[r.key];if(e.hasData())continue;if(r.canonical.z>=this._source.maxzoom){const e=r.children(this._source.maxzoom)[0],i=this.getTile(e);if(i&&i.hasData()){t[e.key]=e;continue}}else{const e=r.children(this._source.maxzoom);if(t[e[0].key]&&t[e[1].key]&&t[e[2].key]&&t[e[3].key])continue}let n=e.wasRequested();for(let o=r.overscaledZ-1;o>=a;--o){const a=r.scaledTo(o);if(i[a.key])break;if(i[a.key]=!0,e=this.getTile(a),!e&&n&&(e=this._addTile(a)),e&&(t[a.key]=a,n=e.wasRequested(),e.hasData()))break}}return t}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let i,r=this._tiles[e].tileID;for(;r.overscaledZ>0;){if(r.key in this._loadedParentTiles){i=this._loadedParentTiles[r.key];break}t.push(r.key);const e=r.scaledTo(r.overscaledZ-1);if(i=this._getLoadedTile(e),i)break;r=e}for(const e of t)this._loadedParentTiles[e]=i}}_addTile(e){let t=this._tiles[e.key];if(t)return t;t=this._cache.getAndRemove(e),t&&(this._setTileReloadTimer(e.key,t),t.tileID=e,this._state.initializeTileState(t,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,t)));const i=Boolean(t);return i||(t=new zh(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom),this._loadTile(t,this._tileLoaded.bind(this,t,e.key,t.state))),t?(t.uses++,this._tiles[e.key]=t,i||this._source.fire(new Re("dataloading",{tile:t,coord:t.tileID,dataType:"source"})),t):null}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const i=t.getExpiryTimeout();i&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),i))}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&"reloading"!==t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._cache.reset()}tilesIn(e,t,i){const r=[],n=this.transform;if(!n)return r;for(const a in this._tiles){const o=this._tiles[a];if(i&&o.clearQueryDebugViz(),o.holdingForFade())continue;const s=e.containsTile(o,n,t);s&&r.push(s)}return r}getVisibleCoordinates(e){const t=this.getRenderableIds(e).map((e=>this._tiles[e].tileID));for(const e of t)e.posMatrix=this.transform.calculatePosMatrix(e.toUnwrapped());return t}hasTransition(){if(this._source.hasTransition())return!0;if(Nu(this._source.type))for(const e in this._tiles){const t=this._tiles[e];if(void 0!==t.fadeEndTime&&t.fadeEndTime>=U.now())return!0}return!1}setFeatureState(e,t,i){this._state.updateState(e=e||"_geojsonTileLayer",t,i)}removeFeatureState(e,t,i){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,i)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,i){const r=this._tiles[e];r&&r.setDependencies(t,i)}reloadTilesForDependencies(e,t){for(const i in this._tiles)this._tiles[i].hasDependency(e,t)&&this._reloadTile(+i,"reloading");this._cache.filter((i=>!i.hasDependency(e,t)))}}function Fu(e,t){const i=Math.abs(2*e.wrap)-+(e.wrap<0),r=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||r-i||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function Nu(e){return"raster"===e||"image"===e||"video"===e}Bu.maxOverzooming=10,Bu.maxUnderzooming=3;class Uu{constructor(e,t,i){this._dem=e,this._scale=t,this._offset=i}static create(e,t,i){const r=i||e.findDEMTileFor(t);if(!r||!r.dem)return;const n=r.dem,a=r.tileID,o=1<<t.canonical.z-a.canonical.z;return new Uu(n,r.tileSize/8192/o,[(t.canonical.x/o-a.canonical.x)*n.dim,(t.canonical.y/o-a.canonical.y)*n.dim])}getElevationAt(e,t,i){const r=e*this._scale+this._offset[0],n=t*this._scale+this._offset[1],a=Math.floor(r),o=Math.floor(n),s=this._dem;return i?Jt(Jt(s.get(a,o),s.get(a,o+1),n-o),Jt(s.get(a+1,o),s.get(a+1,o+1),n-o),r-a):s.get(a,o)}}class ju{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Nr(8192,16,0),this.featureIndexArray=new da,this.promoteId=t}insert(e,t,i,r,n){const a=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,r,n);const o=this.grid;for(let e=0;e<t.length;e++){const i=t[e],r=[1/0,1/0,-1/0,-1/0];for(let e=0;e<i.length;e++){const t=i[e];r[0]=Math.min(r[0],t.x),r[1]=Math.min(r[1],t.y),r[2]=Math.max(r[2],t.x),r[3]=Math.max(r[3],t.y)}r[0]<8192&&r[1]<8192&&r[2]>=0&&r[3]>=0&&o.insert(a,r[0],r[1],r[2],r[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Xs.VectorTile(new Ll(this.rawTileData)).layers,this.sourceLayerCoder=new Rh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,t,i,r){this.loadVTLayers();const n=e.params||{},a=ur(n.filter),o=e.tileResult,s=e.transform,l=o.bufferedTilespaceBounds,c=this.grid.query(l.min.x,l.min.y,l.max.x,l.max.y,((e,t,i,r)=>ro(o.bufferedTilespaceGeometry,e,t,i,r)));c.sort(Gu);let h=null;s.elevation&&c.length>0&&(h=Uu.create(s.elevation,this.tileID));const u={};let d;for(let s=0;s<c.length;s++){const l=c[s];if(l===d)continue;d=l;const p=this.featureIndexArray.get(l);let f=null;this.loadMatchingFeature(u,p.bucketIndex,p.sourceLayerIndex,p.featureIndex,a,n.layers,n.availableImages,t,i,r,((t,i,r)=>(f||(f=Ga(t)),i.queryIntersectsFeature(o,t,r,f,this.z,e.transform,e.pixelPosMatrix,h))))}return u}loadMatchingFeature(e,t,i,r,n,a,o,s,l,c,h){const u=this.bucketLayerIDs[t];if(a&&!function(e,t){for(let i=0;i<e.length;i++)if(t.indexOf(e[i])>=0)return!0;return!1}(a,u))return;const d=this.sourceLayerCoder.decode(i),p=this.vtLayers[d].feature(r);if(n.needGeometry){const e=Ha(p,!0);if(!n.filter(new mn(this.tileID.overscaledZ),e,this.tileID.canonical))return}else if(!n.filter(new mn(this.tileID.overscaledZ),p))return;const f=this.getId(p,d);for(let t=0;t<u.length;t++){const i=u[t];if(a&&a.indexOf(i)<0)continue;const n=s[i];if(!n)continue;let d={};void 0!==f&&c&&(d=c.getState(n.sourceLayer||"_geojsonTileLayer",f));const m=y({},l[i]);m.paint=Vu(m.paint,n.paint,p,d,o),m.layout=Vu(m.layout,n.layout,p,d,o);const g=!h||h(p,n,d);if(!g)continue;const v=new Dh(p,this.z,this.x,this.y,f);v.layer=m;let _=e[i];void 0===_&&(_=e[i]=[]),_.push({featureIndex:r,feature:v,intersectionZ:g})}}lookupSymbolFeatures(e,t,i,r,n,a,o,s){const l={};this.loadVTLayers();const c=ur(n);for(const n of e)this.loadMatchingFeature(l,i,r,n,c,a,o,s,t);return l}hasLayer(e){for(const t of this.bucketLayerIDs)for(const i of t)if(e===i)return!0;return!1}getId(e,t){let i=e.id;return this.promoteId&&(i=e.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[t]],"boolean"==typeof i&&(i=Number(i))),i}}function Vu(e,t,i,r,n){return T(e,((e,a)=>{const o=t instanceof Mn?t.get(a):null;return o&&o.evaluate?o.evaluate(i,r,n):o}))}function Gu(e,t){return t-e}Hr("FeatureIndex",ju,{omit:["rawTileData","sourceLayerCoder"]});class Hu{constructor(e){const t={},i=[];for(const r in e){const n=e[r],a=t[r]={};for(const e in n){const t=n[+e];if(!t||0===t.bitmap.width||0===t.bitmap.height)continue;const r={x:0,y:0,w:t.bitmap.width+2,h:t.bitmap.height+2};i.push(r),a[e]={rect:r,metrics:t.metrics}}}const{w:r,h:n}=Yl(i),a=new qo({width:r||1,height:n||1});for(const i in e){const r=e[i];for(const e in r){const n=r[+e];if(!n||0===n.bitmap.width||0===n.bitmap.height)continue;const o=t[i][e].rect;qo.copy(n.bitmap,a,{x:0,y:0},{x:o.x+1,y:o.y+1},n.bitmap)}}this.image=a,this.positions=t}}Hr("GlyphAtlas",Hu);class Wu{constructor(e){this.tileID=new Ph(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile}parse(e,t,i,r,n){this.status="parsing",this.data=e,this.collisionBoxArray=new na;const a=new Rh(Object.keys(e.layers).sort()),o=new ju(this.tileID,this.promoteId);o.bucketLayerIDs=[];const s={},l={featureIndex:o,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:i},c=t.familiesBySource[this.source];for(const t in c){const r=e.layers[t];if(!r)continue;let n=!1,h=!1;for(const e of c[t])"symbol"===e[0].type?n=!0:h=!0;if(!0===this.isSymbolTile&&!n)continue;if(!1===this.isSymbolTile&&!h)continue;1===r.version&&C(`Vector tile source "${this.source}" layer "${t}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const u=a.encode(t),d=[];for(let e=0;e<r.length;e++){const i=r.feature(e),n=o.getId(i,t);d.push({feature:i,id:n,index:e,sourceLayerIndex:u})}for(const e of c[t]){const t=e[0];void 0!==this.isSymbolTile&&"symbol"===t.type!==this.isSymbolTile||t.minzoom&&this.zoom<Math.floor(t.minzoom)||t.maxzoom&&this.zoom>=t.maxzoom||"none"!==t.visibility&&(qu(e,this.zoom,i),(s[t.id]=t.createBucket({index:o.bucketLayerIDs.length,layers:e,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:u,sourceID:this.source,enableTerrain:this.enableTerrain})).populate(d,l,this.tileID.canonical),o.bucketLayerIDs.push(e.map((e=>e.id))))}}let h,u,d,p;const f={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},m=T(l.glyphDependencies,(e=>Object.keys(e).map(Number)));Object.keys(m).length?r.send("getGlyphs",{uid:this.uid,stacks:m},((e,t)=>{h||(h=e,u=t,_.call(this))}),void 0,void 0,f):u={};const y=Object.keys(l.iconDependencies);y.length?r.send("getImages",{icons:y,source:this.source,tileID:this.tileID,type:"icons"},((e,t)=>{h||(h=e,d=t,_.call(this))}),void 0,void 0,f):d={};const v=Object.keys(l.patternDependencies);function _(){if(h)return n(h);if(u&&d&&p){const e=new Hu(u),t=new Kl(d,p);for(const r in s){const n=s[r];n instanceof $c?(qu(n.layers,this.zoom,i),kc(n,u,e.positions,d,t.iconPositions,this.showCollisionBoxes,this.tileID.canonical,this.tileZoom)):n.hasPattern&&(n instanceof hl||n instanceof ks||n instanceof Qs)&&(qu(n.layers,this.zoom,i),n.addFeatures(l,this.tileID.canonical,t.patternPositions))}this.status="done",n(null,{buckets:g(s).filter((e=>!e.isEmpty())),featureIndex:o,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,imageAtlas:t,glyphMap:this.returnDependencies?u:null,iconMap:this.returnDependencies?d:null,glyphPositions:this.returnDependencies?e.positions:null})}}v.length?r.send("getImages",{icons:v,source:this.source,tileID:this.tileID,type:"patterns"},((e,t)=>{h||(h=e,p=t,_.call(this))}),void 0,void 0,f):p={},_.call(this)}}function qu(e,t,i){const r=new mn(t);for(const t of e)t.recalculate(r,i)}class Zu{constructor(e){this.entries={},this.scheduler=e}request(e,t,i,r){const n=this.entries[e]=this.entries[e]||{callbacks:[]};if(n.result){const[e,i]=n.result;return this.scheduler?this.scheduler.add((()=>{r(e,i)}),t):r(e,i),()=>{}}return n.callbacks.push(r),n.cancel||(n.cancel=i(((i,r)=>{n.result=[i,r];for(const e of n.callbacks)this.scheduler?this.scheduler.add((()=>{e(i,r)}),t):e(i,r);setTimeout((()=>delete this.entries[e]),3e3)}))),()=>{n.result||(n.callbacks=n.callbacks.filter((e=>e!==r)),n.callbacks.length||(n.cancel(),delete this.entries[e]))}}}function Xu(e,t,i){const r=JSON.stringify(e.request);return e.data&&(this.deduped.entries[r]={result:[null,e.data]}),this.deduped.request(r,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},(t=>{const r=we(e.request,((e,r,n,a)=>{e?t(e):r&&t(null,{vectorTile:i?void 0:new Xs.VectorTile(new Ll(r)),rawData:r,cacheControl:n,expires:a})}));return()=>{r.cancel(),t()}}),t)}e.AUTH_ERR_MSG="NO_ACCESS_TOKEN",e.Aabb=Bo,e.Actor=class{constructor(e,t,i){this.target=e,this.parent=t,this.mapId=i,this.callbacks={},this.cancelCallbacks={},w(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=I()?e:a,this.scheduler=new mh}send(e,t,i,r,n=!1,a){const o=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=a,this.callbacks[o]=i);const s=O(this.globalScope)?void 0:[];return this.target.postMessage({id:o,type:e,hasCallback:!!i,targetMapId:r,mustQueue:n,sourceMapId:this.mapId,data:Zr(t,s)},s),{cancel:()=>{i&&delete this.callbacks[o],this.target.postMessage({id:o,type:"<cancel>",targetMapId:r,sourceMapId:this.mapId})}}}receive(e){const t=e.data,i=t.id;if(i&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){const e=this.cancelCallbacks[i];delete this.cancelCallbacks[i],e&&e.cancel()}else if(I()||t.mustQueue){const e=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add((()=>this.processTask(i,t)),e&&e.metadata||{type:"message"})}else this.processTask(i,t)}processTask(e,t){if("<response>"===t.type){const i=this.callbacks[e];delete this.callbacks[e],i&&(t.error?i(Xr(t.error)):i(null,Xr(t.data)))}else{const i=O(this.globalScope)?void 0:[],r=t.hasCallback?(t,r)=>{delete this.cancelCallbacks[e],this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:t?Zr(t):null,data:Zr(r,i)},i)}:e=>{},n=Xr(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,n,r);else if(this.parent.getWorkerSource){const e=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,e[0],n.source)[e[1]](n,r)}else r(new Error(`Could not find function ${t.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},e.AlphaImage=qo,e.CanonicalTileID=Ch,e.Color=st,e.ColorMode=zu,e.Context=class{constructor(e){this.gl=e,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Kh(this),this.clearDepth=new Qh(this),this.clearStencil=new eu(this),this.colorMask=new tu(this),this.depthMask=new iu(this),this.stencilMask=new ru(this),this.stencilFunc=new nu(this),this.stencilOp=new au(this),this.stencilTest=new ou(this),this.depthRange=new su(this),this.depthTest=new lu(this),this.depthFunc=new cu(this),this.blend=new hu(this),this.blendFunc=new uu(this),this.blendColor=new du(this),this.blendEquation=new pu(this),this.cullFace=new fu(this),this.cullFaceSide=new mu(this),this.frontFace=new gu(this),this.program=new yu(this),this.activeTexture=new vu(this),this.viewport=new _u(this),this.bindFramebuffer=new xu(this),this.bindRenderbuffer=new bu(this),this.bindTexture=new wu(this),this.bindVertexBuffer=new Mu(this),this.bindElementBuffer=new Tu(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Su(this),this.pixelStoreUnpack=new Eu(this),this.pixelStoreUnpackPremultiplyAlpha=new Au(this),this.pixelStoreUnpackFlipY=new Cu(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=e.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(e.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,t){return new Xh(this,e,t)}createVertexBuffer(e,t,i){return new Yh(this,e,t,i)}createRenderbuffer(e,t,i){const r=this.gl,n=r.createRenderbuffer();return this.bindRenderbuffer.set(n),r.renderbufferStorage(r.RENDERBUFFER,e,t,i),this.bindRenderbuffer.set(null),n}createFramebuffer(e,t,i){return new Ru(this,e,t,i)}clear({color:e,depth:t,stencil:i}){const r=this.gl;let n=0;e&&(n|=r.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==t&&(n|=r.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(t),this.depthMask.set(!0)),void 0!==i&&(n|=r.STENCIL_BUFFER_BIT,this.clearStencil.set(i),this.stencilMask.set(255)),r.clear(n)}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){o(e.blendFunction,zu.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}},e.CullFaceMode=Ou,e.DEMData=qh,e.DataConstantProperty=Tn,e.DedupedRequest=Zu,e.DepthMode=Du,e.DepthStencilAttachment=class extends Iu{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}},e.EXTENT=8192,e.Elevation=class{getAtPoint(e,t=0){const i=this._source();if(!i)return t;if(e.y<0||e.y>1)return t;const r=i.getSource().maxzoom,n=1<<r,a=Math.floor(e.x),o=e.x-a,s=new Ph(r,a,r,Math.floor(o*n),Math.floor(e.y*n)),l=this.findDEMTileFor(s);if(!l||!l.dem)return t;const c=l.dem,h=1<<l.tileID.canonical.z,u=(o*h-l.tileID.canonical.x)*c.dim,d=(e.y*h-l.tileID.canonical.y)*c.dim,p=Math.floor(u),f=Math.floor(d);return this.exaggeration()*Jt(Jt(c.get(p,f),c.get(p,f+1),d-f),Jt(c.get(p+1,f),c.get(p+1,f+1),d-f),u-p)}getAtTileOffset(e,t,i){const r=1<<e.canonical.z;return this.getAtPoint(new Eh(e.wrap+(e.canonical.x+t/8192)/r,(e.canonical.y+i/8192)/r))}getForTilePoints(e,t,i,r){const n=Uu.create(this,e,r);return!!n&&(t.forEach((e=>{e[2]=this.exaggeration()*n.getElevationAt(e[0],e[1],i)})),!0)}getMinMaxForTile(e){const t=this.findDEMTileFor(e);if(!t||!t.dem)return null;const i=t.dem.tree,r=t.tileID,n=1<<e.canonical.z-r.canonical.z;let a=e.canonical.x/n-r.canonical.x,o=e.canonical.y/n-r.canonical.y,s=0;for(let t=0;t<e.canonical.z-r.canonical.z&&!i.leaves[s];t++){a*=2,o*=2;const e=2*Math.floor(o)+Math.floor(a);s=i.childOffsets[s]+e,a%=1,o%=1}return{min:this.exaggeration()*i.minimums[s],max:this.exaggeration()*i.maximums[s]}}raycast(e,t,i){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},e.ErrorEvent=De,e.EvaluationParameters=mn,e.Event=Re,e.Evented=ke,e.Frustum=Oo,e.ImagePosition=Jl,e.LngLat=vh,e.LngLatBounds=yh,e.MAX_SAFE_INTEGER=s,e.MercatorCoordinate=Eh,e.ONE_EM=24,e.OverscaledTileID=Ph,e.Point=r,e.Point$1=r,e.Properties=Ln,e.RGBAImage=Zo,e.Ray=class{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(e,t,i){const r=Eo(t,this.dir);if(Math.abs(r)<1e-6)return!1;const n=Eo(Po(yo(),e,this.pos),t)/r;return function(e,t){e[0]=t[0],e[1]=t[1],e[2]=t[2]}(i,To(yo(),this.pos,this.dir,n)),!0}},e.RequestManager=class{constructor(e,t){this._transformRequestFn=e,this._customAccessToken=t,this._createSkuToken()}_createSkuToken(){const e=function(){let e="";for(let t=0;t<10;t++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",$,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}normalizeStyleURL(e,t){if(!Y(e))return e;const i=Q(e);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||t)}normalizeGlyphsURL(e,t){if(!Y(e))return e;const i=Q(e);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||t)}normalizeSourceURL(e,t){if(!Y(e))return e;const i=Q(e);return i.path=`/v4/${i.authority}.json`,i.params.push("secure"),this._makeAPIURL(i,this._customAccessToken||t)}normalizeSpriteURL(e,t,i,r){const n=Q(e);return Y(e)?(n.path=`/styles/v1${n.path}/sprite${t}${i}`,this._makeAPIURL(n,this._customAccessToken||r)):(n.path+=`${t}${i}`,ee(n))}normalizeTileURL(e,t,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!Y(e))return e;const r=Q(e);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${t||i&&"raster"!==r.authority&&512===i?"@2x":""}${G.supported?".webp":"$1"}`),"raster"===r.authority?r.path=`/${V.RASTER_URL_PREFIX}${r.path}`:(r.path=r.path.replace(/^.+\/v4\//,"/"),r.path=`/${V.TILE_URL_VERSION}${r.path}`);const n=this._customAccessToken||function(e){for(const t of e){const e=t.match(/^access_token=(.*)$/);if(e)return e[1]}return null}(r.params)||V.ACCESS_TOKEN;return V.REQUIRE_ACCESS_TOKEN&&n&&this._skuToken&&r.params.push(`sku=${this._skuToken}`),this._makeAPIURL(r,n)}canonicalizeTileURL(e,t){const i=Q(e);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return e;let r="mapbox://";i.path.match(/^\/raster\/v1\//)?r+=`raster/${i.path.replace(`/${V.RASTER_URL_PREFIX}/`,"")}`:r+=`tiles/${i.path.replace(`/${V.TILE_URL_VERSION}/`,"")}`;let n=i.params;return t&&(n=n.filter((e=>!e.match(/^access_token=/)))),n.length&&(r+=`?${n.join("&")}`),r}canonicalizeTileset(e,t){const i=!!t&&Y(t),r=[];for(const t of e.tiles||[])J(t)?r.push(this.canonicalizeTileURL(t,i)):r.push(t);return r}_makeAPIURL(e,t){const i="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",r=Q(V.API_URL);if(e.protocol=r.protocol,e.authority=r.authority,"http"===e.protocol){const t=e.params.indexOf("secure");t>=0&&e.params.splice(t,1)}if("/"!==r.path&&(e.path=`${r.path}${e.path}`),!V.REQUIRE_ACCESS_TOKEN)return ee(e);if(!(t=t||V.ACCESS_TOKEN))throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if("s"===t[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`);return e.params=e.params.filter((e=>-1===e.indexOf("access_token"))),e.params.push(`access_token=${t}`),ee(e)}},e.RequestPerformance=fh,e.ResourceType=ve,e.SegmentVector=Ua,e.SourceCache=Bu,e.StencilMode=ku,e.StructArrayLayout1ui2=ta,e.StructArrayLayout2f1f2i16=qn,e.StructArrayLayout2i4=On,e.StructArrayLayout3f12=Vn,e.StructArrayLayout3ui6=Xn,e.StructArrayLayout4i8=Bn,e.Texture=uh,e.Tile=zh,e.Transitionable=vn,e.Uniform1f=wa,e.Uniform1i=class extends ba{constructor(e,t){super(e,t),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1i(this.location,e))}},e.Uniform2f=class extends ba{constructor(e,t){super(e,t),this.current=[0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]||(this.current=e,this.gl.uniform2f(this.location,e[0],e[1]))}},e.Uniform3f=class extends ba{constructor(e,t){super(e,t),this.current=[0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]||(this.current=e,this.gl.uniform3f(this.location,e[0],e[1],e[2]))}},e.Uniform4f=Ma,e.UniformColor=Ta,e.UniformMatrix3f=class extends ba{constructor(e,t){super(e,t),this.current=Ea}set(e){for(let t=0;t<9;t++)if(e[t]!==this.current[t]){this.current=e,this.gl.uniformMatrix3fv(this.location,!1,e);break}}},e.UniformMatrix4f=class extends ba{constructor(e,t){super(e,t),this.current=Sa}set(e){if(e[12]!==this.current[12]||e[0]!==this.current[0])return this.current=e,void this.gl.uniformMatrix4fv(this.location,!1,e);for(let t=1;t<16;t++)if(e[t]!==this.current[t]){this.current=e,this.gl.uniformMatrix4fv(this.location,!1,e);break}}},e.UnwrappedTileID=Lh,e.ValidationError=Oe,e.VectorTileWorkerSource=class{constructor(e,t,i,r){this.actor=e,this.layerIndex=t,this.availableImages=i,this.loadVectorData=r||Xu,this.loading={},this.loaded={},this.deduped=new Zu(e.scheduler)}loadTile(e,t){const i=e.uid,r=!!(e&&e.request&&e.request.collectResourceTiming)&&new fh(e.request),n=this.loading[i]=new Wu(e);n.abort=this.loadVectorData(e,((e,a)=>{const o=!this.loading[i];if(delete this.loading[i],o||e||!a)return n.status="done",o||(this.loaded[i]=n),t(e);const s=a.rawData,l={};a.expires&&(l.expires=a.expires),a.cacheControl&&(l.cacheControl=a.cacheControl);const c={};if(r){const e=r.finish();e&&(c.resourceTiming=JSON.parse(JSON.stringify(e)))}n.vectorTile=a.vectorTile||new Xs.VectorTile(new Ll(s)),n.parse(n.vectorTile,this.layerIndex,this.availableImages,this.actor,((e,i)=>{if(e||!i)return t(e);t(null,y({rawTileData:s.slice(0)},i,l,c))})),this.loaded=this.loaded||{},this.loaded[i]=n}))}reloadTile(e,t){const i=this.loaded,r=e.uid,n=this;if(i&&i[r]){const a=i[r];a.showCollisionBoxes=e.showCollisionBoxes,a.enableTerrain=!!e.enableTerrain;const o=(e,i)=>{const r=a.reloadCallback;r&&(delete a.reloadCallback,a.parse(a.vectorTile,n.layerIndex,this.availableImages,n.actor,r)),t(e,i)};"parsing"===a.status?a.reloadCallback=o:"done"===a.status&&(a.vectorTile?a.parse(a.vectorTile,this.layerIndex,this.availableImages,this.actor,o):o())}}abortTile(e,t){const i=e.uid,r=this.loading[i];r&&(r.abort&&r.abort(),delete this.loading[i]),t()}removeTile(e,t){const i=this.loaded,r=e.uid;i&&i[r]&&delete i[r],t()}},e.WritingMode=Ql,e.ZoomHistory=$r,e.add=bo,e.addDynamicAttributes=Wc,e.altitudeFromMercatorZ=Sh,e.asyncAll=function(e,t,i){if(!e.length)return i(null,[]);let r=e.length;const n=new Array(e.length);let a=null;e.forEach(((e,o)=>{t(e,((e,t)=>{e&&(a=e),n[o]=t,0==--r&&i(a,n)}))}))},e.bezier=d,e.bindAll=w,e.browser=U,e.bufferConvexPolygon=function(e,t){const i=[];for(let r=0;r<e.length;r++){const n=m(r-1,-1,e.length-1),a=m(r+1,-1,e.length-1),o=e[r],s=e[a],l=e[n].sub(o).unit(),c=s.sub(o).unit(),h=c.angleWithSep(l.x,l.y),u=l.add(c).unit().mult(-1*t/Math.sin(h/2));i.push(o.add(u))}return i},e.cacheEntryPossiblyAdded=function(e){ge++,ge>de&&(e.getActor().send("enforceCacheSizeLimit",ue),ge=0)},e.clamp=f,e.clearTileCache=function(e){const t=a.caches.delete("mapbox-tiles");e&&t.catch(e).then((()=>e()))},e.clipLine=bc,e.clone=function(e){var t=new uo(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.clone$1=E,e.collisionCircleLayout=xl,e.config=V,e.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},e.create=function(){var e=new uo(16);return uo!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},e.create$1=po,e.create$2=function(){var e=new uo(4);return uo!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},e.createExpression=Ki,e.createLayout=kn,e.createStyleLayer=function(e){return"custom"===e.type?new ih(e):new ah[e.type](e)},e.cross=Ao,e.deepEqual=o,e.degToRad=h,e.div=function(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e},e.dot=Eo,e.ease=p,e.easeCubicInOut=u,e.emitValidationErrors=Fr,e.endsWith=M,e.enforceCacheSizeLimit=function(e){pe(),ce&&ce.then((t=>{t.keys().then((i=>{for(let r=0;r<i.length-e;r++)t.delete(i[r])}))}))},e.evaluateSizeForFeature=wl,e.evaluateSizeForZoom=Ml,e.evaluateVariableOffset=Dc,e.evented=un,e.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},e.exactEquals$1=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},e.extend=y,e.featureFilter=ur,e.filterObject=S,e.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},e.fromQuat=function(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=i+i,s=r+r,l=n+n,c=i*o,h=r*o,u=r*s,d=n*o,p=n*s,f=n*l,m=a*o,g=a*s,y=a*l;return e[0]=1-u-f,e[1]=h+y,e[2]=d-g,e[3]=0,e[4]=h-y,e[5]=1-c-f,e[6]=p+m,e[7]=0,e[8]=d+g,e[9]=p-m,e[10]=1-c-u,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.fromRotation=function(e,t){var i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=-i,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},e.getAnchorAlignment=hc,e.getAnchorJustification=zc,e.getArrayBuffer=we,e.getBounds=function(e){let t=1/0,i=1/0,n=-1/0,a=-1/0;for(const r of e)t=Math.min(t,r.x),i=Math.min(i,r.y),n=Math.max(n,r.x),a=Math.max(a,r.y);return{min:new r(t,i),max:new r(n,a)}},e.getImage=Le,e.getJSON=function(e,t){return be(y(e,{type:"json"}),t)},e.getMapSessionAPI=le,e.getRTLTextPluginStatus=dn,e.getReferrer=xe,e.getVideo=function(e,t){const i=a.document.createElement("video");i.muted=!0,i.onloadstart=function(){t(null,i)};for(let t=0;t<e.length;t++){const r=a.document.createElement("source");Se(e[t])||(i.crossOrigin="Anonymous"),r.src=e[t],i.appendChild(r)}return{cancel:()=>{}}},e.identity=fo,e.identity$1=ko,e.invert=function(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],s=t[5],l=t[6],c=t[7],h=t[8],u=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],y=t[15],v=i*s-r*o,_=i*l-n*o,x=i*c-a*o,b=r*l-n*s,w=r*c-a*s,M=n*c-a*l,T=h*m-u*f,S=h*g-d*f,E=h*y-p*f,A=u*g-d*m,C=u*y-p*m,L=d*y-p*g,P=v*L-_*C+x*A+b*E-w*S+M*T;return P?(e[0]=(s*L-l*C+c*A)*(P=1/P),e[1]=(n*C-r*L-a*A)*P,e[2]=(m*M-g*w+y*b)*P,e[3]=(d*w-u*M-p*b)*P,e[4]=(l*E-o*L-c*S)*P,e[5]=(i*L-n*E+a*S)*P,e[6]=(g*x-f*M-y*_)*P,e[7]=(h*M-d*x+p*_)*P,e[8]=(o*C-s*E+c*T)*P,e[9]=(r*E-i*C-a*T)*P,e[10]=(f*w-m*x+y*v)*P,e[11]=(u*x-h*w-p*v)*P,e[12]=(s*S-o*A-l*T)*P,e[13]=(i*A-r*S+n*T)*P,e[14]=(m*_-f*b-g*v)*P,e[15]=(h*b-u*_+d*v)*P,e):null},e.isChar=Yr,e.isMapboxURL=Y,e.latFromMercatorY=Th,e.len=Io,e.length=_o,e.length$1=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},e.loadVectorTile=Xu,e.makeRequest=be,e.mercatorXfromLng=bh,e.mercatorYfromLat=wh,e.mercatorZfromAltitude=Mh,e.mul=go,e.mul$1=function(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e},e.multiply=mo,e.mvt=Xs,e.nextPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},e.normalize=So,e.normalize$1=function(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=i*i+r*r+n*n+a*a;return o>0&&(o=1/Math.sqrt(o)),e[0]=i*o,e[1]=r*o,e[2]=n*o,e[3]=a*o,e},e.number=Jt,e.offscreenCanvasSupported=ye,e.ortho=function(e,t,i,r,n,a,o){var s=1/(t-i),l=1/(r-n),c=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+i)*s,e[13]=(n+r)*l,e[14]=(o+a)*c,e[15]=1,e},e.parseGlyphPBF=function(e){return new Ll(e).readFields(Zl,[])},e.pbf=Ll,e.perspective=function(e,t,i,r,n){var a,o=1/Math.tan(t/2);return e[0]=o/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0?(e[10]=(n+r)*(a=1/(r-n)),e[14]=2*n*r*a):(e[10]=-1,e[14]=-2*r),e},e.pick=function(e,t){const i={};for(let r=0;r<t.length;r++){const n=t[r];n in e&&(i[n]=e[n])}return i},e.plugin=fn,e.polygonIntersectsBox=ro,e.polygonIntersectsPolygon=Za,e.polygonizeBounds=function(e,t,i=0){const n=new r(i,i),a=e.sub(n),o=t.add(n);return[a,new r(o.x,a.y),o,new r(a.x,o.y),a]},e.posAttributes=kh,e.postMapLoadEvent=oe,e.postTurnstileEvent=ne,e.potpack=Yl,e.prevPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},e.radToDeg=function(e){return e*c},e.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],e.registerForPluginStateChange=function(e){return e({pluginStatus:sn,pluginURL:ln}),un.on("pluginStateChange",e),e},e.renderColorRamp=$o,e.rotate=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=Math.sin(i),l=Math.cos(i);return e[0]=r*l+a*s,e[1]=n*l+o*s,e[2]=r*-s+a*l,e[3]=n*-s+o*l,e},e.rotateX=function(e,t,i){var r=Math.sin(i),n=Math.cos(i),a=t[4],o=t[5],s=t[6],l=t[7],c=t[8],h=t[9],u=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*n+c*r,e[5]=o*n+h*r,e[6]=s*n+u*r,e[7]=l*n+d*r,e[8]=c*n-a*r,e[9]=h*n-o*r,e[10]=u*n-s*r,e[11]=d*n-l*r,e},e.rotateX$1=zo,e.rotateY=function(e,t,i){var r=Math.sin(i),n=Math.cos(i),a=t[0],o=t[1],s=t[2],l=t[3],c=t[8],h=t[9],u=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n-c*r,e[1]=o*n-h*r,e[2]=s*n-u*r,e[3]=l*n-d*r,e[8]=a*r+c*n,e[9]=o*r+h*n,e[10]=s*r+u*n,e[11]=l*r+d*n,e},e.rotateZ=function(e,t,i){var r=Math.sin(i),n=Math.cos(i),a=t[0],o=t[1],s=t[2],l=t[3],c=t[4],h=t[5],u=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n+c*r,e[1]=o*n+h*r,e[2]=s*n+u*r,e[3]=l*n+d*r,e[4]=c*n-a*r,e[5]=h*n-o*r,e[6]=u*n-s*r,e[7]=d*n-l*r,e},e.rotateZ$1=function(e,t,i){i*=.5;var r=t[0],n=t[1],a=t[2],o=t[3],s=Math.sin(i),l=Math.cos(i);return e[0]=r*l+n*s,e[1]=n*l-r*s,e[2]=a*l+o*s,e[3]=o*l-a*s,e},e.scale=function(e,t,i){var r=i[0],n=i[1],a=i[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.scale$1=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e},e.scale$2=Mo,e.scaleAndAdd=To,e.setCacheLimits=function(e,t){ue=e,de=t},e.setRTLTextPlugin=function(e,t,i=!1){if("deferred"===sn||"loading"===sn||"loaded"===sn)throw new Error("setRTLTextPlugin cannot be called multiple times.");ln=U.resolveURL(e),sn="deferred",on=t,hn(),i||pn()},e.styleSpec=ze,e.sub=Po,e.subtract=wo,e.symbolSize=Tl,e.transformMat3=function(e,t,i){var r=t[0],n=t[1],a=t[2];return e[0]=r*i[0]+n*i[3]+a*i[6],e[1]=r*i[1]+n*i[4]+a*i[7],e[2]=r*i[2]+n*i[5]+a*i[8],e},e.transformMat4=Ro,e.transformQuat=Co,e.translate=function(e,t,i){var r,n,a,o,s,l,c,h,u,d,p,f,m=i[0],g=i[1],y=i[2];return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*y+t[12],e[13]=t[1]*m+t[5]*g+t[9]*y+t[13],e[14]=t[2]*m+t[6]*g+t[10]*y+t[14],e[15]=t[3]*m+t[7]*g+t[11]*y+t[15]):(n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],c=t[6],h=t[7],u=t[8],d=t[9],p=t[10],f=t[11],e[0]=r=t[0],e[1]=n,e[2]=a,e[3]=o,e[4]=s,e[5]=l,e[6]=c,e[7]=h,e[8]=u,e[9]=d,e[10]=p,e[11]=f,e[12]=r*m+s*g+u*y+t[12],e[13]=n*m+l*g+d*y+t[13],e[14]=a*m+c*g+p*y+t[14],e[15]=o*m+h*g+f*y+t[15]),e},e.triggerPluginCompletionEvent=cn,e.uniqueId=_,e.validateCustomStyleLayer=function(e){const t=[],i=e.id;return void 0===i&&t.push({message:`layers.${i}: missing required property "id"`}),void 0===e.render&&t.push({message:`layers.${i}: missing required method "render"`}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),t},e.validateLight=zr,e.validateStyle=kr,e.values=g,e.vectorTile=Xs,e.version="2.0.1",e.warnOnce=C,e.webpSupported=G,e.window=a,e.wrap=m})),r(0,(function(e){function t(e){const i=typeof e;if("number"===i||"boolean"===i||"string"===i||null==e)return JSON.stringify(e);if(Array.isArray(e)){let i="[";for(const r of e)i+=`${t(r)},`;return`${i}]`}const r=Object.keys(e).sort();let n="{";for(let i=0;i<r.length;i++)n+=`${JSON.stringify(r[i])}:${t(e[r[i]])},`;return`${n}}`}function i(i){let r="";for(const n of e.refProperties)r+=`/${t(i[n])}`;return r}class r{constructor(e){this.keyCache={},e&&this.replace(e)}replace(e){this._layerConfigs={},this._layers={},this.update(e,[])}update(t,r){for(const i of t){this._layerConfigs[i.id]=i;const t=this._layers[i.id]=e.createStyleLayer(i);t._featureFilter=e.featureFilter(t.filter),this.keyCache[i.id]&&delete this.keyCache[i.id]}for(const e of r)delete this.keyCache[e],delete this._layerConfigs[e],delete this._layers[e];this.familiesBySource={};const n=function(e,t){const r={};for(let n=0;n<e.length;n++){const a=t&&t[e[n].id]||i(e[n]);t&&(t[e[n].id]=a);let o=r[a];o||(o=r[a]=[]),o.push(e[n])}const n=[];for(const e in r)n.push(r[e]);return n}(e.values(this._layerConfigs),this.keyCache);for(const e of n){const t=e.map((e=>this._layers[e.id])),i=t[0];if("none"===i.visibility)continue;const r=i.source||"";let n=this.familiesBySource[r];n||(n=this.familiesBySource[r]={});const a=i.sourceLayer||"_geojsonTileLayer";let o=n[a];o||(o=n[a]=[]),o.push(t)}}}const{ImageBitmap:n}=e.window;class a{loadTile(t,i){const{uid:r,encoding:a,rawImageData:o,padding:s,buildQuadTree:l}=t,c=n&&o instanceof n?this.getImageData(o,s):o;i(null,new e.DEMData(r,c,a,s<1,l))}getImageData(t,i){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(t.width,t.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=t.width,this.offscreenCanvas.height=t.height,this.offscreenCanvasContext.drawImage(t,0,0,t.width,t.height);const r=this.offscreenCanvasContext.getImageData(-i,-i,t.width+2*i,t.height+2*i);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new e.RGBAImage({width:r.width,height:r.height},r.data)}}function o(e,t){if(0!==e.length){s(e[0],t);for(var i=1;i<e.length;i++)s(e[i],!t)}}function s(e,t){for(var i=0,r=0,n=e.length,a=n-1;r<n;a=r++)i+=(e[r][0]-e[a][0])*(e[a][1]+e[r][1]);i>=0!=!!t&&e.reverse()}const l=e.vectorTile.VectorTileFeature.prototype.toGeoJSON;class c{constructor(t){this._feature=t,this.extent=e.EXTENT,this.type=t.type,this.properties=t.tags,"id"in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10))}loadGeometry(){if(1===this._feature.type){const t=[];for(const i of this._feature.geometry)t.push([new e.Point$1(i[0],i[1])]);return t}{const t=[];for(const i of this._feature.geometry){const r=[];for(const t of i)r.push(new e.Point$1(t[0],t[1]));t.push(r)}return t}}toGeoJSON(e,t,i){return l.call(this,e,t,i)}}class h{constructor(t){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=e.EXTENT,this.length=t.length,this._features=t}feature(e){return new c(this._features[e])}}var u=e.vectorTile.VectorTileFeature,d=p;function p(e,t){this.options=t||{},this.features=e,this.length=e.length}function f(e,t){this.id="number"==typeof e.id?e.id:void 0,this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=t||4096}p.prototype.feature=function(e){return new f(this.features[e],this.options.extent)},f.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var i=0;i<t.length;i++){for(var r=t[i],n=[],a=0;a<r.length;a++)n.push(new e.Point$1(r[a][0],r[a][1]));this.geometry.push(n)}return this.geometry},f.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,i=-1/0,r=1/0,n=-1/0,a=0;a<e.length;a++)for(var o=e[a],s=0;s<o.length;s++){var l=o[s];t=Math.min(t,l.x),i=Math.max(i,l.x),r=Math.min(r,l.y),n=Math.max(n,l.y)}return[t,r,i,n]},f.prototype.toGeoJSON=u.prototype.toGeoJSON;var m=y,g=d;function y(t){var i=new e.pbf;return function(e,t){for(var i in e.layers)t.writeMessage(3,v,e.layers[i])}(t,i),i.finish()}function v(e,t){var i;t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||""),t.writeVarintField(5,e.extent||4096);var r={keys:[],values:[],keycache:{},valuecache:{}};for(i=0;i<e.length;i++)r.feature=e.feature(i),t.writeMessage(2,_,r);var n=r.keys;for(i=0;i<n.length;i++)t.writeStringField(3,n[i]);var a=r.values;for(i=0;i<a.length;i++)t.writeMessage(4,T,a[i])}function _(e,t){var i=e.feature;void 0!==i.id&&t.writeVarintField(1,i.id),t.writeMessage(2,x,e),t.writeVarintField(3,i.type),t.writeMessage(4,M,i)}function x(e,t){var i=e.feature,r=e.keys,n=e.values,a=e.keycache,o=e.valuecache;for(var s in i.properties){var l=a[s];void 0===l&&(r.push(s),a[s]=l=r.length-1),t.writeVarint(l);var c=i.properties[s],h=typeof c;"string"!==h&&"boolean"!==h&&"number"!==h&&(c=JSON.stringify(c));var u=h+":"+c,d=o[u];void 0===d&&(n.push(c),o[u]=d=n.length-1),t.writeVarint(d)}}function b(e,t){return(t<<3)+(7&e)}function w(e){return e<<1^e>>31}function M(e,t){for(var i=e.loadGeometry(),r=e.type,n=0,a=0,o=i.length,s=0;s<o;s++){var l=i[s],c=1;1===r&&(c=l.length),t.writeVarint(b(1,c));for(var h=3===r?l.length-1:l.length,u=0;u<h;u++){1===u&&1!==r&&t.writeVarint(b(2,h-1));var d=l[u].x-n,p=l[u].y-a;t.writeVarint(w(d)),t.writeVarint(w(p)),n+=d,a+=p}3===r&&t.writeVarint(b(7,1))}}function T(e,t){var i=typeof e;"string"===i?t.writeStringField(1,e):"boolean"===i?t.writeBooleanField(7,e):"number"===i&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}function S(e,t,i,r){E(e,i,r),E(t,2*i,2*r),E(t,2*i+1,2*r+1)}function E(e,t,i){const r=e[t];e[t]=e[i],e[i]=r}function A(e,t,i,r){const n=e-i,a=t-r;return n*n+a*a}m.fromVectorTileJs=y,m.fromGeojsonVt=function(e,t){t=t||{};var i={};for(var r in e)i[r]=new d(e[r].features,t),i[r].name=r,i[r].version=t.version,i[r].extent=t.extent;return y({layers:i})},m.GeoJSONWrapper=g;const C=e=>e[0],L=e=>e[1];class P{constructor(e,t=C,i=L,r=64,n=Float64Array){this.nodeSize=r,this.points=e;const a=e.length<65536?Uint16Array:Uint32Array,o=this.ids=new a(e.length),s=this.coords=new n(2*e.length);for(let r=0;r<e.length;r++)o[r]=r,s[2*r]=t(e[r]),s[2*r+1]=i(e[r]);!function e(t,i,r,n,a,o){if(a-n<=r)return;const s=n+a>>1;!function e(t,i,r,n,a,o){for(;a>n;){if(a-n>600){const s=a-n+1,l=r-n+1,c=Math.log(s),h=.5*Math.exp(2*c/3),u=.5*Math.sqrt(c*h*(s-h)/s)*(l-s/2<0?-1:1);e(t,i,r,Math.max(n,Math.floor(r-l*h/s+u)),Math.min(a,Math.floor(r+(s-l)*h/s+u)),o)}const s=i[2*r+o];let l=n,c=a;for(S(t,i,n,r),i[2*a+o]>s&&S(t,i,n,a);l<c;){for(S(t,i,l,c),l++,c--;i[2*l+o]<s;)l++;for(;i[2*c+o]>s;)c--}i[2*n+o]===s?S(t,i,n,c):(c++,S(t,i,c,a)),c<=r&&(n=c+1),r<=c&&(a=c-1)}}(t,i,s,n,a,o%2),e(t,i,r,n,s-1,o+1),e(t,i,r,s+1,a,o+1)}(o,s,r,0,o.length-1,0)}range(e,t,i,r){return function(e,t,i,r,n,a,o){const s=[0,e.length-1,0],l=[];let c,h;for(;s.length;){const u=s.pop(),d=s.pop(),p=s.pop();if(d-p<=o){for(let o=p;o<=d;o++)c=t[2*o],h=t[2*o+1],c>=i&&c<=n&&h>=r&&h<=a&&l.push(e[o]);continue}const f=Math.floor((p+d)/2);c=t[2*f],h=t[2*f+1],c>=i&&c<=n&&h>=r&&h<=a&&l.push(e[f]);const m=(u+1)%2;(0===u?i<=c:r<=h)&&(s.push(p),s.push(f-1),s.push(m)),(0===u?n>=c:a>=h)&&(s.push(f+1),s.push(d),s.push(m))}return l}(this.ids,this.coords,e,t,i,r,this.nodeSize)}within(e,t,i){return function(e,t,i,r,n,a){const o=[0,e.length-1,0],s=[],l=n*n;for(;o.length;){const c=o.pop(),h=o.pop(),u=o.pop();if(h-u<=a){for(let n=u;n<=h;n++)A(t[2*n],t[2*n+1],i,r)<=l&&s.push(e[n]);continue}const d=Math.floor((u+h)/2),p=t[2*d],f=t[2*d+1];A(p,f,i,r)<=l&&s.push(e[d]);const m=(c+1)%2;(0===c?i-n<=p:r-n<=f)&&(o.push(u),o.push(d-1),o.push(m)),(0===c?i+n>=p:r+n>=f)&&(o.push(d+1),o.push(h),o.push(m))}return s}(this.ids,this.coords,e,t,i,this.nodeSize)}}const I={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e};class R{constructor(e){this.options=U(Object.create(I),e),this.trees=new Array(this.options.maxZoom+1)}load(e){const{log:t,minZoom:i,maxZoom:r,nodeSize:n}=this.options;t&&console.time("total time");const a=`prepare ${e.length} points`;t&&console.time(a),this.points=e;let o=[];for(let t=0;t<e.length;t++)e[t].geometry&&o.push(k(e[t],t));this.trees[r+1]=new P(o,j,V,n,Float32Array),t&&console.timeEnd(a);for(let e=r;e>=i;e--){const i=+Date.now();o=this._cluster(o,e),this.trees[e]=new P(o,j,V,n,Float32Array),t&&console.log("z%d: %d clusters in %dms",e,o.length,+Date.now()-i)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let i=((e[0]+180)%360+360)%360-180;const r=Math.max(-90,Math.min(90,e[1]));let n=180===e[2]?180:((e[2]+180)%360+360)%360-180;const a=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)i=-180,n=180;else if(i>n){const e=this.getClusters([i,r,180,a],t),o=this.getClusters([-180,r,n,a],t);return e.concat(o)}const o=this.trees[this._limitZoom(t)],s=o.range(B(i),F(a),B(n),F(r)),l=[];for(const e of s){const t=o.points[e];l.push(t.numPoints?z(t):this.points[t.index])}return l}getChildren(e){const t=this._getOriginId(e),i=this._getOriginZoom(e),r="No cluster with the specified id.",n=this.trees[i];if(!n)throw new Error(r);const a=n.points[t];if(!a)throw new Error(r);const o=this.options.radius/(this.options.extent*Math.pow(2,i-1)),s=n.within(a.x,a.y,o),l=[];for(const t of s){const i=n.points[t];i.parentId===e&&l.push(i.numPoints?z(i):this.points[i.index])}if(0===l.length)throw new Error(r);return l}getLeaves(e,t,i){const r=[];return this._appendLeaves(r,e,t=t||10,i=i||0,0),r}getTile(e,t,i){const r=this.trees[this._limitZoom(e)],n=Math.pow(2,e),{extent:a,radius:o}=this.options,s=o/a,l=(i-s)/n,c=(i+1+s)/n,h={features:[]};return this._addTileFeatures(r.range((t-s)/n,l,(t+1+s)/n,c),r.points,t,i,n,h),0===t&&this._addTileFeatures(r.range(1-s/n,l,1,c),r.points,n,i,n,h),t===n-1&&this._addTileFeatures(r.range(0,l,s/n,c),r.points,-1,i,n,h),h.features.length?h:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const i=this.getChildren(e);if(t++,1!==i.length)break;e=i[0].properties.cluster_id}return t}_appendLeaves(e,t,i,r,n){const a=this.getChildren(t);for(const t of a){const a=t.properties;if(a&&a.cluster?n+a.point_count<=r?n+=a.point_count:n=this._appendLeaves(e,a.cluster_id,i,r,n):n<r?n++:e.push(t),e.length===i)break}return n}_addTileFeatures(e,t,i,r,n,a){for(const o of e){const e=t[o],s=e.numPoints,l={type:1,geometry:[[Math.round(this.options.extent*(e.x*n-i)),Math.round(this.options.extent*(e.y*n-r))]],tags:s?O(e):this.points[e.index].properties};let c;s?c=e.id:this.options.generateId?c=e.index:this.points[e.index].id&&(c=this.points[e.index].id),void 0!==c&&(l.id=c),a.features.push(l)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(+e,this.options.maxZoom+1))}_cluster(e,t){const i=[],{radius:r,extent:n,reduce:a,minPoints:o}=this.options,s=r/(n*Math.pow(2,t));for(let r=0;r<e.length;r++){const n=e[r];if(n.zoom<=t)continue;n.zoom=t;const l=this.trees[t+1],c=l.within(n.x,n.y,s),h=n.numPoints||1;let u=h;for(const e of c){const i=l.points[e];i.zoom>t&&(u+=i.numPoints||1)}if(u>=o){let e=n.x*h,o=n.y*h,s=a&&h>1?this._map(n,!0):null;const d=(r<<5)+(t+1)+this.points.length;for(const i of c){const r=l.points[i];if(r.zoom<=t)continue;r.zoom=t;const c=r.numPoints||1;e+=r.x*c,o+=r.y*c,r.parentId=d,a&&(s||(s=this._map(n,!0)),a(s,this._map(r)))}n.parentId=d,i.push(D(e/u,o/u,d,u,s))}else if(i.push(n),u>1)for(const e of c){const r=l.points[e];r.zoom<=t||(r.zoom=t,i.push(r))}}return i}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t){if(e.numPoints)return t?U({},e.properties):e.properties;const i=this.points[e.index].properties,r=this.options.map(i);return t&&r===i?U({},r):r}}function D(e,t,i,r,n){return{x:e,y:t,zoom:1/0,id:i,parentId:-1,numPoints:r,properties:n}}function k(e,t){const[i,r]=e.geometry.coordinates;return{x:B(i),y:F(r),zoom:1/0,index:t,parentId:-1}}function z(e){return{type:"Feature",id:e.id,properties:O(e),geometry:{type:"Point",coordinates:[(t=e.x,360*(t-.5)),N(e.y)]}};var t}function O(e){const t=e.numPoints,i=t>=1e4?`${Math.round(t/1e3)}k`:t>=1e3?Math.round(t/100)/10+"k":t;return U(U({},e.properties),{cluster:!0,cluster_id:e.id,point_count:t,point_count_abbreviated:i})}function B(e){return e/360+.5}function F(e){const t=Math.sin(e*Math.PI/180),i=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return i<0?0:i>1?1:i}function N(e){const t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}function U(e,t){for(const i in t)e[i]=t[i];return e}function j(e){return e.x}function V(e){return e.y}function G(e,t,i,r,n,a){var o=n-i,s=a-r;if(0!==o||0!==s){var l=((e-i)*o+(t-r)*s)/(o*o+s*s);l>1?(i=n,r=a):l>0&&(i+=o*l,r+=s*l)}return(o=e-i)*o+(s=t-r)*s}function H(e,t,i,r){var n={id:void 0===e?null:e,type:t,geometry:i,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,i=e.type;if("Point"===i||"MultiPoint"===i||"LineString"===i)W(e,t);else if("Polygon"===i||"MultiLineString"===i)for(var r=0;r<t.length;r++)W(e,t[r]);else if("MultiPolygon"===i)for(r=0;r<t.length;r++)for(var n=0;n<t[r].length;n++)W(e,t[r][n])}(n),n}function W(e,t){for(var i=0;i<t.length;i+=3)e.minX=Math.min(e.minX,t[i]),e.minY=Math.min(e.minY,t[i+1]),e.maxX=Math.max(e.maxX,t[i]),e.maxY=Math.max(e.maxY,t[i+1])}function q(e,t,i,r){if(t.geometry){var n=t.geometry.coordinates,a=t.geometry.type,o=Math.pow(i.tolerance/((1<<i.maxZoom)*i.extent),2),s=[],l=t.id;if(i.promoteId?l=t.properties[i.promoteId]:i.generateId&&(l=r||0),"Point"===a)Z(n,s);else if("MultiPoint"===a)for(var c=0;c<n.length;c++)Z(n[c],s);else if("LineString"===a)X(n,s,o,!1);else if("MultiLineString"===a){if(i.lineMetrics){for(c=0;c<n.length;c++)X(n[c],s=[],o,!1),e.push(H(l,"LineString",s,t.properties));return}$(n,s,o,!1)}else if("Polygon"===a)$(n,s,o,!0);else{if("MultiPolygon"!==a){if("GeometryCollection"===a){for(c=0;c<t.geometry.geometries.length;c++)q(e,{id:l,geometry:t.geometry.geometries[c],properties:t.properties},i,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(c=0;c<n.length;c++){var h=[];$(n[c],h,o,!0),s.push(h)}}e.push(H(l,a,s,t.properties))}}function Z(e,t){t.push(Y(e[0])),t.push(J(e[1])),t.push(0)}function X(e,t,i,r){for(var n,a,o=0,s=0;s<e.length;s++){var l=Y(e[s][0]),c=J(e[s][1]);t.push(l),t.push(c),t.push(0),s>0&&(o+=r?(n*c-l*a)/2:Math.sqrt(Math.pow(l-n,2)+Math.pow(c-a,2))),n=l,a=c}var h=t.length-3;t[2]=1,function e(t,i,r,n){for(var a,o=n,s=r-i>>1,l=r-i,c=t[i],h=t[i+1],u=t[r],d=t[r+1],p=i+3;p<r;p+=3){var f=G(t[p],t[p+1],c,h,u,d);if(f>o)a=p,o=f;else if(f===o){var m=Math.abs(p-s);m<l&&(a=p,l=m)}}o>n&&(a-i>3&&e(t,i,a,n),t[a+2]=o,r-a>3&&e(t,a,r,n))}(t,0,h,i),t[h+2]=1,t.size=Math.abs(o),t.start=0,t.end=t.size}function $(e,t,i,r){for(var n=0;n<e.length;n++){var a=[];X(e[n],a,i,r),t.push(a)}}function Y(e){return e/360+.5}function J(e){var t=Math.sin(e*Math.PI/180),i=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return i<0?0:i>1?1:i}function K(e,t,i,r,n,a,o,s){if(r/=t,a>=(i/=t)&&o<r)return e;if(o<i||a>=r)return null;for(var l=[],c=0;c<e.length;c++){var h=e[c],u=h.geometry,d=h.type,p=0===n?h.minX:h.minY,f=0===n?h.maxX:h.maxY;if(p>=i&&f<r)l.push(h);else if(!(f<i||p>=r)){var m=[];if("Point"===d||"MultiPoint"===d)Q(u,m,i,r,n);else if("LineString"===d)ee(u,m,i,r,n,!1,s.lineMetrics);else if("MultiLineString"===d)ie(u,m,i,r,n,!1);else if("Polygon"===d)ie(u,m,i,r,n,!0);else if("MultiPolygon"===d)for(var g=0;g<u.length;g++){var y=[];ie(u[g],y,i,r,n,!0),y.length&&m.push(y)}if(m.length){if(s.lineMetrics&&"LineString"===d){for(g=0;g<m.length;g++)l.push(H(h.id,d,m[g],h.tags));continue}"LineString"!==d&&"MultiLineString"!==d||(1===m.length?(d="LineString",m=m[0]):d="MultiLineString"),"Point"!==d&&"MultiPoint"!==d||(d=3===m.length?"Point":"MultiPoint"),l.push(H(h.id,d,m,h.tags))}}}return l.length?l:null}function Q(e,t,i,r,n){for(var a=0;a<e.length;a+=3){var o=e[a+n];o>=i&&o<=r&&(t.push(e[a]),t.push(e[a+1]),t.push(e[a+2]))}}function ee(e,t,i,r,n,a,o){for(var s,l,c=te(e),h=0===n?ne:ae,u=e.start,d=0;d<e.length-3;d+=3){var p=e[d],f=e[d+1],m=e[d+2],g=e[d+3],y=e[d+4],v=0===n?p:f,_=0===n?g:y,x=!1;o&&(s=Math.sqrt(Math.pow(p-g,2)+Math.pow(f-y,2))),v<i?_>i&&(l=h(c,p,f,g,y,i),o&&(c.start=u+s*l)):v>r?_<r&&(l=h(c,p,f,g,y,r),o&&(c.start=u+s*l)):re(c,p,f,m),_<i&&v>=i&&(l=h(c,p,f,g,y,i),x=!0),_>r&&v<=r&&(l=h(c,p,f,g,y,r),x=!0),!a&&x&&(o&&(c.end=u+s*l),t.push(c),c=te(e)),o&&(u+=s)}var b=e.length-3;p=e[b],f=e[b+1],m=e[b+2],(v=0===n?p:f)>=i&&v<=r&&re(c,p,f,m),b=c.length-3,a&&b>=3&&(c[b]!==c[0]||c[b+1]!==c[1])&&re(c,c[0],c[1],c[2]),c.length&&t.push(c)}function te(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function ie(e,t,i,r,n,a){for(var o=0;o<e.length;o++)ee(e[o],t,i,r,n,a,!1)}function re(e,t,i,r){e.push(t),e.push(i),e.push(r)}function ne(e,t,i,r,n,a){var o=(a-t)/(r-t);return e.push(a),e.push(i+(n-i)*o),e.push(1),o}function ae(e,t,i,r,n,a){var o=(a-i)/(n-i);return e.push(t+(r-t)*o),e.push(a),e.push(1),o}function oe(e,t){for(var i=[],r=0;r<e.length;r++){var n,a=e[r],o=a.type;if("Point"===o||"MultiPoint"===o||"LineString"===o)n=se(a.geometry,t);else if("MultiLineString"===o||"Polygon"===o){n=[];for(var s=0;s<a.geometry.length;s++)n.push(se(a.geometry[s],t))}else if("MultiPolygon"===o)for(n=[],s=0;s<a.geometry.length;s++){for(var l=[],c=0;c<a.geometry[s].length;c++)l.push(se(a.geometry[s][c],t));n.push(l)}i.push(H(a.id,o,n,a.tags))}return i}function se(e,t){var i=[];i.size=e.size,void 0!==e.start&&(i.start=e.start,i.end=e.end);for(var r=0;r<e.length;r+=3)i.push(e[r]+t,e[r+1],e[r+2]);return i}function le(e,t){if(e.transformed)return e;var i,r,n,a=1<<e.z,o=e.x,s=e.y;for(i=0;i<e.features.length;i++){var l=e.features[i],c=l.geometry,h=l.type;if(l.geometry=[],1===h)for(r=0;r<c.length;r+=2)l.geometry.push(ce(c[r],c[r+1],t,a,o,s));else for(r=0;r<c.length;r++){var u=[];for(n=0;n<c[r].length;n+=2)u.push(ce(c[r][n],c[r][n+1],t,a,o,s));l.geometry.push(u)}}return e.transformed=!0,e}function ce(e,t,i,r,n,a){return[Math.round(i*(e*r-n)),Math.round(i*(t*r-a))]}function he(e,t,i,r,n){for(var a=t===n.maxZoom?0:n.tolerance/((1<<t)*n.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:i,y:r,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<e.length;s++){o.numFeatures++,ue(o,e[s],a,n);var l=e[s].minX,c=e[s].minY,h=e[s].maxX,u=e[s].maxY;l<o.minX&&(o.minX=l),c<o.minY&&(o.minY=c),h>o.maxX&&(o.maxX=h),u>o.maxY&&(o.maxY=u)}return o}function ue(e,t,i,r){var n=t.geometry,a=t.type,o=[];if("Point"===a||"MultiPoint"===a)for(var s=0;s<n.length;s+=3)o.push(n[s]),o.push(n[s+1]),e.numPoints++,e.numSimplified++;else if("LineString"===a)de(o,n,e,i,!1,!1);else if("MultiLineString"===a||"Polygon"===a)for(s=0;s<n.length;s++)de(o,n[s],e,i,"Polygon"===a,0===s);else if("MultiPolygon"===a)for(var l=0;l<n.length;l++){var c=n[l];for(s=0;s<c.length;s++)de(o,c[s],e,i,!0,0===s)}if(o.length){var h=t.tags||null;if("LineString"===a&&r.lineMetrics){for(var u in h={},t.tags)h[u]=t.tags[u];h.mapbox_clip_start=n.start/n.size,h.mapbox_clip_end=n.end/n.size}var d={geometry:o,type:"Polygon"===a||"MultiPolygon"===a?3:"LineString"===a||"MultiLineString"===a?2:1,tags:h};null!==t.id&&(d.id=t.id),e.features.push(d)}}function de(e,t,i,r,n,a){var o=r*r;if(r>0&&t.size<(n?o:r))i.numPoints+=t.length/3;else{for(var s=[],l=0;l<t.length;l+=3)(0===r||t[l+2]>o)&&(i.numSimplified++,s.push(t[l]),s.push(t[l+1])),i.numPoints++;n&&function(e,t){for(var i=0,r=0,n=e.length,a=n-2;r<n;a=r,r+=2)i+=(e[r]-e[a])*(e[r+1]+e[a+1]);if(i>0===t)for(r=0,n=e.length;r<n/2;r+=2){var o=e[r],s=e[r+1];e[r]=e[n-2-r],e[r+1]=e[n-1-r],e[n-2-r]=o,e[n-1-r]=s}}(s,a),e.push(s)}}function pe(e,t){var i=(t=this.options=function(e,t){for(var i in t)e[i]=t[i];return e}(Object.create(this.options),t)).debug;if(i&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=function(e,t){var i=[];if("FeatureCollection"===e.type)for(var r=0;r<e.features.length;r++)q(i,e.features[r],t,r);else q(i,"Feature"===e.type?e:{geometry:e},t);return i}(e,t);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(r=function(e,t){var i=t.buffer/t.extent,r=e,n=K(e,1,-1-i,i,0,-1,2,t),a=K(e,1,1-i,2+i,0,-1,2,t);return(n||a)&&(r=K(e,1,-i,1+i,0,-1,2,t)||[],n&&(r=oe(n,1).concat(r)),a&&(r=r.concat(oe(a,-1)))),r}(r,t)).length&&this.splitTile(r,0,0,0),i&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function fe(e,t,i){return 32*((1<<e)*i+t)+e}function me(e,t){const i=e.tileID.canonical;if(!this._geoJSONIndex)return t(null,null);const r=this._geoJSONIndex.getTile(i.z,i.x,i.y);if(!r)return t(null,null);const n=new h(r.features);let a=m(n);0===a.byteOffset&&a.byteLength===a.buffer.byteLength||(a=new Uint8Array(a)),t(null,{vectorTile:n,rawData:a.buffer})}pe.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},pe.prototype.splitTile=function(e,t,i,r,n,a,o){for(var s=[e,t,i,r],l=this.options,c=l.debug;s.length;){r=s.pop(),i=s.pop(),t=s.pop(),e=s.pop();var h=1<<t,u=fe(t,i,r),d=this.tiles[u];if(!d&&(c>1&&console.time("creation"),d=this.tiles[u]=he(e,t,i,r,l),this.tileCoords.push({z:t,x:i,y:r}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,i,r,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));var p="z"+t;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(d.source=e,n){if(t===l.maxZoom||t===n)continue;var f=1<<n-t;if(i!==Math.floor(a/f)||r!==Math.floor(o/f))continue}else if(t===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue;if(d.source=null,0!==e.length){c>1&&console.time("clipping");var m,g,y,v,_,x,b=.5*l.buffer/l.extent,w=.5-b,M=.5+b,T=1+b;m=g=y=v=null,_=K(e,h,i-b,i+M,0,d.minX,d.maxX,l),x=K(e,h,i+w,i+T,0,d.minX,d.maxX,l),e=null,_&&(m=K(_,h,r-b,r+M,1,d.minY,d.maxY,l),g=K(_,h,r+w,r+T,1,d.minY,d.maxY,l),_=null),x&&(y=K(x,h,r-b,r+M,1,d.minY,d.maxY,l),v=K(x,h,r+w,r+T,1,d.minY,d.maxY,l),x=null),c>1&&console.timeEnd("clipping"),s.push(m||[],t+1,2*i,2*r),s.push(g||[],t+1,2*i,2*r+1),s.push(y||[],t+1,2*i+1,2*r),s.push(v||[],t+1,2*i+1,2*r+1)}}},pe.prototype.getTile=function(e,t,i){var r=this.options,n=r.extent,a=r.debug;if(e<0||e>24)return null;var o=1<<e,s=fe(e,t=(t%o+o)%o,i);if(this.tiles[s])return le(this.tiles[s],n);a>1&&console.log("drilling down to z%d-%d-%d",e,t,i);for(var l,c=e,h=t,u=i;!l&&c>0;)c--,h=Math.floor(h/2),u=Math.floor(u/2),l=this.tiles[fe(c,h,u)];return l&&l.source?(a>1&&console.log("found parent tile z%d-%d-%d",c,h,u),a>1&&console.time("drilling down"),this.splitTile(l.source,c,h,u,e,t,i),a>1&&console.timeEnd("drilling down"),this.tiles[s]?le(this.tiles[s],n):null):null};class ge extends e.VectorTileWorkerSource{constructor(e,t,i,r){super(e,t,i,me),r&&(this.loadGeoJSON=r)}loadData(e,t){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=t,this._pendingLoadDataParams=e,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())}_loadData(){if(!this._pendingCallback||!this._pendingLoadDataParams)return;const t=this._pendingCallback,i=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;const r=!!(i&&i.request&&i.request.collectResourceTiming)&&new e.RequestPerformance(i.request);this.loadGeoJSON(i,((n,a)=>{if(n||!a)return t(n);if("object"!=typeof a)return t(new Error(`Input data given to '${i.source}' is not a valid GeoJSON object.`));{!function e(t,i){var r,n=t&&t.type;if("FeatureCollection"===n)for(r=0;r<t.features.length;r++)e(t.features[r],i);else if("GeometryCollection"===n)for(r=0;r<t.geometries.length;r++)e(t.geometries[r],i);else if("Feature"===n)e(t.geometry,i);else if("Polygon"===n)o(t.coordinates,i);else if("MultiPolygon"===n)for(r=0;r<t.coordinates.length;r++)o(t.coordinates[r],i);return t}(a,!0);try{if(i.filter){const t=e.createExpression(i.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===t.result)throw new Error(t.value.map((e=>`${e.key}: ${e.message}`)).join(", "));const r=a.features.filter((e=>t.value.evaluate({zoom:0},e)));a={type:"FeatureCollection",features:r}}this._geoJSONIndex=i.cluster?new R(function({superclusterOptions:t,clusterProperties:i}){if(!i||!t)return t;const r={},n={},a={accumulated:null,zoom:0},o={properties:null},s=Object.keys(i);for(const t of s){const[a,o]=i[t],s=e.createExpression(o),l=e.createExpression("string"==typeof a?[a,["accumulated"],["get",t]]:a);r[t]=s.value,n[t]=l.value}return t.map=e=>{o.properties=e;const t={};for(const e of s)t[e]=r[e].evaluate(a,o);return t},t.reduce=(e,t)=>{o.properties=t;for(const t of s)a.accumulated=e[t],e[t]=n[t].evaluate(a,o)},t}(i)).load(a.features):function(e,t){return new pe(e,t)}(a,i.geojsonVtOptions)}catch(n){return t(n)}this.loaded={};const s={};if(r){const e=r.finish();e&&(s.resourceTiming={},s.resourceTiming[i.source]=JSON.parse(JSON.stringify(e)))}t(null,s)}}))}coalesce(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData())}reloadTile(e,t){const i=this.loaded;return i&&i[e.uid]?super.reloadTile(e,t):this.loadTile(e,t)}loadGeoJSON(t,i){if(t.request)e.getJSON(t.request,i);else{if("string"!=typeof t.data)return i(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`));try{return i(null,JSON.parse(t.data))}catch(e){return i(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`))}}}removeSource(e,t){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),t()}getClusterExpansionZoom(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId))}catch(e){t(e)}}getClusterChildren(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId))}catch(e){t(e)}}getClusterLeaves(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset))}catch(e){t(e)}}}class ye{constructor(t){this.self=t,this.actor=new e.Actor(t,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:e.VectorTileWorkerSource,geojson:ge},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(e,t)=>{if(this.workerSourceTypes[e])throw new Error(`Worker source with name "${e}" already registered.`);this.workerSourceTypes[e]=t},this.self.registerRTLTextPlugin=t=>{if(e.plugin.isParsed())throw new Error("RTL text plugin already registered.");e.plugin.applyArabicShaping=t.applyArabicShaping,e.plugin.processBidirectionalText=t.processBidirectionalText,e.plugin.processStyledBidirectionalText=t.processStyledBidirectionalText}}checkIfReady(e,t,i){i()}setReferrer(e,t){this.referrer=t}setImages(e,t,i){this.availableImages[e]=t;for(const i in this.workerSources[e]){const r=this.workerSources[e][i];for(const e in r)r[e].availableImages=t}i()}enableTerrain(e,t,i){this.terrain=t,i()}setLayers(e,t,i){this.getLayerIndex(e).replace(t),i()}updateLayers(e,t,i){this.getLayerIndex(e).update(t.layers,t.removedIds),i()}loadTile(t,i,r){const n=this.enableTerrain?e.extend({enableTerrain:this.terrain},i):i;this.getWorkerSource(t,i.type,i.source).loadTile(n,r)}loadDEMTile(t,i,r){const n=this.enableTerrain?e.extend({buildQuadTree:this.terrain},i):i;this.getDEMWorkerSource(t,i.source).loadTile(n,r)}reloadTile(t,i,r){const n=this.enableTerrain?e.extend({enableTerrain:this.terrain},i):i;this.getWorkerSource(t,i.type,i.source).reloadTile(n,r)}abortTile(e,t,i){this.getWorkerSource(e,t.type,t.source).abortTile(t,i)}removeTile(e,t,i){this.getWorkerSource(e,t.type,t.source).removeTile(t,i)}removeSource(e,t,i){if(!this.workerSources[e]||!this.workerSources[e][t.type]||!this.workerSources[e][t.type][t.source])return;const r=this.workerSources[e][t.type][t.source];delete this.workerSources[e][t.type][t.source],void 0!==r.removeSource?r.removeSource(t,i):i()}loadWorkerSource(e,t,i){try{this.self.importScripts(t.url),i()}catch(e){i(e.toString())}}syncRTLPluginState(t,i,r){try{e.plugin.setState(i);const t=e.plugin.getPluginURL();if(e.plugin.isLoaded()&&!e.plugin.isParsed()&&null!=t){this.self.importScripts(t);const i=e.plugin.isParsed();r(i?void 0:new Error(`RTL Text Plugin failed to import scripts from ${t}`),i)}}catch(e){r(e.toString())}}getAvailableImages(e){let t=this.availableImages[e];return t||(t=[]),t}getLayerIndex(e){let t=this.layerIndexes[e];return t||(t=this.layerIndexes[e]=new r),t}getWorkerSource(e,t,i){return this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][t]||(this.workerSources[e][t]={}),this.workerSources[e][t][i]||(this.workerSources[e][t][i]=new this.workerSourceTypes[t]({send:(t,i,r,n,a,o)=>{this.actor.send(t,i,r,e,n,o)},scheduler:this.actor.scheduler},this.getLayerIndex(e),this.getAvailableImages(e))),this.workerSources[e][t][i]}getDEMWorkerSource(e,t){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][t]||(this.demWorkerSources[e][t]=new a),this.demWorkerSources[e][t]}enforceCacheSizeLimit(t,i){e.enforceCacheSizeLimit(i)}getWorkerPerformanceMetrics(e,t,i){i(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new ye(self)),ye})),r(0,(function(e){var t=i;function i(e){return!function(e){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var e,t,i=new Blob([""],{type:"text/javascript"}),r=URL.createObjectURL(i);try{t=new Worker(r),e=!0}catch(t){e=!1}return t&&t.terminate(),URL.revokeObjectURL(r),e}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var e=document.createElement("canvas");e.width=e.height=1;var t=e.getContext("2d");if(!t)return!1;var i=t.getImageData(0,0,1,1);return i&&i.width===e.width}()?(void 0===r[t=e&&e.failIfMajorPerformanceCaveat]&&(r[t]=function(e){var t,r=function(e){var t=document.createElement("canvas"),r=Object.create(i.webGLContextAttributes);return r.failIfMajorPerformanceCaveat=e,t.getContext("webgl",r)||t.getContext("experimental-webgl",r)}(e);if(!r)return!1;try{t=r.createShader(r.VERTEX_SHADER)}catch(e){return!1}return!(!t||r.isContextLost())&&(r.shaderSource(t,"void main() {}"),r.compileShader(t),!0===r.getShaderParameter(t,r.COMPILE_STATUS))}(t)),r[t]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var t}(e)}var r={};i.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const n={create:function(t,i,r){const n=e.window.document.createElement(t);return void 0!==i&&(n.className=i),r&&r.appendChild(n),n},createNS:function(t,i){return e.window.document.createElementNS(t,i)}},a=e.window.document&&e.window.document.documentElement.style,o=a&&void 0!==a.userSelect?"userSelect":"WebkitUserSelect";let s;n.disableDrag=function(){a&&o&&(s=a[o],a[o]="none")},n.enableDrag=function(){a&&o&&(a[o]=s)},n.setTransform=function(e,t){e.style.transform=t};let l=!1;try{const t=Object.defineProperty({},"passive",{get(){l=!0}});e.window.addEventListener("test",t,t),e.window.removeEventListener("test",t,t)}catch(e){l=!1}n.addEventListener=function(e,t,i,r={}){e.addEventListener(t,i,"passive"in r&&l?r:r.capture)},n.removeEventListener=function(e,t,i,r={}){e.removeEventListener(t,i,"passive"in r&&l?r:r.capture)};const c=function(t){t.preventDefault(),t.stopPropagation(),e.window.removeEventListener("click",c,!0)};function h(e){const{userImage:t}=e;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}n.suppressClick=function(){e.window.addEventListener("click",c,!0),e.window.setTimeout((()=>{e.window.removeEventListener("click",c,!0)}),0)},n.mousePos=function(t,i){const r=t.getBoundingClientRect();return new e.Point(i.clientX-r.left-t.clientLeft,i.clientY-r.top-t.clientTop)},n.touchPos=function(t,i){const r=t.getBoundingClientRect(),n=[];for(let a=0;a<i.length;a++)n.push(new e.Point(i[a].clientX-r.left-t.clientLeft,i[a].clientY-r.top-t.clientTop));return n},n.mouseButton=function(t){return void 0!==e.window.InstallTrigger&&2===t.button&&t.ctrlKey&&e.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:t.button},n.remove=function(e){e.parentNode&&e.parentNode.removeChild(e)};class u extends e.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new e.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:e,callback:t}of this.requestors)this._notify(e,t);this.requestors=[]}}getImage(e){return this.images[e]}addImage(e,t){this._validate(e,t)&&(this.images[e]=t)}_validate(t,i){let r=!0;return this._validateStretch(i.stretchX,i.data&&i.data.width)||(this.fire(new e.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),r=!1),this._validateStretch(i.stretchY,i.data&&i.data.height)||(this.fire(new e.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),r=!1),this._validateContent(i.content,i)||(this.fire(new e.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),r=!1),r}_validateStretch(e,t){if(!e)return!0;let i=0;for(const r of e){if(r[0]<i||r[1]<r[0]||t<r[1])return!1;i=r[1]}return!0}_validateContent(e,t){return!(e&&(4!==e.length||e[0]<0||t.data.width<e[0]||e[1]<0||t.data.height<e[1]||e[2]<0||t.data.width<e[2]||e[3]<0||t.data.height<e[3]||e[2]<e[0]||e[3]<e[1]))}updateImage(e,t){t.version=this.images[e].version+1,this.images[e]=t,this.updatedImages[e]=!0}removeImage(e){const t=this.images[e];delete this.images[e],delete this.patterns[e],t.userImage&&t.userImage.onRemove&&t.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e,t){let i=!0;if(!this.isLoaded())for(const t of e)this.images[t]||(i=!1);this.isLoaded()||i?this._notify(e,t):this.requestors.push({ids:e,callback:t})}_notify(t,i){const r={};for(const i of t){this.images[i]||this.fire(new e.Event("styleimagemissing",{id:i}));const t=this.images[i];t?r[i]={data:t.data.clone(),pixelRatio:t.pixelRatio,sdf:t.sdf,version:t.version,stretchX:t.stretchX,stretchY:t.stretchY,content:t.content,hasRenderCallback:Boolean(t.userImage&&t.userImage.render)}:e.warnOnce(`Image "${i}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}i(null,r)}getPixelSize(){const{width:e,height:t}=this.atlasImage;return{width:e,height:t}}getPattern(t){const i=this.patterns[t],r=this.getImage(t);if(!r)return null;if(i&&i.position.version===r.version)return i.position;if(i)i.position.version=r.version;else{const i={w:r.data.width+2,h:r.data.height+2,x:0,y:0},n=new e.ImagePosition(i,r);this.patterns[t]={bin:i,position:n}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const i=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new e.Texture(t,this.atlasImage,i.RGBA),this.atlasTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const e in this.patterns)t.push(this.patterns[e].bin);const{w:i,h:r}=e.potpack(t),n=this.atlasImage;n.resize({width:i||1,height:r||1});for(const t in this.patterns){const{bin:i}=this.patterns[t],r=i.x+1,a=i.y+1,o=this.images[t].data,s=o.width,l=o.height;e.RGBAImage.copy(o,n,{x:0,y:0},{x:r,y:a},{width:s,height:l}),e.RGBAImage.copy(o,n,{x:0,y:l-1},{x:r,y:a-1},{width:s,height:1}),e.RGBAImage.copy(o,n,{x:0,y:0},{x:r,y:a+l},{width:s,height:1}),e.RGBAImage.copy(o,n,{x:s-1,y:0},{x:r-1,y:a},{width:1,height:l}),e.RGBAImage.copy(o,n,{x:0,y:0},{x:r+s,y:a},{width:1,height:l})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const t of e){if(this.callbackDispatchedThisFrame[t])continue;this.callbackDispatchedThisFrame[t]=!0;const e=this.images[t];h(e)&&this.updateImage(t,e)}}}var d=m,p=m,f=1e20;function m(e,t,i,r,n,a){this.fontSize=e||24,this.buffer=void 0===t?3:t,this.cutoff=r||.25,this.fontFamily=n||"sans-serif",this.fontWeight=a||"normal",this.radius=i||8;var o=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=o,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(o*o),this.gridInner=new Float64Array(o*o),this.f=new Float64Array(o),this.d=new Float64Array(o),this.z=new Float64Array(o+1),this.v=new Int16Array(o),this.middle=Math.round(o/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function g(e,t,i,r,n,a,o){for(var s=0;s<t;s++){for(var l=0;l<i;l++)r[l]=e[l*t+s];for(y(r,n,a,o,i),l=0;l<i;l++)e[l*t+s]=n[l]}for(l=0;l<i;l++){for(s=0;s<t;s++)r[s]=e[l*t+s];for(y(r,n,a,o,t),s=0;s<t;s++)e[l*t+s]=Math.sqrt(n[s])}}function y(e,t,i,r,n){i[0]=0,r[0]=-f,r[1]=+f;for(var a=1,o=0;a<n;a++){for(var s=(e[a]+a*a-(e[i[o]]+i[o]*i[o]))/(2*a-2*i[o]);s<=r[o];)o--,s=(e[a]+a*a-(e[i[o]]+i[o]*i[o]))/(2*a-2*i[o]);i[++o]=a,r[o]=s,r[o+1]=+f}for(a=0,o=0;a<n;a++){for(;r[o+1]<a;)o++;t[a]=(a-i[o])*(a-i[o])+e[i[o]]}}m.prototype.draw=function(e){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(e,this.buffer,this.middle);for(var t=this.ctx.getImageData(0,0,this.size,this.size),i=new Uint8ClampedArray(this.size*this.size),r=0;r<this.size*this.size;r++){var n=t.data[4*r+3]/255;this.gridOuter[r]=1===n?0:0===n?f:Math.pow(Math.max(0,.5-n),2),this.gridInner[r]=1===n?f:0===n?0:Math.pow(Math.max(0,n-.5),2)}for(g(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),g(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),r=0;r<this.size*this.size;r++)i[r]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[r]-this.gridInner[r])/this.radius+this.cutoff))));return i},d.default=p;class v{constructor(e,t){this.requestManager=e,this.localIdeographFontFamily=t,this.entries={}}setURL(e){this.url=e}getGlyphs(t,i){const r=[];for(const e in t)for(const i of t[e])r.push({stack:e,id:i});e.asyncAll(r,(({stack:e,id:t},i)=>{let r=this.entries[e];r||(r=this.entries[e]={glyphs:{},requests:{},ranges:{}});let n=r.glyphs[t];if(void 0!==n)return void i(null,{stack:e,id:t,glyph:n});if(n=this._tinySDF(r,e,t),n)return r.glyphs[t]=n,void i(null,{stack:e,id:t,glyph:n});const a=Math.floor(t/256);if(256*a>65535)return void i(new Error("glyphs > 65535 not supported"));if(r.ranges[a])return void i(null,{stack:e,id:t,glyph:n});let o=r.requests[a];o||(o=r.requests[a]=[],v.loadGlyphRange(e,a,this.url,this.requestManager,((e,t)=>{if(t){for(const e in t)this._doesCharSupportLocalGlyph(+e)||(r.glyphs[+e]=t[+e]);r.ranges[a]=!0}for(const i of o)i(e,t);delete r.requests[a]}))),o.push(((r,n)=>{r?i(r):n&&i(null,{stack:e,id:t,glyph:n[t]||null})}))}),((e,t)=>{if(e)i(e);else if(t){const e={};for(const{stack:i,id:r,glyph:n}of t)(e[i]||(e[i]={}))[r]=n&&{id:n.id,bitmap:n.bitmap.clone(),metrics:n.metrics};i(null,e)}}))}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(e.isChar["CJK Unified Ideographs"](t)||e.isChar["Hangul Syllables"](t)||e.isChar.Hiragana(t)||e.isChar.Katakana(t))}_tinySDF(t,i,r){const n=this.localIdeographFontFamily;if(!n)return;if(!this._doesCharSupportLocalGlyph(r))return;let a=t.tinySDF;if(!a){let e="400";/bold/i.test(i)?e="900":/medium/i.test(i)?e="500":/light/i.test(i)&&(e="200"),a=t.tinySDF=new v.TinySDF(24,3,8,.25,n,e)}return{id:r,bitmap:new e.AlphaImage({width:30,height:30},a.draw(String.fromCharCode(r))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}}v.loadGlyphRange=function(t,i,r,n,a){const o=256*i,s=o+255,l=n.transformRequest(n.normalizeGlyphsURL(r).replace("{fontstack}",t).replace("{range}",`${o}-${s}`),e.ResourceType.Glyphs);e.getArrayBuffer(l,((t,i)=>{if(t)a(t);else if(i){const t={};for(const r of e.parseGlyphPBF(i))t[r.id]=r;a(null,t)}}))},v.TinySDF=d;const _=new e.Properties({anchor:new e.DataConstantProperty(e.styleSpec.light.anchor),position:new class{constructor(){this.specification=e.styleSpec.light.position}possiblyEvaluate(t,i){return function([t,i,r]){const n=e.degToRad(i+90),a=e.degToRad(r);return{x:t*Math.cos(n)*Math.sin(a),y:t*Math.sin(n)*Math.sin(a),z:t*Math.cos(a),azimuthal:i,polar:r}}(t.expression.evaluate(i))}interpolate(t,i,r){return{x:e.number(t.x,i.x,r),y:e.number(t.y,i.y,r),z:e.number(t.z,i.z,r),azimuthal:e.number(t.azimuthal,i.azimuthal,r),polar:e.number(t.polar,i.polar,r)}}},color:new e.DataConstantProperty(e.styleSpec.light.color),intensity:new e.DataConstantProperty(e.styleSpec.light.intensity)});class x extends e.Evented{constructor(t){super(),this._transitionable=new e.Transitionable(_),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,i={}){if(!this._validate(e.validateLight,t,i))for(const i in t){const r=t[i];e.endsWith(i,"-transition")?this._transitionable.setTransition(i.slice(0,-"-transition".length),r):this._transitionable.setValue(i,r)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,i,r){return(!r||!1!==r.validate)&&e.emitValidationErrors(this,t.call(e.validateStyle,e.extend({value:i,style:{glyphs:!0,sprite:!0},styleSpec:e.styleSpec})))}}const b=new e.Properties({source:new e.DataConstantProperty(e.styleSpec.terrain.source),exaggeration:new e.DataConstantProperty(e.styleSpec.terrain.exaggeration)});class w extends e.Evented{constructor(t){super(),this._transitionable=new e.Transitionable(b),this.set(t),this._transitioning=this._transitionable.untransitioned()}get(){return this._transitionable.serialize()}set(t){for(const i in t){const r=t[i];e.endsWith(i,"-transition")?this._transitionable.setTransition(i.slice(0,-"-transition".length),r):this._transitionable.setValue(i,r)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}}class M{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,t){const i=e.join(",")+String(t);return this.dashEntry[i]||(this.dashEntry[i]=this.addDash(e,t)),this.dashEntry[i]}getDashRanges(e,t,i){const r=[];let n=e.length%2==1?-e[e.length-1]*i:0,a=e[0]*i,o=!0;r.push({left:n,right:a,isDash:o,zeroLength:0===e[0]});let s=e[0];for(let t=1;t<e.length;t++){o=!o;const l=e[t];n=s*i,s+=l,a=s*i,r.push({left:n,right:a,isDash:o,zeroLength:0===l})}return r}addRoundDash(e,t,i){const r=t/2;for(let t=-i;t<=i;t++){const n=this.width*(this.nextRow+i+t);let a=0,o=e[a];for(let s=0;s<this.width;s++){s/o.right>1&&(o=e[++a]);const l=Math.abs(s-o.left),c=Math.abs(s-o.right),h=Math.min(l,c);let u;const d=t/i*(r+1);if(o.isDash){const e=r-Math.abs(d);u=Math.sqrt(h*h+e*e)}else u=r-Math.sqrt(h*h+d*d);this.data[n+s]=Math.max(0,Math.min(255,u+128))}}}addRegularDash(e){for(let t=e.length-1;t>=0;--t){const i=e[t],r=e[t+1];i.zeroLength?e.splice(t,1):r&&r.isDash===i.isDash&&(r.left=i.left,e.splice(t,1))}const t=e[0],i=e[e.length-1];t.isDash===i.isDash&&(t.left=i.left-this.width,i.right=t.right+this.width);const r=this.width*this.nextRow;let n=0,a=e[n];for(let t=0;t<this.width;t++){t/a.right>1&&(a=e[++n]);const i=Math.abs(t-a.left),o=Math.abs(t-a.right),s=Math.min(i,o);this.data[r+t]=Math.max(0,Math.min(255,(a.isDash?s:-s)+128))}}addDash(t,i){const r=i?7:0,n=2*r+1;if(this.nextRow+n>this.height)return e.warnOnce("LineAtlas out of space"),null;0===t.length&&t.push(1);let a=0;for(let i=0;i<t.length;i++)t[i]<0&&(e.warnOnce("Negative value is found in line dasharray, replacing values with 0"),t[i]=0),a+=t[i];if(0!==a){const e=this.width/a,n=this.getDashRanges(t,this.width,e);i?this.addRoundDash(n,e,r):this.addRegularDash(n)}const o={y:(this.nextRow+r+.5)/this.height,height:2*r/this.height,width:a};return this.nextRow+=n,this.dirty=!0,o}bind(e){const t=e.gl;this.texture?(t.bindTexture(t.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width,this.height,t.ALPHA,t.UNSIGNED_BYTE,this.data))):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.ALPHA,this.width,this.height,0,t.ALPHA,t.UNSIGNED_BYTE,this.data))}}class T{constructor(t,i){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=e.uniqueId();const r=this.workerPool.acquire(this.id);for(let e=0;e<r.length;e++){const t=new T.Actor(r[e],i,this.id);t.name=`Worker ${e}`,this.actors.push(t)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(t,i,r){e.asyncAll(this.actors,((e,r)=>{e.send(t,i,r)}),r=r||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((e=>{e.remove()})),this.actors=[],this.workerPool.release(this.id)}}function S(t,i,r){return i*(e.EXTENT/(t.tileSize*Math.pow(2,r-t.tileID.overscaledZ)))}T.Actor=e.Actor;class E{constructor(e,t,i,r){this.screenBounds=e,this.cameraPoint=t,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=i,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map((e=>r.pointCoordinate3D(e))),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(t,i){let r,n;if(t instanceof e.Point||"number"==typeof t[0]){const a=e.Point.convert(t);r=[e.Point.convert(t)],n=i.isPointAboveHorizon(a)}else{const a=e.Point.convert(t[0]),o=e.Point.convert(t[1]);r=[a,o],n=e.polygonizeBounds(a,o).every((e=>i.isPointAboveHorizon(e)))}return new E(r,i.getCameraPoint(),n,i)}bufferedScreenGeometry(t){return e.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const i=[this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0].add(new e.Point(1,0)):this.screenBounds[1],this.cameraPoint];return e.bufferConvexPolygon(i,t)}containsTile(t,i,r){const n=t.queryPadding+1,a=r?this._bufferedCameraMercator(n,i).map((e=>t.tileID.getTilePoint(e))):this._bufferedScreenMercator(n,i).map((e=>t.tileID.getTilePoint(e))),o=this.screenGeometryMercator.map((e=>t.tileID.getTileVec3(e))),s=o.map((t=>new e.Point(t[0],t[1]))),l=i.getFreeCameraOptions().position||new e.MercatorCoordinate(0,0,0),c=t.tileID.getTileVec3(l),h=o.map((t=>{const i=e.sub(t,t,c);return e.normalize(i,i),new e.Ray(c,i)})),u=S(t,1,i.zoom);if(e.polygonIntersectsBox(a,0,0,e.EXTENT,e.EXTENT))return{queryGeometry:this,tilespaceGeometry:s,tilespaceRays:h,bufferedTilespaceGeometry:a,bufferedTilespaceBounds:(d=e.getBounds(a),d.min.x=e.clamp(d.min.x,0,e.EXTENT),d.min.y=e.clamp(d.min.y,0,e.EXTENT),d.max.x=e.clamp(d.max.x,0,e.EXTENT),d.max.y=e.clamp(d.max.y,0,e.EXTENT),d),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:u};var d}_bufferedScreenMercator(e,t){const i=A(e);if(this._screenRaycastCache[i])return this._screenRaycastCache[i];{const r=this.bufferedScreenGeometry(e).map((e=>t.pointCoordinate3D(e)));return this._screenRaycastCache[i]=r,r}}_bufferedCameraMercator(e,t){const i=A(e);if(this._cameraRaycastCache[i])return this._cameraRaycastCache[i];{const r=this.bufferedCameraGeometry(e).map((e=>t.pointCoordinate3D(e)));return this._cameraRaycastCache[i]=r,r}}}function A(e){return 100*e|0}function C(t,i,r){const n=function(n,a){if(n)return r(n);if(a){const n=e.pick(e.extend(a,t),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);a.vector_layers&&(n.vectorLayers=a.vector_layers,n.vectorLayerIds=n.vectorLayers.map((e=>e.id))),n.tiles=i.canonicalizeTileset(n,t.url),r(null,n)}};return t.url?e.getJSON(i.transformRequest(i.normalizeSourceURL(t.url),e.ResourceType.Source),n):e.browser.frame((()=>n(null,t)))}class L{constructor(t,i,r){this.bounds=e.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=i||0,this.maxzoom=r||24}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(t){const i=Math.pow(2,t.z),r=Math.floor(e.mercatorXfromLng(this.bounds.getWest())*i),n=Math.floor(e.mercatorYfromLat(this.bounds.getNorth())*i),a=Math.ceil(e.mercatorXfromLng(this.bounds.getEast())*i),o=Math.ceil(e.mercatorYfromLat(this.bounds.getSouth())*i);return t.x>=r&&t.x<a&&t.y>=n&&t.y<o}}class P extends e.Evented{constructor(t,i,r,n){super(),this.id=t,this.dispatcher=r,this.setEventedParent(n),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=e.extend({type:"raster"},i),e.extend(this,e.pick(i,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new e.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=C(this._options,this.map._requestManager,((t,i)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new e.ErrorEvent(t)):i&&(e.extend(this,i),i.bounds&&(this.tileBounds=new L(i.bounds,this.minzoom,this.maxzoom)),e.postTurnstileEvent(i.tiles),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})))}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return e.extend({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(t,i){const r=e.browser.devicePixelRatio>=2,n=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),r,this.tileSize);t.request=e.getImage(this.map._requestManager.transformRequest(n,e.ResourceType.Tile),((r,n)=>{if(delete t.request,t.aborted)t.state="unloaded",i(null);else if(r)t.state="errored",i(r);else if(n){this.map._refreshExpiredTiles&&t.setExpiryData(n),delete n.cacheControl,delete n.expires;const r=this.map.painter.context,a=r.gl;t.texture=this.map.painter.getTileTexture(n.width),t.texture?t.texture.update(n,{useMipmap:!0}):(t.texture=new e.Texture(r,n,a.RGBA,{useMipmap:!0}),t.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST),r.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax)),t.state="loaded",e.cacheEntryPossiblyAdded(this.dispatcher),i(null)}}))}abortTile(e,t){e.request&&(e.request.cancel(),delete e.request),t()}unloadTile(e,t){e.texture&&this.map.painter.saveTileTexture(e.texture),t()}hasTransition(){return!1}}var I=e.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class R extends e.Evented{constructor(e,t,i,r){super(),this.id=e,this.dispatcher=i,this.coordinates=t.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(r),this.options=t}load(t,i){this._loaded=!1,this.fire(new e.Event("dataloading",{dataType:"source"})),this.url=this.options.url,e.getImage(this.map._requestManager.transformRequest(this.url,e.ResourceType.Image),((r,n)=>{this._loaded=!0,r?this.fire(new e.ErrorEvent(r)):n&&(this.image=n,t&&(this.coordinates=t),i&&i(),this._finishLoading())}))}loaded(){return this._loaded}updateImage(e){return this.image&&e.url?(this.options.url=e.url,this.load(e.coordinates,(()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}setCoordinates(t){this.coordinates=t;const i=t.map(e.MercatorCoordinate.fromLngLat);this.tileID=function(t){let i=1/0,r=1/0,n=-1/0,a=-1/0;for(const e of t)i=Math.min(i,e.x),r=Math.min(r,e.y),n=Math.max(n,e.x),a=Math.max(a,e.y);const o=Math.max(n-i,a-r),s=Math.max(0,Math.floor(-Math.log(o)/Math.LN2)),l=Math.pow(2,s);return new e.CanonicalTileID(s,Math.floor((i+n)/2*l),Math.floor((r+a)/2*l))}(i),this.minzoom=this.maxzoom=this.tileID.z;const r=i.map((e=>this.tileID.getTilePoint(e)._round()));return this._boundsArray=new e.StructArrayLayout4i8,this._boundsArray.emplaceBack(r[0].x,r[0].y,0,0),this._boundsArray.emplaceBack(r[1].x,r[1].y,e.EXTENT,0),this._boundsArray.emplaceBack(r[3].x,r[3].y,0,e.EXTENT),this._boundsArray.emplaceBack(r[2].x,r[2].y,e.EXTENT,e.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const t=this.map.painter.context,i=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,I.members)),this.boundsSegments||(this.boundsSegments=e.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new e.Texture(t,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture)}}loadTile(e,t){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},t(null)):(e.state="errored",t(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const D={vector:class extends e.Evented{constructor(t,i,r,n){if(super(),this.id=t,this.dispatcher=r,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,e.extend(this,e.pick(i,["url","scheme","tileSize","promoteId"])),this._options=e.extend({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(n),this._tileWorkers={},this._deduped=new e.DedupedRequest}load(){this._loaded=!1,this.fire(new e.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=C(this._options,this.map._requestManager,((t,i)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new e.ErrorEvent(t)):i&&(e.extend(this,i),i.bounds&&(this.tileBounds=new L(i.bounds,this.minzoom,this.maxzoom)),e.postTurnstileEvent(i.tiles,this.map._requestManager._customAccessToken),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})))}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.cancel(),e();const t=this.map.style._getSourceCaches(this.id);for(const e of t)e.clearTiles();this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return e.extend({},this._options)}loadTile(t,i){const r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),n={request:this.map._requestManager.transformRequest(r,e.ResourceType.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:e.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile};if(n.request.collectResourceTiming=this._collectResourceTiming,t.actor&&"expired"!==t.state)"loading"===t.state?t.reloadCallback=i:t.request=t.actor.send("reloadTile",n,a.bind(this));else if(t.actor=this._tileWorkers[r]=this._tileWorkers[r]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",n,a.bind(this));else{const i=e.loadVectorTile.call({deduped:this._deduped},n,((e,i)=>{e||!i?a.call(this,e):(n.data={cacheControl:i.cacheControl,expires:i.expires,rawData:i.rawData.slice(0)},t.actor&&t.actor.send("loadTile",n,a.bind(this)))}),!0);t.request={cancel:i}}function a(r,n){return delete t.request,t.aborted?i(null):r&&404!==r.status?i(r):(n&&n.resourceTiming&&(t.resourceTiming=n.resourceTiming),this.map._refreshExpiredTiles&&n&&t.setExpiryData(n),t.loadVectorData(n,this.map.painter),e.cacheEntryPossiblyAdded(this.dispatcher),i(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id},void 0)}unloadTile(e){e.unloadVectorData(),e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:P,"raster-dem":class extends P{constructor(t,i,r,n){super(t,i,r,n),this.type="raster-dem",this.maxzoom=22,this._options=e.extend({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(t,i){const r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function n(e,r){e&&(t.state="errored",i(e)),r&&(t.dem=r,t.dem.onDeserialize(),t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0,t.state="loaded",i(null))}t.request=e.getImage(this.map._requestManager.transformRequest(r,e.ResourceType.Tile),function(r,a){if(delete t.request,t.aborted)t.state="unloaded",i(null);else if(r)t.state="errored",i(r);else if(a){this.map._refreshExpiredTiles&&t.setExpiryData(a),delete a.cacheControl,delete a.expires;const i=e.window.ImageBitmap&&a instanceof e.window.ImageBitmap&&e.offscreenCanvasSupported(),r=1-(a.width-e.prevPowerOfTwo(a.width))/2;r<1||t.neighboringTiles||(t.neighboringTiles=this._getNeighboringTiles(t.tileID));const o=i?a:e.browser.getImageData(a,r),s={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:o,encoding:this.encoding,padding:r};t.actor&&"expired"!==t.state||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",s,n.bind(this)))}}.bind(this))}_getNeighboringTiles(t){const i=t.canonical,r=Math.pow(2,i.z),n=(i.x-1+r)%r,a=0===i.x?t.wrap-1:t.wrap,o=(i.x+1+r)%r,s=i.x+1===r?t.wrap+1:t.wrap,l={};return l[new e.OverscaledTileID(t.overscaledZ,a,i.z,n,i.y).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,s,i.z,o,i.y).key]={backfilled:!1},i.y>0&&(l[new e.OverscaledTileID(t.overscaledZ,a,i.z,n,i.y-1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,t.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,s,i.z,o,i.y-1).key]={backfilled:!1}),i.y+1<r&&(l[new e.OverscaledTileID(t.overscaledZ,a,i.z,n,i.y+1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,t.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,s,i.z,o,i.y+1).key]={backfilled:!1}),l}unloadTile(e){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded"}},geojson:class extends e.Evented{constructor(t,i,r,n){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=r.getActor(),this.setEventedParent(n),this._data=i.data,this._options=e.extend({},i),this._collectResourceTiming=i.collectResourceTiming,this._resourceTiming=[],void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const a=e.EXTENT/this.tileSize;this.workerOptions=e.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*a,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*a,extent:e.EXTENT,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?Math.min(i.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:e.EXTENT,radius:(i.clusterRadius||50)*a,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions)}load(){this.fire(new e.Event("dataloading",{dataType:"source"})),this._updateWorkerData((t=>{if(t)return void this.fire(new e.ErrorEvent(t));const i={dataType:"source",sourceDataType:"metadata"};this._collectResourceTiming&&this._resourceTiming&&this._resourceTiming.length>0&&(i.resourceTiming=this._resourceTiming,this._resourceTiming=[]),this.fire(new e.Event("data",i))}))}onAdd(e){this.map=e,this.load()}setData(t){return this._data=t,this.fire(new e.Event("dataloading",{dataType:"source"})),this._updateWorkerData((t=>{if(t)return void this.fire(new e.ErrorEvent(t));const i={dataType:"source",sourceDataType:"content"};this._collectResourceTiming&&this._resourceTiming&&this._resourceTiming.length>0&&(i.resourceTiming=this._resourceTiming,this._resourceTiming=[]),this.fire(new e.Event("data",i))})),this}getClusterExpansionZoom(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id},t),this}getClusterChildren(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id},t),this}getClusterLeaves(e,t,i,r){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:e,limit:t,offset:i},r),this}_updateWorkerData(t){this._loaded=!1;const i=e.extend({},this.workerOptions),r=this._data;"string"==typeof r?(i.request=this.map._requestManager.transformRequest(e.browser.resolveURL(r),e.ResourceType.Source),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(r),this.actor.send(`${this.type}.loadData`,i,((e,r)=>{this._removed||r&&r.abandoned||(this._loaded=!0,r&&r.resourceTiming&&r.resourceTiming[this.id]&&(this._resourceTiming=r.resourceTiming[this.id].slice(0)),this.actor.send(`${this.type}.coalesce`,{source:i.source},null),t(e))}))}loaded(){return this._loaded}loadTile(t,i){const r=t.actor?"reloadTile":"loadTile";t.actor=this.actor,t.request=this.actor.send(r,{type:this.type,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:e.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},((e,n)=>(delete t.request,t.unloadVectorData(),t.aborted?i(null):e?i(e):(t.loadVectorData(n,this.map.painter,"reloadTile"===r),i(null)))))}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e){e.unloadVectorData(),this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return e.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends R{constructor(e,t,i,r){super(e,t,i,r),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const i of t.urls)this.urls.push(this.map._requestManager.transformRequest(i,e.ResourceType.Source).url);e.getVideo(this.urls,((t,i)=>{this._loaded=!0,t?this.fire(new e.ErrorEvent(t)):i&&(this.video=i,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const i=this.video.seekable;t<i.start(0)||t>i.end(0)?this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const t=this.map.painter.context,i=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,I.members)),this.boundsSegments||(this.boundsSegments=e.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new e.Texture(t,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:R,canvas:class extends R{constructor(t,i,r,n){super(t,i,r,n),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some((e=>!Array.isArray(e)||2!==e.length||e.some((e=>"number"!=typeof e))))||this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof e.window.HTMLCanvasElement||this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof e.window.HTMLCanvasElement?this.options.canvas:e.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new e.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const i=this.map.painter.context,r=i.gl;this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,I.members)),this.boundsSegments||(this.boundsSegments=e.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new e.Texture(i,this.canvas,r.RGBA,{premultiply:!0});for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}},k=function(t,i,r,n){const a=new D[i.type](t,i,r,n);if(a.id!==t)throw new Error(`Expected Source id to be ${t} instead of ${a.id}`);return e.bindAll(["load","abort","unload","serialize","prepare"],a),a};function z(t,i){const r=e.identity([]);return e.scale(r,r,[.5*t.width,.5*-t.height,1]),e.translate(r,r,[1,-1,0]),e.multiply(r,r,t.calculatePosMatrix(i.toUnwrapped()))}function O(e,t,i,r,n,a,o,s=!1){const l=e.tilesIn(r,o,s);l.sort(F);const c=[];for(const r of l)c.push({wrappedTileID:r.tile.tileID.wrapped().key,queryResults:r.tile.queryRenderedFeatures(t,i,e._state,r,n,a,z(e.transform,r.tile.tileID),s)});const h=function(e){const t={},i={};for(const r of e){const e=r.queryResults,n=r.wrappedTileID,a=i[n]=i[n]||{};for(const i in e){const r=e[i],n=a[i]=a[i]||{},o=t[i]=t[i]||[];for(const e of r)n[e.featureIndex]||(n[e.featureIndex]=!0,o.push(e))}}return t}(c);for(const t in h)h[t].forEach((t=>{const i=t.feature,r=e.getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=r}));return h}function B(e,t){const i=e.getRenderableIds().map((t=>e.getTileByID(t))),r=[],n={};for(let e=0;e<i.length;e++){const a=i[e],o=a.tileID.canonical.key;n[o]||(n[o]=!0,a.querySourceFeatures(r,t))}return r}function F(e,t){const i=e.tileID,r=t.tileID;return i.overscaledZ-r.overscaledZ||i.canonical.y-r.canonical.y||i.wrap-r.wrap||i.canonical.x-r.canonical.x}function N(){return null!=Mn.workerClass?new Mn.workerClass:new e.window.Worker(Mn.workerUrl)}const U="mapboxgl_preloaded_worker_pool";class j{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<j.workerCount;)this.workers.push(new N);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],0===this.numActive()&&(this.workers.forEach((e=>{e.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[U]}numActive(){return Object.keys(this.active).length}}let V;function G(){return V||(V=new j),V}function H(t,i){const r={};for(const e in t)"ref"!==e&&(r[e]=t[e]);return e.refProperties.forEach((e=>{e in i&&(r[e]=i[e])})),r}function W(e){e=e.slice();const t=Object.create(null);for(let i=0;i<e.length;i++)t[e[i].id]=e[i];for(let i=0;i<e.length;i++)"ref"in e[i]&&(e[i]=H(e[i],t[e[i].ref]));return e}j.workerCount=2;const q={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain"};function Z(e,t,i){i.push({command:q.addSource,args:[e,t[e]]})}function X(e,t,i){t.push({command:q.removeSource,args:[e]}),i[e]=!0}function $(e,t,i,r){X(e,i,r),Z(e,t,i)}function Y(t,i,r){let n;for(n in t[r])if(t[r].hasOwnProperty(n)&&"data"!==n&&!e.deepEqual(t[r][n],i[r][n]))return!1;for(n in i[r])if(i[r].hasOwnProperty(n)&&"data"!==n&&!e.deepEqual(t[r][n],i[r][n]))return!1;return!0}function J(t,i,r,n,a,o){let s;for(s in i=i||{},t=t||{})t.hasOwnProperty(s)&&(e.deepEqual(t[s],i[s])||r.push({command:o,args:[n,s,i[s],a]}));for(s in i)i.hasOwnProperty(s)&&!t.hasOwnProperty(s)&&(e.deepEqual(t[s],i[s])||r.push({command:o,args:[n,s,i[s],a]}))}function K(e){return e.id}function Q(e,t){return e[t.id]=t,e}class ee{constructor(e,t){this.reset(e,t)}reset(e,t){this.points=e||[],this._distances=[0];for(let e=1;e<this.points.length;e++)this._distances[e]=this._distances[e-1]+this.points[e].dist(this.points[e-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(1===this.points.length)return this.points[0];t=e.clamp(t,0,1);let i=1,r=this._distances[i];const n=t*this.paddedLength+this.padding;for(;r<n&&i<this._distances.length;)r=this._distances[++i];const a=i-1,o=this._distances[a],s=r-o,l=s>0?(n-o)/s:0;return this.points[a].mult(1-l).add(this.points[i].mult(l))}}class te{constructor(e,t,i){const r=this.boxCells=[],n=this.circleCells=[];this.xCellCount=Math.ceil(e/i),this.yCellCount=Math.ceil(t/i);for(let e=0;e<this.xCellCount*this.yCellCount;e++)r.push([]),n.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,t,i,r,n){this._forEachCell(t,i,r,n,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n)}insertCircle(e,t,i,r){this._forEachCell(t-r,i-r,t+r,i+r,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(i),this.circles.push(r)}_insertBoxCell(e,t,i,r,n,a){this.boxCells[n].push(a)}_insertCircleCell(e,t,i,r,n,a){this.circleCells[n].push(a)}_query(e,t,i,r,n,a){if(i<0||e>this.width||r<0||t>this.height)return!n&&[];const o=[];if(e<=0&&t<=0&&this.width<=i&&this.height<=r){if(n)return!0;for(let e=0;e<this.boxKeys.length;e++)o.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){const t=this.circles[3*e],i=this.circles[3*e+1],r=this.circles[3*e+2];o.push({key:this.circleKeys[e],x1:t-r,y1:i-r,x2:t+r,y2:i+r})}return a?o.filter(a):o}return this._forEachCell(e,t,i,r,this._queryCell,o,{hitTest:n,seenUids:{box:{},circle:{}}},a),n?o.length>0:o}_queryCircle(e,t,i,r,n){const a=e-i,o=e+i,s=t-i,l=t+i;if(o<0||a>this.width||l<0||s>this.height)return!r&&[];const c=[];return this._forEachCell(a,s,o,l,this._queryCellCircle,c,{hitTest:r,circle:{x:e,y:t,radius:i},seenUids:{box:{},circle:{}}},n),r?c.length>0:c}query(e,t,i,r,n){return this._query(e,t,i,r,!1,n)}hitTest(e,t,i,r,n){return this._query(e,t,i,r,!0,n)}hitTestCircle(e,t,i,r){return this._queryCircle(e,t,i,!0,r)}_queryCell(e,t,i,r,n,a,o,s){const l=o.seenUids,c=this.boxCells[n];if(null!==c){const n=this.bboxes;for(const h of c)if(!l.box[h]){l.box[h]=!0;const c=4*h;if(e<=n[c+2]&&t<=n[c+3]&&i>=n[c+0]&&r>=n[c+1]&&(!s||s(this.boxKeys[h]))){if(o.hitTest)return a.push(!0),!0;a.push({key:this.boxKeys[h],x1:n[c],y1:n[c+1],x2:n[c+2],y2:n[c+3]})}}}const h=this.circleCells[n];if(null!==h){const n=this.circles;for(const c of h)if(!l.circle[c]){l.circle[c]=!0;const h=3*c;if(this._circleAndRectCollide(n[h],n[h+1],n[h+2],e,t,i,r)&&(!s||s(this.circleKeys[c]))){if(o.hitTest)return a.push(!0),!0;{const e=n[h],t=n[h+1],i=n[h+2];a.push({key:this.circleKeys[c],x1:e-i,y1:t-i,x2:e+i,y2:t+i})}}}}}_queryCellCircle(e,t,i,r,n,a,o,s){const l=o.circle,c=o.seenUids,h=this.boxCells[n];if(null!==h){const e=this.bboxes;for(const t of h)if(!c.box[t]){c.box[t]=!0;const i=4*t;if(this._circleAndRectCollide(l.x,l.y,l.radius,e[i+0],e[i+1],e[i+2],e[i+3])&&(!s||s(this.boxKeys[t])))return a.push(!0),!0}}const u=this.circleCells[n];if(null!==u){const e=this.circles;for(const t of u)if(!c.circle[t]){c.circle[t]=!0;const i=3*t;if(this._circlesCollide(e[i],e[i+1],e[i+2],l.x,l.y,l.radius)&&(!s||s(this.circleKeys[t])))return a.push(!0),!0}}}_forEachCell(e,t,i,r,n,a,o,s){const l=this._convertToXCellCoord(e),c=this._convertToYCellCoord(t),h=this._convertToXCellCoord(i),u=this._convertToYCellCoord(r);for(let d=l;d<=h;d++)for(let l=c;l<=u;l++)if(n.call(this,e,t,i,r,this.xCellCount*l+d,a,o,s))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,t,i,r,n,a){const o=r-e,s=n-t,l=i+a;return l*l>o*o+s*s}_circleAndRectCollide(e,t,i,r,n,a,o){const s=(a-r)/2,l=Math.abs(e-(r+s));if(l>s+i)return!1;const c=(o-n)/2,h=Math.abs(t-(n+c));if(h>c+i)return!1;if(l<=s||h<=c)return!0;const u=l-s,d=h-c;return u*u+d*d<=i*i}}function ie(t,i,r,n,a){const o=e.create();return i?(e.scale(o,o,[1/a,1/a,1]),r||e.rotateZ(o,o,n.angle)):e.multiply(o,n.labelPlaneMatrix,t),o}function re(t,i,r,n,a){if(i){const i=e.clone(t);return e.scale(i,i,[a,a,1]),r||e.rotateZ(i,i,-n.angle),i}return n.glCoordMatrix}function ne(t,i,r=0){const n=[t.x,t.y,r,1];r?e.transformMat4(n,n,i):me(n,n,i);const a=n[3];return{point:new e.Point(n[0]/a,n[1]/a),signedDistanceFromCamera:a}}function ae(e,t){return Math.min(.5+e/t*.5,1.5)}function oe(e,t){const i=e[0]/e[3],r=e[1]/e[3];return i>=-t[0]&&i<=t[0]&&r>=-t[1]&&r<=t[1]}function se(t,i,r,n,a,o,s,l,c){const h=n?t.textSizeData:t.iconSizeData,u=e.evaluateSizeForZoom(h,r.transform.zoom),d=[256/r.width*2+1,256/r.height*2+1],p=n?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;p.clear();const f=t.lineVertexArray,m=n?t.text.placedSymbolArray:t.icon.placedSymbolArray,g=r.transform.width/r.transform.height;let y=!1;for(let n=0;n<m.length;n++){const v=m.get(n);if(v.hidden||v.writingMode===e.WritingMode.vertical&&!y){fe(v.numGlyphs,p);continue}y=!1;const _=c?c({x:v.anchorX,y:v.anchorY}):0,x=[v.anchorX,v.anchorY,_,1];if(e.transformMat4(x,x,i),!oe(x,d)){fe(v.numGlyphs,p);continue}const b=ae(r.transform.cameraToCenterDistance,x[3]),w=e.evaluateSizeForFeature(h,u,v),M=s?w/b:w*b,T=new e.Point(v.anchorX,v.anchorY),S=ne(T,a,_);if(S.signedDistanceFromCamera<=0){fe(v.numGlyphs,p);continue}const E=S.point;let A={};const C=s?null:c,L=he(v,M,!1,l,i,a,o,t.glyphOffsetArray,f,p,E,T,A,g,C);y=L.useVertical,C&&L.needsFlipping&&(A={}),(L.notEnoughRoom||y||L.needsFlipping&&he(v,M,!0,l,i,a,o,t.glyphOffsetArray,f,p,E,T,A,g,C).notEnoughRoom)&&fe(v.numGlyphs,p)}n?t.text.dynamicLayoutVertexBuffer.updateData(p):t.icon.dynamicLayoutVertexBuffer.updateData(p)}function le(e,t,i,r,n,a,o,s,l,c,h,u,d){const p=s.glyphStartIndex+s.numGlyphs,f=s.lineStartIndex,m=s.lineStartIndex+s.lineLength,g=t.getoffsetX(s.glyphStartIndex),y=t.getoffsetX(p-1),v=de(e*g,i,r,n,a,o,s.segment,f,m,l,c,h,u,d,!0);if(!v)return null;const _=de(e*y,i,r,n,a,o,s.segment,f,m,l,c,h,u,d,!0);return _?{first:v,last:_}:null}function ce(t,i,r,n){return t===e.WritingMode.horizontal&&Math.abs(r.y-i.y)>Math.abs(r.x-i.x)*n?{useVertical:!0}:(t===e.WritingMode.vertical?i.y<r.y:i.x>r.x)?{needsFlipping:!0}:null}function he(t,i,r,n,a,o,s,l,c,h,u,d,p,f,m){const g=i/24,y=t.lineOffsetX*g,v=t.lineOffsetY*g;let _;if(t.numGlyphs>1){const e=t.glyphStartIndex+t.numGlyphs,i=t.lineStartIndex,a=t.lineStartIndex+t.lineLength,h=le(g,l,y,v,r,u,d,t,c,o,p,m);if(!h)return{notEnoughRoom:!0};const x=ne(h.first.point,s).point,b=ne(h.last.point,s).point;if(n&&!r){const e=ce(t.writingMode,x,b,f);if(e)return e}_=[h.first];for(let n=t.glyphStartIndex+1;n<e-1;n++)_.push(de(g*l.getoffsetX(n),y,v,r,u,d,t.segment,i,a,c,o,p,m));_.push(h.last)}else{if(n&&!r){const i=ne(d,a).point,r=t.lineStartIndex+t.segment+1,n=new e.Point(c.getx(r),c.gety(r)),o=ne(n,a),s=o.signedDistanceFromCamera>0?o.point:ue(d,n,i,1,a),l=ce(t.writingMode,i,s,f);if(l)return l}const i=de(g*l.getoffsetX(t.glyphStartIndex),y,v,r,u,d,t.segment,t.lineStartIndex,t.lineStartIndex+t.lineLength,c,o,p,m);if(!i)return{notEnoughRoom:!0};_=[i]}for(const t of _)e.addDynamicAttributes(h,t.point,t.angle);return{}}function ue(e,t,i,r,n,a){const o=e.add(e.sub(t)._unit()),s=ne(o,n,a?a(o):0).point,l=i.sub(s);return i.add(l._mult(r/l.mag()))}function de(t,i,r,n,a,o,s,l,c,h,u,d,p,f,m){const g=n?t-i:t+i;let y=g>0?1:-1,v=0;n&&(y*=-1,v=Math.PI),y<0&&(v+=Math.PI);let _=y>0?l+s:l+s+1,x=a,b=a,w=0,M=0;const T=Math.abs(g),S=[],E=[];let A=o;const C=()=>{const t=_-y;return 0===w?o:new e.Point(h.getx(t),h.gety(t))},L=()=>ue(C(),A,b,T-w+1,u,p);for(;w+M<=T;){if(_+=y,_<l||_>=c)return null;if(b=x,S.push(x),f&&E.push(A||C()),x=d[_],void 0===x){A=new e.Point(h.getx(_),h.gety(_));const t=ne(A,u,p?p(A):0);x=t.signedDistanceFromCamera>0?d[_]=t.point:L()}else A=null;w+=M,M=b.dist(x)}m&&p&&(A=A||new e.Point(h.getx(_),h.gety(_)),d[_]=x=void 0===d[_]?x:L(),M=b.dist(x));const P=(T-w)/M,I=x.sub(b),R=I.mult(P)._add(b);r&&R._add(I._unit()._perp()._mult(r*y));const D=v+Math.atan2(x.y-b.y,x.x-b.x);return S.push(R),f&&(A=A||new e.Point(h.getx(_),h.gety(_)),E.push(function(t,i,r){const n=1-r;return new e.Point(t.x*n+i.x*r,t.y*n+i.y*r)}(E.length>0?E[E.length-1]:A,A,P))),{point:R,angle:D,path:S,tilePath:E}}const pe=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function fe(e,t){for(let i=0;i<e;i++){const e=t.length;t.resize(e+4),t.float32.set(pe,3*e)}}function me(e,t,i){const r=t[0],n=t[1];return e[0]=i[0]*r+i[4]*n+i[12],e[1]=i[1]*r+i[5]*n+i[13],e[3]=i[3]*r+i[7]*n+i[15],e}class ge{constructor(e,t=new te(e.width+200,e.height+200,25),i=new te(e.width+200,e.height+200,25)){this.transform=e,this.grid=t,this.ignoredGrid=i,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+100,this.screenBottomBoundary=e.height+100,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200}placeCollisionBox(e,t,i,r,n,a,o){const s=this.projectAndGetPerspectiveRatio(a,t.anchorPointX,t.anchorPointY,t.elevation),l=n*s.perspectiveRatio,c=(t.x1*e+i.x-t.padding)*l+s.point.x,h=(t.y1*e+i.y-t.padding)*l+s.point.y,u=(t.x2*e+i.x+t.padding)*l+s.point.x,d=(t.y2*e+i.y+t.padding)*l+s.point.y,p=s.perspectiveRatio<=.55;return!this.isInsideGrid(c,h,u,d)||!r&&this.grid.hitTest(c,h,u,d,o)||p?{box:[],offscreen:!1}:{box:[c,h,u,d],offscreen:this.isOffscreen(c,h,u,d)}}placeCollisionCircles(t,i,r,n,a,o,s,l,c,h,u,d,p,f){const m=[],g=this.transform.elevation,y=g?e=>g.getAtTileOffset(f,e.x,e.y):e=>0,v=new e.Point(i.anchorX,i.anchorY),_=y(v),x=ne(v,o,_),b=ae(this.transform.cameraToCenterDistance,x.signedDistanceFromCamera),w=(h?a/b:a*b)/e.ONE_EM,M=ne(v,s,_).point,T=x.signedDistanceFromCamera>0?le(w,n,i.lineOffsetX*w,i.lineOffsetY*w,!1,M,v,i,r,s,{},g&&!h?y:null,h&&!!g):null;let S=!1,E=!1,A=!0;if(T){const i=.5*d*b+p,r=new e.Point(-100,-100),n=new e.Point(this.screenRightBoundary,this.screenBottomBoundary),a=new ee,o=T.first,s=T.last;let h=[];for(let e=o.path.length-1;e>=1;e--)h.push(o.path[e]);for(let e=1;e<s.path.length;e++)h.push(s.path[e]);const f=2.5*i;if(l){const e=h.map(g?(e,t)=>{const i=y(t<o.path.length-1?o.tilePath[o.path.length-1-t]:s.tilePath[t-o.path.length+2]);return ne(e,l,i)}:e=>ne(e,l));h=e.some((e=>e.signedDistanceFromCamera<=0))?[]:e.map((e=>e.point))}let v=[];if(h.length>0){const t=h[0].clone(),i=h[0].clone();for(let e=1;e<h.length;e++)t.x=Math.min(t.x,h[e].x),t.y=Math.min(t.y,h[e].y),i.x=Math.max(i.x,h[e].x),i.y=Math.max(i.y,h[e].y);v=t.x>=r.x&&i.x<=n.x&&t.y>=r.y&&i.y<=n.y?[h]:i.x<r.x||t.x>n.x||i.y<r.y||t.y>n.y?[]:e.clipLine([h],r.x,r.y,n.x,n.y)}for(const e of v){a.reset(e,.25*i);let r=0;r=a.length<=.5*i?1:Math.ceil(a.paddedLength/f)+1;for(let e=0;e<r;e++){const n=e/Math.max(r-1,1),o=a.lerp(n),s=o.x+100,l=o.y+100;m.push(s,l,i,0);const h=s-i,d=l-i,p=s+i,f=l+i;if(A=A&&this.isOffscreen(h,d,p,f),E=E||this.isInsideGrid(h,d,p,f),!t&&this.grid.hitTestCircle(s,l,i,u)&&(S=!0,!c))return{circles:[],offscreen:!1,collisionDetected:S}}}}return{circles:!c&&S||!E?[]:m,offscreen:A,collisionDetected:S}}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const i=[];let r=1/0,n=1/0,a=-1/0,o=-1/0;for(const s of t){const t=new e.Point(s.x+100,s.y+100);r=Math.min(r,t.x),n=Math.min(n,t.y),a=Math.max(a,t.x),o=Math.max(o,t.y),i.push(t)}const s=this.grid.query(r,n,a,o).concat(this.ignoredGrid.query(r,n,a,o)),l={},c={};for(const t of s){const r=t.key;if(void 0===l[r.bucketInstanceId]&&(l[r.bucketInstanceId]={}),l[r.bucketInstanceId][r.featureIndex])continue;const n=[new e.Point(t.x1,t.y1),new e.Point(t.x2,t.y1),new e.Point(t.x2,t.y2),new e.Point(t.x1,t.y2)];e.polygonIntersectsPolygon(i,n)&&(l[r.bucketInstanceId][r.featureIndex]=!0,void 0===c[r.bucketInstanceId]&&(c[r.bucketInstanceId]=[]),c[r.bucketInstanceId].push(r.featureIndex))}return c}insertCollisionBox(e,t,i,r,n){(t?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:r,collisionGroupID:n},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,t,i,r,n){const a=t?this.ignoredGrid:this.grid,o={bucketInstanceId:i,featureIndex:r,collisionGroupID:n};for(let t=0;t<e.length;t+=4)a.insertCircle(o,e[t],e[t+1],e[t+2])}projectAndGetPerspectiveRatio(t,i,r,n){const a=[i,r,0,1];return n?(a[2]=n,e.transformMat4(a,a,t)):me(a,a,t),{point:new e.Point((a[0]/a[3]+1)/2*this.transform.width+100,(-a[1]/a[3]+1)/2*this.transform.height+100),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/a[3]*.5,1.5)}}isOffscreen(e,t,i,r){return i<100||e>=this.screenRightBoundary||r<100||t>this.screenBottomBoundary}isInsideGrid(e,t,i,r){return i>=0&&e<this.gridRightBoundary&&r>=0&&t<this.gridBottomBoundary}getViewportMatrix(){const t=e.identity([]);return e.translate(t,t,[-100,-100,0]),t}}class ye{constructor(e,t,i,r){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):r&&i?1:0,this.placed=i}isHidden(){return 0===this.opacity&&!this.placed}}class ve{constructor(e,t,i,r,n){this.text=new ye(e?e.text:null,t,i,n),this.icon=new ye(e?e.icon:null,t,r,n)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class _e{constructor(e,t,i){this.text=e,this.icon=t,this.skipFade=i}}class xe{constructor(){this.invProjMatrix=e.create(),this.viewportMatrix=e.create(),this.circles=[]}}class be{constructor(e,t,i,r,n){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=i,this.bucketIndex=r,this.tileID=n}}class we{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:e=>e.collisionGroupID===t}}return this.collisionGroups[e]}}function Me(t,i,r,n,a){const{horizontalAlign:o,verticalAlign:s}=e.getAnchorAlignment(t),l=-(o-.5)*i,c=-(s-.5)*r,h=e.evaluateVariableOffset(t,n);return new e.Point(l+h[0]*a,c+h[1]*a)}function Te(t,i,r,n,a){const o=new e.Point(t,i);return r&&o._rotate(n?a:-a),o}class Se{constructor(e,t,i,r){this.transform=e.clone(),this.collisionIndex=new ge(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=t,this.retainedQueryData={},this.collisionGroups=new we(i),this.collisionCircleArrays={},this.prevPlacement=r,r&&(r.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,i,r,n){const a=r.getBucket(i),o=r.latestFeatureIndex;if(!a||!o||i.id!==a.layerIds[0])return;const s=r.collisionBoxArray,l=a.layers[0].layout,c=Math.pow(2,this.transform.zoom-r.tileID.overscaledZ),h=r.tileSize/e.EXTENT,u=this.transform.calculatePosMatrix(r.tileID.toUnwrapped()),d="map"===l.get("text-pitch-alignment"),p="map"===l.get("text-rotation-alignment"),f=S(r,1,this.transform.zoom),m=ie(u,d,p,this.transform,f);let g=null;if(d){const t=re(u,d,p,this.transform,f);g=e.multiply([],this.transform.labelPlaneMatrix,t)}this.retainedQueryData[a.bucketInstanceId]=new be(a.bucketInstanceId,o,a.sourceLayerIndex,a.index,r.tileID);const y={bucket:a,layout:l,posMatrix:u,textLabelPlaneMatrix:m,labelToScreenMatrix:g,scale:c,textPixelRatio:h,holdingForFade:r.holdingForFade(),collisionBoxArray:s,partiallyEvaluatedTextSize:e.evaluateSizeForZoom(a.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:e.evaluateSizeForZoom(a.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(a.sourceID)};if(n)for(const e of a.sortKeyRanges){const{sortKey:i,symbolInstanceStart:r,symbolInstanceEnd:n}=e;t.push({sortKey:i,symbolInstanceStart:r,symbolInstanceEnd:n,parameters:y})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:a.symbolInstances.length,parameters:y})}attemptAnchorPlacement(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g,y){const v=[u.textOffset0,u.textOffset1],_=p.getSymbolInstanceTextSize(g,u,this.transform.zoom,d),x=Me(e,i,r,v,n),b=this.collisionIndex.placeCollisionBox(_,t,Te(x.x,x.y,a,o,this.transform.angle),h,s,l,c.predicate);if((!m||0!==this.collisionIndex.placeCollisionBox(p.getSymbolInstanceIconSize(y,this.transform.zoom,d),m,Te(x.x,x.y,a,o,this.transform.angle),h,s,l,c.predicate).box.length)&&b.box.length>0){let t;return this.prevPlacement&&this.prevPlacement.variableOffsets[u.crossTileID]&&this.prevPlacement.placements[u.crossTileID]&&this.prevPlacement.placements[u.crossTileID].text&&(t=this.prevPlacement.variableOffsets[u.crossTileID].anchor),this.variableOffsets[u.crossTileID]={textOffset:v,width:i,height:r,anchor:e,textBoxScale:n,prevAnchor:t},this.markUsedJustification(p,e,u,f),p.allowVerticalPlacement&&(this.markUsedOrientation(p,f,u),this.placedOrientations[u.crossTileID]=f),{shift:x,placedGlyphBoxes:b}}}placeLayerBucketPart(t,i,r){const{bucket:n,layout:a,posMatrix:o,textLabelPlaneMatrix:s,labelToScreenMatrix:l,textPixelRatio:c,holdingForFade:h,collisionBoxArray:u,partiallyEvaluatedTextSize:d,partiallyEvaluatedIconSize:p,collisionGroup:f}=t.parameters,m=a.get("text-optional"),g=a.get("icon-optional"),y=a.get("text-allow-overlap"),v=a.get("icon-allow-overlap"),_="map"===a.get("text-rotation-alignment"),x="map"===a.get("text-pitch-alignment"),b="none"!==a.get("icon-text-fit"),w="viewport-y"===a.get("symbol-z-order"),M=y&&(v||!n.hasIconData()||g),T=v&&(y||!n.hasTextData()||m);!n.collisionArrays&&u&&n.deserializeCollisionBoxes(u),r&&n.updateCollisionDebugBuffers(this.transform.zoom,u);const S=(t,u,w)=>{if(i[t.crossTileID])return;if(h)return void(this.placements[t.crossTileID]=new _e(!1,!1,!1));let S=!1,E=!1,A=!0,C=null,L={box:null,offscreen:null},P={box:null,offscreen:null},I=null,R=null,D=null,k=0,z=0,O=0;w.textFeatureIndex?k=w.textFeatureIndex:t.useRuntimeCollisionCircles&&(k=t.featureIndex),w.verticalTextFeatureIndex&&(z=w.verticalTextFeatureIndex);const B=e=>{(this.transform.elevation||e.elevation)&&(e.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[n.bucketInstanceId].tileID,e.anchorPointX,e.anchorPointY):0)},F=w.textBox;if(F){B(F);const i=i=>{let r=e.WritingMode.horizontal;if(n.allowVerticalPlacement&&!i&&this.prevPlacement){const e=this.prevPlacement.placedOrientations[t.crossTileID];e&&(this.placedOrientations[t.crossTileID]=e,r=e,this.markUsedOrientation(n,r,t))}return r},r=(i,r)=>{if(n.allowVerticalPlacement&&t.numVerticalGlyphVertices>0&&w.verticalTextBox){for(const t of n.writingModes)if(t===e.WritingMode.vertical?(L=r(),P=L):L=i(),L&&L.box&&L.box.length)break}else L=i()};if(a.get("text-variable-anchor")){let s=a.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[t.crossTileID]){const e=this.prevPlacement.variableOffsets[t.crossTileID];s.indexOf(e.anchor)>0&&(s=s.filter((t=>t!==e.anchor)),s.unshift(e.anchor))}const l=(e,i,r)=>{const a=t.textBoxScale,l=(e.x2-e.x1)*a+2*e.padding,h=(e.y2-e.y1)*a+2*e.padding,m=b&&!v?i:null;m&&B(m);let g={box:[],offscreen:!1};const w=y?2*s.length:s.length;for(let i=0;i<w;++i){const y=this.attemptAnchorPlacement(s[i%s.length],e,l,h,a,_,x,c,o,f,i>=s.length,t,u,n,r,m,d,p);if(y&&(g=y.placedGlyphBoxes,g&&g.box&&g.box.length)){S=!0,C=y.shift;break}}return g};r((()=>l(F,w.iconBox,e.WritingMode.horizontal)),(()=>{const i=w.verticalTextBox;return i&&B(i),n.allowVerticalPlacement&&!(L&&L.box&&L.box.length)&&t.numVerticalGlyphVertices>0&&i?l(i,w.verticalIconBox,e.WritingMode.vertical):{box:null,offscreen:null}})),L&&(S=L.box,A=L.offscreen);const h=i(L&&L.box);if(!S&&this.prevPlacement){const e=this.prevPlacement.variableOffsets[t.crossTileID];e&&(this.variableOffsets[t.crossTileID]=e,this.markUsedJustification(n,e.anchor,t,h))}}else{const a=(i,r)=>{const a=n.getSymbolInstanceTextSize(d,t,this.transform.zoom,u),s=this.collisionIndex.placeCollisionBox(a,i,new e.Point(0,0),y,c,o,f.predicate);return s&&s.box&&s.box.length&&(this.markUsedOrientation(n,r,t),this.placedOrientations[t.crossTileID]=r),s};r((()=>a(F,e.WritingMode.horizontal)),(()=>{const i=w.verticalTextBox;return n.allowVerticalPlacement&&t.numVerticalGlyphVertices>0&&i?(B(i),a(i,e.WritingMode.vertical)):{box:null,offscreen:null}})),i(L&&L.box&&L.box.length)}}if(I=L,S=I&&I.box&&I.box.length>0,A=I&&I.offscreen,t.useRuntimeCollisionCircles){const i=n.text.placedSymbolArray.get(t.centerJustifiedTextSymbolIndex),c=e.evaluateSizeForFeature(n.textSizeData,d,i),h=a.get("text-padding");R=this.collisionIndex.placeCollisionCircles(y,i,n.lineVertexArray,n.glyphOffsetArray,c,o,s,l,r,x,f.predicate,t.collisionCircleDiameter,h,this.retainedQueryData[n.bucketInstanceId].tileID),S=y||R.circles.length>0&&!R.collisionDetected,A=A&&R.offscreen}if(w.iconFeatureIndex&&(O=w.iconFeatureIndex),w.iconBox){const t=t=>{B(t);const i=b&&C?Te(C.x,C.y,_,x,this.transform.angle):new e.Point(0,0),r=n.getSymbolInstanceIconSize(p,this.transform.zoom,u);return this.collisionIndex.placeCollisionBox(r,t,i,v,c,o,f.predicate)};P&&P.box&&P.box.length&&w.verticalIconBox?(D=t(w.verticalIconBox),E=D.box.length>0):(D=t(w.iconBox),E=D.box.length>0),A=A&&D.offscreen}const N=m||0===t.numHorizontalGlyphVertices&&0===t.numVerticalGlyphVertices,U=g||0===t.numIconVertices;if(N||U?U?N||(E=E&&S):S=E&&S:E=S=E&&S,S&&I&&I.box&&this.collisionIndex.insertCollisionBox(I.box,a.get("text-ignore-placement"),n.bucketInstanceId,P&&P.box&&z?z:k,f.ID),E&&D&&this.collisionIndex.insertCollisionBox(D.box,a.get("icon-ignore-placement"),n.bucketInstanceId,O,f.ID),R&&(S&&this.collisionIndex.insertCollisionCircles(R.circles,a.get("text-ignore-placement"),n.bucketInstanceId,k,f.ID),r)){const e=n.bucketInstanceId;let t=this.collisionCircleArrays[e];void 0===t&&(t=this.collisionCircleArrays[e]=new xe);for(let e=0;e<R.circles.length;e+=4)t.circles.push(R.circles[e+0]),t.circles.push(R.circles[e+1]),t.circles.push(R.circles[e+2]),t.circles.push(R.collisionDetected?1:0)}this.placements[t.crossTileID]=new _e(S||M,E||T,A||n.justReloaded),i[t.crossTileID]=!0};if(w){const e=n.getSortedSymbolIndexes(this.transform.angle);for(let t=e.length-1;t>=0;--t){const i=e[t];S(n.symbolInstances.get(i),i,n.collisionArrays[i])}}else for(let e=t.symbolInstanceStart;e<t.symbolInstanceEnd;e++)S(n.symbolInstances.get(e),e,n.collisionArrays[e]);if(r&&n.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[n.bucketInstanceId];e.invert(t.invProjMatrix,o),t.viewportMatrix=this.collisionIndex.getViewportMatrix()}n.justReloaded=!1}markUsedJustification(t,i,r,n){let a;a=n===e.WritingMode.vertical?r.verticalPlacedTextSymbolIndex:{left:r.leftJustifiedTextSymbolIndex,center:r.centerJustifiedTextSymbolIndex,right:r.rightJustifiedTextSymbolIndex}[e.getAnchorJustification(i)];const o=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex,r.verticalPlacedTextSymbolIndex];for(const e of o)e>=0&&(t.text.placedSymbolArray.get(e).crossTileID=a>=0&&e!==a?0:r.crossTileID)}markUsedOrientation(t,i,r){const n=i===e.WritingMode.horizontal||i===e.WritingMode.horizontalOnly?i:0,a=i===e.WritingMode.vertical?i:0,o=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex];for(const e of o)t.text.placedSymbolArray.get(e).placedOrientation=n;r.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(r.verticalPlacedTextSymbolIndex).placedOrientation=a)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const t=this.prevPlacement;let i=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;const r=t?t.symbolFadeChange(e):1,n=t?t.opacities:{},a=t?t.variableOffsets:{},o=t?t.placedOrientations:{};for(const e in this.placements){const t=this.placements[e],a=n[e];a?(this.opacities[e]=new ve(a,r,t.text,t.icon),i=i||t.text!==a.text.placed||t.icon!==a.icon.placed):(this.opacities[e]=new ve(null,r,t.text,t.icon,t.skipFade),i=i||t.text||t.icon)}for(const e in n){const t=n[e];if(!this.opacities[e]){const n=new ve(t,r,!1,!1);n.isHidden()||(this.opacities[e]=n,i=i||t.text.placed||t.icon.placed)}}for(const e in a)this.variableOffsets[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.variableOffsets[e]=a[e]);for(const e in o)this.placedOrientations[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.placedOrientations[e]=o[e]);i?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)}updateLayerOpacities(e,t){const i={};for(const r of t){const t=r.getBucket(e);t&&r.latestFeatureIndex&&e.id===t.layerIds[0]&&this.updateBucketOpacities(t,i,r.collisionBoxArray)}}updateBucketOpacities(t,i,r){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const n=t.layers[0].layout,a=new ve(null,0,!1,!1,!0),o=n.get("text-allow-overlap"),s=n.get("icon-allow-overlap"),l=n.get("text-variable-anchor"),c="map"===n.get("text-rotation-alignment"),h="map"===n.get("text-pitch-alignment"),u="none"!==n.get("icon-text-fit"),d=new ve(null,0,o&&(s||!t.hasIconData()||n.get("icon-optional")),s&&(o||!t.hasTextData()||n.get("text-optional")),!0);!t.collisionArrays&&r&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(r);const p=(e,t,i)=>{for(let r=0;r<t/4;r++)e.opacityVertexArray.emplaceBack(i)};for(let r=0;r<t.symbolInstances.length;r++){const n=t.symbolInstances.get(r),{numHorizontalGlyphVertices:o,numVerticalGlyphVertices:s,crossTileID:f}=n;let m=this.opacities[f];i[f]?m=a:m||(m=d,this.opacities[f]=m),i[f]=!0;const g=n.numIconVertices>0,y=this.placedOrientations[n.crossTileID],v=y===e.WritingMode.vertical,_=y===e.WritingMode.horizontal||y===e.WritingMode.horizontalOnly;if(o>0||s>0){const e=ke(m.text);p(t.text,o,v?ze:e),p(t.text,s,_?ze:e);const i=m.text.isHidden();[n.rightJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.leftJustifiedTextSymbolIndex].forEach((e=>{e>=0&&(t.text.placedSymbolArray.get(e).hidden=i||v?1:0)})),n.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(n.verticalPlacedTextSymbolIndex).hidden=i||_?1:0);const r=this.variableOffsets[n.crossTileID];r&&this.markUsedJustification(t,r.anchor,n,y);const a=this.placedOrientations[n.crossTileID];a&&(this.markUsedJustification(t,"left",n,a),this.markUsedOrientation(t,a,n))}if(g){const e=ke(m.icon),i=!(u&&n.verticalPlacedIconSymbolIndex&&v);n.placedIconSymbolIndex>=0&&(p(t.icon,n.numIconVertices,i?e:ze),t.icon.placedSymbolArray.get(n.placedIconSymbolIndex).hidden=m.icon.isHidden()),n.verticalPlacedIconSymbolIndex>=0&&(p(t.icon,n.numVerticalIconVertices,i?ze:e),t.icon.placedSymbolArray.get(n.verticalPlacedIconSymbolIndex).hidden=m.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const i=t.collisionArrays[r];if(i){let r=new e.Point(0,0);if(i.textBox||i.verticalTextBox){let e=!0;if(l){const t=this.variableOffsets[f];t?(r=Me(t.anchor,t.width,t.height,t.textOffset,t.textBoxScale),c&&r._rotate(h?this.transform.angle:-this.transform.angle)):e=!1}i.textBox&&Ee(t.textCollisionBox.collisionVertexArray,m.text.placed,!e||v,r.x,r.y),i.verticalTextBox&&Ee(t.textCollisionBox.collisionVertexArray,m.text.placed,!e||_,r.x,r.y)}const n=Boolean(!_&&i.verticalIconBox);i.iconBox&&Ee(t.iconCollisionBox.collisionVertexArray,m.icon.placed,n,u?r.x:0,u?r.y:0),i.verticalIconBox&&Ee(t.iconCollisionBox.collisionVertexArray,m.icon.placed,!n,u?r.x:0,u?r.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=e.invProjMatrix,t.placementViewportMatrix=e.viewportMatrix,t.collisionCircleArray=e.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,t){const i=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*i>e}setStale(){this.stale=!0}}function Ee(e,t,i,r,n){e.emplaceBack(t?1:0,i?1:0,r||0,n||0),e.emplaceBack(t?1:0,i?1:0,r||0,n||0),e.emplaceBack(t?1:0,i?1:0,r||0,n||0),e.emplaceBack(t?1:0,i?1:0,r||0,n||0)}const Ae=Math.pow(2,25),Ce=Math.pow(2,24),Le=Math.pow(2,17),Pe=Math.pow(2,16),Ie=Math.pow(2,9),Re=Math.pow(2,8),De=Math.pow(2,1);function ke(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;const t=e.placed?1:0,i=Math.floor(127*e.opacity);return i*Ae+t*Ce+i*Le+t*Pe+i*Ie+t*Re+i*De+t}const ze=0;class Oe{constructor(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&void 0!==e.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,t,i,r,n){const a=this._bucketParts;for(;this._currentTileIndex<e.length;)if(t.getBucketParts(a,r,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,n())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,a.sort(((e,t)=>e.sortKey-t.sortKey)));this._currentPartIndex<a.length;)if(t.placeLayerBucketPart(a[this._currentPartIndex],this._seenCrossTileIDs,i),this._currentPartIndex++,n())return!0;return!1}}class Be{constructor(e,t,i,r,n,a,o){this.placement=new Se(e,n,a,o),this._currentPlacementIndex=t.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=r,this._done=!1}isDone(){return this._done}continuePlacement(t,i,r){const n=e.browser.now(),a=()=>{const t=e.browser.now()-n;return!this._forceFullPlacement&&t>2};for(;this._currentPlacementIndex>=0;){const e=i[t[this._currentPlacementIndex]],n=this.placement.collisionIndex.transform.zoom;if("symbol"===e.type&&(!e.minzoom||e.minzoom<=n)&&(!e.maxzoom||e.maxzoom>n)){if(this._inProgressLayer||(this._inProgressLayer=new Oe(e)),this._inProgressLayer.continuePlacement(r[e.source],this.placement,this._showCollisionBoxes,e,a))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Fe=512/e.EXTENT/2;class Ne{constructor(e,t,i){this.tileID=e,this.indexedSymbolInstances={},this.bucketInstanceId=i;for(let i=0;i<t.length;i++){const r=t.get(i),n=r.key;this.indexedSymbolInstances[n]||(this.indexedSymbolInstances[n]=[]),this.indexedSymbolInstances[n].push({crossTileID:r.crossTileID,coord:this.getScaledCoordinates(r,e)})}}getScaledCoordinates(t,i){const r=Fe/Math.pow(2,i.canonical.z-this.tileID.canonical.z);return{x:Math.floor((i.canonical.x*e.EXTENT+t.anchorX)*r),y:Math.floor((i.canonical.y*e.EXTENT+t.anchorY)*r)}}findMatches(e,t,i){const r=this.tileID.canonical.z<t.canonical.z?1:Math.pow(2,this.tileID.canonical.z-t.canonical.z);for(let n=0;n<e.length;n++){const a=e.get(n);if(a.crossTileID)continue;const o=this.indexedSymbolInstances[a.key];if(!o)continue;const s=this.getScaledCoordinates(a,t);for(const e of o)if(Math.abs(e.coord.x-s.x)<=r&&Math.abs(e.coord.y-s.y)<=r&&!i[e.crossTileID]){i[e.crossTileID]=!0,a.crossTileID=e.crossTileID;break}}}}class Ue{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class je{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const t=Math.round((e-this.lng)/360);if(0!==t)for(const e in this.indexes){const i=this.indexes[e],r={};for(const e in i){const n=i[e];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+t),r[n.tileID.key]=n}this.indexes[e]=r}this.lng=e}addBucket(e,t,i){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let e=0;e<t.symbolInstances.length;e++)t.symbolInstances.get(e).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const r=this.usedCrossTileIDs[e.overscaledZ];for(const i in this.indexes){const n=this.indexes[i];if(Number(i)>e.overscaledZ)for(const i in n){const a=n[i];a.tileID.isChildOf(e)&&a.findMatches(t.symbolInstances,e,r)}else{const a=n[e.scaledTo(Number(i)).key];a&&a.findMatches(t.symbolInstances,e,r)}}for(let e=0;e<t.symbolInstances.length;e++){const n=t.symbolInstances.get(e);n.crossTileID||(n.crossTileID=i.generate(),r[n.crossTileID]=!0)}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Ne(e,t.symbolInstances,t.bucketInstanceId),!0}removeBucketCrossTileIDs(e,t){for(const i in t.indexedSymbolInstances)for(const r of t.indexedSymbolInstances[i])delete this.usedCrossTileIDs[e][r.crossTileID]}removeStaleBuckets(e){let t=!1;for(const i in this.indexes){const r=this.indexes[i];for(const n in r)e[r[n].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,r[n]),delete r[n],t=!0)}return t}}class Ve{constructor(){this.layerIndexes={},this.crossTileIDs=new Ue,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,t,i){let r=this.layerIndexes[e.id];void 0===r&&(r=this.layerIndexes[e.id]=new je);let n=!1;const a={};r.handleWrapJump(i);for(const i of t){const t=i.getBucket(e);t&&e.id===t.layerIds[0]&&(t.bucketInstanceId||(t.bucketInstanceId=++this.maxBucketInstanceId),r.addBucket(i.tileID,t,this.crossTileIDs)&&(n=!0),a[t.bucketInstanceId]=!0)}return r.removeStaleBuckets(a)&&(n=!0),n}pruneUnusedLayers(e){const t={};e.forEach((e=>{t[e]=!0}));for(const e in this.layerIndexes)t[e]||delete this.layerIndexes[e]}}const Ge=(t,i)=>e.emitValidationErrors(t,i&&i.filter((e=>"source.canvas"!==e.identifier))),He=e.pick(q,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain"]),We=e.pick(q,["setCenter","setZoom","setBearing","setPitch"]),qe=function(){const t={},i=e.styleSpec.$version;for(const r in e.styleSpec.$root){const n=e.styleSpec.$root[r];if(n.required){let e=null;e="version"===r?i:"array"===n.type?[]:{},null!=e&&(t[r]=e)}}return t}();class Ze extends e.Evented{constructor(t,i={}){super(),this.map=t,this.dispatcher=new T(G(),this),this.imageManager=new u,this.imageManager.setEventedParent(this),this.glyphManager=new v(t._requestManager,i.localIdeographFontFamily),this.lineAtlas=new M(256,512),this.crossTileSymbolIndex=new Ve,this._layers={},this._num3DLayers=0,this._serializedLayers={},this._order=[],this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new e.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",e.getReferrer());const r=this;this._rtlTextPluginCallback=Ze.registerForPluginStateChange((t=>{r.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:t.pluginStatus,pluginURL:t.pluginURL},((t,i)=>{if(e.triggerPluginCompletionEvent(t),i&&i.every((e=>e)))for(const e in r._sourceCaches){const t=r._sourceCaches[e],i=t.getSource().type;"vector"!==i&&"geojson"!==i||t.reload()}}))})),this.on("data",(e=>{if("source"!==e.dataType||"metadata"!==e.sourceDataType)return;const t=this.getSource(e.sourceId);if(t&&t.vectorLayerIds)for(const e in this._layers){const i=this._layers[e];i.source===t.id&&this._validateLayer(i)}}))}loadURL(t,i={}){this.fire(new e.Event("dataloading",{dataType:"style"}));const r="boolean"==typeof i.validate?i.validate:!e.isMapboxURL(t);t=this.map._requestManager.normalizeStyleURL(t,i.accessToken);const n=this.map._requestManager.transformRequest(t,e.ResourceType.Style);this._request=e.getJSON(n,((t,i)=>{this._request=null,t?this.fire(new e.ErrorEvent(t)):i&&this._load(i,r)}))}loadJSON(t,i={}){this.fire(new e.Event("dataloading",{dataType:"style"})),this._request=e.browser.frame((()=>{this._request=null,this._load(t,!1!==i.validate)}))}loadEmpty(){this.fire(new e.Event("dataloading",{dataType:"style"})),this._load(qe,!1)}_load(t,i){if(i&&Ge(this,e.validateStyle(t)))return;this._loaded=!0,this.stylesheet=t;for(const e in t.sources)this.addSource(e,t.sources[e],{validate:!1});this._changed=!1,t.sprite?this._loadSprite(t.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(t.glyphs);const r=W(this.stylesheet.layers);this._order=r.map((e=>e.id)),this._layers={},this._serializedLayers={};for(let t of r)t=e.createStyleLayer(t),t.setEventedParent(this,{layer:{id:t.id}}),this._layers[t.id]=t,this._serializedLayers[t.id]=t.serialize(),t.is3D()&&this._num3DLayers++;this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new x(this.stylesheet.light),this.stylesheet.terrain&&this._createTerrain(this.stylesheet.terrain),this.fire(new e.Event("data",{dataType:"style"})),this.fire(new e.Event("style.load"))}_loadSprite(t){this._spriteRequest=function(t,i,r){let n,a,o;const s=e.browser.devicePixelRatio>1?"@2x":"";let l=e.getJSON(i.transformRequest(i.normalizeSpriteURL(t,s,".json"),e.ResourceType.SpriteJSON),((e,t)=>{l=null,o||(o=e,n=t,h())})),c=e.getImage(i.transformRequest(i.normalizeSpriteURL(t,s,".png"),e.ResourceType.SpriteImage),((e,t)=>{c=null,o||(o=e,a=t,h())}));function h(){if(o)r(o);else if(n&&a){const t=e.browser.getImageData(a),i={};for(const r in n){const{width:a,height:o,x:s,y:l,sdf:c,pixelRatio:h,stretchX:u,stretchY:d,content:p}=n[r],f=new e.RGBAImage({width:a,height:o});e.RGBAImage.copy(t,f,{x:s,y:l},{x:0,y:0},{width:a,height:o}),i[r]={data:f,pixelRatio:h,sdf:c,stretchX:u,stretchY:d,content:p}}r(null,i)}}return{cancel(){l&&(l.cancel(),l=null),c&&(c.cancel(),c=null)}}}(t,this.map._requestManager,((t,i)=>{if(this._spriteRequest=null,t)this.fire(new e.ErrorEvent(t));else if(i)for(const e in i)this.imageManager.addImage(e,i[e]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new e.Event("data",{dataType:"style"}))}))}_validateLayer(t){const i=this.getSource(t.source);if(!i)return;const r=t.sourceLayer;r&&("geojson"===i.type||i.vectorLayerIds&&-1===i.vectorLayerIds.indexOf(r))&&this.fire(new e.ErrorEvent(new Error(`Source layer "${r}" does not exist on source "${i.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(const e in this._sourceCaches)if(!this._sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(e){const t=[];for(const i of e){const e=this._layers[i];"custom"!==e.type&&t.push(e.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const e in this._sourceCaches)if(this._sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(t){if(!this._loaded)return;const i=this._changed;if(this._changed){const e=Object.keys(this._updatedLayers),i=Object.keys(this._removedLayers);(e.length||i.length)&&this._updateWorkerLayers(e,i);for(const e in this._updatedSources){const t=this._updatedSources[e];"reload"===t?this._reloadSource(e):"clear"===t&&this._clearSource(e)}this._updateTilesForChangedImages();for(const e in this._updatedPaintProps)this._layers[e].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const r={};for(const e in this._sourceCaches){const t=this._sourceCaches[e];r[e]=t.used,t.used=!1}for(const e of this._order){const i=this._layers[e];if(i.recalculate(t,this._availableImages),!i.isHidden(t.zoom)){const e=this._getLayerSourceCache(i);e&&(e.used=!0)}const r=this.map.painter;if(r){const e=i.getProgramIds();if(!e)continue;const n=i.getProgramConfiguration(t.zoom);for(const t of e)r.useProgram(t,n)}}for(const t in r){const i=this._sourceCaches[t];r[t]!==i.used&&i.getSource().fire(new e.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:i.getSource().id}))}this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.z=t.zoom,i&&this.fire(new e.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const t in this._sourceCaches)this._sourceCaches[t].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateWorkerLayers(e,t){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(e),removedIds:t})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(t){if(this._checkLoaded(),Ge(this,e.validateStyle(t)))return!1;(t=e.clone$1(t)).layers=W(t.layers);const i=function(t,i){if(!t)return[{command:q.setStyle,args:[i]}];let r=[];try{if(!e.deepEqual(t.version,i.version))return[{command:q.setStyle,args:[i]}];e.deepEqual(t.center,i.center)||r.push({command:q.setCenter,args:[i.center]}),e.deepEqual(t.zoom,i.zoom)||r.push({command:q.setZoom,args:[i.zoom]}),e.deepEqual(t.bearing,i.bearing)||r.push({command:q.setBearing,args:[i.bearing]}),e.deepEqual(t.pitch,i.pitch)||r.push({command:q.setPitch,args:[i.pitch]}),e.deepEqual(t.sprite,i.sprite)||r.push({command:q.setSprite,args:[i.sprite]}),e.deepEqual(t.glyphs,i.glyphs)||r.push({command:q.setGlyphs,args:[i.glyphs]}),e.deepEqual(t.transition,i.transition)||r.push({command:q.setTransition,args:[i.transition]}),e.deepEqual(t.light,i.light)||r.push({command:q.setLight,args:[i.light]});const n={},a=[];!function(t,i,r,n){let a;for(a in i=i||{},t=t||{})t.hasOwnProperty(a)&&(i.hasOwnProperty(a)||X(a,r,n));for(a in i)i.hasOwnProperty(a)&&(t.hasOwnProperty(a)?e.deepEqual(t[a],i[a])||("geojson"===t[a].type&&"geojson"===i[a].type&&Y(t,i,a)?r.push({command:q.setGeoJSONSourceData,args:[a,i[a].data]}):$(a,i,r,n)):Z(a,i,r))}(t.sources,i.sources,a,n);const o=[];t.layers&&t.layers.forEach((e=>{n[e.source]?r.push({command:q.removeLayer,args:[e.id]}):o.push(e)}));let s=t.terrain;s&&n[s.source]&&(r.push({command:q.setTerrain,args:[void 0]}),s=void 0),r=r.concat(a),e.deepEqual(s,i.terrain)||r.push({command:q.setTerrain,args:[i.terrain]}),function(t,i,r){i=i||[];const n=(t=t||[]).map(K),a=i.map(K),o=t.reduce(Q,{}),s=i.reduce(Q,{}),l=n.slice(),c=Object.create(null);let h,u,d,p,f,m,g;for(h=0,u=0;h<n.length;h++)d=n[h],s.hasOwnProperty(d)?u++:(r.push({command:q.removeLayer,args:[d]}),l.splice(l.indexOf(d,u),1));for(h=0,u=0;h<a.length;h++)d=a[a.length-1-h],l[l.length-1-h]!==d&&(o.hasOwnProperty(d)?(r.push({command:q.removeLayer,args:[d]}),l.splice(l.lastIndexOf(d,l.length-u),1)):u++,m=l[l.length-h],r.push({command:q.addLayer,args:[s[d],m]}),l.splice(l.length-h,0,d),c[d]=!0);for(h=0;h<a.length;h++)if(d=a[h],p=o[d],f=s[d],!c[d]&&!e.deepEqual(p,f))if(e.deepEqual(p.source,f.source)&&e.deepEqual(p["source-layer"],f["source-layer"])&&e.deepEqual(p.type,f.type)){for(g in J(p.layout,f.layout,r,d,null,q.setLayoutProperty),J(p.paint,f.paint,r,d,null,q.setPaintProperty),e.deepEqual(p.filter,f.filter)||r.push({command:q.setFilter,args:[d,f.filter]}),e.deepEqual(p.minzoom,f.minzoom)&&e.deepEqual(p.maxzoom,f.maxzoom)||r.push({command:q.setLayerZoomRange,args:[d,f.minzoom,f.maxzoom]}),p)p.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&(0===g.indexOf("paint.")?J(p[g],f[g],r,d,g.slice(6),q.setPaintProperty):e.deepEqual(p[g],f[g])||r.push({command:q.setLayerProperty,args:[d,g,f[g]]}));for(g in f)f.hasOwnProperty(g)&&!p.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&(0===g.indexOf("paint.")?J(p[g],f[g],r,d,g.slice(6),q.setPaintProperty):e.deepEqual(p[g],f[g])||r.push({command:q.setLayerProperty,args:[d,g,f[g]]}))}else r.push({command:q.removeLayer,args:[d]}),m=l[l.lastIndexOf(d)+1],r.push({command:q.addLayer,args:[f,m]})}(o,i.layers,r)}catch(e){console.warn("Unable to compute style diff:",e),r=[{command:q.setStyle,args:[i]}]}return r}(this.serialize(),t).filter((e=>!(e.command in We)));if(0===i.length)return!1;const r=i.filter((e=>!(e.command in He)));if(r.length>0)throw new Error(`Unimplemented: ${r.map((e=>e.command)).join(", ")}.`);return i.forEach((e=>{"setTransition"!==e.command&&this[e.command].apply(this,e.args)})),this.stylesheet=t,!0}addImage(t,i){if(this.getImage(t))return this.fire(new e.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(t,i),this._afterImageUpdated(t)}updateImage(e,t){this.imageManager.updateImage(e,t)}getImage(e){return this.imageManager.getImage(e)}removeImage(t){if(!this.getImage(t))return this.fire(new e.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new e.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,i,r={}){if(this._checkLoaded(),void 0!==this.getSource(t))throw new Error("There is already a source with this ID");if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(e.validateStyle.source,`sources.${t}`,i,null,r))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const n=k(t,i,this.dispatcher,this);n.setEventedParent(this,(()=>({isSourceLoaded:this.loaded(),source:n.serialize(),sourceId:t})));const a=i=>{const r=(i?"symbol:":"other:")+t,a=this._sourceCaches[r]=new e.SourceCache(r,n,i);(i?this._symbolSourceCaches:this._otherSourceCaches)[t]=a,a.style=this,a.onAdd(this.map)};a(!1),"vector"!==i.type&&"geojson"!==i.type||a(!0),n.onAdd&&n.onAdd(this.map),this._changed=!0}removeSource(t){this._checkLoaded();const i=this.getSource(t);if(void 0===i)throw new Error("There is no source with this ID");for(const i in this._layers)if(this._layers[i].source===t)return this.fire(new e.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${i}" is using it.`)));if(this.terrain&&this.terrain.get().source===t)return this.fire(new e.ErrorEvent(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const r=this._getSourceCaches(t);for(const t of r)delete this._sourceCaches[t.id],delete this._updatedSources[t.id],t.fire(new e.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:t.getSource().id})),t.setEventedParent(null),t.clearTiles();delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],i.setEventedParent(null),i.onRemove&&i.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,t){this._checkLoaded(),this.getSource(e).setData(t),this._changed=!0}getSource(e){const t=this._getSourceCache(e);return t&&t.getSource()}addLayer(t,i,r={}){this._checkLoaded();const n=t.id;if(this.getLayer(n))return void this.fire(new e.ErrorEvent(new Error(`Layer with id "${n}" already exists on this map`)));let a;if("custom"===t.type){if(Ge(this,e.validateCustomStyleLayer(t)))return;a=e.createStyleLayer(t)}else{if("object"==typeof t.source&&(this.addSource(n,t.source),t=e.clone$1(t),t=e.extend(t,{source:n})),this._validate(e.validateStyle.layer,`layers.${n}`,t,{arrayIndex:-1},r))return;a=e.createStyleLayer(t),this._validateLayer(a),a.setEventedParent(this,{layer:{id:n}}),this._serializedLayers[a.id]=a.serialize(),a.is3D()&&this._num3DLayers++}const o=i?this._order.indexOf(i):this._order.length;if(i&&-1===o)return void this.fire(new e.ErrorEvent(new Error(`Layer with id "${i}" does not exist on this map.`)));this._order.splice(o,0,n),this._layerOrderChanged=!0,this._layers[n]=a;const s=this._getLayerSourceCache(a);if(this._removedLayers[n]&&a.source&&s&&"custom"!==a.type){const e=this._removedLayers[n];delete this._removedLayers[n],e.type!==a.type?this._updatedSources[a.source]="clear":(this._updatedSources[a.source]="reload",s.pause())}this._updateLayer(a),a.onAdd&&a.onAdd(this.map)}moveLayer(t,i){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===i)return;const r=this._order.indexOf(t);this._order.splice(r,1);const n=i?this._order.indexOf(i):this._order.length;i&&-1===n?this.fire(new e.ErrorEvent(new Error(`Layer with id "${i}" does not exist on this map.`))):(this._order.splice(n,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const i=this._layers[t];if(!i)return void this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be removed.`)));i.setEventedParent(null),i.is3D()&&this._num3DLayers--;const r=this._order.indexOf(t);this._order.splice(r,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=i,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],i.onRemove&&i.onRemove(this.map)}getLayer(e){return this._layers[e]}hasLayer(e){return e in this._layers}setLayerZoomRange(t,i,r){this._checkLoaded();const n=this.getLayer(t);n?n.minzoom===i&&n.maxzoom===r||(null!=i&&(n.minzoom=i),null!=r&&(n.maxzoom=r),this._updateLayer(n)):this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(t,i,r={}){this._checkLoaded();const n=this.getLayer(t);if(n){if(!e.deepEqual(n.filter,i))return null==i?(n.filter=void 0,void this._updateLayer(n)):void(this._validate(e.validateStyle.filter,`layers.${n.id}.filter`,i,null,r)||(n.filter=e.clone$1(i),this._updateLayer(n)))}else this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be filtered.`)))}getFilter(t){return e.clone$1(this.getLayer(t).filter)}setLayoutProperty(t,i,r,n={}){this._checkLoaded();const a=this.getLayer(t);a?e.deepEqual(a.getLayoutProperty(i),r)||(a.setLayoutProperty(i,r,n),this._updateLayer(a)):this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(t,i){const r=this.getLayer(t);if(r)return r.getLayoutProperty(i);this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style.`)))}setPaintProperty(t,i,r,n={}){this._checkLoaded();const a=this.getLayer(t);a?e.deepEqual(a.getPaintProperty(i),r)||(a.setPaintProperty(i,r,n)&&this._updateLayer(a),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(e,t){return this.getLayer(e).getPaintProperty(t)}setFeatureState(t,i){this._checkLoaded();const r=t.source,n=t.sourceLayer,a=this.getSource(r);if(void 0===a)return void this.fire(new e.ErrorEvent(new Error(`The source '${r}' does not exist in the map's style.`)));const o=a.type;if("geojson"===o&&n)return void this.fire(new e.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===o&&!n)return void this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===t.id&&this.fire(new e.ErrorEvent(new Error("The feature id parameter must be provided.")));const s=this._getSourceCaches(r);for(const e of s)e.setFeatureState(n,t.id,i)}removeFeatureState(t,i){this._checkLoaded();const r=t.source,n=this.getSource(r);if(void 0===n)return void this.fire(new e.ErrorEvent(new Error(`The source '${r}' does not exist in the map's style.`)));const a=n.type,o="vector"===a?t.sourceLayer:void 0;if("vector"===a&&!o)return void this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(i&&"string"!=typeof t.id&&"number"!=typeof t.id)return void this.fire(new e.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const s=this._getSourceCaches(r);for(const e of s)e.removeFeatureState(o,t.id,i)}getFeatureState(t){this._checkLoaded();const i=t.source,r=t.sourceLayer,n=this.getSource(i);if(void 0!==n){if("vector"!==n.type||r)return void 0===t.id&&this.fire(new e.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(i)[0].getFeatureState(r,t.id);this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new e.ErrorEvent(new Error(`The source '${i}' does not exist in the map's style.`)))}getTransition(){return e.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const t={};for(const e in this._sourceCaches){const i=this._sourceCaches[e].getSource();t[i.id]||(t[i.id]=i.serialize())}return e.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:t,layers:this._serializeLayers(this._order)},(e=>void 0!==e))}_updateLayer(e){this._updatedLayers[e.id]=!0;const t=this._getLayerSourceCache(e);e.source&&!this._updatedSources[e.source]&&t&&"raster"!==t.getSource().type&&(this._updatedSources[e.source]="reload",t.pause()),this._changed=!0}_flattenAndSortRenderedFeatures(e){const t=e=>"fill-extrusion"===this._layers[e].type,i={},r=[];for(let n=this._order.length-1;n>=0;n--){const a=this._order[n];if(t(a)){i[a]=n;for(const t of e){const e=t[a];if(e)for(const t of e)r.push(t)}}}r.sort(((e,t)=>t.intersectionZ-e.intersectionZ));const n=[];for(let a=this._order.length-1;a>=0;a--){const o=this._order[a];if(t(o))for(let e=r.length-1;e>=0;e--){const t=r[e].feature;if(i[t.layer.id]<a)break;n.push(t),r.pop()}else for(const t of e){const e=t[o];if(e)for(const t of e)n.push(t.feature)}}return n}queryRenderedFeatures(t,i,r){i&&i.filter&&this._validate(e.validateStyle.filter,"queryRenderedFeatures.filter",i.filter,null,i);const n={};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new e.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const t of i.layers){const i=this._layers[t];if(!i)return this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be queried for features.`))),[];n[i.source]=!0}}const a=[];i.availableImages=this._availableImages;const o=i&&i.layers?i.layers.some((e=>{const t=this.getLayer(e);return t&&t.is3D()})):this.has3DLayers(),s=E.createFromScreenPoints(t,r);for(const e in this._sourceCaches){const t=this._sourceCaches[e].getSource().id;i.layers&&!n[t]||a.push(O(this._sourceCaches[e],this._layers,this._serializedLayers,s,i,r,o,!!this.map._showQueryGeometry))}return this.placement&&a.push(function(e,t,i,r,n,a,o){const s={},l=a.queryRenderedSymbols(r),c=[];for(const e of Object.keys(l).map(Number))c.push(o[e]);c.sort(F);for(const i of c){const r=i.featureIndex.lookupSymbolFeatures(l[i.bucketInstanceId],t,i.bucketIndex,i.sourceLayerIndex,n.filter,n.layers,n.availableImages,e);for(const e in r){const t=s[e]=s[e]||[],n=r[e];n.sort(((e,t)=>{const r=i.featureSortOrder;if(r){const i=r.indexOf(e.featureIndex);return r.indexOf(t.featureIndex)-i}return t.featureIndex-e.featureIndex}));for(const e of n)t.push(e)}}for(const t in s)s[t].forEach((r=>{const n=r.feature,a=i(e[t]).getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=a}));return s}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),s.screenGeometry,i,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(a)}querySourceFeatures(t,i){i&&i.filter&&this._validate(e.validateStyle.filter,"querySourceFeatures.filter",i.filter,null,i);const r=this._getSourceCaches(t);let n=[];for(const e of r)n=n.concat(B(e,i));return n}addSourceType(e,t,i){return Ze.getSourceType(e)?i(new Error(`A source type called "${e}" already exists.`)):(Ze.setSourceType(e,t),t.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:t.workerSourceURL},i):i(null,null))}getLight(){return this.light.getLight()}setLight(t,i={}){this._checkLoaded();const r=this.light.getLight();let n=!1;for(const i in t)if(!e.deepEqual(t[i],r[i])){n=!0;break}if(!n)return;const a={now:e.browser.now(),transition:e.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,i),this.light.updateTransitions(a)}setTerrain(t){if(this._checkLoaded(),!t)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),void this._force3DLayerUpdate();if("object"==typeof t.source){const i="terrain-dem-src";this.addSource(i,t.source),t=e.clone$1(t),t=e.extend(t,{source:i})}if(!this._validate(e.validateStyle.terrain,"terrain",t))if(this.terrain){const i=this.terrain,r=i.get();for(const n in t)if(!e.deepEqual(t[n],r[n])){i.set(t),this.stylesheet.terrain=t;const r={now:e.browser.now(),transition:e.extend({duration:0},this.stylesheet.transition)};i.updateTransitions(r);break}}else this._createTerrain(t)}_createTerrain(t){const i=this.terrain=new w(t);this.stylesheet.terrain=t,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const r={now:e.browser.now(),transition:e.extend({duration:0},this.stylesheet.transition)};i.updateTransitions(r)}_force3DLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"fill-extrusion"===t.type&&this._updateLayer(t)}}_validate(t,i,r,n,a={}){return(!a||!1!==a.validate)&&Ge(this,t.call(e.validateStyle,e.extend({key:i,style:this.serialize(),value:r,styleSpec:e.styleSpec},n)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),e.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const e in this._layers)this._layers[e].setEventedParent(null);for(const e in this._sourceCaches)this._sourceCaches[e].clearTiles(),this._sourceCaches[e].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(e){const t=this._getSourceCaches(e);for(const e of t)e.clearTiles()}_reloadSource(e){const t=this._getSourceCaches(e);for(const e of t)e.resume(),e.reload()}_updateSources(e){for(const t in this._sourceCaches)this._sourceCaches[t].update(e)}_generateCollisionBoxes(){for(const e in this._sourceCaches){const t=this._sourceCaches[e];t.resume(),t.reload()}}_updatePlacement(t,i,r,n,a=!1){let o=!1,s=!1;const l={};for(const e of this._order){const i=this._layers[e];if("symbol"!==i.type)continue;if(!l[i.source]){const e=this._getLayerSourceCache(i);if(!e)continue;l[i.source]=e.getRenderableIds(!0).map((t=>e.getTileByID(t))).sort(((e,t)=>t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1)))}const r=this.crossTileSymbolIndex.addLayer(i,l[i.source],t.center.lng);o=o||r}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((a=a||this._layerOrderChanged||0===r)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(e.browser.now(),t.zoom))&&(this.pauseablePlacement=new Be(t,this._order,a,i,r,n,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(e.browser.now()),s=!0),o&&this.pauseablePlacement.placement.setStale()),s||o)for(const e of this._order){const t=this._layers[e];"symbol"===t.type&&this.placement.updateLayerOpacities(t,l[t.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(e.browser.now())}_releaseSymbolFadeTiles(){for(const e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,t,i){this.imageManager.getImages(t.icons,i),this._updateTilesForChangedImages();const r=e=>{e&&e.setDependencies(t.tileID.key,t.type,t.icons)};r(this._otherSourceCaches[t.source]),r(this._symbolSourceCaches[t.source])}getGlyphs(e,t,i){this.glyphManager.getGlyphs(t.stacks,i)}getResource(t,i,r){return e.makeRequest(i,r)}_getSourceCache(e){return this._otherSourceCaches[e]}_getLayerSourceCache(e){return"symbol"===e.type?this._symbolSourceCaches[e.source]:this._otherSourceCaches[e.source]}_getSourceCaches(e){const t=[];return this._otherSourceCaches[e]&&t.push(this._otherSourceCaches[e]),this._symbolSourceCaches[e]&&t.push(this._symbolSourceCaches[e]),t}has3DLayers(){return this._num3DLayers>0}}Ze.getSourceType=function(e){return D[e]},Ze.setSourceType=function(e,t){D[e]=t},Ze.registerForPluginStateChange=e.registerForPluginStateChange;var Xe="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let $e={};$e=At("","#ifdef TERRAIN\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);}float prevElevation(vec2 apos) {float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*word/7.3;}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0);const Ye=At("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nconst float PI=3.141592653589793;","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const float PI=3.141592653589793;const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Je=At("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Ke=At("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Qe=At("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);vec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),et=At("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),tt=At("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}"),it=At("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),rt=At("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=u_matrix*vec4(a_pos,elevation(a_pos),1.0);gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),nt=At("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),at=At("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);}"),ot=At("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),st=At("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),lt=At("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),ct=At("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),ht=At("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;\n#ifdef TERRAIN\nvec2 centroid_pos=a_centroid_pos;bool flat_roof=centroid_pos.x !=0.0;float ele=elevation(pos_nx.xy);float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);gl_Position=mix(u_matrix*vec4(pos_nx.xy,h,1),AWAY,hidden);\n#else\ngl_Position=u_matrix*vec4(pos_nx.xy,t > 0.0 ? height : base,1);\n#endif\nfloat colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),ut=At("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;\n#ifdef TERRAIN\nvec2 centroid_pos=a_centroid_pos;bool flat_roof=centroid_pos.x !=0.0;float ele=elevation(pos_nx.xy);float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);gl_Position=mix(u_matrix*vec4(pos_nx.xy,h,1),AWAY,hidden);\n#else\ngl_Position=u_matrix*vec4(pos_nx.xy,z,1);\n#endif\nvec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),dt=At("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),pt=At("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),ft=At("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_width2=vec2(outset,inset);}"),mt=At("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_width2=vec2(outset,inset);}"),gt=At("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),yt=At("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),vt=At("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),_t=At("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float h=elevation(a_pos);vec4 projectedPoint=u_matrix*vec4(a_pos,h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),h,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h,1.0);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));}"),xt=At("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float h=elevation(a_pos);vec4 projectedPoint=u_matrix*vec4(a_pos,h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),h,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h,1.0);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),bt=At("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float h=elevation(a_pos);vec4 projectedPoint=u_matrix*vec4(a_pos,h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),h,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h,1.0);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),wt=At("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;const float skirtOffset=24575.0;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);}"),Mt=At("#ifdef GL_ES\nprecision highp float;\n#endif\nvec4 pack_depth(float ndc_z) {float depth=ndc_z*0.5+0.5;const vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),Tt=At("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(vec3(p.xyx)*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract(vec3((p3.x+p3.y)*p3.z,(p3.x+p3.z)*p3.y,(p3.y+p3.z)*p3.x));}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;color.rgb+=rnd/255.0;return color;}float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Xe),St=At("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform lowp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(vec3(p.xyx)*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract(vec3((p3.x+p3.y)*p3.z,(p3.x+p3.z)*p3.y,(p3.y+p3.z)*p3.x));}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;color.rgb+=rnd/255.0;return color;}void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5))*u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Xe),Et=At("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}");function At(e,t,i){const r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,n=t.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),a=e.match(/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g),o=t.match(/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g);let s=o?o.concat(a):a;i||(s=$e.staticUniforms.concat(s));const l={};return{fragmentSource:e=e.replace(r,((e,t,i,r,n)=>(l[n]=!0,"define"===t?`\n#ifndef HAS_UNIFORM_u_${n}\nvarying ${i} ${r} ${n};\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${n}\n    ${i} ${r} ${n} = u_${n};\n#endif\n`))),vertexSource:t=t.replace(r,((e,t,i,r,n)=>{const a="float"===r?"vec2":"vec4",o=n.match(/color/)?"color":a;return l[n]?"define"===t?`\n#ifndef HAS_UNIFORM_u_${n}\nuniform lowp float u_${n}_t;\nattribute ${i} ${a} a_${n};\nvarying ${i} ${r} ${n};\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:"vec4"===o?`\n#ifndef HAS_UNIFORM_u_${n}\n    ${n} = a_${n};\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${n}\n    ${n} = unpack_mix_${o}(a_${n}, u_${n}_t);\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`:"define"===t?`\n#ifndef HAS_UNIFORM_u_${n}\nuniform lowp float u_${n}_t;\nattribute ${i} ${a} a_${n};\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:"vec4"===o?`\n#ifndef HAS_UNIFORM_u_${n}\n    ${i} ${r} ${n} = a_${n};\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${n}\n    ${i} ${r} ${n} = unpack_mix_${o}(a_${n}, u_${n}_t);\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`})),staticAttributes:n,staticUniforms:s}}var Ct=Object.freeze({__proto__:null,get preludeTerrain(){return $e},prelude:Ye,background:Je,backgroundPattern:Ke,circle:Qe,clippingMask:et,heatmap:tt,heatmapTexture:it,collisionBox:rt,collisionCircle:nt,debug:at,fill:ot,fillOutline:st,fillOutlinePattern:lt,fillPattern:ct,fillExtrusion:ht,fillExtrusionPattern:ut,hillshadePrepare:dt,hillshade:pt,line:ft,lineGradient:mt,linePattern:gt,lineSDF:yt,raster:vt,symbolIcon:_t,symbolSDF:xt,symbolTextAndIcon:bt,terrainRaster:wt,terrainDepth:Mt,skybox:Tt,skyboxGradient:St,skyboxCapture:Et});class Lt{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,t,i,r,n,a,o,s){this.context=e;let l=this.boundPaintVertexBuffers.length!==r.length;for(let e=0;!l&&e<r.length;e++)this.boundPaintVertexBuffers[e]!==r[e]&&(l=!0);e.extVertexArrayObject&&this.vao&&this.boundProgram===t&&this.boundLayoutVertexBuffer===i&&!l&&this.boundIndexBuffer===n&&this.boundVertexOffset===a&&this.boundDynamicVertexBuffer===o&&this.boundDynamicVertexBuffer2===s?(e.bindVertexArrayOES.set(this.vao),o&&o.bind(),n&&n.dynamicDraw&&n.bind(),s&&s.bind()):this.freshBind(t,i,r,n,a,o,s)}freshBind(e,t,i,r,n,a,o){let s;const l=e.numAttributes,c=this.context,h=c.gl;if(c.extVertexArrayObject)this.vao&&this.destroy(),this.vao=c.extVertexArrayObject.createVertexArrayOES(),c.bindVertexArrayOES.set(this.vao),s=0,this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=r,this.boundVertexOffset=n,this.boundDynamicVertexBuffer=a,this.boundDynamicVertexBuffer2=o;else{s=c.currentNumAttributes||0;for(let e=l;e<s;e++)h.disableVertexAttribArray(e)}t.enableAttributes(h,e);for(const t of i)t.enableAttributes(h,e);a&&a.enableAttributes(h,e),o&&o.enableAttributes(h,e),t.bind(),t.setVertexAttribPointers(h,e,n);for(const t of i)t.bind(),t.setVertexAttribPointers(h,e,n);a&&(a.bind(),a.setVertexAttribPointers(h,e,n)),r&&r.bind(),o&&(o.bind(),o.setVertexAttribPointers(h,e,n)),c.currentNumAttributes=l}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Pt(t,i){const r=Math.pow(2,i.canonical.z),n=i.canonical.y;return[new e.MercatorCoordinate(0,n/r).toLngLat().lat,new e.MercatorCoordinate(0,(n+1)/r).toLngLat().lat]}function It(t,i,r,n,a,o,s){const l=t.context,c=l.gl,h=r.fbo;if(!h)return;t.prepareDrawTile(i);const u=t.useProgram("hillshade");l.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,h.colorAttachment.get());const d=((e,t,i,r)=>{const n=i.paint.get("hillshade-shadow-color"),a=i.paint.get("hillshade-highlight-color"),o=i.paint.get("hillshade-accent-color");let s=i.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===i.paint.get("hillshade-illumination-anchor")&&(s-=e.transform.angle);const l=!e.options.moving;return{u_matrix:r||e.transform.calculatePosMatrix(t.tileID.toUnwrapped(),l),u_image:0,u_latrange:Pt(0,t.tileID),u_light:[i.paint.get("hillshade-exaggeration"),s],u_shadow:n,u_highlight:a,u_accent:o}})(t,r,n,t.terrain?i.posMatrix:null);u.draw(l,c.TRIANGLES,a,o,s,e.CullFaceMode.disabled,d,n.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}function Rt(t,i,r){if(!i.needsDEMTextureUpload)return;const n=t.context,a=n.gl;n.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||t.getTileTexture(r.stride);const o=r.getPixels();i.demTexture?i.demTexture.update(o,{premultiply:!1}):i.demTexture=new e.Texture(n,o,a.RGBA,{premultiply:!1}),i.needsDEMTextureUpload=!1}function Dt(t,i,r,n,a,o){const s=t.context,l=s.gl;if(!i.dem)return;const c=i.dem;if(s.activeTexture.set(l.TEXTURE1),Rt(t,i,c),!i.demTexture)return;i.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE);const h=c.dim;s.activeTexture.set(l.TEXTURE0);let u=i.fbo;if(!u){const t=new e.Texture(s,{width:h,height:h,data:null},l.RGBA);t.bind(l.LINEAR,l.CLAMP_TO_EDGE),u=i.fbo=s.createFramebuffer(h,h,!0),u.colorAttachment.set(t.texture)}s.bindFramebuffer.set(u.framebuffer),s.viewport.set([0,0,h,h]),t.useProgram("hillshadePrepare").draw(s,l.TRIANGLES,n,a,o,e.CullFaceMode.disabled,((t,i)=>{const r=i.stride,n=e.create();return e.ortho(n,0,e.EXTENT,-e.EXTENT,0,0,1),e.translate(n,n,[0,-e.EXTENT,0]),{u_matrix:n,u_image:1,u_dimension:[r,r],u_zoom:t.overscaledZ,u_unpack:i.unpackVector}})(i.tileID,c),r.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments),i.needsHillshadePrepare=!1}const kt=(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_image0:new e.Uniform1i(t,i.u_image0),u_skirt_height:new e.Uniform1f(t,i.u_skirt_height)}),zt=(e,t)=>({u_matrix:e,u_image0:0,u_skirt_height:t}),Ot=new class{constructor(){this.operations={}}newMorphing(e,t,i,r,n){if(e in this.operations){const t=this.operations[e];t.to.tileID.key!==i.tileID.key&&(t.queued=i)}else this.operations[e]={startTime:r,phase:0,duration:n,from:t,to:i,queued:null}}getMorphValuesForProxy(e){if(!(e in this.operations))return null;const t=this.operations[e];return{from:t.from,to:t.to,phase:t.phase}}update(e){for(const t in this.operations){const i=this.operations[t];for(i.phase=(e-i.startTime)/i.duration;i.phase>=1||!this._validOp(i);)if(!this._nextOp(i,e)){delete this.operations[t];break}}}_nextOp(e,t){return!!e.queued&&(e.from=e.to,e.to=e.queued,e.queued=null,e.phase=0,e.startTime=t,!0)}_validOp(e){return e.from.hasData()&&e.to.hasData()}},Bt={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Ft(t,i,r,n,a){const o=t.context,s=o.gl;let l=t.useProgram("terrainRaster"),c=0;const h=t.colorModeForRenderPass(),u=new e.DepthMode(s.LEQUAL,e.DepthMode.ReadWrite,t.depthRangeFor3D);Ot.update(a);const d=t.transform,p=6*Math.pow(1.5,22-d.zoom)*i.exaggeration();var f,m,g;for(const y of n){const n=r.getTile(y),v=e.StencilMode.disabled,_=i.prevTerrainTileForTile[y.key],x=i.terrainTileForTile[y.key];g=x,null!=(m=_)&&null!=g&&m.hasData()&&g.hasData()&&null!=m.demTexture&&null!=g.demTexture&&m.tileID.key!==g.tileID.key&&Ot.newMorphing(y.key,_,x,a,250),o.activeTexture.set(s.TEXTURE0),n.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST);const b=Ot.getMorphValuesForProxy(y.key),w=b?1:0;let M;b&&(M={morphing:{srcDemTile:b.from,dstDemTile:b.to,phase:e.easeCubicInOut(b.phase)}});const T=zt(y.posMatrix,Nt(y.canonical,d.renderWorldCopies)?p/10:p);c!==(f=w)&&(l=t.useProgram("terrainRaster",null,Bt[f]),c=f),i.setupElevationDraw(n,l,M),l.draw(o,s.TRIANGLES,u,v,h,e.CullFaceMode.backCCW,T,"terrain_raster",i.gridBuffer,i.gridIndexBuffer,i.gridSegments)}}function Nt(e,t){const i=1<<e.z;return!t&&(0===e.x||e.x===i-1)||0===e.y||e.y===i-1}const Ut=e=>({u_matrix:e});function jt(t,i,r,n,a){if(a>0){const o=e.browser.now(),s=(o-t.timeAdded)/a,l=i?(o-i.timeAdded)/a:-1,c=r.getSource(),h=n.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),u=!i||Math.abs(i.tileID.overscaledZ-h)>Math.abs(t.tileID.overscaledZ-h),d=u&&t.refreshedUponExpiration?1:e.clamp(u?s:1-l,0,1);return t.refreshedUponExpiration&&s>=1&&(t.refreshedUponExpiration=!1),i?{opacity:1,mix:1-d}:{opacity:d,mix:0}}return{opacity:1,mix:0}}const Vt={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Gt extends e.SourceCache{constructor(e){const t=k("proxy",{type:"geojson",maxzoom:e.transform.maxZoom},new T(G(),null),e.style);super("proxy",t,!1),t.setEventedParent(this),this.map=this.getSource().map=e,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,i,r){if(t.freezeTileCoverage)return;this.transform=t;const n=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,useElevationData:!0}).reduce(((i,r)=>{if(i[r.key]="",!this._tiles[r.key]){const i=new e.Tile(r,this._source.tileSize*r.overscaleFactor(),t.tileZoom);i.state="loaded",this._tiles[r.key]=i}return i}),{});for(const e in this._tiles)e in n||(this.freeFBO(e),this._tiles[e].state="unloaded",delete this._tiles[e])}freeFBO(e){const t=this.proxyCachedFBO[e];void 0!==t&&(this.renderCachePool.push(t),delete this.proxyCachedFBO[e])}deallocRenderCache(){this.renderCache.forEach((e=>e.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Ht extends e.OverscaledTileID{constructor(e,t,i){super(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y),this.proxyTileKey=t,this.posMatrix=i}}class Wt extends e.Elevation{constructor(t,i){super(),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[r,n,a]=function(t){const i=new e.StructArrayLayout4i8,r=new e.StructArrayLayout3ui6;i.reserve(17161),r.reserve(33800);const n=e.EXTENT/128,a=e.EXTENT+n/2,o=a+n;for(let t=-n;t<o;t+=n)for(let r=-n;r<o;r+=n){const n=r<0||r>a||t<0||t>a?24575:0,o=e.clamp(Math.round(r),0,e.EXTENT),s=e.clamp(Math.round(t),0,e.EXTENT);i.emplaceBack(o+n,s,o,s)}const s=(e,t)=>{const i=131*t+e;r.emplaceBack(i+1,i,i+131),r.emplaceBack(i+131,i+131+1,i+1)};for(let e=1;e<129;e++)for(let t=1;t<129;t++)s(t,e);return[0,129].forEach((e=>{for(let t=0;t<130;t++)s(t,e),s(e,t)})),[i,r,32768]}(),o=t.context;this.gridBuffer=o.createVertexBuffer(r,I.members),this.gridIndexBuffer=o.createIndexBuffer(n),this.gridSegments=e.SegmentVector.simpleSegment(0,0,r.length,n.length),this.gridNoSkirtSegments=e.SegmentVector.simpleSegment(0,0,r.length,a),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._sourceTilesOverlap={},this.proxySourceCache=new Gt(i.map),this.orthoMatrix=e.create(),e.ortho(this.orthoMatrix,0,e.EXTENT,0,e.EXTENT,0,1);const s=o.gl;this._overlapStencilMode=new e.StencilMode({func:s.GEQUAL,mask:255},0,255,s.KEEP,s.KEEP,s.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=i,i.on("data",this._onStyleDataEvent.bind(this))}update(t,i,r){if(t&&t.terrain){this.style!==t&&(t.on("data",this._onStyleDataEvent.bind(this)),this.style=t),this.enabled=!0;const n=t.terrain.properties;this.sourceCache=t._getSourceCache(n.get("source")),this._exaggeration=n.get("exaggeration");const a=()=>{this.sourceCache.used&&e.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const t=this.sourceCache.getSource().tileSize/128,r=this.proxySourceCache.getSource().tileSize;this.sourceCache.update(i,t*r,!0),this._findCoveringTileCache[this.sourceCache.id]={}};this.sourceCache.usedForTerrain||(this._findCoveringTileCache[this.sourceCache.id]={},this.sourceCache.usedForTerrain=!0,a(),this._initializing=!0),a(),i.updateElevation(!r),this._findCoveringTileCache[this.proxySourceCache.id]={},this.proxySourceCache.update(i),this._depthDone=!1,this._emptyDEMTextureDirty=!0}else this._disable()}_onStyleDataEvent(e){e.coord&&"source"===e.dataType?this._clearRenderCacheForTile(e.sourceCacheId,e.coord):"style"===e.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this.proxySourceCache.deallocRenderCache(),this.painter.style))for(const e in this.painter.style._sourceCaches)this.painter.style._sourceCaches[e].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach((e=>e.fb.destroy())),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const e=2*this.proxySourceCache.getSource().tileSize;return[e,e]}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const i=this.proxySourceCache,r=this.painter.transform;this._initializing&&(this._initializing=0===r._centerAltitude&&-1===this.getAtPoint(e.MercatorCoordinate.fromLngLat(r.center),-1),this._emptyDEMTextureDirty=!this._initializing);const n=this.painter.options;this.drapeFirst=(n.zooming||n.moving||n.rotating||!!this.forceDrapeFirst)&&!this._invalidateRenderCache,this._invalidateRenderCache=!1;const a=this.proxyCoords=i.getIds().map((e=>{const t=i.getTileByID(e).tileID;return t.posMatrix=r.calculatePosMatrix(t.toUnwrapped()),t}));!function(t,i){const r=i.transform.pointCoordinate(i.transform.getCameraPoint()),n=new e.Point(r.x,r.y);t.sort(((t,i)=>{if(i.overscaledZ-t.overscaledZ)return i.overscaledZ-t.overscaledZ;const r=new e.Point(t.canonical.x+(1<<t.canonical.z)*t.wrap,t.canonical.y),a=new e.Point(i.canonical.x+(1<<i.canonical.z)*i.wrap,i.canonical.y),o=n.mult(1<<t.canonical.z);return o.x-=.5,o.y-=.5,o.distSqr(r)-o.distSqr(a)}))}(a,this.painter),this._previousZoom=r.zoom;const o=this.proxyToSource||{};this.proxyToSource={},a.forEach((e=>{this.proxyToSource[e.key]={}})),this.terrainTileForTile={};const s=this.painter.style._sourceCaches;for(const e in s){const i=s[e];if(!i.used)continue;if(i!==this.sourceCache&&(this._findCoveringTileCache[i.id]={}),this._setupProxiedCoordsForOrtho(i,t[e],o),i.usedForTerrain)continue;const r=t[e];i.getSource().reparseOverscaled&&this._assignTerrainTiles(r)}this.proxiedCoords[i.id]=a.map((e=>new Ht(e,e.key,this.orthoMatrix))),this._assignTerrainTiles(a),this._prepareDEMTextures(),this._setupRenderCache(o),this.drapeFirstPending=this.drapeFirst,this.renderingToTexture=!1,this._initFBOPool(),this._updateTimestamp=e.browser.now();const l={};this._visibleDemTiles=[];for(const e of this.proxyCoords){const t=this.terrainTileForTile[e.key];if(!t)continue;const i=t.tileID.key;i in l||(this._visibleDemTiles.push(t),l[i]=i)}}_assignTerrainTiles(e){this._initializing||e.forEach((e=>{if(this.terrainTileForTile[e.key])return;const t=this._findTileCoveringTileID(e,this.sourceCache);t&&(this.terrainTileForTile[e.key]=t)}))}_prepareDEMTextures(){const e=this.painter.context,t=e.gl;for(const i in this.terrainTileForTile){const r=this.terrainTileForTile[i],n=r.dem;!n||r.demTexture&&!r.needsDEMTextureUpload||(e.activeTexture.set(t.TEXTURE1),Rt(this.painter,r,n))}}_prepareDemTileUniforms(e,t,i,r){if(!t||null==t.demTexture)return!1;const n=e.tileID.canonical,a=Math.pow(2,t.tileID.canonical.z-n.z),o=r||"";return i[`u_dem_tl${o}`]=[n.x*a%1,n.y*a%1],i[`u_dem_scale${o}`]=a,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){let e=0;const t=this._visibleDemTiles.reduce(((t,i)=>{if(!i.dem)return t;const r=i.dem.tree.minimums[0];return r>0&&e++,t+r}),0);return e?t/e:0}_updateEmptyDEMTexture(){const t=this.painter.context,i=t.gl;t.activeTexture.set(i.TEXTURE2);const r=this._getLoadedAreaMinimum(),n={width:1,height:1,data:new Uint8Array(e.DEMData.pack(r,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let a=this._emptyDEMTexture;return a?a.update(n,{premultiply:!1}):a=this._emptyDEMTexture=new e.Texture(t,n,i.RGBA,{premultiply:!1}),a}setupElevationDraw(t,i,r){const n=this.painter.context,a=n.gl,o=(s=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:e.DEMData.getUnpackVector(s),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var s;o.u_dem_size=this.sourceCache.getSource().tileSize,o.u_exaggeration=this.exaggeration();let l=null,c=null,h=1;if(r&&r.morphing){const e=r.morphing.srcDemTile,i=r.morphing.dstDemTile;h=r.morphing.phase,e&&i&&(this._prepareDemTileUniforms(t,e,o,"_prev")&&(c=e),this._prepareDemTileUniforms(t,i,o)&&(l=i))}if(c&&l?(n.activeTexture.set(a.TEXTURE2),l.demTexture.bind(a.NEAREST,a.CLAMP_TO_EDGE,a.NEAREST),n.activeTexture.set(a.TEXTURE4),c.demTexture.bind(a.NEAREST,a.CLAMP_TO_EDGE,a.NEAREST),o.u_dem_lerp=h):(l=this.terrainTileForTile[t.tileID.key],n.activeTexture.set(a.TEXTURE2),(this._prepareDemTileUniforms(t,l,o)?l.demTexture:this.emptyDEMTexture).bind(a.NEAREST,a.CLAMP_TO_EDGE,a.NEAREST)),r&&r.useDepthForOcclusion&&(n.activeTexture.set(a.TEXTURE3),this._depthTexture.bind(a.NEAREST,a.CLAMP_TO_EDGE,a.NEAREST),o.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]),r&&r.useMeterToDem&&l){const t=(1<<l.tileID.canonical.z)*e.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;o.u_meter_to_dem=t}r&&r.labelPlaneMatrixInv&&(o.u_label_plane_matrix_inv=r.labelPlaneMatrixInv),i.setTerrainUniformValues(n,o)}renderLayer(e,t){return"translucent"!==this.painter.renderPass?(this._depthDone||"symbol"!==e.type&&"circle"!==e.type||this.drawDepth(),!0):this.drapeFirst&&this.drapeFirstPending?(this.render(),this.drapeFirstPending=!1,!0):!!this._isLayerDrapedOverTerrain(e)&&(this.drapeFirst&&!this.renderingToTexture||this.render(),!0)}render(){this.renderingToTexture=!0;const t=this.painter,i=this.painter.context,r=this.proxySourceCache,n=this.proxiedCoords[r.id],a=()=>{i.bindFramebuffer.set(null),i.viewport.set([0,0,t.width,t.height]),this.renderingToTexture=!1},o=t.currentLayer;let s=o,l=[];const c=t.style._order;let h=0;for(let u=0;u<n.length;u++){const d=n[u],p=r.getTileByID(d.proxyTileKey),f=r.proxyCachedFBO[d.key],m=this.currentFBO=void 0!==f?r.renderCache[f]:this.pool[h++];if(p.texture=m.tex,void 0!==f&&!m.dirty){l.push(p.tileID);continue}let g;for(i.bindFramebuffer.set(m.fb.framebuffer),this.renderedToTile=!1,m.dirty&&(i.clear({color:e.Color.transparent}),m.dirty=!1),t.currentLayer=o;t.currentLayer<c.length;t.currentLayer++){const e=t.style._layers[c[t.currentLayer]],r=e.isHidden(t.transform.zoom),n=this._isLayerDrapedOverTerrain(e);if(this.drapeFirst&&!n)continue;if(t.currentLayer>s){if(!r&&!n)break;s++}if(r)continue;const a=this.painter.style._getLayerSourceCache(e),o=a?this.proxyToSource[d.key][a.id]:[d];if(!o)continue;const l=o;i.viewport.set([0,0,m.fb.width,m.fb.height]),g!==(a?a.id:null)&&(this._setupStencil(o,e,a),g=a?a.id:null),t.renderLayer(t,a,e,l)}m.dirty=this.renderedToTile,this.renderedToTile&&l.push(p.tileID),5===h&&(h=0,l.length>0&&(a(),Ft(t,this,r,l,this._updateTimestamp),this.renderingToTexture=!0,l=[]))}a(),l.length>0&&Ft(t,this,r,l,this._updateTimestamp),t.currentLayer=this.drapeFirst?-1:s}raycast(e,t,i){if(!this._visibleDemTiles)return null;const r=this._visibleDemTiles.filter((e=>e.dem)).map((r=>{const n=r.tileID,a=Math.pow(2,n.overscaledZ),{x:o,y:s}=n.canonical,l=o/a,c=(o+1)/a,h=s/a,u=(s+1)/a;return{minx:l,miny:h,maxx:c,maxy:u,t:r.dem.tree.raycastRoot(l,h,c,u,e,t,i),tile:r}}));r.sort(((e,t)=>(null!==e.t?e.t:Number.MAX_VALUE)-(null!==t.t?t.t:Number.MAX_VALUE)));for(const n of r){if(null==n.t)return null;const r=n.tile.dem.tree.raycast(n.minx,n.miny,n.maxx,n.maxy,e,t,i);if(null!=r)return r}return null}_createFBO(){const t=this.painter.context,i=t.gl,r=this.drapeBufferSize;t.activeTexture.set(i.TEXTURE0);const n=new e.Texture(t,{width:r[0],height:r[1],data:null},i.RGBA);n.bind(i.LINEAR,i.CLAMP_TO_EDGE);const a=t.createFramebuffer(r[0],r[1],!1);return a.colorAttachment.set(n.texture),t.extTextureFilterAnisotropic&&!t.extTextureFilterAnisotropicForceOff&&i.texParameterf(i.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:a,tex:n,dirty:!1,ref:1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){return!this.drapeFirst||this.painter.style._order.some((e=>{const t=this.painter.style._layers[e],i=!t.isHidden(this.painter.transform.zoom),r=t.getCrossfadeParameters();return"custom"!==t.type&&!i&&!!r&&1!==r.t}))}_clearRasterFadeFromRenderCache(){for(const e in this.painter.style._sourceCaches)if(!(this.painter.style._sourceCaches[e]._source instanceof P))return;for(let e=0;e<this.painter.style._order.length;++e){const t=this.painter.style._layers[this.painter.style._order[e]],i=t.isHidden(this.painter.transform.zoom),r=this.painter.style._getLayerSourceCache(t);if("raster"!==t.type||i||!r)continue;const n=t.paint.get("raster-fade-duration");for(const e of this.proxyCoords){const t=this.proxyToSource[e.key][r.id];if(t)for(const e of t){const t=jt(r.getTile(e),r.findLoadedParent(e,0),r,this.painter.transform,n);(1!==t.opacity||0!==t.mix)&&this._clearRenderCacheForTile(r.id,e)}}}}_setupRenderCache(e){const t=this.proxySourceCache;if(this._shouldDisableRenderCache()){if(t.renderCache.length>t.renderCachePool.length){const e=Object.values(t.proxyCachedFBO);t.proxyCachedFBO={},t.renderCachePool=t.renderCachePool.concat(e)}return}this._clearRasterFadeFromRenderCache();const i=this.proxyCoords,r=this._tilesDirty;for(let n=i.length-1;n>=0;n--){const a=i[n];if(t.getTileByID(a.key),void 0!==t.proxyCachedFBO[a.key]){const i=e[a.key],n=this.proxyToSource[a.key];let o=0;for(const e in n){const t=n[e],a=i[e];if(!a||a.length!==t.length||t.some(((t,i)=>t!==a[i]||r[e]&&r[e].hasOwnProperty(t.key)))){o=-1;break}++o}t.renderCache[t.proxyCachedFBO[a.key]].dirty=o<0||o!==Object.values(i).length}else{let e=t.renderCachePool.pop();void 0===e&&t.renderCache.length<50&&(e=t.renderCache.length,t.renderCache.push(this._createFBO())),void 0!==e&&(t.proxyCachedFBO[a.key]=e,t.renderCache[e].dirty=!0)}}this._tilesDirty={}}_setupStencil(t,i,r){if(!r||!this._sourceTilesOverlap[r.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const n=this.painter.context,a=n.gl;if(t.length<=1)return void(this._overlapStencilType=!1);const o=this.currentFBO,s=o.fb;let l;if(i.isTileClipped())l=t.length,this._overlapStencilMode.test={func:a.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(t[0].overscaledZ>t[t.length-1].overscaledZ))return void(this._overlapStencilType=!1);l=1,this._overlapStencilMode.test={func:a.GREATER,mask:255},this._overlapStencilType="Mask"}if(!s.depthAttachment){const t=n.createRenderbuffer(n.gl.DEPTH_STENCIL,s.width,s.height);s.depthAttachment=new e.DepthStencilAttachment(n,s.framebuffer),s.depthAttachment.set(t),n.clear({stencil:0})}o.ref+l>255&&(n.clear({stencil:0}),o.ref=0),o.ref+=l,this._overlapStencilMode.ref=o.ref,i.isTileClipped()&&this._renderTileClippingMasks(t,this._overlapStencilMode.ref)}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):e.StencilMode.disabled}_renderTileClippingMasks(t,i){const r=this.painter,n=this.painter.context,a=n.gl;r._tileClippingMaskIDs={},n.setColorMode(e.ColorMode.disabled),n.setDepthMode(e.DepthMode.disabled);const o=r.useProgram("clippingMask");for(const s of t){const t=r._tileClippingMaskIDs[s.key]=--i;o.draw(n,a.TRIANGLES,e.DepthMode.disabled,new e.StencilMode({func:a.ALWAYS,mask:0},t,255,a.KEEP,a.KEEP,a.REPLACE),e.ColorMode.disabled,e.CullFaceMode.disabled,Ut(s.posMatrix),"$clipping",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments)}}pointCoordinate(t){const i=this.painter.transform;if(t.x<0||t.x>i.width||t.y<0||t.y>i.height)return null;const r=[t.x,t.y,1,1];e.transformMat4(r,r,i.pixelMatrixInverse),e.scale$1(r,r,1/r[3]),r[0]/=i.worldSize,r[1]/=i.worldSize;const n=i._camera.position,a=e.mercatorZfromAltitude(1,i.center.lat),o=[n[0],n[1],n[2]/a,0],s=e.subtract([],r.slice(0,3),o);e.normalize(s,s);const l=this.raycast(o,s,this._exaggeration);return null!==l&&l?(e.scaleAndAdd(o,o,s,l),o[3]=o[2],o[2]*=a,o):null}drawDepth(){const t=this.painter,i=t.context,r=this.proxySourceCache,n=Math.ceil(t.width),a=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===n&&this._depthFBO.height===a||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const t=i.gl,r=i.createFramebuffer(n,a,!0);i.activeTexture.set(t.TEXTURE0);const o=new e.Texture(i,{width:n,height:a,data:null},t.RGBA);o.bind(t.NEAREST,t.CLAMP_TO_EDGE),r.colorAttachment.set(o.texture);const s=i.createRenderbuffer(i.gl.DEPTH_COMPONENT16,n,a);r.depthAttachment.set(s),this._depthFBO=r,this._depthTexture=o}i.bindFramebuffer.set(this._depthFBO.framebuffer),i.viewport.set([0,0,n,a]),function(t,i,r,n){const a=t.context,o=a.gl;a.clear({depth:1});const s=t.useProgram("terrainDepth"),l=new e.DepthMode(o.LESS,e.DepthMode.ReadWrite,t.depthRangeFor3D);for(const t of n){const n=r.getTile(t),c=zt(t.posMatrix,0);i.setupElevationDraw(n,s),s.draw(a,o.TRIANGLES,l,e.StencilMode.disabled,e.ColorMode.unblended,e.CullFaceMode.backCCW,c,"terrain_depth",i.gridBuffer,i.gridIndexBuffer,i.gridNoSkirtSegments)}}(t,this,r,this.proxyCoords),i.bindFramebuffer.set(null),i.viewport.set([0,0,t.width,t.height]),this._depthDone=!0}_isLayerDrapedOverTerrain(e){return!!this.enabled&&Vt.hasOwnProperty(e.type)}_setupProxiedCoordsForOrtho(e,t,i){if(e.getSource()instanceof R)return this._setupProxiedCoordsForImageSource(e,t,i);this._findCoveringTileCache[e.id]=this._findCoveringTileCache[e.id]||{};const r=this.proxiedCoords[e.id]=[],n=this.proxyCoords;for(let t=0;t<n.length;t++){const a=n[t],o=this._findTileCoveringTileID(a,e);if(o){const t=this._createProxiedId(a,o,i[a.key]&&i[a.key][e.id]);r.push(t),this.proxyToSource[a.key][e.id]=[t]}}let a=!1;for(let n=0;n<t.length;n++){const o=e.getTile(t[n]);if(!o||!o.hasData())continue;const s=this._findTileCoveringTileID(o.tileID,this.proxySourceCache);if(s&&s.tileID.canonical.z!==o.tileID.canonical.z){const t=this.proxyToSource[s.tileID.key][e.id],n=this._createProxiedId(s.tileID,o,i[s.tileID.key]&&i[s.tileID.key][e.id]);t?t.splice(t.length-1,0,n):this.proxyToSource[s.tileID.key][e.id]=[n],r.push(n),a=!0}}this._sourceTilesOverlap[e.id]=a}_setupProxiedCoordsForImageSource(t,i,r){if(!t.getSource().loaded())return;const n=this.proxiedCoords[t.id]=[],a=this.proxyCoords,o=t.getSource(),s=new e.Point(o.tileID.x,o.tileID.y)._div(1<<o.tileID.z),l=o.coordinates.map(e.MercatorCoordinate.fromLngLat).reduce(((e,t)=>(e.min.x=Math.min(e.min.x,t.x-s.x),e.min.y=Math.min(e.min.y,t.y-s.y),e.max.x=Math.max(e.max.x,t.x-s.x),e.max.y=Math.max(e.max.y,t.y-s.y),e)),{min:new e.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new e.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),c=(t,i)=>{const r=t.wrap+t.canonical.x/(1<<t.canonical.z),n=t.canonical.y/(1<<t.canonical.z),a=e.EXTENT/(1<<t.canonical.z),o=i.wrap+i.canonical.x/(1<<i.canonical.z),s=i.canonical.y/(1<<i.canonical.z);return r+a<o+l.min.x||r>o+l.max.x||n+a<s+l.min.y||n>s+l.max.y};for(let e=0;e<a.length;e++){const o=a[e];for(let e=0;e<i.length;e++){const a=t.getTile(i[e]);if(!a||!a.hasData())continue;if(c(o,a.tileID))continue;const s=this._createProxiedId(o,a,r[o.key]&&r[o.key][t.id]),l=this.proxyToSource[o.key][t.id];l?l.push(s):this.proxyToSource[o.key][t.id]=[s],n.push(s)}}}_createProxiedId(t,i,r){let n=this.orthoMatrix;if(r){const e=r.find((e=>e.key===i.tileID.key));if(e)return e}if(i.tileID.key!==t.key){const r=t.canonical.z-i.tileID.canonical.z;let a,o,s;n=e.create();const l=i.tileID.wrap-t.wrap<<t.overscaledZ;r>0?(a=e.EXTENT>>r,o=a*((i.tileID.canonical.x<<r)-t.canonical.x+l),s=a*((i.tileID.canonical.y<<r)-t.canonical.y)):(a=e.EXTENT<<-r,o=e.EXTENT*(i.tileID.canonical.x-(t.canonical.x+l<<-r)),s=e.EXTENT*(i.tileID.canonical.y-(t.canonical.y<<-r))),e.ortho(n,0,a,0,a,0,1),e.translate(n,n,[o,s,0])}return new Ht(i.tileID,t.key,n)}_findTileCoveringTileID(t,i){let r=i.getTile(t);if(r&&r.hasData())return r;const n=this._findCoveringTileCache[i.id],a=n[t.key];if(r=a?i.getTileByID(a):null,r&&r.hasData()||null===a)return r;let o=r?r.tileID:t,s=o.overscaledZ;const l=i.getSource().minzoom,c=[];if(!a){const n=i.getSource().maxzoom;if(t.canonical.z>=n){const r=t.canonical.z-n;i.getSource().reparseOverscaled?(s=Math.max(t.canonical.z+2,i.transform.tileZoom),o=new e.OverscaledTileID(s,t.wrap,n,t.canonical.x>>r,t.canonical.y>>r)):0!==r&&(s=n,o=new e.OverscaledTileID(s,t.wrap,n,t.canonical.x>>r,t.canonical.y>>r))}o.key!==t.key&&(c.push(o.key),r=i.getTile(o))}const h=e=>{c.forEach((t=>{n[t]=e})),c.length=0};for(s-=1;s>=l&&(!r||!r.hasData());s--){r&&h(r.tileID.key);const e=o.calculateScaledKey(s);if(r=i.getTileByID(e),r&&r.hasData())break;const t=n[e];if(null===t)break;void 0===t?c.push(e):r=i.getTileByID(t)}return h(r?r.tileID.key:null),r&&r.hasData()?r:null}findDEMTileFor(e){return this.enabled?this._findTileCoveringTileID(e,this.sourceCache):null}prepareDrawTile(e){this.renderedToTile||(this.renderedToTile=!0)}_clearRenderCacheForTile(e,t){let i=this._tilesDirty[e];i||(i=this._tilesDirty[e]={}),i[t.key]=!0}}function qt(e){const t=[];for(let i=0;i<e.length;i++){if(null===e[i])continue;const r=e[i].split(" ");t.push(r.pop())}return t}class Zt{static cacheKey(e,t,i){let r=`${e}${i?i.cacheKey:""}`;for(const e of t)r+=`/${e}`;return r}constructor(t,i,r,n,a,o){const s=t.gl;this.program=s.createProgram();const l=qt(r.staticAttributes),c=n?n.getBinderAttributes():[],h=l.concat(c),u=r.staticUniforms?qt(r.staticUniforms):[],d=n?n.getBinderUniforms():[],p=u.concat(d),f=[];for(const e of p)f.indexOf(e)<0&&f.push(e);let m=n?n.defines():[];m=m.concat(o.map((e=>`#define ${e}`)));const g=m.concat(Ye.fragmentSource,r.fragmentSource).join("\n"),y=m.concat(Ye.vertexSource,$e.vertexSource,r.vertexSource).join("\n"),v=s.createShader(s.FRAGMENT_SHADER);if(s.isContextLost())return void(this.failedToCreate=!0);s.shaderSource(v,g),s.compileShader(v),s.attachShader(this.program,v);const _=s.createShader(s.VERTEX_SHADER);if(s.isContextLost())return void(this.failedToCreate=!0);s.shaderSource(_,y),s.compileShader(_),s.attachShader(this.program,_),this.attributes={};const x={};this.numAttributes=h.length;for(let e=0;e<this.numAttributes;e++)h[e]&&(s.bindAttribLocation(this.program,e,h[e]),this.attributes[h[e]]=e);s.linkProgram(this.program),s.deleteShader(_),s.deleteShader(v);for(let e=0;e<f.length;e++){const t=f[e];if(t&&!x[t]){const e=s.getUniformLocation(this.program,t);e&&(x[t]=e)}}this.fixedUniforms=a(t,x),this.binderUniforms=n?n.getUniforms(t,x):[],-1!==o.indexOf("TERRAIN")&&(this.terrainUniforms=((t,i)=>({u_dem:new e.Uniform1i(t,i.u_dem),u_dem_prev:new e.Uniform1i(t,i.u_dem_prev),u_dem_unpack:new e.Uniform4f(t,i.u_dem_unpack),u_dem_tl:new e.Uniform2f(t,i.u_dem_tl),u_dem_scale:new e.Uniform1f(t,i.u_dem_scale),u_dem_tl_prev:new e.Uniform2f(t,i.u_dem_tl_prev),u_dem_scale_prev:new e.Uniform1f(t,i.u_dem_scale_prev),u_dem_size:new e.Uniform1f(t,i.u_dem_size),u_dem_lerp:new e.Uniform1f(t,i.u_dem_lerp),u_exaggeration:new e.Uniform1f(t,i.u_exaggeration),u_depth:new e.Uniform1i(t,i.u_depth),u_depth_size_inv:new e.Uniform2f(t,i.u_depth_size_inv),u_meter_to_dem:new e.Uniform1f(t,i.u_meter_to_dem),u_label_plane_matrix_inv:new e.UniformMatrix4f(t,i.u_label_plane_matrix_inv)}))(t,x))}setTerrainUniformValues(e,t){if(!this.terrainUniforms)return;const i=this.terrainUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e].set(t[e])}}draw(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m){const g=e.gl;if(this.failedToCreate)return;e.program.set(this.program),e.setDepthMode(i),e.setStencilMode(r),e.setColorMode(n),e.setCullFace(a);for(const e in this.fixedUniforms)this.fixedUniforms[e].set(o[e]);p&&p.setUniforms(e,this.binderUniforms,u,{zoom:d});const y={[g.LINES]:2,[g.TRIANGLES]:3,[g.LINE_STRIP]:1}[t];for(const i of h.get()){const r=i.vaos||(i.vaos={});(r[s]||(r[s]=new Lt)).bind(e,this,l,p?p.getPaintVertexBuffers():[],c,i.vertexOffset,f,m),g.drawElements(t,i.primitiveLength*y,g.UNSIGNED_SHORT,i.primitiveOffset*y*2)}}}function Xt(e,t,i){const r=1/S(i,1,t.transform.tileZoom),n=Math.pow(2,i.tileID.overscaledZ),a=i.tileSize*Math.pow(2,t.transform.tileZoom)/n,o=a*(i.tileID.canonical.x+i.tileID.wrap*n),s=a*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_scale:[r,e.fromScale,e.toScale],u_fade:e.t,u_pixel_coord_upper:[o>>16,s>>16],u_pixel_coord_lower:[65535&o,65535&s]}}const $t=(t,i,r,n)=>{const a=i.style.light,o=a.properties.get("position"),s=[o.x,o.y,o.z],l=e.create$1();"viewport"===a.properties.get("anchor")&&(e.fromRotation(l,-i.transform.angle),e.transformMat3(s,s,l));const c=a.properties.get("color");return{u_matrix:t,u_lightpos:s,u_lightintensity:a.properties.get("intensity"),u_lightcolor:[c.r,c.g,c.b],u_vertical_gradient:+r,u_opacity:n}},Yt=(t,i,r,n,a,o,s)=>e.extend($t(t,i,r,n),Xt(o,i,s),{u_height_factor:-Math.pow(2,a.overscaledZ)/s.tileSize/8}),Jt=e=>({u_matrix:e}),Kt=(t,i,r,n)=>e.extend(Jt(t),Xt(r,i,n)),Qt=(e,t)=>({u_matrix:e,u_world:t}),ei=(t,i,r,n,a)=>e.extend(Kt(t,i,r,n),{u_world:a}),ti=(t,i,r,n)=>{const a=t.transform;let o;if("map"===n.paint.get("circle-pitch-alignment")){const e=S(r,1,a.zoom);o=[e,e]}else o=a.pixelsToGLUnits;return{u_camera_to_center_distance:a.cameraToCenterDistance,u_matrix:t.translatePosMatrix(i.posMatrix,r,n.paint.get("circle-translate"),n.paint.get("circle-translate-anchor")),u_device_pixel_ratio:e.browser.devicePixelRatio,u_extrude_scale:o}},ii=e=>{const t=[];return"map"===e.paint.get("circle-pitch-alignment")&&t.push("PITCH_WITH_MAP"),"map"===e.paint.get("circle-pitch-scale")&&t.push("SCALE_WITH_MAP"),t},ri=(t,i,r)=>{const n=e.EXTENT/r.tileSize;return{u_matrix:t,u_camera_to_center_distance:i.cameraToCenterDistance,u_extrude_scale:[i.pixelsToGLUnits[0]/n,i.pixelsToGLUnits[1]/n]}},ni=(e,t,i=1)=>({u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:i}),ai=(e,t,i,r)=>({u_matrix:e,u_extrude_scale:S(t,1,i),u_intensity:r}),oi=(t,i,r,n)=>{const a=t.transform;return{u_matrix:ui(t,i,r,n),u_ratio:1/S(i,1,a.zoom),u_device_pixel_ratio:e.browser.devicePixelRatio,u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]]}},si=(t,i,r,n,a)=>e.extend(oi(t,i,r,n),{u_image:0,u_image_height:a}),li=(t,i,r,n,a)=>{const o=t.transform,s=hi(i,o);return{u_matrix:ui(t,i,r,a),u_texsize:i.imageAtlasTexture.size,u_ratio:1/S(i,1,o.zoom),u_device_pixel_ratio:e.browser.devicePixelRatio,u_image:0,u_scale:[s,n.fromScale,n.toScale],u_fade:n.t,u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]]}},ci=(t,i,r,n,a,o)=>{const s=t.lineAtlas,l=hi(i,t.transform),c="round"===r.layout.get("line-cap"),h=s.getDash(n.from,c),u=s.getDash(n.to,c),d=h.width*a.fromScale,p=u.width*a.toScale;return e.extend(oi(t,i,r,o),{u_patternscale_a:[l/d,-h.height/2],u_patternscale_b:[l/p,-u.height/2],u_sdfgamma:s.width/(256*Math.min(d,p)*e.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:h.y,u_tex_y_b:u.y,u_mix:a.t})};function hi(e,t){return 1/S(e,1,t.tileZoom)}function ui(e,t,i,r){return e.translatePosMatrix(r||t.tileID.posMatrix,t,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const di=(e,t,i,r,n)=>{return{u_matrix:e,u_tl_parent:t,u_scale_parent:i,u_buffer_scale:1,u_fade_t:r.mix,u_opacity:r.opacity*n.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:n.paint.get("raster-brightness-min"),u_brightness_high:n.paint.get("raster-brightness-max"),u_saturation_factor:(o=n.paint.get("raster-saturation"),o>0?1-1/(1.001-o):-o),u_contrast_factor:(a=n.paint.get("raster-contrast"),a>0?1/(1-a):1+a),u_spin_weights:pi(n.paint.get("raster-hue-rotate"))};var a,o};function pi(e){e*=Math.PI/180;const t=Math.sin(e),i=Math.cos(e);return[(2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3]}const fi=(e,t,i,r,n,a,o,s,l,c)=>{const h=n.transform;return{u_is_size_zoom_constant:+("constant"===e||"source"===e),u_is_size_feature_constant:+("constant"===e||"camera"===e),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:h.cameraToCenterDistance,u_pitch:h.pitch/360*2*Math.PI,u_rotate_symbol:+i,u_aspect_ratio:h.width/h.height,u_fade_change:n.options.fadeDuration?n.symbolFadeChange:1,u_matrix:a,u_label_plane_matrix:o,u_coord_matrix:s,u_is_text:+l,u_pitch_with_map:+r,u_texsize:c,u_texture:0}},mi=(t,i,r,n,a,o,s,l,c,h,u)=>{const d=a.transform;return e.extend(fi(t,i,r,n,a,o,s,l,c,h),{u_gamma_scale:n?Math.cos(d._pitch)*d.cameraToCenterDistance:1,u_device_pixel_ratio:e.browser.devicePixelRatio,u_is_halo:+u})},gi=(t,i,r,n,a,o,s,l,c,h)=>e.extend(mi(t,i,r,n,a,o,s,l,!0,c,!0),{u_texsize_icon:h,u_texture_icon:1}),yi=(e,t,i)=>({u_matrix:e,u_opacity:t,u_color:i}),vi=(t,i,r,n,a,o)=>e.extend(function(e,t,i,r){const n=i.imageManager.getPattern(e.from.toString()),a=i.imageManager.getPattern(e.to.toString()),{width:o,height:s}=i.imageManager.getPixelSize(),l=Math.pow(2,r.tileID.overscaledZ),c=r.tileSize*Math.pow(2,i.transform.tileZoom)/l,h=c*(r.tileID.canonical.x+r.tileID.wrap*l),u=c*r.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:n.tl,u_pattern_br_a:n.br,u_pattern_tl_b:a.tl,u_pattern_br_b:a.br,u_texsize:[o,s],u_mix:t.t,u_pattern_size_a:n.displaySize,u_pattern_size_b:a.displaySize,u_scale_a:t.fromScale,u_scale_b:t.toScale,u_tile_units_to_pixels:1/S(r,1,i.transform.tileZoom),u_pixel_coord_upper:[h>>16,u>>16],u_pixel_coord_lower:[65535&h,65535&u]}}(n,o,r,a),{u_matrix:t,u_opacity:i}),_i={fillExtrusion:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_lightpos:new e.Uniform3f(t,i.u_lightpos),u_lightintensity:new e.Uniform1f(t,i.u_lightintensity),u_lightcolor:new e.Uniform3f(t,i.u_lightcolor),u_vertical_gradient:new e.Uniform1f(t,i.u_vertical_gradient),u_opacity:new e.Uniform1f(t,i.u_opacity)}),fillExtrusionPattern:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_lightpos:new e.Uniform3f(t,i.u_lightpos),u_lightintensity:new e.Uniform1f(t,i.u_lightintensity),u_lightcolor:new e.Uniform3f(t,i.u_lightcolor),u_vertical_gradient:new e.Uniform1f(t,i.u_vertical_gradient),u_height_factor:new e.Uniform1f(t,i.u_height_factor),u_image:new e.Uniform1i(t,i.u_image),u_texsize:new e.Uniform2f(t,i.u_texsize),u_pixel_coord_upper:new e.Uniform2f(t,i.u_pixel_coord_upper),u_pixel_coord_lower:new e.Uniform2f(t,i.u_pixel_coord_lower),u_scale:new e.Uniform3f(t,i.u_scale),u_fade:new e.Uniform1f(t,i.u_fade),u_opacity:new e.Uniform1f(t,i.u_opacity)}),fill:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix)}),fillPattern:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_image:new e.Uniform1i(t,i.u_image),u_texsize:new e.Uniform2f(t,i.u_texsize),u_pixel_coord_upper:new e.Uniform2f(t,i.u_pixel_coord_upper),u_pixel_coord_lower:new e.Uniform2f(t,i.u_pixel_coord_lower),u_scale:new e.Uniform3f(t,i.u_scale),u_fade:new e.Uniform1f(t,i.u_fade)}),fillOutline:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_world:new e.Uniform2f(t,i.u_world)}),fillOutlinePattern:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_world:new e.Uniform2f(t,i.u_world),u_image:new e.Uniform1i(t,i.u_image),u_texsize:new e.Uniform2f(t,i.u_texsize),u_pixel_coord_upper:new e.Uniform2f(t,i.u_pixel_coord_upper),u_pixel_coord_lower:new e.Uniform2f(t,i.u_pixel_coord_lower),u_scale:new e.Uniform3f(t,i.u_scale),u_fade:new e.Uniform1f(t,i.u_fade)}),circle:(t,i)=>({u_camera_to_center_distance:new e.Uniform1f(t,i.u_camera_to_center_distance),u_extrude_scale:new e.Uniform2f(t,i.u_extrude_scale),u_device_pixel_ratio:new e.Uniform1f(t,i.u_device_pixel_ratio),u_matrix:new e.UniformMatrix4f(t,i.u_matrix)}),collisionBox:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_camera_to_center_distance:new e.Uniform1f(t,i.u_camera_to_center_distance),u_extrude_scale:new e.Uniform2f(t,i.u_extrude_scale)}),collisionCircle:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_inv_matrix:new e.UniformMatrix4f(t,i.u_inv_matrix),u_camera_to_center_distance:new e.Uniform1f(t,i.u_camera_to_center_distance),u_viewport_size:new e.Uniform2f(t,i.u_viewport_size)}),debug:(t,i)=>({u_color:new e.UniformColor(t,i.u_color),u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_overlay:new e.Uniform1i(t,i.u_overlay),u_overlay_scale:new e.Uniform1f(t,i.u_overlay_scale)}),clippingMask:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix)}),heatmap:(t,i)=>({u_extrude_scale:new e.Uniform1f(t,i.u_extrude_scale),u_intensity:new e.Uniform1f(t,i.u_intensity),u_matrix:new e.UniformMatrix4f(t,i.u_matrix)}),heatmapTexture:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_world:new e.Uniform2f(t,i.u_world),u_image:new e.Uniform1i(t,i.u_image),u_color_ramp:new e.Uniform1i(t,i.u_color_ramp),u_opacity:new e.Uniform1f(t,i.u_opacity)}),hillshade:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_image:new e.Uniform1i(t,i.u_image),u_latrange:new e.Uniform2f(t,i.u_latrange),u_light:new e.Uniform2f(t,i.u_light),u_shadow:new e.UniformColor(t,i.u_shadow),u_highlight:new e.UniformColor(t,i.u_highlight),u_accent:new e.UniformColor(t,i.u_accent)}),hillshadePrepare:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_image:new e.Uniform1i(t,i.u_image),u_dimension:new e.Uniform2f(t,i.u_dimension),u_zoom:new e.Uniform1f(t,i.u_zoom),u_unpack:new e.Uniform4f(t,i.u_unpack)}),line:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_ratio:new e.Uniform1f(t,i.u_ratio),u_device_pixel_ratio:new e.Uniform1f(t,i.u_device_pixel_ratio),u_units_to_pixels:new e.Uniform2f(t,i.u_units_to_pixels)}),lineGradient:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_ratio:new e.Uniform1f(t,i.u_ratio),u_device_pixel_ratio:new e.Uniform1f(t,i.u_device_pixel_ratio),u_units_to_pixels:new e.Uniform2f(t,i.u_units_to_pixels),u_image:new e.Uniform1i(t,i.u_image),u_image_height:new e.Uniform1f(t,i.u_image_height)}),linePattern:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_texsize:new e.Uniform2f(t,i.u_texsize),u_ratio:new e.Uniform1f(t,i.u_ratio),u_device_pixel_ratio:new e.Uniform1f(t,i.u_device_pixel_ratio),u_image:new e.Uniform1i(t,i.u_image),u_units_to_pixels:new e.Uniform2f(t,i.u_units_to_pixels),u_scale:new e.Uniform3f(t,i.u_scale),u_fade:new e.Uniform1f(t,i.u_fade)}),lineSDF:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_ratio:new e.Uniform1f(t,i.u_ratio),u_device_pixel_ratio:new e.Uniform1f(t,i.u_device_pixel_ratio),u_units_to_pixels:new e.Uniform2f(t,i.u_units_to_pixels),u_patternscale_a:new e.Uniform2f(t,i.u_patternscale_a),u_patternscale_b:new e.Uniform2f(t,i.u_patternscale_b),u_sdfgamma:new e.Uniform1f(t,i.u_sdfgamma),u_image:new e.Uniform1i(t,i.u_image),u_tex_y_a:new e.Uniform1f(t,i.u_tex_y_a),u_tex_y_b:new e.Uniform1f(t,i.u_tex_y_b),u_mix:new e.Uniform1f(t,i.u_mix)}),raster:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_tl_parent:new e.Uniform2f(t,i.u_tl_parent),u_scale_parent:new e.Uniform1f(t,i.u_scale_parent),u_buffer_scale:new e.Uniform1f(t,i.u_buffer_scale),u_fade_t:new e.Uniform1f(t,i.u_fade_t),u_opacity:new e.Uniform1f(t,i.u_opacity),u_image0:new e.Uniform1i(t,i.u_image0),u_image1:new e.Uniform1i(t,i.u_image1),u_brightness_low:new e.Uniform1f(t,i.u_brightness_low),u_brightness_high:new e.Uniform1f(t,i.u_brightness_high),u_saturation_factor:new e.Uniform1f(t,i.u_saturation_factor),u_contrast_factor:new e.Uniform1f(t,i.u_contrast_factor),u_spin_weights:new e.Uniform3f(t,i.u_spin_weights)}),symbolIcon:(t,i)=>({u_is_size_zoom_constant:new e.Uniform1i(t,i.u_is_size_zoom_constant),u_is_size_feature_constant:new e.Uniform1i(t,i.u_is_size_feature_constant),u_size_t:new e.Uniform1f(t,i.u_size_t),u_size:new e.Uniform1f(t,i.u_size),u_camera_to_center_distance:new e.Uniform1f(t,i.u_camera_to_center_distance),u_pitch:new e.Uniform1f(t,i.u_pitch),u_rotate_symbol:new e.Uniform1i(t,i.u_rotate_symbol),u_aspect_ratio:new e.Uniform1f(t,i.u_aspect_ratio),u_fade_change:new e.Uniform1f(t,i.u_fade_change),u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_label_plane_matrix:new e.UniformMatrix4f(t,i.u_label_plane_matrix),u_coord_matrix:new e.UniformMatrix4f(t,i.u_coord_matrix),u_is_text:new e.Uniform1i(t,i.u_is_text),u_pitch_with_map:new e.Uniform1i(t,i.u_pitch_with_map),u_texsize:new e.Uniform2f(t,i.u_texsize),u_texture:new e.Uniform1i(t,i.u_texture)}),symbolSDF:(t,i)=>({u_is_size_zoom_constant:new e.Uniform1i(t,i.u_is_size_zoom_constant),u_is_size_feature_constant:new e.Uniform1i(t,i.u_is_size_feature_constant),u_size_t:new e.Uniform1f(t,i.u_size_t),u_size:new e.Uniform1f(t,i.u_size),u_camera_to_center_distance:new e.Uniform1f(t,i.u_camera_to_center_distance),u_pitch:new e.Uniform1f(t,i.u_pitch),u_rotate_symbol:new e.Uniform1i(t,i.u_rotate_symbol),u_aspect_ratio:new e.Uniform1f(t,i.u_aspect_ratio),u_fade_change:new e.Uniform1f(t,i.u_fade_change),u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_label_plane_matrix:new e.UniformMatrix4f(t,i.u_label_plane_matrix),u_coord_matrix:new e.UniformMatrix4f(t,i.u_coord_matrix),u_is_text:new e.Uniform1i(t,i.u_is_text),u_pitch_with_map:new e.Uniform1i(t,i.u_pitch_with_map),u_texsize:new e.Uniform2f(t,i.u_texsize),u_texture:new e.Uniform1i(t,i.u_texture),u_gamma_scale:new e.Uniform1f(t,i.u_gamma_scale),u_device_pixel_ratio:new e.Uniform1f(t,i.u_device_pixel_ratio),u_is_halo:new e.Uniform1i(t,i.u_is_halo)}),symbolTextAndIcon:(t,i)=>({u_is_size_zoom_constant:new e.Uniform1i(t,i.u_is_size_zoom_constant),u_is_size_feature_constant:new e.Uniform1i(t,i.u_is_size_feature_constant),u_size_t:new e.Uniform1f(t,i.u_size_t),u_size:new e.Uniform1f(t,i.u_size),u_camera_to_center_distance:new e.Uniform1f(t,i.u_camera_to_center_distance),u_pitch:new e.Uniform1f(t,i.u_pitch),u_rotate_symbol:new e.Uniform1i(t,i.u_rotate_symbol),u_aspect_ratio:new e.Uniform1f(t,i.u_aspect_ratio),u_fade_change:new e.Uniform1f(t,i.u_fade_change),u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_label_plane_matrix:new e.UniformMatrix4f(t,i.u_label_plane_matrix),u_coord_matrix:new e.UniformMatrix4f(t,i.u_coord_matrix),u_is_text:new e.Uniform1i(t,i.u_is_text),u_pitch_with_map:new e.Uniform1i(t,i.u_pitch_with_map),u_texsize:new e.Uniform2f(t,i.u_texsize),u_texsize_icon:new e.Uniform2f(t,i.u_texsize_icon),u_texture:new e.Uniform1i(t,i.u_texture),u_texture_icon:new e.Uniform1i(t,i.u_texture_icon),u_gamma_scale:new e.Uniform1f(t,i.u_gamma_scale),u_device_pixel_ratio:new e.Uniform1f(t,i.u_device_pixel_ratio),u_is_halo:new e.Uniform1i(t,i.u_is_halo)}),background:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_opacity:new e.Uniform1f(t,i.u_opacity),u_color:new e.UniformColor(t,i.u_color)}),backgroundPattern:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_opacity:new e.Uniform1f(t,i.u_opacity),u_image:new e.Uniform1i(t,i.u_image),u_pattern_tl_a:new e.Uniform2f(t,i.u_pattern_tl_a),u_pattern_br_a:new e.Uniform2f(t,i.u_pattern_br_a),u_pattern_tl_b:new e.Uniform2f(t,i.u_pattern_tl_b),u_pattern_br_b:new e.Uniform2f(t,i.u_pattern_br_b),u_texsize:new e.Uniform2f(t,i.u_texsize),u_mix:new e.Uniform1f(t,i.u_mix),u_pattern_size_a:new e.Uniform2f(t,i.u_pattern_size_a),u_pattern_size_b:new e.Uniform2f(t,i.u_pattern_size_b),u_scale_a:new e.Uniform1f(t,i.u_scale_a),u_scale_b:new e.Uniform1f(t,i.u_scale_b),u_pixel_coord_upper:new e.Uniform2f(t,i.u_pixel_coord_upper),u_pixel_coord_lower:new e.Uniform2f(t,i.u_pixel_coord_lower),u_tile_units_to_pixels:new e.Uniform1f(t,i.u_tile_units_to_pixels)}),terrainRaster:kt,terrainDepth:kt,skybox:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_sun_direction:new e.Uniform3f(t,i.u_sun_direction),u_cubemap:new e.Uniform1i(t,i.u_cubemap),u_opacity:new e.Uniform1f(t,i.u_opacity),u_temporal_offset:new e.Uniform1f(t,i.u_temporal_offset)}),skyboxGradient:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_color_ramp:new e.Uniform1i(t,i.u_color_ramp),u_center_direction:new e.Uniform3f(t,i.u_center_direction),u_radius:new e.Uniform1f(t,i.u_radius),u_opacity:new e.Uniform1f(t,i.u_opacity),u_temporal_offset:new e.Uniform1f(t,i.u_temporal_offset)}),skyboxCapture:(t,i)=>({u_matrix_3f:new e.UniformMatrix3f(t,i.u_matrix_3f),u_sun_direction:new e.Uniform3f(t,i.u_sun_direction),u_sun_intensity:new e.Uniform1f(t,i.u_sun_intensity),u_color_tint_r:new e.Uniform4f(t,i.u_color_tint_r),u_color_tint_m:new e.Uniform4f(t,i.u_color_tint_m),u_luminance:new e.Uniform1f(t,i.u_luminance)})};let xi;function bi(t,i,r,n,a,o,s){const l=t.context,c=l.gl,h=t.useProgram("collisionBox"),u=[];let d=0,p=0;for(let f=0;f<n.length;f++){const m=n[f],g=i.getTile(m),y=g.getBucket(r);if(!y)continue;let v=m.posMatrix;0===a[0]&&0===a[1]||(v=t.translatePosMatrix(m.posMatrix,g,a,o));const _=s?y.textCollisionBox:y.iconCollisionBox,x=y.collisionCircleArray;if(x.length>0){const i=e.create(),r=v;e.mul(i,y.placementInvProjMatrix,t.transform.glCoordMatrix),e.mul(i,i,y.placementViewportMatrix),u.push({circleArray:x,circleOffset:p,transform:r,invTransform:i}),d+=x.length/4,p=d}_&&(t.terrain&&t.terrain.setupElevationDraw(g,h),h.draw(l,c.LINES,e.DepthMode.disabled,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.disabled,ri(v,t.transform,g),r.id,_.layoutVertexBuffer,_.indexBuffer,_.segments,null,t.transform.zoom,null,_.collisionVertexBuffer,_.collisionVertexBufferExt))}if(!s||!u.length)return;const f=t.useProgram("collisionCircle"),m=new e.StructArrayLayout2f1f2i16;m.resize(4*d),m._trim();let g=0;for(const e of u)for(let t=0;t<e.circleArray.length/4;t++){const i=4*t,r=e.circleArray[i+0],n=e.circleArray[i+1],a=e.circleArray[i+2],o=e.circleArray[i+3];m.emplace(g++,r,n,a,o,0),m.emplace(g++,r,n,a,o,1),m.emplace(g++,r,n,a,o,2),m.emplace(g++,r,n,a,o,3)}(!xi||xi.length<2*d)&&(xi=function(t){const i=2*t,r=new e.StructArrayLayout3ui6;r.resize(i),r._trim();for(let e=0;e<i;e++){const t=6*e;r.uint16[t+0]=4*e+0,r.uint16[t+1]=4*e+1,r.uint16[t+2]=4*e+2,r.uint16[t+3]=4*e+2,r.uint16[t+4]=4*e+3,r.uint16[t+5]=4*e+0}return r}(d));const y=l.createIndexBuffer(xi,!0),v=l.createVertexBuffer(m,e.collisionCircleLayout.members,!0);for(const i of u){const n={u_matrix:i.transform,u_inv_matrix:i.invTransform,u_camera_to_center_distance:(_=t.transform).cameraToCenterDistance,u_viewport_size:[_.width,_.height]};f.draw(l,c.TRIANGLES,e.DepthMode.disabled,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.disabled,n,r.id,v,y,e.SegmentVector.simpleSegment(0,2*i.circleOffset,i.circleArray.length,i.circleArray.length/2),null,t.transform.zoom,null,null,null)}var _;v.destroy(),y.destroy()}const wi=e.identity(new Float32Array(16));function Mi(t,i,r,n,a,o){const{horizontalAlign:s,verticalAlign:l}=e.getAnchorAlignment(t),c=-(s-.5)*i,h=-(l-.5)*r,u=e.evaluateVariableOffset(t,n);return new e.Point((c/a+u[0])*o,(h/a+u[1])*o)}function Ti(t,i,r,n,a,o,s,l,c,h,u,d){const p=t.text.placedSymbolArray,f=t.text.dynamicLayoutVertexArray,m=t.icon.dynamicLayoutVertexArray,g={};f.clear();for(let m=0;m<p.length;m++){const y=p.get(m),v=t.allowVerticalPlacement&&!y.placedOrientation,_=y.hidden||!y.crossTileID||v?null:n[y.crossTileID];if(_){const n=new e.Point(y.anchorX,y.anchorY),p=d(n),m=ne(n,r?l:s,p),v=ae(o.cameraToCenterDistance,m.signedDistanceFromCamera);let x=a.evaluateSizeForFeature(t.textSizeData,h,y)*v/e.ONE_EM;r&&(x*=t.tilePixelRatio/c);const{width:b,height:w,anchor:M,textOffset:T,textBoxScale:S}=_,E=Mi(M,b,w,T,S,x),A=r?ne(n.add(E),s,p).point:m.point.add(i?E.rotate(-o.angle):E),C=t.allowVerticalPlacement&&y.placedOrientation===e.WritingMode.vertical?Math.PI/2:0;for(let t=0;t<y.numGlyphs;t++)e.addDynamicAttributes(f,A,C);u&&y.associatedIconIndex>=0&&(g[y.associatedIconIndex]={shiftedAnchor:A,angle:C})}else fe(y.numGlyphs,f)}if(u){m.clear();const i=t.icon.placedSymbolArray;for(let t=0;t<i.length;t++){const r=i.get(t);if(r.hidden)fe(r.numGlyphs,m);else{const i=g[t];if(i)for(let t=0;t<r.numGlyphs;t++)e.addDynamicAttributes(m,i.shiftedAnchor,i.angle);else fe(r.numGlyphs,m)}}t.icon.dynamicLayoutVertexBuffer.updateData(m)}t.text.dynamicLayoutVertexBuffer.updateData(f)}function Si(e,t,i){return i.iconsInText&&t?"symbolTextAndIcon":e?"symbolSDF":"symbolIcon"}function Ei(t,i,r,n,a,o,s,l,c,h,u,d){const p=t.context,f=p.gl,m=t.transform,g="map"===l,y="map"===c,v=g&&"point"!==r.layout.get("symbol-placement"),_=g&&!y&&!v,x=void 0!==r.layout.get("symbol-sort-key").constantOr(1);let b=!1;const w=t.depthModeForSublayer(0,e.DepthMode.ReadOnly),M=r.layout.get("text-variable-anchor"),T=[],E=t.terrain&&y?["PITCH_WITH_MAP_TERRAIN"]:null;for(const l of n){const n=i.getTile(l),c=n.getBucket(r);if(!c)continue;const u=a?c.text:c.icon;if(!u||!u.segments.get().length)continue;const d=u.programConfigurations.get(r.id),p=a||c.sdfIcons,w=a?c.textSizeData:c.iconSizeData,A=y||0!==m.pitch,C=t.useProgram(Si(p,a,c),d,E),L=e.evaluateSizeForZoom(w,m.zoom);let P,I,R,D,k=[0,0],z=null;if(a){if(I=n.glyphAtlasTexture,R=f.LINEAR,P=n.glyphAtlasTexture.size,c.iconsInText){k=n.imageAtlasTexture.size,z=n.imageAtlasTexture;const e="composite"===w.kind||"camera"===w.kind;D=A||t.options.rotating||t.options.zooming||e?f.LINEAR:f.NEAREST}}else{const e=1!==r.layout.get("icon-size").constantOr(0)||c.iconsNeedLinear;I=n.imageAtlasTexture,R=p||t.options.rotating||t.options.zooming||e||A?f.LINEAR:f.NEAREST,P=n.imageAtlasTexture.size}const O=S(n,1,t.transform.zoom),B=ie(l.posMatrix,y,g,t.transform,O),F=t.terrain&&y&&v?e.invert(new Float32Array(16),B):wi,N=re(l.posMatrix,y,g,t.transform,O),U=M&&c.hasTextData(),j="none"!==r.layout.get("icon-text-fit")&&U&&c.hasIconData();if(v){const e=m.elevation;se(c,l.posMatrix,t,a,B,N,y,h,e?t=>e.getAtTileOffset(l,t.x,t.y):null)}const V=t.translatePosMatrix(l.posMatrix,n,o,s),G=v||a&&M||j?wi:B,H=t.translatePosMatrix(N,n,o,s,!0),W=p&&0!==r.paint.get(a?"text-halo-width":"icon-halo-width").constantOr(1);let q;q=p?c.iconsInText?gi(w.kind,L,_,y,t,V,G,H,P,k):mi(w.kind,L,_,y,t,V,G,H,a,P,!0):fi(w.kind,L,_,y,t,V,G,H,a,P);const Z={program:C,buffers:u,uniformValues:q,atlasTexture:I,atlasTextureIcon:z,atlasInterpolation:R,atlasInterpolationIcon:D,isSDF:p,hasHalo:W,tile:n,labelPlaneMatrixInv:F};if(x&&c.canOverlap){b=!0;const t=u.segments.get();for(const i of t)T.push({segments:new e.SegmentVector([i]),sortKey:i.sortKey,state:Z})}else T.push({segments:u.segments,sortKey:0,state:Z})}b&&T.sort(((e,t)=>e.sortKey-t.sortKey));for(const e of T){const i=e.state;if(t.terrain&&t.terrain.setupElevationDraw(i.tile,i.program,{useDepthForOcclusion:!0,labelPlaneMatrixInv:i.labelPlaneMatrixInv}),p.activeTexture.set(f.TEXTURE0),i.atlasTexture.bind(i.atlasInterpolation,f.CLAMP_TO_EDGE),i.atlasTextureIcon&&(p.activeTexture.set(f.TEXTURE1),i.atlasTextureIcon&&i.atlasTextureIcon.bind(i.atlasInterpolationIcon,f.CLAMP_TO_EDGE)),i.isSDF){const n=i.uniformValues;i.hasHalo&&(n.u_is_halo=1,Ai(i.buffers,e.segments,r,t,i.program,w,u,d,n)),n.u_is_halo=0}Ai(i.buffers,e.segments,r,t,i.program,w,u,d,i.uniformValues)}}function Ai(t,i,r,n,a,o,s,l,c){const h=n.context;a.draw(h,h.gl.TRIANGLES,o,s,l,e.CullFaceMode.disabled,c,r.id,t.layoutVertexBuffer,t.indexBuffer,i,r.paint,n.transform.zoom,t.programConfigurations.get(r.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer)}function Ci(t,i,r,n,a,o,s){const l=t.context.gl,c=r.paint.get("fill-pattern"),h=c&&c.constantOr(1),u=r.getCrossfadeParameters();let d,p,f,m,g;s?(p=h&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",d=l.LINES):(p=h?"fillPattern":"fill",d=l.TRIANGLES);for(const y of n){const n=i.getTile(y);if(h&&!n.patternsLoaded())continue;const v=n.getBucket(r);if(!v)continue;t.prepareDrawTile(y);const _=v.programConfigurations.get(r.id),x=t.useProgram(p,_);h&&(t.context.activeTexture.set(l.TEXTURE0),n.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),_.updatePaintBuffers(u));const b=c.constantOr(null);if(b&&n.imageAtlas){const e=n.imageAtlas,t=e.patternPositions[b.to.toString()],i=e.patternPositions[b.from.toString()];t&&i&&_.setConstantPatternPositions(t,i)}const w=t.translatePosMatrix(y.posMatrix,n,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"));if(s){m=v.indexBuffer2,g=v.segments2;const e=t.terrain&&t.terrain.renderingToTexture?t.terrain.drapeBufferSize:[l.drawingBufferWidth,l.drawingBufferHeight];f="fillOutlinePattern"===p&&h?ei(w,t,u,n,e):Qt(w,e)}else m=v.indexBuffer,g=v.segments,f=h?Kt(w,t,u,n):Jt(w);x.draw(t.context,d,a,t.stencilModeForClipping(y),o,e.CullFaceMode.disabled,f,r.id,v.layoutVertexBuffer,m,g,r.paint,t.transform.zoom,_)}}function Li(t,i,r,n,a,o,s){const l=t.context,c=l.gl,h=r.paint.get("fill-extrusion-pattern"),u=h.constantOr(1),d=r.getCrossfadeParameters(),p=r.paint.get("fill-extrusion-opacity");for(const f of n){const n=i.getTile(f),m=n.getBucket(r);if(!m)continue;const g=m.programConfigurations.get(r.id),y=t.useProgram(u?"fillExtrusionPattern":"fillExtrusion",g);if(t.terrain){const e=t.terrain;if(!m.enableTerrain)continue;if(e.setupElevationDraw(n,y,{useMeterToDem:!0}),Pi(l,i,f,m,r,e),!m.centroidVertexBuffer){const e=y.attributes.a_centroid_pos;void 0!==e&&c.vertexAttrib2f(e,0,0)}}u&&(t.context.activeTexture.set(c.TEXTURE0),n.imageAtlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),g.updatePaintBuffers(d));const v=h.constantOr(null);if(v&&n.imageAtlas){const e=n.imageAtlas,t=e.patternPositions[v.to.toString()],i=e.patternPositions[v.from.toString()];t&&i&&g.setConstantPatternPositions(t,i)}const _=t.translatePosMatrix(f.posMatrix,n,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),x=r.paint.get("fill-extrusion-vertical-gradient"),b=u?Yt(_,t,x,p,f,d,n):$t(_,t,x,p);y.draw(l,l.gl.TRIANGLES,a,o,s,e.CullFaceMode.backCCW,b,r.id,m.layoutVertexBuffer,m.indexBuffer,m.segments,r.paint,t.transform.zoom,g,t.terrain?m.centroidVertexBuffer:null)}}function Pi(t,i,r,n,a,o){const s=[t=>{let i=t.canonical.x-1,r=t.wrap;return i<0&&(i=(1<<t.canonical.z)-1,r--),new e.OverscaledTileID(t.overscaledZ,r,t.canonical.z,i,t.canonical.y)},t=>{let i=t.canonical.x+1,r=t.wrap;return i===1<<t.canonical.z&&(i=0,r++),new e.OverscaledTileID(t.overscaledZ,r,t.canonical.z,i,t.canonical.y)},t=>new e.OverscaledTileID(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(0===t.canonical.y?1<<t.canonical.z:t.canonical.y)-1),t=>new e.OverscaledTileID(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)],l=e=>{const t=i.getSource().maxzoom;for(const r of[0,-1,1]){if(e.overscaledZ+r<t)continue;if(r>0&&e.overscaledZ<t)continue;const n=i.getTileByID(e.calculateScaledKey(e.overscaledZ+r));if(n&&n.hasData()){const e=n.getBucket(a);if(e)return e}}},c=[0,0,0],h=(t,i)=>(c[0]=Math.min(t.min.y,i.min.y),c[1]=Math.max(t.max.y,i.max.y),c[2]=e.EXTENT-i.min.x>t.max.x?i.min.x-e.EXTENT:t.max.x,c),u=(t,i)=>(c[0]=Math.min(t.min.x,i.min.x),c[1]=Math.max(t.max.x,i.max.x),c[2]=e.EXTENT-i.min.y>t.max.y?i.min.y-e.EXTENT:t.max.y,c),d=[(e,t)=>h(e,t),(e,t)=>h(t,e),(e,t)=>u(e,t),(e,t)=>u(t,e)],p=new e.Point(0,0);let f,m,g;const y=(t,i,n,a,s)=>{const l=[[a?n:t,a?t:n,0],[a?n:i,a?i:n,0]],c=s<0?e.EXTENT+s:s,h=[a?c:(t+i)/2,a?(t+i)/2:c,0];return 0===n&&s<0||0!==n&&s>0?o.getForTilePoints(g,[h],!0,m):l.push(h),o.getForTilePoints(r,l,!0,f),Math.max(l[0][2],l[1][2],h[2])/o.exaggeration()};for(let t=0;t<4;t++){const i=n.borders[t];if(0===i.length&&(n.borderDone[t]=!0),n.borderDone[t])continue;const a=g=s[t](r),c=l(a);if(!c||!c.enableTerrain)continue;if(m=o.findDEMTileFor(a),!m||!m.dem)continue;if(!f){const e=o.findDEMTileFor(r);if(!e||!e.dem)return;f=e}const h=(t<2?1:5)-t,u=c.borders[h];let v=0;for(let r=0;r<i.length;r++){const a=n.featuresOnBorder[i[r]],o=a.borders[t];let s;for(;v<u.length&&(s=c.featuresOnBorder[u[v]],!(s.borders[h][1]>o[0]+3));)c.borderDone[h]||c.encodeCentroid(void 0,s,!1),v++;if(s&&v<u.length){const i=v;let r=0;for(;!(s.borders[h][0]>o[1]-3)&&(r++,++v!==u.length);)s=c.featuresOnBorder[u[v]];if(s=c.featuresOnBorder[u[i]],a.intersectsCount()>1||s.intersectsCount()>1||1!==r){1!==r&&(v=i),n.encodeCentroid(void 0,a,!1),c.borderDone[h]||c.encodeCentroid(void 0,s,!1);continue}const l=d[t](a,s),f=t%2?e.EXTENT-1:0;p.x=y(l[0],Math.min(e.EXTENT-1,l[1]),f,t<2,l[2]),p.y=0,n.encodeCentroid(p,a,!1),c.borderDone[h]||c.encodeCentroid(p,s,!1)}else n.encodeCentroid(void 0,a,!1)}n.borderDone[t]=n.needsCentroidUpdate=!0,c.borderDone[h]||(c.borderDone[h]=c.needsCentroidUpdate=!0)}(n.needsCentroidUpdate||!n.centroidVertexBuffer&&0!==n.centroidVertexArray.length)&&n.uploadCentroid(t)}const Ii=new e.Color(1,0,0,1),Ri=new e.Color(0,1,0,1),Di=new e.Color(0,0,1,1),ki=new e.Color(1,0,1,1),zi=new e.Color(0,1,1,1);function Oi(e,t,i,r){Fi(e,0,t+i/2,e.transform.width,i,r)}function Bi(e,t,i,r){Fi(e,t-i/2,0,i,e.transform.height,r)}function Fi(t,i,r,n,a,o){const s=t.context,l=s.gl;l.enable(l.SCISSOR_TEST),l.scissor(i*e.browser.devicePixelRatio,r*e.browser.devicePixelRatio,n*e.browser.devicePixelRatio,a*e.browser.devicePixelRatio),s.clear({color:o}),l.disable(l.SCISSOR_TEST)}function Ni(t,i,r){const n=t.context,a=n.gl,o=r.posMatrix,s=t.useProgram("debug"),l=i.getTileByID(r.key);t.terrain&&t.terrain.setupElevationDraw(l,s);const c=e.DepthMode.disabled,h=e.StencilMode.disabled,u=t.colorModeForRenderPass();n.activeTexture.set(a.TEXTURE0),t.emptyTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),s.draw(n,a.LINE_STRIP,c,h,u,e.CullFaceMode.disabled,ni(o,e.Color.red),"$debug",t.debugBuffer,t.tileBorderIndexBuffer,t.debugSegments);const d=l.latestRawTileData,p=Math.floor((d&&d.byteLength||0)/1024),f=i.getTile(r).tileSize,m=512/Math.min(f,512)*(r.overscaledZ/t.transform.zoom)*.5;let g=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(g+=` => ${r.overscaledZ}`),function(e,t){e.initDebugOverlayCanvas();const i=e.debugOverlayCanvas,r=e.context.gl,n=e.debugOverlayCanvas.getContext("2d");n.clearRect(0,0,i.width,i.height),n.shadowColor="white",n.shadowBlur=2,n.lineWidth=1.5,n.strokeStyle="white",n.textBaseline="top",n.font="bold 36px Open Sans, sans-serif",n.fillText(t,5,5),n.strokeText(t,5,5),e.debugOverlayTexture.update(i),e.debugOverlayTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}(t,`${g} ${p}kb`),s.draw(n,a.TRIANGLES,c,h,e.ColorMode.alphaBlended,e.CullFaceMode.disabled,ni(o,e.Color.transparent,m),"$debug",t.debugBuffer,t.quadTriangleIndexBuffer,t.debugSegments)}const Ui=e.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ji}=Ui;function Vi(e,t,i,r){e.emplaceBack(t,i,r)}class Gi{constructor(t){this.vertexArray=new e.StructArrayLayout3f12,this.indices=new e.StructArrayLayout3ui6,Vi(this.vertexArray,-1,-1,1),Vi(this.vertexArray,1,-1,1),Vi(this.vertexArray,-1,1,1),Vi(this.vertexArray,1,1,1),Vi(this.vertexArray,-1,-1,-1),Vi(this.vertexArray,1,-1,-1),Vi(this.vertexArray,-1,1,-1),Vi(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,ji),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=e.SegmentVector.simpleSegment(0,0,36,12)}}function Hi(t,i,r,n,a,o){const s=t.gl,l=i.paint.get("sky-atmosphere-color"),c=i.paint.get("sky-atmosphere-halo-color"),h=i.paint.get("sky-atmosphere-sun-intensity"),u=((e,t,i,r,n)=>({u_matrix_3f:e,u_sun_direction:t,u_sun_intensity:i,u_color_tint_r:[r.r,r.g,r.b,r.a],u_color_tint_m:[n.r,n.g,n.b,n.a],u_luminance:5e-5}))(e.fromMat4([],n),a,h,l,c);s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+o,i.skyboxTexture,0),r.draw(t,s.TRIANGLES,e.DepthMode.disabled,e.StencilMode.disabled,e.ColorMode.unblended,e.CullFaceMode.frontCW,u,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const Wi={symbol:function(t,i,r,n,a){if("translucent"!==t.renderPass)return;const o=e.StencilMode.disabled,s=t.colorModeForRenderPass();r.layout.get("text-variable-anchor")&&function(t,i,r,n,a,o,s){const l=i.transform,c="map"===a,h="map"===o;for(const a of t){const t=n.getTile(a),o=t.getBucket(r);if(!o||!o.text||!o.text.segments.get().length)continue;const u=e.evaluateSizeForZoom(o.textSizeData,l.zoom),d=S(t,1,i.transform.zoom),p=ie(a.posMatrix,h,c,i.transform,d),f="none"!==r.layout.get("icon-text-fit")&&o.hasIconData();if(u){const i=Math.pow(2,l.zoom-t.tileID.overscaledZ),r=l.elevation;Ti(o,c,h,s,e.symbolSize,l,p,a.posMatrix,i,u,f,r?e=>r.getAtTileOffset(a,e.x,e.y):e=>0)}}}(n,t,r,i,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),a),0!==r.paint.get("icon-opacity").constantOr(1)&&Ei(t,i,r,n,!1,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),r.layout.get("icon-rotation-alignment"),r.layout.get("icon-pitch-alignment"),r.layout.get("icon-keep-upright"),o,s),0!==r.paint.get("text-opacity").constantOr(1)&&Ei(t,i,r,n,!0,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.layout.get("text-keep-upright"),o,s),i.map.showCollisionBoxes&&(bi(t,i,r,n,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),bi(t,i,r,n,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))},circle:function(t,i,r,n){if("translucent"!==t.renderPass)return;const a=r.paint.get("circle-opacity"),o=r.paint.get("circle-stroke-width"),s=r.paint.get("circle-stroke-opacity"),l=void 0!==r.layout.get("circle-sort-key").constantOr(1);if(0===a.constantOr(1)&&(0===o.constantOr(1)||0===s.constantOr(1)))return;const c=t.context,h=c.gl,u=t.depthModeForSublayer(0,e.DepthMode.ReadOnly),d=e.StencilMode.disabled,p=t.colorModeForRenderPass(),f=[];for(let a=0;a<n.length;a++){const o=n[a],s=i.getTile(o),c=s.getBucket(r);if(!c)continue;const h=c.programConfigurations.get(r.id),u=ii(r),d={programConfiguration:h,program:t.useProgram("circle",h,u),layoutVertexBuffer:c.layoutVertexBuffer,indexBuffer:c.indexBuffer,uniformValues:ti(t,o,s,r),tile:s};if(l){const t=c.segments.get();for(const i of t)f.push({segments:new e.SegmentVector([i]),sortKey:i.sortKey,state:d})}else f.push({segments:c.segments,sortKey:0,state:d})}l&&f.sort(((e,t)=>e.sortKey-t.sortKey));for(const i of f){const{programConfiguration:n,program:a,layoutVertexBuffer:o,indexBuffer:s,uniformValues:l,tile:f}=i.state,m=i.segments;t.terrain&&t.terrain.setupElevationDraw(f,a,{useDepthForOcclusion:!0}),a.draw(c,h.TRIANGLES,u,d,p,e.CullFaceMode.disabled,l,r.id,o,s,m,r.paint,t.transform.zoom,n)}},heatmap:function(t,i,r,n){if(0!==r.paint.get("heatmap-opacity"))if("offscreen"===t.renderPass){const a=t.context,o=a.gl,s=e.StencilMode.disabled,l=new e.ColorMode([o.ONE,o.ONE],e.Color.transparent,[!0,!0,!0,!0]);!function(e,t,i){const r=e.gl;e.activeTexture.set(r.TEXTURE1),e.viewport.set([0,0,t.width/4,t.height/4]);let n=i.heatmapFbo;if(n)r.bindTexture(r.TEXTURE_2D,n.colorAttachment.get()),e.bindFramebuffer.set(n.framebuffer);else{const a=r.createTexture();r.bindTexture(r.TEXTURE_2D,a),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),n=i.heatmapFbo=e.createFramebuffer(t.width/4,t.height/4,!1),function(e,t,i,r){const n=e.gl;n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t.width/4,t.height/4,0,n.RGBA,e.extRenderToTextureHalfFloat?e.extTextureHalfFloat.HALF_FLOAT_OES:n.UNSIGNED_BYTE,null),r.colorAttachment.set(i)}(e,t,a,n)}}(a,t,r),a.clear({color:e.Color.transparent});for(let c=0;c<n.length;c++){const h=n[c];if(i.hasRenderableParent(h))continue;const u=i.getTile(h),d=u.getBucket(r);if(!d)continue;const p=d.programConfigurations.get(r.id),f=t.useProgram("heatmap",p),{zoom:m}=t.transform;t.terrain&&t.terrain.setupElevationDraw(u,f),f.draw(a,o.TRIANGLES,e.DepthMode.disabled,s,l,e.CullFaceMode.disabled,ai(h.posMatrix,u,m,r.paint.get("heatmap-intensity")),r.id,d.layoutVertexBuffer,d.indexBuffer,d.segments,r.paint,t.transform.zoom,p)}a.viewport.set([0,0,t.width,t.height])}else"translucent"===t.renderPass&&(t.context.setColorMode(t.colorModeForRenderPass()),function(t,i){const r=t.context,n=r.gl,a=i.heatmapFbo;if(!a)return;r.activeTexture.set(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,a.colorAttachment.get()),r.activeTexture.set(n.TEXTURE1);let o=i.colorRampTexture;o||(o=i.colorRampTexture=new e.Texture(r,i.colorRamp,n.RGBA)),o.bind(n.LINEAR,n.CLAMP_TO_EDGE),t.useProgram("heatmapTexture").draw(r,n.TRIANGLES,e.DepthMode.disabled,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.disabled,((t,i,r,n)=>{const a=e.create();e.ortho(a,0,t.width,t.height,0,0,1);const o=t.context.gl;return{u_matrix:a,u_world:[o.drawingBufferWidth,o.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:i.paint.get("heatmap-opacity")}})(t,i),i.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments,i.paint,t.transform.zoom)}(t,r))},line:function(t,i,r,n){if("translucent"!==t.renderPass)return;const a=r.paint.get("line-opacity"),o=r.paint.get("line-width");if(0===a.constantOr(1)||0===o.constantOr(1))return;const s=t.depthModeForSublayer(0,e.DepthMode.ReadOnly),l=t.colorModeForRenderPass(),c=r.paint.get("line-dasharray"),h=r.paint.get("line-pattern"),u=h.constantOr(1),d=r.paint.get("line-gradient"),p=r.getCrossfadeParameters(),f=u?"linePattern":c?"lineSDF":d?"lineGradient":"line",m=t.context,g=m.gl;let y=!0;for(const a of n){const n=i.getTile(a);if(u&&!n.patternsLoaded())continue;const o=n.getBucket(r);if(!o)continue;t.prepareDrawTile(a);const v=o.programConfigurations.get(r.id),_=t.context.program.get(),x=t.useProgram(f,v),b=y||x.program!==_,w=h.constantOr(null);if(w&&n.imageAtlas){const e=n.imageAtlas,t=e.patternPositions[w.to.toString()],i=e.patternPositions[w.from.toString()];t&&i&&v.setConstantPatternPositions(t,i)}const M=t.terrain?a.posMatrix:null,T=u?li(t,n,r,p,M):c?ci(t,n,r,c,p,M):d?si(t,n,r,M,o.lineClipsArray.length):oi(t,n,r,M);if(u)m.activeTexture.set(g.TEXTURE0),n.imageAtlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),v.updatePaintBuffers(p);else if(c&&(b||t.lineAtlas.dirty))m.activeTexture.set(g.TEXTURE0),t.lineAtlas.bind(m);else if(d){const n=o.gradients[r.id];let s=n.texture;if(r.gradientVersion!==n.version){let l=256;if(r.stepInterpolant){const r=i.getSource().maxzoom,n=a.canonical.z===r?Math.ceil(1<<t.transform.maxZoom-a.canonical.z):1;l=e.clamp(e.nextPowerOfTwo(o.maxLineLength/e.EXTENT*1024*n),256,m.maxTextureSize)}n.gradient=e.renderColorRamp({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:l,image:n.gradient||void 0,clips:o.lineClipsArray}),n.texture?n.texture.update(n.gradient):n.texture=new e.Texture(m,n.gradient,g.RGBA),n.version=r.gradientVersion,s=n.texture}m.activeTexture.set(g.TEXTURE0),s.bind(r.stepInterpolant?g.NEAREST:g.LINEAR,g.CLAMP_TO_EDGE)}x.draw(m,g.TRIANGLES,s,t.stencilModeForClipping(a),l,e.CullFaceMode.disabled,T,r.id,o.layoutVertexBuffer,o.indexBuffer,o.segments,r.paint,t.transform.zoom,v,o.layoutVertexBuffer2),y=!1}},fill:function(t,i,r,n){const a=r.paint.get("fill-color"),o=r.paint.get("fill-opacity");if(0===o.constantOr(1))return;const s=t.colorModeForRenderPass(),l=r.paint.get("fill-pattern"),c=t.opaquePassEnabledForLayer()&&!l.constantOr(1)&&1===a.constantOr(e.Color.transparent).a&&1===o.constantOr(0)?"opaque":"translucent";if(t.renderPass===c){const a=t.depthModeForSublayer(1,"opaque"===t.renderPass?e.DepthMode.ReadWrite:e.DepthMode.ReadOnly);Ci(t,i,r,n,a,s,!1)}if("translucent"===t.renderPass&&r.paint.get("fill-antialias")){const a=t.depthModeForSublayer(r.getPaintProperty("fill-outline-color")?2:0,e.DepthMode.ReadOnly);Ci(t,i,r,n,a,s,!0)}},"fill-extrusion":function(t,i,r,n){const a=r.paint.get("fill-extrusion-opacity");if(0!==a&&"translucent"===t.renderPass){const o=new e.DepthMode(t.context.gl.LEQUAL,e.DepthMode.ReadWrite,t.depthRangeFor3D);if(1!==a||r.paint.get("fill-extrusion-pattern").constantOr(1))Li(t,i,r,n,o,e.StencilMode.disabled,e.ColorMode.disabled),Li(t,i,r,n,o,t.stencilModeFor3D(),t.colorModeForRenderPass());else{const a=t.colorModeForRenderPass();Li(t,i,r,n,o,e.StencilMode.disabled,a)}}},hillshade:function(t,i,r,n){if("offscreen"!==t.renderPass&&"translucent"!==t.renderPass)return;const a=t.context,o=t.depthModeForSublayer(0,e.DepthMode.ReadOnly),s=t.colorModeForRenderPass(),l=t.terrain&&t.terrain.renderingToTexture,[c,h]="translucent"!==t.renderPass||l?[{},n]:t.stencilConfigForOverlap(n);for(const n of h){const a=i.getTile(n);if(a.needsHillshadePrepare&&"offscreen"===t.renderPass)Dt(t,a,r,o,e.StencilMode.disabled,s);else if("translucent"===t.renderPass){const e=l&&t.terrain?t.terrain.stencilModeForRTTOverlap(n):c[n.overscaledZ];It(t,n,a,r,o,e,s)}}a.viewport.set([0,0,t.width,t.height])},raster:function(t,i,r,n,a,o){if("translucent"!==t.renderPass)return;if(0===r.paint.get("raster-opacity"))return;if(!n.length)return;const s=t.context,l=s.gl,c=i.getSource(),h=t.useProgram("raster"),u=t.colorModeForRenderPass(),d=t.terrain&&t.terrain.renderingToTexture,[p,f]=c instanceof R||d?[{},n]:t.stencilConfigForOverlap(n),m=f[f.length-1].overscaledZ,g=!t.options.moving;for(const n of f){const a=d?e.DepthMode.disabled:t.depthModeForSublayer(n.overscaledZ-m,1===r.paint.get("raster-opacity")?e.DepthMode.ReadWrite:e.DepthMode.ReadOnly,l.LESS),f=i.getTile(n);if(d&&(!f||!f.hasData()))continue;const y=d?n.posMatrix:t.transform.calculatePosMatrix(n.toUnwrapped(),g),v=t.terrain&&d?t.terrain.stencilModeForRTTOverlap(n):p[n.overscaledZ],_=o?0:r.paint.get("raster-fade-duration");f.registerFadeDuration(_);const x=i.findLoadedParent(n,0),b=jt(f,x,i,t.transform,_);let w,M;t.terrain&&t.terrain.prepareDrawTile(n);const T="nearest"===r.paint.get("raster-resampling")?l.NEAREST:l.LINEAR;s.activeTexture.set(l.TEXTURE0),f.texture.bind(T,l.CLAMP_TO_EDGE,l.LINEAR_MIPMAP_NEAREST),s.activeTexture.set(l.TEXTURE1),x?(x.texture.bind(T,l.CLAMP_TO_EDGE,l.LINEAR_MIPMAP_NEAREST),w=Math.pow(2,x.tileID.overscaledZ-f.tileID.overscaledZ),M=[f.tileID.canonical.x*w%1,f.tileID.canonical.y*w%1]):f.texture.bind(T,l.CLAMP_TO_EDGE,l.LINEAR_MIPMAP_NEAREST);const S=di(y,M||[0,0],w||1,b,r);c instanceof R?h.draw(s,l.TRIANGLES,a,e.StencilMode.disabled,u,e.CullFaceMode.disabled,S,r.id,c.boundsBuffer,t.quadTriangleIndexBuffer,c.boundsSegments):h.draw(s,l.TRIANGLES,a,v,u,e.CullFaceMode.disabled,S,r.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}},background:function(t,i,r,n){const a=r.paint.get("background-color"),o=r.paint.get("background-opacity");if(0===o)return;const s=t.context,l=s.gl,c=t.transform,h=c.tileSize,u=r.paint.get("background-pattern");if(t.isPatternMissing(u))return;const d=!u&&1===a.a&&1===o&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass!==d)return;const p=e.StencilMode.disabled,f=t.depthModeForSublayer(0,"opaque"===d?e.DepthMode.ReadWrite:e.DepthMode.ReadOnly),m=t.colorModeForRenderPass(),g=t.useProgram(u?"backgroundPattern":"background"),y=n||c.coveringTiles({tileSize:h});u&&(s.activeTexture.set(l.TEXTURE0),t.imageManager.bind(t.context));const v=r.getCrossfadeParameters();for(const i of y){const c=n?i.posMatrix:t.transform.calculatePosMatrix(i.toUnwrapped());t.prepareDrawTile(i);const d=u?vi(c,o,t,u,{tileID:i,tileSize:h},v):yi(c,o,a);g.draw(s,l.TRIANGLES,f,p,m,e.CullFaceMode.disabled,d,r.id,t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments)}},sky:function(t,i,r){const n=r.paint.get("sky-opacity");if(0===n)return;const a=t.context,o=r.paint.get("sky-type"),s=new e.DepthMode(a.gl.LEQUAL,e.DepthMode.ReadOnly,[0,1]),l=t.frameCounter/1e3%1;"atmosphere"===o?"offscreen"===t.renderPass?r.needsSkyboxCapture(t)&&(function(t,i,r,n){const a=t.context,o=a.gl;let s=i.skyboxFbo;if(!s){s=i.skyboxFbo=a.createFramebuffer(32,32,!1),i.skyboxGeometry=new Gi(a),i.skyboxTexture=a.gl.createTexture(),o.bindTexture(o.TEXTURE_CUBE_MAP,i.skyboxTexture),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MAG_FILTER,o.LINEAR);for(let e=0;e<6;++e)o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,o.RGBA,32,32,0,o.RGBA,o.UNSIGNED_BYTE,null)}a.bindFramebuffer.set(s.framebuffer),a.viewport.set([0,0,32,32]);const l=i.getCenter(t,!0),c=t.useProgram("skyboxCapture"),h=new Float64Array(16);e.identity(h),e.rotateY(h,h,.5*-Math.PI),Hi(a,i,c,h,l,0),e.identity(h),e.rotateY(h,h,.5*Math.PI),Hi(a,i,c,h,l,1),e.identity(h),e.rotateX(h,h,.5*-Math.PI),Hi(a,i,c,h,l,2),e.identity(h),e.rotateX(h,h,.5*Math.PI),Hi(a,i,c,h,l,3),e.identity(h),Hi(a,i,c,h,l,4),e.identity(h),e.rotateY(h,h,Math.PI),Hi(a,i,c,h,l,5),a.viewport.set([0,0,t.width,t.height])}(t,r),r.markSkyboxValid(t)):"sky"===t.renderPass&&function(t,i,r,n,a){const o=t.context,s=o.gl,l=t.transform,c=t.useProgram("skybox");o.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_CUBE_MAP,i.skyboxTexture);const h=((e,t,i,r,n)=>({u_matrix:e,u_sun_direction:t,u_cubemap:0,u_opacity:r,u_temporal_offset:n}))(l.skyboxMatrix,i.getCenter(t,!1),0,n,a);c.draw(o,s.TRIANGLES,r,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.backCW,h,"skybox",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}(t,r,s,n,l):"gradient"===o&&"sky"===t.renderPass&&function(t,i,r,n,a){const o=t.context,s=o.gl,l=t.transform,c=t.useProgram("skyboxGradient");i.skyboxGeometry||(i.skyboxGeometry=new Gi(o)),o.activeTexture.set(s.TEXTURE0);let h=i.colorRampTexture;h||(h=i.colorRampTexture=new e.Texture(o,i.colorRamp,s.RGBA)),h.bind(s.LINEAR,s.CLAMP_TO_EDGE);const u=((t,i,r,n,a)=>({u_matrix:t,u_color_ramp:0,u_center_direction:i,u_radius:e.degToRad(r),u_opacity:n,u_temporal_offset:a}))(l.skyboxMatrix,i.getCenter(t,!1),i.paint.get("sky-gradient-radius"),n,a);c.draw(o,s.TRIANGLES,r,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.backCW,u,"skyboxGradient",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}(t,r,s,n,l)},debug:function(e,t,i){for(let r=0;r<i.length;r++)Ni(e,t,i[r])},custom:function(t,i,r){const n=t.context,a=r.implementation;if("offscreen"===t.renderPass){const e=a.prerender;e&&(t.setCustomLayerDefaults(),n.setColorMode(t.colorModeForRenderPass()),e.call(a,n.gl,t.transform.customLayerMatrix()),n.setDirty(),t.setBaseState())}else if("translucent"===t.renderPass){t.setCustomLayerDefaults(),n.setColorMode(t.colorModeForRenderPass()),n.setStencilMode(e.StencilMode.disabled);const i="3d"===a.renderingMode?new e.DepthMode(t.context.gl.LEQUAL,e.DepthMode.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,e.DepthMode.ReadOnly);n.setDepthMode(i),a.render(n.gl,t.transform.customLayerMatrix()),n.setDirty(),t.setBaseState(),n.bindFramebuffer.set(null)}}};class qi{constructor(t,i){this.context=new e.Context(t),this.transform=i,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=e.SourceCache.maxUnderzooming+e.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ve,this.gpuTimers={},this.frameCounter=0}updateTerrain(e,t){const i=!!e&&!!e.terrain;if(!(i||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Wt(this,e));const r=this._terrain;this.transform.elevation=i?r:null,r.update(e,this.transform,t)}get terrain(){return this._terrain&&this._terrain.enabled?this._terrain:null}resize(t,i){if(this.width=t*e.browser.devicePixelRatio,this.height=i*e.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const e of this.style._order)this.style._layers[e].resize()}setup(){const t=this.context,i=new e.StructArrayLayout2i4;i.emplaceBack(0,0),i.emplaceBack(e.EXTENT,0),i.emplaceBack(0,e.EXTENT),i.emplaceBack(e.EXTENT,e.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(i,e.posAttributes.members),this.tileExtentSegments=e.SegmentVector.simpleSegment(0,0,4,2);const r=new e.StructArrayLayout2i4;r.emplaceBack(0,0),r.emplaceBack(e.EXTENT,0),r.emplaceBack(0,e.EXTENT),r.emplaceBack(e.EXTENT,e.EXTENT),this.debugBuffer=t.createVertexBuffer(r,e.posAttributes.members),this.debugSegments=e.SegmentVector.simpleSegment(0,0,4,5);const n=new e.StructArrayLayout4i8;n.emplaceBack(0,0,0,0),n.emplaceBack(e.EXTENT,0,e.EXTENT,0),n.emplaceBack(0,e.EXTENT,0,e.EXTENT),n.emplaceBack(e.EXTENT,e.EXTENT,e.EXTENT,e.EXTENT),this.rasterBoundsBuffer=t.createVertexBuffer(n,I.members),this.rasterBoundsSegments=e.SegmentVector.simpleSegment(0,0,4,2);const a=new e.StructArrayLayout2i4;a.emplaceBack(0,0),a.emplaceBack(1,0),a.emplaceBack(0,1),a.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(a,e.posAttributes.members),this.viewportSegments=e.SegmentVector.simpleSegment(0,0,4,2);const o=new e.StructArrayLayout1ui2;o.emplaceBack(0),o.emplaceBack(1),o.emplaceBack(3),o.emplaceBack(2),o.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(o);const s=new e.StructArrayLayout3ui6;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(s),this.emptyTexture=new e.Texture(t,{width:1,height:1,data:new Uint8Array([0,0,0,0])},t.gl.RGBA);const l=this.context.gl;this.stencilClearMode=new e.StencilMode({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO),this.loadTimeStamps.push(e.window.performance.now())}clearStencil(){const t=this.context,i=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const r=e.create();e.ortho(r,0,this.width,this.height,0,0,1),e.scale(r,r,[i.drawingBufferWidth,i.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,i.TRIANGLES,e.DepthMode.disabled,this.stencilClearMode,e.ColorMode.disabled,e.CullFaceMode.disabled,Ut(r),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,i,r){if(!(i&&this.currentStencilSource!==i.id&&t.isTileClipped()&&r&&r.length))return;this.currentStencilSource=i.id;const n=this.context,a=n.gl;this.nextStencilID+r.length>256&&this.clearStencil(),n.setColorMode(e.ColorMode.disabled),n.setDepthMode(e.DepthMode.disabled);const o=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const t of r){const i=this._tileClippingMaskIDs[t.key]=this.nextStencilID++;o.draw(n,a.TRIANGLES,e.DepthMode.disabled,new e.StencilMode({func:a.ALWAYS,mask:0},i,255,a.KEEP,a.KEEP,a.REPLACE),e.ColorMode.disabled,e.CullFaceMode.disabled,Ut(t.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,i=this.context.gl;return new e.StencilMode({func:i.NOTEQUAL,mask:255},t,255,i.KEEP,i.KEEP,i.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const i=this.context.gl;return new e.StencilMode({func:i.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,i.KEEP,i.KEEP,i.REPLACE)}stencilConfigForOverlap(t){const i=this.context.gl,r=t.sort(((e,t)=>t.overscaledZ-e.overscaledZ)),n=r[r.length-1].overscaledZ,a=r[0].overscaledZ-n+1;if(a>1){this.currentStencilSource=void 0,this.nextStencilID+a>256&&this.clearStencil();const t={};for(let r=0;r<a;r++)t[r+n]=new e.StencilMode({func:i.GEQUAL,mask:255},r+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=a,[t,r]}return[{[n]:e.StencilMode.disabled},r]}colorModeForRenderPass(){const t=this.context.gl;if(this._showOverdrawInspector){const i=1/8;return new e.ColorMode([t.CONSTANT_COLOR,t.ONE],new e.Color(i,i,i,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?e.ColorMode.unblended:e.ColorMode.alphaBlended}depthModeForSublayer(t,i,r){if(!this.opaquePassEnabledForLayer())return e.DepthMode.disabled;const n=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new e.DepthMode(r||this.context.gl.LEQUAL,i,[n,n])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,i){this.style=t,this.options=i,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(e.browser.now()),this.imageManager.beginFrame();const r=this.style._order,n=this.style._sourceCaches;for(const e in n){const t=n[e];t.used&&t.prepare(this.context)}const a={},o={},s={};for(const e in n){const t=n[e];a[e]=t.getVisibleCoordinates(),o[e]=a[e].slice().reverse(),s[e]=t.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let e=0;e<r.length;e++)if(this.style._layers[r[e]].is3D()){this.opaquePassCutoff=e;break}this.terrain&&(this.terrain.updateTileBinding(s),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const e of r){const i=this.style._layers[e],r=t._getLayerSourceCache(i);if(!i.hasOffscreenPass()||i.isHidden(this.transform.zoom))continue;const n=r?o[r.id]:void 0;("custom"===i.type||i.isSky()||n&&n.length)&&this.renderLayer(this,r,i,n)}for(this.context.bindFramebuffer.set(null),this.context.clear({color:i.showOverdrawInspector?e.Color.black:e.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=i.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=r.length-1;this.currentLayer>=0;this.currentLayer--){const e=this.style._layers[r[this.currentLayer]],i=t._getLayerSourceCache(e);if(this.terrain&&this.terrain.renderLayer(e,i)||e.isSky())continue;const n=i?o[i.id]:void 0;this._renderTileClippingMasks(e,i,n),this.renderLayer(this,i,e,n)}if(this.renderPass="sky",this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<r.length;this.currentLayer++){const e=this.style._layers[r[this.currentLayer]],i=t._getLayerSourceCache(e);e.isSky()&&this.renderLayer(this,i,e,i?o[i.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<r.length;this.currentLayer++){const e=this.style._layers[r[this.currentLayer]],i=t._getLayerSourceCache(e);if(this.terrain&&this.terrain.renderLayer(e,i)||e.isSky())continue;const n=i?("symbol"===e.type?s:o)[i.id]:void 0;this._renderTileClippingMasks(e,i,i?a[i.id]:void 0),this.renderLayer(this,i,e,n)}if(this.options.showTileBoundaries||this.options.showQueryGeometry){let i=null;e.values(this.style._layers).forEach((e=>{const r=t._getLayerSourceCache(e);r&&!e.isHidden(this.transform.zoom)&&(!i||i.getSource().maxzoom<r.getSource().maxzoom)&&(i=r)})),i&&this.options.showTileBoundaries&&Wi.debug(this,i,i.getVisibleCoordinates())}this.options.showPadding&&function(e){const t=e.transform.padding;Oi(e,e.transform.height-(t.top||0),3,Ii),Oi(e,t.bottom||0,3,Ri),Bi(e,t.left||0,3,Di),Bi(e,e.transform.width-(t.right||0),3,ki);const i=e.transform.centerPoint;!function(e,t,i,r){Fi(e,t-1,i-10,2,20,r),Fi(e,t-10,i-1,20,2,r)}(e,i.x,e.transform.height-i.y,zi)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%e.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(e.window.performance.now()),this.saveCanvasCopy())}renderLayer(e,t,i,r){i.isHidden(this.transform.zoom)||("background"===i.type||"sky"===i.type||"custom"===i.type||r&&r.length)&&(this.id=i.id,this.gpuTimingStart(i),Wi[i.type](e,t,i,r,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(e){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;let i=this.gpuTimers[e.id];i||(i=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:t.createQueryEXT()}),i.calls++,t.beginQueryEXT(t.TIME_ELAPSED_EXT,i.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const e=this.context.extTimerQuery;e.endQueryEXT(e.TIME_ELAPSED_EXT)}collectGpuTimers(){const e=this.gpuTimers;return this.gpuTimers={},e}queryGpuTimers(e){const t={};for(const i in e){const r=e[i],n=this.context.extTimerQuery,a=n.getQueryObjectEXT(r.query,n.QUERY_RESULT_EXT)/1e6;n.deleteQueryEXT(r.query),t[i]=a}return t}translatePosMatrix(t,i,r,n,a){if(!r[0]&&!r[1])return t;const o=a?"map"===n?this.transform.angle:0:"viewport"===n?-this.transform.angle:0;if(o){const e=Math.sin(o),t=Math.cos(o);r=[r[0]*t-r[1]*e,r[0]*e+r[1]*t]}const s=[a?r[0]:S(i,r[0],this.transform.zoom),a?r[1]:S(i,r[1],this.transform.zoom),0],l=new Float32Array(16);return e.translate(l,t,s),l}saveTileTexture(e){const t=this._tileTextures[e.size[0]];t?t.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const t=this._tileTextures[e];return t&&t.length>0?t.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const t=this.imageManager.getPattern(e.from.toString()),i=this.imageManager.getPattern(e.to.toString());return!t||!i}currentGlobalDefines(){const e=this.terrain&&this.terrain.renderingToTexture,t=[];return this.terrain&&!this.terrain.renderingToTexture&&t.push("TERRAIN"),e&&t.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&t.push("OVERDRAW_INSPECTOR"),t}useProgram(e,t,i){this.cache=this.cache||{};const r=i||[],n=this.currentGlobalDefines().concat(r),a=Zt.cacheKey(e,n,t);return this.cache[a]||(this.cache[a]=new Zt(this.context,e,Ct[e],t,_i[e],n)),this.cache[a]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=e.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new e.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(e){this.terrain&&this.terrain.prepareDrawTile(e)}setTileLoadedFlag(e){this.tileLoaded=e}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const e=this.context.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,e.drawingBufferWidth,e.drawingBufferHeight,0),t}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}}class Zi{constructor(e=0,t=0,i=0,r=0){if(isNaN(e)||e<0||isNaN(t)||t<0||isNaN(i)||i<0||isNaN(r)||r<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=t,this.left=i,this.right=r}interpolate(t,i,r){return null!=i.top&&null!=t.top&&(this.top=e.number(t.top,i.top,r)),null!=i.bottom&&null!=t.bottom&&(this.bottom=e.number(t.bottom,i.bottom,r)),null!=i.left&&null!=t.left&&(this.left=e.number(t.left,i.left,r)),null!=i.right&&null!=t.right&&(this.right=e.number(t.right,i.right,r)),this}getCenter(t,i){const r=e.clamp((this.left+t-this.right)/2,0,t),n=e.clamp((this.top+i-this.bottom)/2,0,i);return new e.Point(r,n)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Zi(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Xi(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}function $i(e,t,i){e[4*t+0]=i[0],e[4*t+1]=i[1],e[4*t+2]=i[2],e[4*t+3]=i[3]}function Yi(t,i){const r=Xi(t,3);e.fromQuat(t,i),$i(t,3,r)}function Ji(e,t){$i(e,3,[t[0],t[1],t[2],1])}function Ki(t,i){const r=e.identity$1([]);return e.rotateZ$1(r,r,-i),e.rotateX$1(r,r,-t),r}function Qi(t,i){const r=[t[0],t[1],0],n=[i[0],i[1],0];if(e.length(r)>=1e-15){const t=e.normalize([],r);e.scale$2(n,t,e.dot(n,t)),i[0]=n[0],i[1]=n[1]}const a=e.cross([],i,t);if(e.len(a)<1e-15)return null;const o=Math.atan2(-a[1],a[0]);return Ki(Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2]),o)}class er{constructor(e,t){this.position=e,this.orientation=t}get position(){return this._position}set position(t){this._position=this._renderWorldCopies?function(t){if(!t)return;const i=Array.isArray(t)?new e.MercatorCoordinate(t[0],t[1],t[2]):t;return i.x=e.wrap(i.x,0,1),i}(t):t}lookAtPoint(t,i){if(this.orientation=null,!this.position)return;const r=this._elevation?this._elevation.getAtPoint(e.MercatorCoordinate.fromLngLat(t)):0,n=this.position,a=e.MercatorCoordinate.fromLngLat(t,r),o=[a.x-n.x,a.y-n.y,a.z-n.z];i||(i=[0,0,1]),i[2]=Math.abs(i[2]),this.orientation=Qi(o,i)}setPitchBearing(t,i){this.orientation=Ki(e.degToRad(t),e.degToRad(-i))}}class tr{constructor(t,i){this._transform=e.identity([]),this._orientation=e.identity$1([]),i&&(this._orientation=i,Yi(this._transform,this._orientation)),t&&Ji(this._transform,t)}get mercatorPosition(){const t=this.position;return new e.MercatorCoordinate(t[0],t[1],t[2])}get position(){const e=Xi(this._transform,3);return[e[0],e[1],e[2]]}set position(e){Ji(this._transform,e)}get orientation(){return this._orientation}set orientation(e){this._orientation=e,Yi(this._transform,this._orientation)}getPitchBearing(){const e=this.forward(),t=this.right();return{bearing:Math.atan2(-t[1],t[0]),pitch:Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2])}}setPitchBearing(e,t){this._orientation=Ki(e,t),Yi(this._transform,this._orientation)}forward(){const e=Xi(this._transform,2);return[-e[0],-e[1],-e[2]]}up(){const e=Xi(this._transform,1);return[-e[0],-e[1],-e[2]]}right(){const e=Xi(this._transform,0);return[e[0],e[1],e[2]]}getCameraToWorld(t,i){const r=new Float64Array(16);return e.invert(r,this.getWorldToCamera(t,i)),r}getWorldToCamera(t,i){const r=new Float64Array(16),n=new Float64Array(4),a=this.position;return e.conjugate(n,this._orientation),e.scale$2(a,a,-t),e.fromQuat(r,n),e.translate(r,r,a),r[1]*=-1,r[5]*=-1,r[9]*=-1,r[13]*=-1,r[8]*=i,r[9]*=i,r[10]*=i,r[11]*=i,r}getCameraToClipPerspective(t,i,r,n){const a=new Float64Array(16);return e.perspective(a,t,i,r,n),a}clone(){return new tr([...this.position],[...this.orientation])}}class ir{constructor(t,i,r,n,a){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===a||a,this._minZoom=t||0,this._maxZoom=i||22,this._minPitch=null==r?0:r,this._maxPitch=null==n?60:n,this.setMaxBounds(),this.width=0,this.height=0,this._center=new e.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Zi,this._posMatrixCache={},this._alignedPosMatrixCache={},this._camera=new tr,this._centerAltitude=0,this.cameraElevationReference="ground"}clone(){const e=new ir(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e._elevation=this._elevation,e._centerAltitude=this._centerAltitude,e.tileSize=this.tileSize,e.latRange=this.latRange,e.width=this.width,e.height=this.height,e.cameraElevationReference=this.cameraElevationReference,e._center=this._center,e._setZoom(this.zoom),e._cameraZoom=this._cameraZoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._camera=this._camera.clone(),e._calcMatrices(),e.freezeTileCoverage=this.freezeTileCoverage,e}get elevation(){return this._elevation}set elevation(e){this._elevation!==e&&(this._elevation=e,e?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(e){this._terrainEnabled()&&null==this._cameraZoom&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),e&&this._constrainCameraAltitude(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new e.Point(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const i=-e.wrap(t,-180,180)*Math.PI/180;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=e.create$2(),e.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const i=e.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const t=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==t&&(this._unmodified=!1,this._setZoom(t),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(e){this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const t=this._elevation.getAtPoint(e.MercatorCoordinate.fromLngLat(this.center),-1);return-1===t?(this._cameraZoom=null,!1):(this._centerAltitude=t,!0)}_updateCameraOnTerrain(){const t=this.cameraToCenterDistance/this.worldSize,i=e.mercatorZfromAltitude(this._centerAltitude,this.center.lat);this._cameraZoom=this._zoomFromMercatorZ(i+t)}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._cameraZoom||!this._elevation)return;const t=this._cameraZoom,i=this._elevation.getAtPoint(e.MercatorCoordinate.fromLngLat(this.center)),r=e.mercatorZfromAltitude(i,this.center.lat),n=this._mercatorZfromZoom(t),a=this._mercatorZfromZoom(this._maxZoom),o=Math.max(n-r,a);this._setZoom(this._zoomFromMercatorZ(o))}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}computeZoomRelativeTo(t){const i=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let r;r=t.z<this._camera.position[2]?[i.x,i.y,i.z]:[t.x,t.y,t.z];const n=e.length(e.sub([],this._camera.position,r));return e.clamp(this._zoomFromMercatorZ(n),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height)return;if(!t.position&&!t.orientation)return;this._updateCameraState();let i=!1;if(t.orientation&&!e.exactEquals(t.orientation,this._camera.orientation)&&(i=this._setCameraOrientation(t.orientation)),t.position){const r=[t.position.x,t.position.y,t.position.z];e.exactEquals$1(r,this._camera.position)||(this._setCameraPosition(r),i=!0)}i&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,i=new er;return i.position=new e.MercatorCoordinate(t[0],t[1],t[2]),i.orientation=this._camera.orientation,i._elevation=this.elevation,i._renderWorldCopies=this._renderWorldCopies,i}_setCameraOrientation(t){if(!e.length$1(t))return!1;e.normalize$1(t,t);const i=e.transformQuat([],[0,0,-1],t),r=e.transformQuat([],[0,-1,0],t);if(r[2]<0)return!1;const n=Qi(i,r);return!!n&&(this._camera.orientation=n,!0)}_setCameraPosition(t){const i=this.zoomScale(this.minZoom)*this.tileSize,r=this.zoomScale(this.maxZoom)*this.tileSize,n=this.cameraToCenterDistance;t[2]=e.clamp(t[2],n/r,n/i),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,t,i){this._unmodified=!1,this._edgeInsets.interpolate(e,t,i),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)}getVisibleUnwrappedCoordinates(t){const i=[new e.UnwrappedTileID(0,t)];if(this._renderWorldCopies){const r=this.pointCoordinate(new e.Point(0,0)),n=this.pointCoordinate(new e.Point(this.width,0)),a=this.pointCoordinate(new e.Point(this.width,this.height)),o=this.pointCoordinate(new e.Point(0,this.height)),s=Math.floor(Math.min(r.x,n.x,a.x,o.x)),l=Math.floor(Math.max(r.x,n.x,a.x,o.x)),c=1;for(let r=s-c;r<=l+c;r++)0!==r&&i.push(new e.UnwrappedTileID(r,t))}return i}coveringTiles(t){let i=this.coveringZoomLevel(t);const r=i,n=!!t.useElevationData;if(void 0!==t.minzoom&&i<t.minzoom)return[];void 0!==t.maxzoom&&i>t.maxzoom&&(i=t.maxzoom);const a=e.MercatorCoordinate.fromLngLat(this.center),o=1<<i,s=[o*a.x,o*a.y,0],l=e.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i),c=this.pointCoordinate(this.getCameraPoint()),h=o*e.mercatorZfromAltitude(1,this.center.lat),u=this._camera.position[2]/e.mercatorZfromAltitude(1,this.center.lat),d=[o*c.x,o*c.y,u],p=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),f=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation?i:0,m=this.elevation?1e4*this.elevation.exaggeration():0,g=t=>({aabb:new e.Aabb([t*o,0,-m],[(t+1)*o,o,m]),zoom:0,x:0,y:0,wrap:t,fullyVisible:!1}),y=[],v=[],_=i,x=t.reparseOverscaled?r:i,b=(e,t)=>{if(!this._elevation)return;const i=this._elevation.getMinMaxForTile(t);i&&(e.min[2]=i.min,e.max[2]=i.max,e.center[2]=(e.min[2]+e.max[2])/2)},w=e=>e*e,M=w((u-this._centerAltitude)*h),T=(e,t)=>{if(t*w(.707)<e)return 1;const i=Math.sqrt(t/e);return i/(1/.707+(Math.pow(1.1,i-1/.707+1)-1)/(1.1-1)-1)};if(this._renderWorldCopies)for(let e=1;e<=3;e++)y.push(g(-e)),y.push(g(e));for(y.push(g(0));y.length>0;){const r=y.pop(),a=r.x,o=r.y;let c=r.fullyVisible;if(!c){const e=r.aabb.intersects(l);if(0===e)continue;c=2===e}let u=!0;if(f<=r.zoom&&r.zoom<_){const e=r.aabb.distanceX(d),t=r.aabb.distanceY(d);let i=M;n&&(i=w(r.aabb.distanceZ(d)*h));const a=e*e+t*t+i;u=a<w((1<<_-r.zoom)*p*T(Math.max(i,M),a))}if(r.zoom!==_&&u)for(let t=0;t<4;t++){const i=(a<<1)+t%2,s=(o<<1)+(t>>1),l=r.aabb.quadrant(t);let h=null;n&&r.zoom>_-6&&(h=new e.OverscaledTileID(r.zoom+1===_?x:r.zoom+1,r.wrap,r.zoom+1,i,s),b(l,h)),y.push({aabb:l,zoom:r.zoom+1,x:i,y:s,wrap:r.wrap,fullyVisible:c,tileID:h})}else{const n=r.zoom===_?x:r.zoom;if(t.minzoom&&t.minzoom>n)continue;const l=s[0]-(.5+a+(r.wrap<<r.zoom))*(1<<i-r.zoom),c=s[1]-.5-o,h=r.tileID?r.tileID:new e.OverscaledTileID(n,r.wrap,r.zoom,a,o);v.push({tileID:h,distanceSq:l*l+c*c})}}return v.sort(((e,t)=>e.distanceSq-t.distanceSq)).map((e=>e.tileID))}resize(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(t){const i=e.clamp(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new e.Point(e.mercatorXfromLng(t.lng)*this.worldSize,e.mercatorYfromLat(i)*this.worldSize)}unproject(t){return new e.MercatorCoordinate(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}setLocationAtPoint(t,i){const r=this.pointCoordinate(i),n=this.pointCoordinate(this.centerPoint),a=this.locationCoordinate(t),o=new e.MercatorCoordinate(a.x-(r.x-n.x),a.y-(r.y-n.y));this.center=this.coordinateLocation(o),this._renderWorldCopies&&(this.center=this.center.wrap())}setLocation(e){this.center=this.coordinateLocation(e),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e){return this._coordinatePoint(this.locationCoordinate(e),!1)}locationPoint3D(e){return this._coordinatePoint(this.locationCoordinate(e),!0)}pointLocation(e){return this.coordinateLocation(this.pointCoordinate(e))}pointLocation3D(e){return this.coordinateLocation(this.pointCoordinate3D(e))}locationCoordinate(t){return e.MercatorCoordinate.fromLngLat(t)}coordinateLocation(e){return e.toLngLat()}pointRayIntersection(t,i){const r=null!=i?i:this._centerAltitude,n=[t.x,t.y,0,1],a=[t.x,t.y,1,1];e.transformMat4(n,n,this.pixelMatrixInverse),e.transformMat4(a,a,this.pixelMatrixInverse);const o=a[3];e.scale$1(n,n,1/n[3]),e.scale$1(a,a,1/o);const s=n[2],l=a[2];return{p0:n,p1:a,t:s===l?0:(r-s)/(l-s)}}screenPointToMercatorRay(t){const i=[t.x,t.y,0,1],r=[t.x,t.y,1,1];return e.transformMat4(i,i,this.pixelMatrixInverse),e.transformMat4(r,r,this.pixelMatrixInverse),e.scale$1(i,i,1/i[3]),e.scale$1(r,r,1/r[3]),i[2]=e.mercatorZfromAltitude(i[2],this._center.lat)*this.worldSize,r[2]=e.mercatorZfromAltitude(r[2],this._center.lat)*this.worldSize,e.scale$1(i,i,1/this.worldSize),e.scale$1(r,r,1/this.worldSize),new e.Ray([i[0],i[1],i[2]],e.normalize([],e.sub([],r,i)))}rayIntersectionCoordinate(t){const{p0:i,p1:r,t:n}=t,a=e.mercatorZfromAltitude(i[2],this._center.lat),o=e.mercatorZfromAltitude(r[2],this._center.lat);return new e.MercatorCoordinate(e.number(i[0],r[0],n)/this.worldSize,e.number(i[1],r[1],n)/this.worldSize,e.number(a,o,n))}pointCoordinate(t){const i=this.horizonLineFromTop(!1),r=new e.Point(t.x,Math.max(i,t.y));return this.rayIntersectionCoordinate(this.pointRayIntersection(r))}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);const i=this.elevation;let r=this.elevation.pointCoordinate(t);if(r)return new e.MercatorCoordinate(r[0],r[1],r[2]);let n=0,a=this.horizonLineFromTop();if(t.y>a)return this.pointCoordinate(t);const o=.02*a,s=t.clone();for(let t=0;t<10&&a-n>o;t++){s.y=e.number(n,a,.66);const t=i.pointCoordinate(s);t?(a=s.y,r=t):n=s.y}return r?new e.MercatorCoordinate(r[0],r[1],r[2]):this.pointCoordinate(t)}isPointAboveHorizon(e){if(this.elevation)return!this.elevation.pointCoordinate(e);{const t=this.horizonLineFromTop();return e.y<t}}_coordinatePoint(t,i){const r=i&&this.elevation?this.elevation.getAtPoint(t,this._centerAltitude):this._centerAltitude,n=[t.x*this.worldSize,t.y*this.worldSize,r+t.toAltitude(),1];return e.transformMat4(n,n,this.pixelMatrix),n[3]>0?new e.Point(n[0]/n[3],n[1]/n[3]):new e.Point(Number.MAX_VALUE,Number.MAX_VALUE)}getBounds(){return this._terrainEnabled()?this._getBounds3D():(new e.LngLatBounds).extend(this.pointLocation(new e.Point(0,0))).extend(this.pointLocation(new e.Point(this.width,0))).extend(this.pointLocation(new e.Point(this.width,this.height))).extend(this.pointLocation(new e.Point(0,this.height)))}_getBounds3D(){const t=this.elevation,i=t.visibleDemTiles.reduce(((e,t)=>{if(t.dem){const i=t.dem.tree;e.min=Math.min(e.min,i.minimums[0]),e.max=Math.max(e.max,i.maximums[0])}return e}),{min:Number.MAX_VALUE,max:0});i.min*=t.exaggeration(),i.max*=t.exaggeration();const r=this.horizonLineFromTop();return[new e.Point(0,r),new e.Point(this.width,r),new e.Point(this.width,this.height),new e.Point(0,this.height)].reduce(((e,t)=>e.extend(this.coordinateLocation(this.rayIntersectionCoordinate(this.pointRayIntersection(t,i.min)))).extend(this.coordinateLocation(this.rayIntersectionCoordinate(this.pointRayIntersection(t,i.max))))),new e.LngLatBounds)}horizonLineFromTop(e=!0){const t=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,i=this.height/2-.97*t;return e?Math.max(0,i):i}getMaxBounds(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new e.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,i=!1){const r=t.key,n=i?this._alignedPosMatrixCache:this._posMatrixCache;if(n[r])return n[r];const a=t.canonical,o=this.worldSize/this.zoomScale(a.z),s=a.x+Math.pow(2,a.z)*t.wrap,l=e.identity(new Float64Array(16));return e.translate(l,l,[s*o,a.y*o,0]),e.scale(l,l,[o/e.EXTENT,o/e.EXTENT,1]),e.multiply(l,i?this.alignedProjMatrix:this.projMatrix,l),n[r]=new Float32Array(l),n[r]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const t=this._elevation;this._updateCameraState();const i=this._camera.position,r=this._camera.forward();if(i.z<=0||r[2]>=0)return;const n=e.mercatorZfromAltitude(1,this._center.lat);i[2]/=n,r[2]/=n,e.normalize(r,r);const a=t.raycast(i,r,t.exaggeration());if(a){const t=e.scaleAndAdd([],i,r,a),n=new e.MercatorCoordinate(t[0],t[1],e.mercatorZfromAltitude(t[2],e.latFromMercatorY(t[1]))),o=this._camera.position,s=n.z+e.length([n.x-o[0],n.y-o[1],n.z-o[2]]);this._cameraZoom=this._zoomFromMercatorZ(s),this._centerAltitude=n.toAltitude(),this._center=n.toLngLat(),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const t=this._elevation;this._updateCameraState();const i=t.getAtPoint(this._camera.mercatorPosition),r=this._minimumHeightOverTerrain()*Math.cos(e.degToRad(this._maxPitch)),n=e.mercatorZfromAltitude(i,this._center.lat),a=this._camera.position[2]-n;if(a<r){const t=e.MercatorCoordinate.fromLngLat(this._center,this._centerAltitude),i=this._camera.mercatorPosition,n=[t.x-i.x,t.y-i.y,t.z-i.z],o=e.length(n);n[2]-=r-a;const s=e.length(n);if(0===s)return;e.scale$2(n,n,o/s),this._camera.position=[t.x-n[0],t.y-n[1],t.z-n[2]],this._camera.orientation=Qi(n,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,i,r,n,a=-90,o=90,s=-180,l=180;const c=this.size,h=this._unmodified;if(this.latRange){const i=this.latRange;a=e.mercatorYfromLat(i[1])*this.worldSize,o=e.mercatorYfromLat(i[0])*this.worldSize,t=o-a<c.y?c.y/(o-a):0}if(this.lngRange){const t=this.lngRange;s=e.mercatorXfromLng(t[0])*this.worldSize,l=e.mercatorXfromLng(t[1])*this.worldSize,i=l-s<c.x?c.x/(l-s):0}const u=this.point,d=Math.max(i||0,t||0);if(d)return this.center=this.unproject(new e.Point(i?(l+s)/2:u.x,t?(o+a)/2:u.y)),this.zoom+=this.scaleZoom(d),this._unmodified=h,void(this._constraining=!1);if(this.latRange){const e=u.y,t=c.y/2;e-t<a&&(n=a+t),e+t>o&&(n=o-t)}if(this.lngRange){const e=u.x,t=c.x/2;e-t<s&&(r=s+t),e+t>l&&(r=l-t)}void 0===r&&void 0===n||(this.center=this.unproject(new e.Point(void 0!==r?r:u.x,void 0!==n?n:u.y))),this._constrainCameraAltitude(),this._unmodified=h,this._constraining=!1}_minZoomForBounds(){const t=(e,t)=>Math.log2(e/(this.tileSize*Math.abs(t[1]-t[0])));let i=0;if(this.latRange){const r=this.latRange;i=t(this.height,[e.mercatorYfromLat(r[0]),e.mercatorYfromLat(r[1])])}let r=0;if(this.lngRange){const i=this.lngRange;r=t(this.width,[e.mercatorXfromLng(i[0]),e.mercatorXfromLng(i[1])])}return Math.max(i,r)}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const i=e.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;this._updateCameraState();const r=Math.PI/2+this._pitch,n=this.fovAboveCenter,a=this._camera.position[2]*this.worldSize/Math.cos(this._pitch),o=Math.sin(n)*a/Math.sin(e.clamp(Math.PI-r-n,.01,Math.PI-.01)),s=this.point,l=s.x,c=s.y,h=1.01*(Math.cos(Math.PI/2-this._pitch)*o+a),u=this.height/50,d=this._camera.getWorldToCamera(this.worldSize,i),p=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,u,h);p[8]=2*-t.x/this.width,p[9]=2*t.y/this.height;let f=e.mul([],p,d);this.mercatorMatrix=e.scale([],f,[this.worldSize,this.worldSize,this.worldSize/i]),this.projMatrix=f,this.invProjMatrix=e.invert(new Float64Array(16),this.projMatrix);const m=new Float32Array(16);e.identity(m),e.scale(m,m,[1,-1,1]),e.rotateX(m,m,this._pitch),e.rotateZ(m,m,this.angle);const g=e.perspective(new Float32Array(16),this._fov,this.width/this.height,u,h);g[8]=2*-t.x/this.width,g[9]=2*t.y/this.height,this.skyboxMatrix=e.multiply(m,g,m);const y=this.width%2/2,v=this.height%2/2,_=Math.cos(this.angle),x=Math.sin(this.angle),b=l-Math.round(l)+_*y+x*v,w=c-Math.round(c)+_*v+x*y,M=new Float64Array(f);if(e.translate(M,M,[b>.5?b-1:b,w>.5?w-1:w,0]),this.alignedProjMatrix=M,f=e.create(),e.scale(f,f,[this.width/2,-this.height/2,1]),e.translate(f,f,[1,-1,0]),this.labelPlaneMatrix=f,f=e.create(),e.scale(f,f,[1,-1,1]),e.translate(f,f,[-1,-1,0]),e.scale(f,f,[2/this.width,2/this.height,1]),this.glCoordMatrix=f,this.pixelMatrix=e.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),f=e.invert(new Float64Array(16),this.pixelMatrix),!f)throw new Error("failed to invert matrix");this.pixelMatrixInverse=f,this._posMatrixCache={},this._alignedPosMatrixCache={}}_updateCameraState(){if(!this.height)return;this._camera.setPitchBearing(this._pitch,this.angle);const t=this._camera.forward(),i=this.cameraToCenterDistance,r=this.point,n=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)-e.mercatorZfromAltitude(this._centerAltitude,this.center.lat),a=this.cameraToCenterDistance/n;this._camera.position=[r.x/this.worldSize-t[0]*i/a,r.y/this.worldSize-t[1]*i/a,e.mercatorZfromAltitude(this._centerAltitude,this._center.lat)+-t[2]*i/a]}_translateCameraConstrained(t){const i=this._maxCameraBoundsDistance()*Math.cos(this._pitch),r=t[2];let n=1;r>0&&(n=Math.min((i-this._camera.position[2])/r,1)),this._camera.position=e.scaleAndAdd([],this._camera.position,t,n),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,i=this._camera.forward(),{pitch:r,bearing:n}=this._camera.getPitchBearing(),a=e.mercatorZfromAltitude(this._centerAltitude,this.center.lat),o=this._mercatorZfromZoom(this._maxZoom)*Math.cos(e.degToRad(this._maxPitch)),s=Math.max((t[2]-a)/Math.cos(r),o),l=this._zoomFromMercatorZ(s);e.scaleAndAdd(t,t,i,s),this._pitch=e.clamp(r,e.degToRad(this.minPitch),e.degToRad(this.maxPitch)),this.angle=e.wrap(n,-Math.PI,Math.PI),this._setZoom(e.clamp(l,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=new e.MercatorCoordinate(t[0],t[1],t[2]).toLngLat(),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(e){return Math.pow(2,e)*this.tileSize}_mercatorZfromZoom(e){return this.cameraToCenterDistance/this._worldSizeFromZoom(e)}_minimumHeightOverTerrain(){const e=Math.min((null!=this._cameraZoom?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(e)}_zoomFromMercatorZ(e){return this.scaleZoom(this.cameraToCenterDistance/(e*this.tileSize))}_terrainEnabled(){return!!this._elevation}isHorizonVisibleForPoints(t,i){const r=Math.min(t.x,i.x),n=Math.max(t.x,i.x),a=Math.min(t.y,i.y),o=Math.max(t.y,i.y),s=[new e.Point(r,a),new e.Point(n,o),new e.Point(r,o),new e.Point(n,a)],l=this._renderWorldCopies?-3:0,c=this._renderWorldCopies?4:1;for(const e of s){const t=this.pointRayIntersection(e);if(t.t<0)return!0;const i=this.rayIntersectionCoordinate(t);if(i.x<l||i.y<0||i.x>c||i.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+e.radToDeg(this.fovAboveCenter)>88||this.isHorizonVisibleForPoints(new e.Point(0,0),new e.Point(this.width,this.height))}zoomDeltaToMovement(t,i){const r=e.length(e.sub([],this._camera.position,t)),n=this._zoomFromMercatorZ(r)+i;return r-this._mercatorZfromZoom(n)}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new e.Point(0,t))}}class rr{constructor(t){this._hashName=t&&encodeURIComponent(t),e.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(e,t){let i=!1,r=null;const n=()=>{r=null,i&&(e(),r=setTimeout(n,300),i=!1)};return()=>(i=!0,r||n(),r)}(this._updateHashUnthrottled.bind(this))}addTo(t){return this._map=t,e.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return e.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const i=this._map.getCenter(),r=Math.round(100*this._map.getZoom())/100,n=Math.ceil((r*Math.LN2+Math.log(512/360/.5))/Math.LN10),a=Math.pow(10,n),o=Math.round(i.lng*a)/a,s=Math.round(i.lat*a)/a,l=this._map.getBearing(),c=this._map.getPitch();let h="";if(h+=t?`/${o}/${s}/${r}`:`${r}/${s}/${o}`,(l||c)&&(h+="/"+Math.round(10*l)/10),c&&(h+=`/${Math.round(c)}`),this._hashName){const t=this._hashName;let i=!1;const r=e.window.location.hash.slice(1).split("&").map((e=>{const r=e.split("=")[0];return r===t?(i=!0,`${r}=${h}`):e})).filter((e=>e));return i||r.push(`${t}=${h}`),`#${r.join("&")}`}return`#${h}`}_getCurrentHash(){const t=e.window.location.hash.replace("#","");if(this._hashName){let e;return t.split("&").map((e=>e.split("="))).forEach((t=>{t[0]===this._hashName&&(e=t)})),(e&&e[1]||"").split("/")}return t.split("/")}_onHashChange(){const e=this._getCurrentHash();if(e.length>=3&&!e.some((e=>isNaN(e)))){const t=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(e[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:t,pitch:+(e[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=e.window.location.href.replace(/(#.+)?$/,this.getHashString());e.window.history.replaceState(e.window.history.state,null,t)}}const nr={linearity:.3,easing:e.bezier(0,0,.3,1)},ar=e.extend({deceleration:2500,maxSpeed:1400},nr),or=e.extend({deceleration:20,maxSpeed:1400},nr),sr=e.extend({deceleration:1e3,maxSpeed:360},nr),lr=e.extend({deceleration:1e3,maxSpeed:90},nr);class cr{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:e.browser.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,i=e.browser.now();for(;t.length>0&&i-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const i={zoom:0,bearing:0,pitch:0,pan:new e.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:e}of this._inertiaBuffer)i.zoom+=e.zoomDelta||0,i.bearing+=e.bearingDelta||0,i.pitch+=e.pitchDelta||0,e.panDelta&&i.pan._add(e.panDelta),e.around&&(i.around=e.around),e.pinchAround&&(i.pinchAround=e.pinchAround);const r=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,n={};if(i.pan.mag()){const a=ur(i.pan.mag(),r,e.extend({},ar,t||{}));n.offset=i.pan.mult(a.amount/i.pan.mag()),n.center=this._map.transform.center,hr(n,a)}if(i.zoom){const e=ur(i.zoom,r,or);n.zoom=this._map.transform.zoom+e.amount,hr(n,e)}if(i.bearing){const t=ur(i.bearing,r,sr);n.bearing=this._map.transform.bearing+e.clamp(t.amount,-179,179),hr(n,t)}if(i.pitch){const e=ur(i.pitch,r,lr);n.pitch=this._map.transform.pitch+e.amount,hr(n,e)}if(n.zoom||n.bearing){const e=void 0===i.pinchAround?i.around:i.pinchAround;n.around=e?this._map.unproject(e):this._map.getCenter()}return this.clear(),e.extend(n,{noMoveStart:!0})}}function hr(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function ur(t,i,r){const{maxSpeed:n,linearity:a,deceleration:o}=r,s=e.clamp(t*a/(i/1e3),-n,n),l=Math.abs(s)/(o*a);return{easing:r.easing,duration:1e3*l,amount:s*(l/2)}}class dr extends e.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,r,a={}){const o=n.mousePos(i.getCanvasContainer(),r),s=i.unproject(o);super(t,e.extend({point:o,lngLat:s,originalEvent:r},a)),this._defaultPrevented=!1,this.target=i}}class pr extends e.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,r){const a="touchend"===t?r.changedTouches:r.touches,o=n.touchPos(i.getCanvasContainer(),a),s=o.map((e=>i.unproject(e))),l=o.reduce(((e,t,i,r)=>e.add(t.div(r.length))),new e.Point(0,0));super(t,{points:o,point:l,lngLats:s,lngLat:i.unproject(l),originalEvent:r}),this._defaultPrevented=!1}}class fr extends e.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,i){super(e,{originalEvent:i}),this._defaultPrevented=!1}}class mr{constructor(e,t){this._map=e,this._clickTolerance=t.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new fr(e.type,this._map,e))}mousedown(e,t){return this._mousedownPos=t,this._firePreventable(new dr(e.type,this._map,e))}mouseup(e){this._map.fire(new dr(e.type,this._map,e))}click(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||this._map.fire(new dr(e.type,this._map,e))}dblclick(e){return this._firePreventable(new dr(e.type,this._map,e))}mouseover(e){this._map.fire(new dr(e.type,this._map,e))}mouseout(e){this._map.fire(new dr(e.type,this._map,e))}touchstart(e){return this._firePreventable(new pr(e.type,this._map,e))}touchmove(e){this._map.fire(new pr(e.type,this._map,e))}touchend(e){this._map.fire(new pr(e.type,this._map,e))}touchcancel(e){this._map.fire(new pr(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class gr{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(e){this._map.fire(new dr(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new dr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new dr(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class yr{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(n.disableDrag(),this._startPos=this._lastPos=t,this._active=!0)}mousemoveWindow(e,t){if(!this._active)return;const i=t;if(this._lastPos.equals(i)||!this._box&&i.dist(this._startPos)<this._clickTolerance)return;const r=this._startPos;this._lastPos=i,this._box||(this._box=n.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));const a=Math.min(r.x,i.x),o=Math.max(r.x,i.x),s=Math.min(r.y,i.y),l=Math.max(r.y,i.y);n.setTransform(this._box,`translate(${a}px,${s}px)`),this._box.style.width=o-a+"px",this._box.style.height=l-s+"px"}mouseupWindow(t,i){if(!this._active)return;if(0!==t.button)return;const r=this._startPos,a=i;if(this.reset(),n.suppressClick(),r.x!==a.x||r.y!==a.y)return this._map.fire(new e.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:e=>e.fitScreenCoordinates(r,a,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(n.remove(this._box),this._box=null),n.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,i){return this._map.fire(new e.Event(t,{originalEvent:i}))}}function vr(e,t){const i={};for(let r=0;r<e.length;r++)i[e[r].identifier]=t[r];return i}class _r{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,i,r){(this.centroid||r.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=t.timeStamp),r.length===this.numTouches&&(this.centroid=function(t){const i=new e.Point(0,0);for(const e of t)i._add(e);return i.div(t.length)}(i),this.touches=vr(r,i)))}touchmove(e,t,i){if(this.aborted||!this.centroid)return;const r=vr(i,t);for(const e in this.touches){const t=this.touches[e],i=r[e];(!i||i.dist(t)>30)&&(this.aborted=!0)}}touchend(e,t,i){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===i.length){const e=!this.aborted&&this.centroid;if(this.reset(),e)return e}}}class xr{constructor(e){this.singleTap=new _r(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,t,i){this.singleTap.touchstart(e,t,i)}touchmove(e,t,i){this.singleTap.touchmove(e,t,i)}touchend(e,t,i){const r=this.singleTap.touchend(e,t,i);if(r){const t=e.timeStamp-this.lastTime<500,i=!this.lastTap||this.lastTap.dist(r)<30;if(t&&i||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}class br{constructor(){this._zoomIn=new xr({numTouches:1,numTaps:2}),this._zoomOut=new xr({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,t,i){this._zoomIn.touchstart(e,t,i),this._zoomOut.touchstart(e,t,i)}touchmove(e,t,i){this._zoomIn.touchmove(e,t,i),this._zoomOut.touchmove(e,t,i)}touchend(e,t,i){const r=this._zoomIn.touchend(e,t,i),n=this._zoomOut.touchend(e,t,i);return r?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()+1,around:t.unproject(r)},{originalEvent:e})}):n?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()-1,around:t.unproject(n)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const wr={0:1,2:2};class Mr{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(e,t){return!1}_move(e,t){return{}}mousedown(e,t){if(this._lastPoint)return;const i=n.mouseButton(e);this._correctButton(e,i)&&(this._lastPoint=t,this._eventButton=i)}mousemoveWindow(e,t){const i=this._lastPoint;if(i)if(e.preventDefault(),function(e,t){const i=wr[t];return void 0===e.buttons||(e.buttons&i)!==i}(e,this._eventButton))this.reset();else if(this._moved||!(t.dist(i)<this._clickTolerance))return this._moved=!0,this._lastPoint=t,this._move(i,t)}mouseupWindow(e){this._lastPoint&&n.mouseButton(e)===this._eventButton&&(this._moved&&n.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Tr extends Mr{mousedown(e,t){super.mousedown(e,t),this._lastPoint&&(this._active=!0)}_correctButton(e,t){return 0===t&&!e.ctrlKey}_move(e,t){return{around:t,panDelta:t.sub(e)}}}class Sr extends Mr{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const i=.8*(t.x-e.x);if(i)return this._active=!0,{bearingDelta:i}}contextmenu(e){e.preventDefault()}}class Er extends Mr{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const i=-.5*(t.y-e.y);if(i)return this._active=!0,{pitchDelta:i}}contextmenu(e){e.preventDefault()}}class Ar{constructor(e){this._minTouches=1,this._clickTolerance=e.clickTolerance||1,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new e.Point(0,0)}touchstart(e,t,i){return this._calculateTransform(e,t,i)}touchmove(e,t,i){if(this._active&&!(i.length<this._minTouches))return e.preventDefault(),this._calculateTransform(e,t,i)}touchend(e,t,i){this._calculateTransform(e,t,i),this._active&&i.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,i,r){r.length>0&&(this._active=!0);const n=vr(r,i),a=new e.Point(0,0),o=new e.Point(0,0);let s=0;for(const e in n){const t=n[e],i=this._touches[e];i&&(a._add(t),o._add(t.sub(i)),s++,n[e]=t)}if(this._touches=n,s<this._minTouches||!o.mag())return;const l=o.div(s);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:a.div(s),panDelta:l}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Cr{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(e){}_move(e,t,i){return{}}touchstart(e,t,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([t[0],t[1]]))}touchmove(e,t,i){if(!this._firstTwoTouches)return;e.preventDefault();const[r,n]=this._firstTwoTouches,a=Lr(i,t,r),o=Lr(i,t,n);if(!a||!o)return;const s=this._aroundCenter?null:a.add(o).div(2);return this._move([a,o],s,e)}touchend(e,t,i){if(!this._firstTwoTouches)return;const[r,a]=this._firstTwoTouches,o=Lr(i,t,r),s=Lr(i,t,a);o&&s||(this._active&&n.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Lr(e,t,i){for(let r=0;r<e.length;r++)if(e[r].identifier===i)return t[r]}function Pr(e,t){return Math.log(e/t)/Math.LN2}class Ir extends Cr{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,t){const i=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Pr(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Pr(this._distance,i),pinchAround:t}}}function Rr(e,t){return 180*e.angleWith(t)/Math.PI}class Dr extends Cr{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,t){const i=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Rr(this._vector,i),pinchAround:t}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const t=25/(Math.PI*this._minDiameter)*360,i=Rr(e,this._startVector);return Math.abs(i)<t}}function kr(e){return Math.abs(e.y)>Math.abs(e.x)}class zr extends Cr{reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(e){this._lastPoints=e,kr(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,t,i){const r=e[0].sub(this._lastPoints[0]),n=e[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(r,n,i.timeStamp),this._valid)return this._lastPoints=e,this._active=!0,{pitchDelta:(r.y+n.y)/2*-.5}}gestureBeginsVertically(e,t,i){if(void 0!==this._valid)return this._valid;const r=e.mag()>=2,n=t.mag()>=2;if(!r&&!n)return;if(!r||!n)return void 0===this._firstMove&&(this._firstMove=i),i-this._firstMove<100&&void 0;const a=e.y>0==t.y>0;return kr(e)&&kr(t)&&a}}const Or={panStep:100,bearingStep:15,pitchStep:10};class Br{constructor(){const e=Or;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let t=0,i=0,r=0,n=0,a=0;switch(e.keyCode){case 61:case 107:case 171:case 187:t=1;break;case 189:case 109:case 173:t=-1;break;case 37:e.shiftKey?i=-1:(e.preventDefault(),n=-1);break;case 39:e.shiftKey?i=1:(e.preventDefault(),n=1);break;case 38:e.shiftKey?r=1:(e.preventDefault(),a=-1);break;case 40:e.shiftKey?r=-1:(e.preventDefault(),a=1);break;default:return}return this._rotationDisabled&&(i=0,r=0),{cameraAnimation:o=>{const s=o.getZoom();o.easeTo({duration:300,easeId:"keyboardHandler",easing:Fr,zoom:t?Math.round(s)+t*(e.shiftKey?2:1):s,bearing:o.getBearing()+i*this._bearingStep,pitch:o.getPitch()+r*this._pitchStep,offset:[-n*this._panStep,-a*this._panStep],center:o.getCenter()},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Fr(e){return e*(2-e)}class Nr{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._handler=i,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,e.bindAll(["_onTimeout"],this)}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=e&&"center"===e.around)}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;let i=t.deltaMode===e.window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const r=e.browser.now(),n=r-(this._lastWheelEventTime||0);this._lastWheelEventTime=r,0!==i&&i%4.000244140625==0?this._type="wheel":0!==i&&Math.abs(i)<4?this._type="trackpad":n>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(n*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),t.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=t,this._delta-=i,this._active||this._start(t)),t.preventDefault()}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const t=n.mousePos(this._el,e);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:t,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const t=this._map.transform,i=()=>t._terrainEnabled()?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(0!==this._delta){const e="wheel"===this._type&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate;let r=2/(1+Math.exp(-Math.abs(this._delta*e)));this._delta<0&&0!==r&&(r=1/r);const n=i(),a=Math.pow(2,n),o="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):a;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(o*r))),"wheel"===this._type&&(this._startZoom=i(),this._easing=this._smoothOutEasing(200)),this._delta=0}const r="number"==typeof this._targetZoom?this._targetZoom:i(),n=this._startZoom,a=this._easing;let o,s=!1;if("wheel"===this._type&&n&&a){const t=Math.min((e.browser.now()-this._lastWheelEventTime)/200,1),i=a(t);o=e.number(n,r,i),t<1?this._frameId||(this._frameId=!0):s=!0}else o=r,s=!0;return this._active=!0,s&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!s,zoomDelta:o-i(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let i=e.ease;if(this._prevEase){const t=this._prevEase,r=(e.browser.now()-t.start)/t.duration,n=t.easing(r+.01)-t.easing(r),a=.27/Math.sqrt(n*n+1e-4)*.01,o=Math.sqrt(.0729-a*a);i=e.bezier(a,o,.25,1)}return this._prevEase={start:e.browser.now(),duration:t,easing:i},i}reset(){this._active=!1}}class Ur{constructor(e,t){this._clickZoom=e,this._tapZoom=t}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class jr{constructor(){this.reset()}reset(){this._active=!1}dblclick(e,t){return e.preventDefault(),{cameraAnimation:i=>{i.easeTo({duration:300,zoom:i.getZoom()+(e.shiftKey?-1:1),around:i.unproject(t)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vr{constructor(){this._tap=new xr({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(e,t,i){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?i.length>0&&(this._swipePoint=t[0],this._swipeTouch=i[0].identifier):this._tap.touchstart(e,t,i))}touchmove(e,t,i){if(this._tapTime){if(this._swipePoint){if(i[0].identifier!==this._swipeTouch)return;const r=t[0],n=r.y-this._swipePoint.y;return this._swipePoint=r,e.preventDefault(),this._active=!0,{zoomDelta:n/128}}}else this._tap.touchmove(e,t,i)}touchend(e,t,i){this._tapTime?this._swipePoint&&0===i.length&&this.reset():this._tap.touchend(e,t,i)&&(this._tapTime=e.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gr{constructor(e,t,i){this._el=e,this._mousePan=t,this._touchPan=i}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Hr{constructor(e,t,i){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=t,this._mousePitch=i}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Wr{constructor(e,t,i,r){this._el=e,this._touchZoom=t,this._touchRotate=i,this._tapDragZoom=r,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const qr=e=>e.zoom||e.drag||e.pitch||e.rotate;class Zr extends e.Event{}class Xr{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,i){const r=e.sub([],i,t);this.radius=e.length(r[2]<0?e.div([],r,this.constants):[r[0],r[1],0])}projectRay(t){e.div(t,t,this.constants),e.normalize(t,t),e.mul$1(t,t,this.constants);const i=e.scale$2([],t,this.radius);if(i[2]>0){const t=e.scale$2([],[0,0,1],e.dot(i,[0,0,1])),r=e.scale$2([],e.normalize([],[i[0],i[1],0]),this.radius),n=e.add([],i,e.scale$2([],e.sub([],e.add([],r,t),i),2));i[0]=n[0],i[1]=n[1]}return i}}function $r(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class Yr{constructor(t,i){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new cr(t),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Xr,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(i),e.bindAll(["handleEvent","handleWindowEvent"],this);const r=this._el;this._listeners=[[r,"touchstart",{passive:!0}],[r,"touchmove",{passive:!1}],[r,"touchend",void 0],[r,"touchcancel",void 0],[r,"mousedown",void 0],[r,"mousemove",void 0],[r,"mouseup",void 0],[e.window.document,"mousemove",{capture:!0}],[e.window.document,"mouseup",void 0],[r,"mouseover",void 0],[r,"mouseout",void 0],[r,"dblclick",void 0],[r,"click",void 0],[r,"keydown",{capture:!1}],[r,"keyup",void 0],[r,"wheel",{passive:!1}],[r,"contextmenu",void 0],[e.window,"blur",void 0]];for(const[t,i,r]of this._listeners)n.addEventListener(t,i,t===e.window.document?this.handleWindowEvent:this.handleEvent,r)}destroy(){for(const[t,i,r]of this._listeners)n.removeEventListener(t,i,t===e.window.document?this.handleWindowEvent:this.handleEvent,r)}_addDefaultHandlers(e){const t=this._map,i=t.getCanvasContainer();this._add("mapEvent",new mr(t,e));const r=t.boxZoom=new yr(t,e);this._add("boxZoom",r);const n=new br,a=new jr;t.doubleClickZoom=new Ur(a,n),this._add("tapZoom",n),this._add("clickZoom",a);const o=new Vr;this._add("tapDragZoom",o);const s=t.touchPitch=new zr;this._add("touchPitch",s);const l=new Sr(e),c=new Er(e);t.dragRotate=new Hr(e,l,c),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);const h=new Tr(e),u=new Ar(e);t.dragPan=new Gr(i,h,u),this._add("mousePan",h),this._add("touchPan",u,["touchZoom","touchRotate"]);const d=new Dr,p=new Ir;t.touchZoomRotate=new Wr(i,p,d,o),this._add("touchRotate",d,["touchPan","touchZoom"]),this._add("touchZoom",p,["touchPan","touchRotate"]),this._add("blockableMapEvent",new gr(t));const f=t.scrollZoom=new Nr(t,this);this._add("scrollZoom",f,["mousePan"]);const m=t.keyboard=new Br;this._add("keyboard",m);for(const i of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[i]&&t[i].enable(e[i])}_add(e,t,i){this._handlers.push({handlerName:e,handler:t,allowed:i}),this._handlersById[e]=t}stop(e){if(!this._updatingCamera){for(const{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(qr(this._eventsInProgress))||this.isZooming()}_blockedByActive(e,t,i){for(const r in e)if(r!==i&&(!t||t.indexOf(r)<0))return!0;return!1}handleWindowEvent(e){this.handleEvent(e,`${e.type}Window`)}_getMapTouches(e){const t=[];for(const i of e)this._el.contains(i.target)&&t.push(i);return t}handleEvent(e,t){if("blur"===e.type)return void this.stop(!0);this._updatingCamera=!0;const i="renderFrame"===e.type?void 0:e,r={needsRenderFrame:!1},a={},o={},s=e.touches?this._getMapTouches(e.touches):void 0,l=s?n.touchPos(this._el,s):n.mousePos(this._el,e);for(const{handlerName:n,handler:c,allowed:h}of this._handlers){if(!c.isEnabled())continue;let u;this._blockedByActive(o,h,n)?c.reset():c[t||e.type]&&(u=c[t||e.type](e,l,s),this.mergeHandlerResult(r,a,u,n,i),u&&u.needsRenderFrame&&this._triggerRenderFrame()),(u||c.isActive())&&(o[n]=c)}const c={};for(const e in this._previousActiveHandlers)o[e]||(c[e]=i);this._previousActiveHandlers=o,(Object.keys(c).length||$r(r))&&(this._changes.push([r,a,c]),this._triggerRenderFrame()),(Object.keys(o).length||$r(r))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:h}=r;h&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],h(this._map))}mergeHandlerResult(t,i,r,n,a){if(!r)return;e.extend(t,r);const o={handlerName:n,originalEvent:r.originalEvent||a};void 0!==r.zoomDelta&&(i.zoom=o),void 0!==r.panDelta&&(i.drag=o),void 0!==r.pitchDelta&&(i.pitch=o),void 0!==r.bearingDelta&&(i.rotate=o)}_applyChanges(){const t={},i={},r={};for(const[n,a,o]of this._changes)n.panDelta&&(t.panDelta=(t.panDelta||new e.Point(0,0))._add(n.panDelta)),n.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+n.zoomDelta),n.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+n.bearingDelta),n.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+n.pitchDelta),void 0!==n.around&&(t.around=n.around),void 0!==n.aroundCoord&&(t.aroundCoord=n.aroundCoord),void 0!==n.pinchAround&&(t.pinchAround=n.pinchAround),n.noInertia&&(t.noInertia=n.noInertia),e.extend(i,a),e.extend(r,o);this._updateMapTransform(t,i,r),this._changes=[]}_updateMapTransform(t,i,r){const n=this._map,a=n.transform,o=e=>[e.x,e.y,e.z];if((e=>{const t=this._eventsInProgress.drag;return t&&!this._handlersById[t.handlerName].isActive()})()&&!$r(t)){const e=a.zoom;a.cameraElevationReference="sea",a.recenterOnTerrain(),a.cameraElevationReference="ground",e!==a.zoom&&this._map._update(!0)}if(!$r(t))return this._fireEvents(i,r,!0);let{panDelta:s,zoomDelta:l,bearingDelta:c,pitchDelta:h,around:u,aroundCoord:d,pinchAround:p}=t;void 0!==p&&(u=p),(e=>i.drag&&!this._eventsInProgress.drag)()&&u&&(this._dragOrigin=o(a.pointCoordinate3D(u)),this._trackingEllipsoid.setup(a._camera.position,this._dragOrigin)),a.cameraElevationReference="sea",n._stop(!0),u=u||n.transform.centerPoint,c&&(a.bearing+=c),h&&(a.pitch+=h),a._updateCameraState();const f=[0,0,0];if(s){const e=a.screenPointToMercatorRay(u),t=a.screenPointToMercatorRay(u.sub(s)),i=this._trackingEllipsoid.projectRay(e.dir),r=this._trackingEllipsoid.projectRay(t.dir);f[0]=r[0]-i[0],f[1]=r[1]-i[1]}const m=a.zoom,g=[0,0,0];if(l){const t=o(d||a.pointCoordinate3D(u)),i={dir:e.normalize([],e.sub([],t,a._camera.position))},r=a.screenPointToMercatorRay(a.centerPoint);if(i.dir[2]<0){const n=e.altitudeFromMercatorZ(t[2],t[1]),s=a.rayIntersectionCoordinate(a.pointRayIntersection(a.centerPoint,n)),c=a.zoomDeltaToMovement(o(s),l)*(r.dir[2]/i.dir[2]);e.scale$2(g,i.dir,c)}else if(a._terrainEnabled()){const r=a.zoomDeltaToMovement(t,l);e.scale$2(g,i.dir,r)}}const y=e.add(f,f,g);a._translateCameraConstrained(y),l&&Math.abs(a.zoom-m)>1e-4&&a.recenterOnTerrain(),a.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(i,r,!0)}_fireEvents(t,i,r){const n=qr(this._eventsInProgress),a=qr(t),o={};for(const e in t){const{originalEvent:i}=t[e];this._eventsInProgress[e]||(o[`${e}start`]=i),this._eventsInProgress[e]=t[e]}!n&&a&&this._fireEvent("movestart",a.originalEvent);for(const e in o)this._fireEvent(e,o[e]);a&&this._fireEvent("move",a.originalEvent);for(const e in t){const{originalEvent:i}=t[e];this._fireEvent(e,i)}const s={};let l;for(const e in this._eventsInProgress){const{handlerName:t,originalEvent:r}=this._eventsInProgress[e];this._handlersById[t].isActive()||(delete this._eventsInProgress[e],l=i[t]||r,s[`${e}end`]=l)}for(const e in s)this._fireEvent(e,s[e]);const c=qr(this._eventsInProgress);if(r&&(n||a)&&!c){this._updatingCamera=!0;const t=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),i=e=>0!==e&&-this._bearingSnap<e&&e<this._bearingSnap;t?(i(t.bearing||this._map.getBearing())&&(t.bearing=0),this._map.easeTo(t,{originalEvent:l})):(this._map.fire(new e.Event("moveend",{originalEvent:l})),i(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,i){this._map.fire(new e.Event(t,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{delete this._frameId,this.handleEvent(new Zr("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}class Jr extends e.Evented{constructor(t,i){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=i.bearingSnap,e.bindAll(["_renderFrameCallback"],this)}getCenter(){return new e.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(e,t){return this.jumpTo({center:e},t)}panBy(t,i,r){return t=e.Point.convert(t).mult(-1),this.panTo(this.transform.center,e.extend({offset:t},i),r)}panTo(t,i,r){return this.easeTo(e.extend({center:t},i),r)}getZoom(){return this.transform.zoom}setZoom(e,t){return this.jumpTo({zoom:e},t),this}zoomTo(t,i,r){return this.easeTo(e.extend({zoom:t},i),r)}zoomIn(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}zoomOut(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}getBearing(){return this.transform.bearing}setBearing(e,t){return this.jumpTo({bearing:e},t),this}getPadding(){return this.transform.padding}setPadding(e,t){return this.jumpTo({padding:e},t),this}rotateTo(t,i,r){return this.easeTo(e.extend({bearing:t},i),r)}resetNorth(t,i){return this.rotateTo(0,e.extend({duration:1e3},t),i),this}resetNorthPitch(t,i){return this.easeTo(e.extend({bearing:0,pitch:0,duration:1e3},t),i),this}snapToNorth(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}getPitch(){return this.transform.pitch}setPitch(e,t){return this.jumpTo({pitch:e},t),this}cameraForBounds(t,i){t=e.LngLatBounds.convert(t);const r=i&&i.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),r,i)}_extendCameraOptions(t){const i={top:0,bottom:0,right:0,left:0};if("number"==typeof(t=e.extend({padding:i,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding){const e=t.padding;t.padding={top:e,bottom:e,right:e,left:e}}return t.padding=e.extend(i,t.padding),t}_cameraForBoxAndBearing(t,i,r,n){const a=this._extendCameraOptions(n),o=this.transform,s=o.padding,l=o.project(e.LngLat.convert(t)),c=o.project(e.LngLat.convert(i)),h=l.rotate(-e.degToRad(r)),u=c.rotate(-e.degToRad(r)),d=new e.Point(Math.max(h.x,u.x),Math.max(h.y,u.y)),p=new e.Point(Math.min(h.x,u.x),Math.min(h.y,u.y)),f=d.sub(p),m=(o.width-(s.left+s.right+a.padding.left+a.padding.right))/f.x,g=(o.height-(s.top+s.bottom+a.padding.top+a.padding.bottom))/f.y;if(g<0||m<0)return void e.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const y=Math.min(o.scaleZoom(o.scale*Math.min(m,g)),a.maxZoom),v="number"==typeof a.offset.x?new e.Point(a.offset.x,a.offset.y):e.Point.convert(a.offset),_=new e.Point((a.padding.left-a.padding.right)/2,(a.padding.top-a.padding.bottom)/2).rotate(r*Math.PI/180),x=v.add(_).mult(o.scale/o.zoomScale(y));return{center:o.unproject(l.add(c).div(2).sub(x)),zoom:y,bearing:r}}_cameraForBox(t,i,r,n,a){const o=this._extendCameraOptions(a);r=r||0,n=n||0,t=e.LngLat.convert(t),i=e.LngLat.convert(i);const s=this.transform.clone();s.padding=o.padding;const l=this.getFreeCameraOptions(),c=new e.LngLat(.5*(t.lng+i.lng),.5*(t.lat+i.lat)),h=.5*(r+n);if(s._camera.position[2]<e.mercatorZfromAltitude(h,c.lat))return void e.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");l.lookAtPoint(c),s.setFreeCameraOptions(l);const u=e.MercatorCoordinate.fromLngLat(t),d=e.MercatorCoordinate.fromLngLat(i),p=s.pointRayIntersection(s.centerPoint,h),f=[(m=s.rayIntersectionCoordinate(p)).x,m.y,m.z];var m;const g=s.screenPointToMercatorRay(s.centerPoint);let y,v=0;do{const i=Math.floor(s.zoom),a=1<<i,o=Math.min(a*u.x,a*d.x),l=Math.min(a*u.y,a*d.y),c=Math.max(a*u.x,a*d.x),h=Math.max(a*u.y,a*d.y),p=new e.Aabb([o,l,r],[c,h,n]),m=e.Frustum.fromInvProjectionMatrix(s.invProjMatrix,s.worldSize,i);if(2!==p.intersects(m)){y&&(s._camera.position=e.scaleAndAdd([],s._camera.position,g.dir,-y),s._updateStateFromCamera());break}const v=e.sub([],s._camera.position,f);y=.5*e.length(v),s._camera.position=e.scaleAndAdd([],s._camera.position,g.dir,y);try{s._updateStateFromCamera()}catch(t){return void e.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++v<10);return{center:s.center,zoom:s.zoom,bearing:s.bearing,pitch:s.pitch}}fitBounds(e,t,i){return this._fitInternal(this.cameraForBounds(e,t),t,i)}_raycastElevationBox(t,i){const r=this.transform.elevation;if(!r)return;const n=new e.Point(t.x,i.y),a=new e.Point(i.x,t.y),o=r.pointCoordinate(t);if(!o)return;const s=r.pointCoordinate(i);if(!s)return;const l=r.pointCoordinate(n);if(!l)return;const c=r.pointCoordinate(a);if(!c)return;const h=new e.MercatorCoordinate(o[0],o[1]).toLngLat(),u=new e.MercatorCoordinate(s[0],s[1]).toLngLat(),d=new e.MercatorCoordinate(l[0],l[1]).toLngLat(),p=new e.MercatorCoordinate(c[0],c[1]).toLngLat(),f=Math.min(h.lng,Math.min(u.lng,Math.min(d.lng,p.lng))),m=Math.min(h.lat,Math.min(u.lat,Math.min(d.lat,p.lat))),g=Math.max(h.lng,Math.max(u.lng,Math.max(d.lng,p.lng))),y=Math.max(h.lat,Math.max(u.lat,Math.max(d.lat,p.lat))),v=Math.min(o[3],Math.min(s[3],Math.min(l[3],c[3]))),_=Math.max(o[3],Math.max(s[3],Math.max(l[3],c[3])));return{minLngLat:new e.LngLat(f,m),maxLngLat:new e.LngLat(g,y),minAltitude:v,maxAltitude:_}}fitScreenCoordinates(t,i,r,n,a){let o,s,l,c;const h=e.Point.convert(t),u=e.Point.convert(i),d=this._raycastElevationBox(h,u);if(d)o=d.minLngLat,s=d.maxLngLat,l=d.minAltitude,c=d.maxAltitude;else{if(this.transform.isHorizonVisibleForPoints(h,u))return this;o=this.transform.pointLocation(h),s=this.transform.pointLocation(u)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(e.Point.convert(t)),this.transform.pointLocation(e.Point.convert(i)),r,n):this._cameraForBox(o,s,l,c,n),n,a)}_fitInternal(t,i,r){return t?(delete(i=e.extend(t,i)).padding,i.linear?this.easeTo(i,r):this.flyTo(i,r)):this}jumpTo(t,i){this.stop();const r=this.transform;let n=!1,a=!1,o=!1;return"zoom"in t&&r.zoom!==+t.zoom&&(n=!0,r.zoom=+t.zoom),void 0!==t.center&&(r.center=e.LngLat.convert(t.center)),"bearing"in t&&r.bearing!==+t.bearing&&(a=!0,r.bearing=+t.bearing),"pitch"in t&&r.pitch!==+t.pitch&&(o=!0,r.pitch=+t.pitch),null==t.padding||r.isPaddingEqual(t.padding)||(r.padding=t.padding),this.fire(new e.Event("movestart",i)).fire(new e.Event("move",i)),n&&this.fire(new e.Event("zoomstart",i)).fire(new e.Event("zoom",i)).fire(new e.Event("zoomend",i)),a&&this.fire(new e.Event("rotatestart",i)).fire(new e.Event("rotate",i)).fire(new e.Event("rotateend",i)),o&&this.fire(new e.Event("pitchstart",i)).fire(new e.Event("pitch",i)).fire(new e.Event("pitchend",i)),this.fire(new e.Event("moveend",i))}getFreeCameraOptions(){return this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,i){this.stop();const r=this.transform,n=r.zoom,a=r.pitch,o=r.bearing;r.setFreeCameraOptions(t);const s=n!==r.zoom,l=a!==r.pitch,c=o!==r.bearing;return this.fire(new e.Event("movestart",i)).fire(new e.Event("move",i)),s&&this.fire(new e.Event("zoomstart",i)).fire(new e.Event("zoom",i)).fire(new e.Event("zoomend",i)),c&&this.fire(new e.Event("rotatestart",i)).fire(new e.Event("rotate",i)).fire(new e.Event("rotateend",i)),l&&this.fire(new e.Event("pitchstart",i)).fire(new e.Event("pitch",i)).fire(new e.Event("pitchend",i)),this.fire(new e.Event("moveend",i)),this}easeTo(t,i){this._stop(!1,t.easeId),(!1===(t=e.extend({offset:[0,0],duration:500,easing:e.ease},t)).animate||!t.essential&&e.browser.prefersReducedMotion)&&(t.duration=0);const r=this.transform,n=this.getZoom(),a=this.getBearing(),o=this.getPitch(),s=this.getPadding(),l="zoom"in t?+t.zoom:n,c="bearing"in t?this._normalizeBearing(t.bearing,a):a,h="pitch"in t?+t.pitch:o,u="padding"in t?t.padding:r.padding,d=e.Point.convert(t.offset);let p=r.centerPoint.add(d);const f=r.pointLocation(p),m=e.LngLat.convert(t.center||f);this._normalizeCenter(m);const g=r.project(f),y=r.project(m).sub(g),v=r.zoomScale(l-n);let _,x;t.around&&(_=e.LngLat.convert(t.around),x=r.locationPoint(_));const b={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||l!==n,this._rotating=this._rotating||a!==c,this._pitching=this._pitching||h!==o,this._padding=!r.isPaddingEqual(u),this._easeId=t.easeId,this._prepareEase(i,t.noMoveStart,b),this._ease((t=>{if(this._zooming&&(r.zoom=e.number(n,l,t)),this._rotating&&(r.bearing=e.number(a,c,t)),this._pitching&&(r.pitch=e.number(o,h,t)),this._padding&&(r.interpolatePadding(s,u,t),p=r.centerPoint.add(d)),_)r.setLocationAtPoint(_,x);else{const e=r.zoomScale(r.zoom-n),i=l>n?Math.min(2,v):Math.max(.5,v),a=Math.pow(i,1-t),o=r.unproject(g.add(y.mult(t*a)).mult(e));r.setLocationAtPoint(r.renderWorldCopies?o.wrap():o,p)}this._fireMoveEvents(i)}),(e=>{r.recenterOnTerrain(),this._afterEase(i,e)}),t),this}_prepareEase(t,i,r={}){this._moving=!0,this.transform.cameraElevationReference="sea",i||r.moving||this.fire(new e.Event("movestart",t)),this._zooming&&!r.zooming&&this.fire(new e.Event("zoomstart",t)),this._rotating&&!r.rotating&&this.fire(new e.Event("rotatestart",t)),this._pitching&&!r.pitching&&this.fire(new e.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new e.Event("move",t)),this._zooming&&this.fire(new e.Event("zoom",t)),this._rotating&&this.fire(new e.Event("rotate",t)),this._pitching&&this.fire(new e.Event("pitch",t))}_afterEase(t,i){if(this._easeId&&i&&this._easeId===i)return;delete this._easeId,this.transform.cameraElevationReference="ground";const r=this._zooming,n=this._rotating,a=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,r&&this.fire(new e.Event("zoomend",t)),n&&this.fire(new e.Event("rotateend",t)),a&&this.fire(new e.Event("pitchend",t)),this.fire(new e.Event("moveend",t))}flyTo(t,i){if(!t.essential&&e.browser.prefersReducedMotion){const r=e.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(r,i)}this.stop(),t=e.extend({offset:[0,0],speed:1.2,curve:1.42,easing:e.ease},t);const r=this.transform,n=this.getZoom(),a=this.getBearing(),o=this.getPitch(),s=this.getPadding(),l="zoom"in t?e.clamp(+t.zoom,r.minZoom,r.maxZoom):n,c="bearing"in t?this._normalizeBearing(t.bearing,a):a,h="pitch"in t?+t.pitch:o,u="padding"in t?t.padding:r.padding,d=r.zoomScale(l-n),p=e.Point.convert(t.offset);let f=r.centerPoint.add(p);const m=r.pointLocation(f),g=e.LngLat.convert(t.center||m);this._normalizeCenter(g);const y=r.project(m),v=r.project(g).sub(y);let _=t.curve;const x=Math.max(r.width,r.height),b=x/d,w=v.mag();if("minZoom"in t){const i=e.clamp(Math.min(t.minZoom,n,l),r.minZoom,r.maxZoom),a=x/r.zoomScale(i-n);_=Math.sqrt(a/w*2)}const M=_*_;function T(e){const t=(b*b-x*x+(e?-1:1)*M*M*w*w)/(2*(e?b:x)*M*w);return Math.log(Math.sqrt(t*t+1)-t)}function S(e){return(Math.exp(e)-Math.exp(-e))/2}function E(e){return(Math.exp(e)+Math.exp(-e))/2}const A=T(0);let C=function(e){return E(A)/E(A+_*e)},L=function(e){return x*((E(A)*(S(t=A+_*e)/E(t))-S(A))/M)/w;var t},P=(T(1)-A)/_;if(Math.abs(w)<1e-6||!isFinite(P)){if(Math.abs(x-b)<1e-6)return this.easeTo(t,i);const e=b<x?-1:1;P=Math.abs(Math.log(b/x))/_,L=function(){return 0},C=function(t){return Math.exp(e*_*t)}}return t.duration="duration"in t?+t.duration:1e3*P/("screenSpeed"in t?+t.screenSpeed/_:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=a!==c,this._pitching=h!==o,this._padding=!r.isPaddingEqual(u),this._prepareEase(i,!1),this._ease((t=>{const d=t*P,m=1/C(d);r.zoom=1===t?l:n+r.scaleZoom(m),this._rotating&&(r.bearing=e.number(a,c,t)),this._pitching&&(r.pitch=e.number(o,h,t)),this._padding&&(r.interpolatePadding(s,u,t),f=r.centerPoint.add(p));const _=1===t?g:r.unproject(y.add(v.mult(L(d))).mult(m));r.setLocationAtPoint(r.renderWorldCopies?_.wrap():_,f),r._updateCenterElevation(),this._fireMoveEvents(i)}),(()=>this._afterEase(i)),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,t){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const e=this._onEaseEnd;delete this._onEaseEnd,e.call(this,t)}if(!e){const e=this.handlers;e&&e.stop(!1)}return this}_ease(t,i,r){!1===r.animate||0===r.duration?(t(1),i()):(this._easeStart=e.browser.now(),this._easeOptions=r,this._onEaseFrame=t,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((e.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,i){t=e.wrap(t,-180,180);const r=Math.abs(t-i);return Math.abs(t-360-i)<r&&(t-=360),Math.abs(t+360-i)<r&&(t+=360),t}_normalizeCenter(e){const t=this.transform;if(!t.renderWorldCopies||t.lngRange)return;const i=e.lng-t.center.lng;e.lng+=i>180?-360:i<-180?360:0}}class Kr{constructor(t={}){this.options=t,e.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(e){const t=this.options&&this.options.compact;return this._map=e,this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=n.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=n.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),t&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===t&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){n.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(e,t){const i=this._map._getUIString(`AttributionControl.${t}`);e.title=i,e.setAttribute("aria-label",i)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const i=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||e.config.ACCESS_TOKEN}];if(t){const r=i.reduce(((e,t,r)=>(t.value&&(e+=`${t.key}=${t.value}${r<i.length-1?"&":""}`),e)),"?");t.href=`${e.config.FEEDBACK_URL}/${r}${this._map._hash?this._map._hash.getHashString(!0):""}`,t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(e){!e||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType&&"style"!==e.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map((e=>"string"!=typeof e?"":e))):"string"==typeof this.options.customAttribution&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}const t=this._map.style._sourceCaches;for(const i in t){const r=t[i];if(r.used){const t=r.getSource();t.attribution&&e.indexOf(t.attribution)<0&&e.push(t.attribution)}}e.sort(((e,t)=>e.length-t.length)),e=e.filter(((t,i)=>{for(let r=i+1;r<e.length;r++)if(e[r].indexOf(t)>=0)return!1;return!0}));const i=e.join(" | ");i!==this._attribHTML&&(this._attribHTML=i,e.length?(this._innerContainer.innerHTML=i,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Qr{constructor(){e.bindAll(["_updateLogo"],this),e.bindAll(["_updateCompact"],this)}onAdd(e){this._map=e,this._container=n.create("div","mapboxgl-ctrl");const t=n.create("a","mapboxgl-ctrl-logo");return t.target="_blank",t.rel="noopener nofollow",t.href="https://www.mapbox.com/",t.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),t.setAttribute("rel","noopener nofollow"),this._container.appendChild(t),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){n.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(e){e&&"metadata"!==e.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return;const e=this._map.style._sourceCaches;if(0===Object.entries(e).length)return!0;for(const t in e){const i=e[t].getSource();if(i.hasOwnProperty("mapbox_logo")&&!i.mapbox_logo)return!1}return!0}_updateCompact(){const e=this._container.children;if(e.length){const t=e[0];this._map.getCanvasContainer().offsetWidth<250?t.classList.add("mapboxgl-compact"):t.classList.remove("mapboxgl-compact")}}}class en{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}remove(e){const t=this._currentlyRunning,i=t?this._queue.concat(t):this._queue;for(const t of i)if(t.id===e)return void(t.cancelled=!0)}run(e=0){const t=this._currentlyRunning=this._queue;this._queue=[];for(const i of t)if(!i.cancelled&&(i.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const tn={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},{HTMLImageElement:rn,HTMLElement:nn,ImageBitmap:an}=e.window,on={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function sn(e){e.parentNode&&e.parentNode.removeChild(e)}const ln={showCompass:!0,showZoom:!0,visualizePitch:!1};class cn{constructor(t,i,r=!1){this._clickTolerance=10,this.element=i,this.mouseRotate=new Sr({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,r&&(this.mousePitch=new Er({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),e.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),n.addEventListener(i,"mousedown",this.mousedown),n.addEventListener(i,"touchstart",this.touchstart,{passive:!1}),n.addEventListener(i,"touchmove",this.touchmove),n.addEventListener(i,"touchend",this.touchend),n.addEventListener(i,"touchcancel",this.reset)}down(e,t){this.mouseRotate.mousedown(e,t),this.mousePitch&&this.mousePitch.mousedown(e,t),n.disableDrag()}move(e,t){const i=this.map,r=this.mouseRotate.mousemoveWindow(e,t);if(r&&r.bearingDelta&&i.setBearing(i.getBearing()+r.bearingDelta),this.mousePitch){const r=this.mousePitch.mousemoveWindow(e,t);r&&r.pitchDelta&&i.setPitch(i.getPitch()+r.pitchDelta)}}off(){const e=this.element;n.removeEventListener(e,"mousedown",this.mousedown),n.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),n.removeEventListener(e,"touchmove",this.touchmove),n.removeEventListener(e,"touchend",this.touchend),n.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){n.enableDrag(),n.removeEventListener(e.window,"mousemove",this.mousemove),n.removeEventListener(e.window,"mouseup",this.mouseup)}mousedown(t){this.down(e.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),n.mousePos(this.element,t)),n.addEventListener(e.window,"mousemove",this.mousemove),n.addEventListener(e.window,"mouseup",this.mouseup)}mousemove(e){this.move(e,n.mousePos(this.element,e))}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}touchstart(e){1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=n.touchPos(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos))}touchmove(e){1!==e.targetTouches.length?this.reset():(this._lastPos=n.touchPos(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos))}touchend(e){0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function hn(t,i,r){if(t=new e.LngLat(t.lng,t.lat),i){const n=new e.LngLat(t.lng-360,t.lat),a=new e.LngLat(t.lng+360,t.lat),o=360*Math.ceil(Math.abs(t.lng-r.center.lng)/360),s=r.locationPoint(t).distSqr(i),l=i.x<0||i.y<0||i.x>r.width||i.y>r.height;r.locationPoint(n).distSqr(i)<s&&(l||Math.abs(n.lng-r.center.lng)<o)?t=n:r.locationPoint(a).distSqr(i)<s&&(l||Math.abs(a.lng-r.center.lng)<o)&&(t=a)}for(;Math.abs(t.lng-r.center.lng)>180;){const e=r.locationPoint(t);if(e.x>=0&&e.y>=0&&e.x<=r.width&&e.y<=r.height)break;t.lng>r.center.lng?t.lng-=360:t.lng+=360}return t}const un={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function dn(e,t,i){const r=e.classList;for(const e in un)r.remove(`mapboxgl-${i}-anchor-${e}`);r.add(`mapboxgl-${i}-anchor-${t}`)}class pn extends e.Evented{constructor(t,i){if(super(),(t instanceof e.window.HTMLElement||i)&&(t=e.extend({element:t},i)),e.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&"auto"!==t.pitchAlignment?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=e.Point.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=n.create("div"),this._element.setAttribute("aria-label","Map marker");const i=n.createNS("http://www.w3.org/2000/svg","svg"),r=41,a=27;i.setAttributeNS(null,"display","block"),i.setAttributeNS(null,"height",`${r}px`),i.setAttributeNS(null,"width",`${a}px`),i.setAttributeNS(null,"viewBox",`0 0 ${a} ${r}`);const o=n.createNS("http://www.w3.org/2000/svg","g");o.setAttributeNS(null,"stroke","none"),o.setAttributeNS(null,"stroke-width","1"),o.setAttributeNS(null,"fill","none"),o.setAttributeNS(null,"fill-rule","evenodd");const s=n.createNS("http://www.w3.org/2000/svg","g");s.setAttributeNS(null,"fill-rule","nonzero");const l=n.createNS("http://www.w3.org/2000/svg","g");l.setAttributeNS(null,"transform","translate(3.0, 29.0)"),l.setAttributeNS(null,"fill","#000000");const c=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const e of c){const t=n.createNS("http://www.w3.org/2000/svg","ellipse");t.setAttributeNS(null,"opacity","0.04"),t.setAttributeNS(null,"cx","10.5"),t.setAttributeNS(null,"cy","5.80029008"),t.setAttributeNS(null,"rx",e.rx),t.setAttributeNS(null,"ry",e.ry),l.appendChild(t)}const h=n.createNS("http://www.w3.org/2000/svg","g");h.setAttributeNS(null,"fill",this._color);const u=n.createNS("http://www.w3.org/2000/svg","path");u.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),h.appendChild(u);const d=n.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"opacity","0.25"),d.setAttributeNS(null,"fill","#000000");const p=n.createNS("http://www.w3.org/2000/svg","path");p.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),d.appendChild(p);const f=n.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"transform","translate(6.0, 7.0)"),f.setAttributeNS(null,"fill","#FFFFFF");const m=n.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"transform","translate(8.0, 8.0)");const g=n.createNS("http://www.w3.org/2000/svg","circle");g.setAttributeNS(null,"fill","#000000"),g.setAttributeNS(null,"opacity","0.25"),g.setAttributeNS(null,"cx","5.5"),g.setAttributeNS(null,"cy","5.5"),g.setAttributeNS(null,"r","5.4999962");const y=n.createNS("http://www.w3.org/2000/svg","circle");y.setAttributeNS(null,"fill","#FFFFFF"),y.setAttributeNS(null,"cx","5.5"),y.setAttributeNS(null,"cy","5.5"),y.setAttributeNS(null,"r","5.4999962"),m.appendChild(g),m.appendChild(y),s.appendChild(l),s.appendChild(h),s.appendChild(d),s.appendChild(f),s.appendChild(m),i.appendChild(s),i.setAttributeNS(null,"height",r*this._scale+"px"),i.setAttributeNS(null,"width",a*this._scale+"px"),this._element.appendChild(i),this._offset=e.Point.convert(t&&t.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(e=>{e.preventDefault()})),this._element.addEventListener("mousedown",(e=>{e.preventDefault()})),dn(this._element,this._anchor,"marker"),this._popup=null}addTo(e){return this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),n.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=e.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const t=38.1,i=13.5,r=Math.sqrt(Math.pow(i,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-t],"bottom-left":[r,-1*(t-i+r)],"bottom-right":[-r,-1*(t-i+r)],left:[i,-1*(t-i)],right:[-i,-1*(t-i)]}:this._offset}this._popup=e,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(e){const t=e.code,i=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==i&&13!==i||this.togglePopup()}_onMapClick(e){const t=e.originalEvent.target,i=this._element;this._popup&&(t===i||i.contains(t))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const e=this._popup;return e?(e.isOpen()?e.remove():e.addTo(this._map),this):this}_updateOcclusion(){this._occlusionTimer||(this._occlusionTimer=setTimeout(this._onOcclusionTimer.bind(this),60))}_onOcclusionTimer(){const e=this._map.transform,t=this._pos?this._pos.sub(this._transformedOffset()):null;if(t&&t.x>=0&&t.x<e.width&&t.y>=0&&t.y<e.height){const e=this._map.unproject(t),i=this._map.getFreeCameraOptions();if(i.position){const t=i.position.toLngLat(),r=t.distanceTo(e),n=t.distanceTo(this._lngLat);this._element.classList.toggle("mapboxgl-marker-occluded",r<.9*n)}}this._occlusionTimer=null}_update(e){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=hn(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset()),this._map.transform.elevation&&this._updateOcclusion();let t="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?t=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(t=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let i="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?i="rotateX(0deg)":"map"===this._pitchAlignment&&(i=`rotateX(${this._map.getPitch()}deg)`),e&&"moveend"!==e.type||(this._pos=this._pos.round()),n.setTransform(this._element,`${un[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${i} ${t}`)}_transformedOffset(){if(!this._defaultMarker)return this._offset;const e=this._map.transform,t=this._offset.mult(this._scale);return"map"===this._rotationAlignment&&t._rotate(e.angle),"map"===this._pitchAlignment&&(t.y*=Math.cos(e._pitch)),t}getOffset(){return this._offset}setOffset(t){return this._offset=e.Point.convert(t),this._update(),this}_onMove(t){if(!this._isDragging){const e=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=e}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new e.Event("dragstart"))),this.fire(new e.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new e.Event("dragend")),this._state="inactive"}_addDragHandler(e){this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=e.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&"auto"!==e?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const fn={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let mn,gn=0,yn=!1;const vn={maxWidth:100,unit:"metric"};function _n(e,t,i){const r=i&&i.maxWidth||100,n=e._container.clientHeight/2,a=e.unproject([0,n]),o=e.unproject([r,n]),s=a.distanceTo(o);if(i&&"imperial"===i.unit){const i=3.2808*s;i>5280?xn(t,r,i/5280,e._getUIString("ScaleControl.Miles")):xn(t,r,i,e._getUIString("ScaleControl.Feet"))}else i&&"nautical"===i.unit?xn(t,r,s/1852,e._getUIString("ScaleControl.NauticalMiles")):s>=1e3?xn(t,r,s/1e3,e._getUIString("ScaleControl.Kilometers")):xn(t,r,s,e._getUIString("ScaleControl.Meters"))}function xn(e,t,i,r){const n=function(e){const t=Math.pow(10,`${Math.floor(e)}`.length-1);let i=e/t;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:i>=1?1:function(e){const t=Math.pow(10,Math.ceil(-Math.log(e)/Math.LN10));return Math.round(e*t)/t}(i),t*i}(i);e.style.width=t*(n/i)+"px",e.innerHTML=`${n}&nbsp;${r}`}const bn={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},wn=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Mn={version:e.version,supported:t,setRTLTextPlugin:e.setRTLTextPlugin,getRTLTextPluginStatus:e.getRTLTextPluginStatus,Map:class extends Jr{constructor(t){if(null!=(t=e.extend({},on,t)).minZoom&&null!=t.maxZoom&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=t.minPitch&&null!=t.maxPitch&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=t.minPitch&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=t.maxPitch&&t.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new ir(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies),t),this._interactive=t.interactive,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._antialias=t.antialias,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=t.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=t.collectResourceTiming,this._renderTaskQueue=new en,this._controls=[],this._mapId=e.uniqueId(),this._locale=e.extend({},tn,t.locale),this._clickTolerance=t.clickTolerance,this._requestManager=new e.RequestManager(t.transformRequest,t.accessToken),"string"==typeof t.container){if(this._container=e.window.document.getElementById(t.container),!this._container)throw new Error(`Container '${t.container}' not found.`)}else{if(!(t.container instanceof nn))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(t.maxBounds&&this.setMaxBounds(t.maxBounds),e.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),void 0!==e.window&&(e.window.addEventListener("online",this._onWindowOnline,!1),e.window.addEventListener("resize",this._onWindowResize,!1),e.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Yr(this,t),this._hash=t.hash&&new rr("string"==typeof t.hash&&t.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}),t.bounds&&(this.resize(),this.fitBounds(t.bounds,e.extend({},t.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=t.localIdeographFontFamily,t.style&&this.setStyle(t.style,{localIdeographFontFamily:t.localIdeographFontFamily}),t.attributionControl&&this.addControl(new Kr({customAttribution:t.customAttribution})),this._logoControl=new Qr,this.addControl(this._logoControl,t.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(t=>{this._update("style"===t.dataType),this.fire(new e.Event(`${t.dataType}data`,t))})),this.on("dataloading",(t=>{this.fire(new e.Event(`${t.dataType}dataloading`,t))}))}_getMapId(){return this._mapId}addControl(t,i){if(void 0===i&&(i=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new e.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=t.onAdd(this);this._controls.push(t);const n=this._controlPositions[i];return-1!==i.indexOf("bottom")?n.insertBefore(r,n.firstChild):n.appendChild(r),this}removeControl(t){if(!t||!t.onRemove)return this.fire(new e.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(t);return i>-1&&this._controls.splice(i,1),t.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}resize(t){const i=this._containerDimensions(),r=i[0],n=i[1];this._resizeCanvas(r,n),this.transform.resize(r,n),this.painter.resize(r,n);const a=!this._moving;return a&&(this.stop(),this.fire(new e.Event("movestart",t)).fire(new e.Event("move",t))),this.fire(new e.Event("resize",t)),a&&this.fire(new e.Event("moveend",t)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(t){return this.transform.setMaxBounds(e.LngLatBounds.convert(t)),this._update()}setMinZoom(e){if((e=null==e?-2:e)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this._update(),this.getZoom()<e&&this.setZoom(e),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this._update(),this.getZoom()>e&&this.setZoom(e),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to 0");if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this._update(),this.getPitch()<e&&this.setPitch(e),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(e){if((e=null==e?85:e)>85)throw new Error("maxPitch must be less than or equal to 85");if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this._update(),this.getPitch()>e&&this.setPitch(e),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this._update()}project(t){return this.transform.locationPoint3D(e.LngLat.convert(t))}unproject(t){return this.transform.pointLocation3D(e.Point.convert(t))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(e,t,i){if("mouseenter"===e||"mouseover"===e){let r=!1;const n=n=>{const a=this.getLayer(t)?this.queryRenderedFeatures(n.point,{layers:[t]}):[];a.length?r||(r=!0,i.call(this,new dr(e,this,n.originalEvent,{features:a}))):r=!1};return{layer:t,listener:i,delegates:{mousemove:n,mouseout:()=>{r=!1}}}}if("mouseleave"===e||"mouseout"===e){let r=!1;const n=n=>{(this.getLayer(t)?this.queryRenderedFeatures(n.point,{layers:[t]}):[]).length?r=!0:r&&(r=!1,i.call(this,new dr(e,this,n.originalEvent)))},a=t=>{r&&(r=!1,i.call(this,new dr(e,this,t.originalEvent)))};return{layer:t,listener:i,delegates:{mousemove:n,mouseout:a}}}{const r=e=>{const r=this.getLayer(t)?this.queryRenderedFeatures(e.point,{layers:[t]}):[];r.length&&(e.features=r,i.call(this,e),delete e.features)};return{layer:t,listener:i,delegates:{[e]:r}}}}on(e,t,i){if(void 0===i)return super.on(e,t);const r=this._createDelegatedListener(e,t,i);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(r);for(const e in r.delegates)this.on(e,r.delegates[e]);return this}once(e,t,i){if(void 0===i)return super.once(e,t);const r=this._createDelegatedListener(e,t,i);for(const e in r.delegates)this.once(e,r.delegates[e]);return this}off(e,t,i){return void 0===i?super.off(e,t):(this._delegatedListeners&&this._delegatedListeners[e]&&(r=>{const n=this._delegatedListeners[e];for(let e=0;e<n.length;e++){const r=n[e];if(r.layer===t&&r.listener===i){for(const e in r.delegates)this.off(e,r.delegates[e]);return n.splice(e,1),this}}})(),this)}queryRenderedFeatures(t,i){return this.style?(void 0!==i||void 0===t||t instanceof e.Point||Array.isArray(t)||(i=t,t=void 0),this.style.queryRenderedFeatures(t=t||[[0,0],[this.transform.width,this.transform.height]],i=i||{},this.transform)):[]}querySourceFeatures(e,t){return this.style.querySourceFeatures(e,t)}setStyle(t,i){return!1!==(i=e.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},i)).diff&&i.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&t?(this._diffStyle(t,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._updateStyle(t,i))}_getUIString(e){const t=this._locale[e];if(null==t)throw new Error(`Missing UI string '${e}'`);return t}_updateStyle(e,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),e&&(this.style=new Ze(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof e?this.style.loadURL(e):this.style.loadJSON(e)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ze(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(t,i){if("string"==typeof t){const r=this._requestManager.normalizeStyleURL(t),n=this._requestManager.transformRequest(r,e.ResourceType.Style);e.getJSON(n,((t,r)=>{t?this.fire(new e.ErrorEvent(t)):r&&this._updateDiff(r,i)}))}else"object"==typeof t&&this._updateDiff(t,i)}_updateDiff(t,i){try{this.style.setState(t)&&this._update(!0)}catch(r){e.warnOnce(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(t,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():e.warnOnce("There is no style added to the map.")}addSource(e,t){return this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)}isSourceLoaded(t){const i=this.style&&this.style._getSourceCaches(t);if(0!==i.length)return i.every((e=>e.loaded()));this.fire(new e.ErrorEvent(new Error(`There is no source with ID '${t}'`)))}areTilesLoaded(){const e=this.style&&this.style._sourceCaches;for(const t in e){const i=e[t]._tiles;for(const e in i){const t=i[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}}return!0}addSourceType(e,t,i){return this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,i)}removeSource(e){return this.style.removeSource(e),this._updateTerrain(),this._update(!0)}getSource(e){return this.style.getSource(e)}addImage(t,i,{pixelRatio:r=1,sdf:n=!1,stretchX:a,stretchY:o,content:s}={}){if(this._lazyInitEmptyStyle(),i instanceof rn||an&&i instanceof an){const{width:l,height:c,data:h}=e.browser.getImageData(i);this.style.addImage(t,{data:new e.RGBAImage({width:l,height:c},h),pixelRatio:r,stretchX:a,stretchY:o,content:s,sdf:n,version:0})}else{if(void 0===i.width||void 0===i.height)return this.fire(new e.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:l,height:c,data:h}=i,u=i;this.style.addImage(t,{data:new e.RGBAImage({width:l,height:c},new Uint8Array(h)),pixelRatio:r,stretchX:a,stretchY:o,content:s,sdf:n,version:0,userImage:u}),u.onAdd&&u.onAdd(this,t)}}}updateImage(t,i){const r=this.style.getImage(t);if(!r)return this.fire(new e.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const n=i instanceof rn||an&&i instanceof an?e.browser.getImageData(i):i,{width:a,height:o,data:s}=n;return void 0===a||void 0===o?this.fire(new e.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):a!==r.data.width||o!==r.data.height?this.fire(new e.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(r.data.replace(s,!(i instanceof rn||an&&i instanceof an)),void this.style.updateImage(t,r))}hasImage(t){return t?!!this.style.getImage(t):(this.fire(new e.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(e){this.style.removeImage(e)}loadImage(t,i){e.getImage(this._requestManager.transformRequest(t,e.ResourceType.Image),i)}listImages(){return this.style.listImages()}addLayer(e,t){return this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)}moveLayer(e,t){return this.style.moveLayer(e,t),this._update(!0)}removeLayer(e){return this.style.removeLayer(e),this._update(!0)}getLayer(e){return this.style.getLayer(e)}setLayerZoomRange(e,t,i){return this.style.setLayerZoomRange(e,t,i),this._update(!0)}setFilter(e,t,i={}){return this.style.setFilter(e,t,i),this._update(!0)}getFilter(e){return this.style.getFilter(e)}setPaintProperty(e,t,i,r={}){return this.style.setPaintProperty(e,t,i,r),this._update(!0)}getPaintProperty(e,t){return this.style.getPaintProperty(e,t)}setLayoutProperty(e,t,i,r={}){return this.style.setLayoutProperty(e,t,i,r),this._update(!0)}getLayoutProperty(e,t){return this.style.getLayoutProperty(e,t)}setLight(e,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(e,t),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(e){return this._lazyInitEmptyStyle(),this.style.setTerrain(e),this._update(!0)}setFeatureState(e,t){return this.style.setFeatureState(e,t),this._update()}removeFeatureState(e,t){return this.style.removeFeatureState(e,t),this._update()}getFeatureState(e){return this.style.getFeatureState(e)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let e=0,t=0;return this._container&&(e=this._container.clientWidth||400,t=this._container.clientHeight||300),[e,t]}_detectMissingCSS(){"rgb(250, 128, 114)"!==e.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&e.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const e=this._container;e.classList.add("mapboxgl-map"),(this._missingCSSCanary=n.create("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=n.create("div","mapboxgl-canvas-container",e);this._interactive&&t.classList.add("mapboxgl-interactive"),this._canvas=n.create("canvas","mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const i=this._containerDimensions();this._resizeCanvas(i[0],i[1]);const r=this._controlContainer=n.create("div","mapboxgl-control-container",e),a=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((e=>{a[e]=n.create("div",`mapboxgl-ctrl-${e}`,r)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(t,i){const r=e.browser.devicePixelRatio||1;this._canvas.width=r*t,this._canvas.height=r*i,this._canvas.style.width=`${t}px`,this._canvas.style.height=`${i}px`}_setupPainter(){const i=e.extend({},t.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl",i)||this._canvas.getContext("experimental-webgl",i);r?(this.painter=new qi(r,this.transform),this.on("data",(e=>{"source"===e.dataType&&this.painter.setTileLoadedFlag(!0)})),e.webpSupported.testSupport(r)):this.fire(new e.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(t){t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new e.Event("webglcontextlost",{originalEvent:t}))}_contextRestored(t){this._setupPainter(),this.resize(),this._update(),this.fire(new e.Event("webglcontextrestored",{originalEvent:t}))}_onMapScroll(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(e){return this.style?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_render(t){let i,r=0;const n=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(i=n.createQueryEXT(),n.beginQueryEXT(n.TIME_ELAPSED_EXT,i),r=e.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(t),this._removed)return;let a=!1;const o=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const t=this.transform.zoom,i=e.browser.now();this.style.zoomHistory.update(t,i);const r=new e.EvaluationParameters(t,{now:i,fadeDuration:o,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),n=r.crossFadingFactor();1===n&&n===this._crossFadingFactor||(a=!0,this._crossFadingFactor=n),this.style.update(r)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this._updateTerrain(),this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,o,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:o,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new e.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new e.Event("load"))),this.style&&(this.style.hasTransitions()||a)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const t=e.browser.now()-r;n.endQueryEXT(n.TIME_ELAPSED_EXT,i),setTimeout((()=>{const r=n.getQueryObjectEXT(i,n.QUERY_RESULT_EXT)/1e6;n.deleteQueryEXT(i),this.fire(new e.Event("gpu-timing-frame",{cpuTime:t,gpuTime:r}))}),50)}if(this.listens("gpu-timing-layer")){const t=this.painter.collectGpuTimers();setTimeout((()=>{const i=this.painter.queryGpuTimers(t);this.fire(new e.Event("gpu-timing-layer",{layerTimes:i}))}),50)}const s=this._sourcesDirty||this._styleDirty||this._placementDirty;if(s||this._repaint)this.triggerRepaint();else if(this._triggerFrame(!1),!this.isMoving()&&this.loaded()&&(this.fire(new e.Event("idle")),this._isInitialLoad&&this._authenticate(),this._isInitialLoad=!1,this.speedIndexTiming)){const t=this._calculateSpeedIndex();this.fire(new e.Event("speedindexcompleted",{speedIndex:t})),this.speedIndexTiming=!1}return!this._loaded||this._fullyLoaded||s||(this._fullyLoaded=!0),this}_authenticate(){e.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(t=>{if(t&&(t.message===e.AUTH_ERR_MSG||401===t.status)){console.error("Error: A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/"),e.browser.setErrorState();const t=this.painter.context.gl;this._logoControl instanceof Qr&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT)}})),e.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const e=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const i=this.painter.context.gl,r=i.createFramebuffer();function n(e){i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,e,0);const t=new Uint8Array(i.drawingBufferWidth*i.drawingBufferHeight*4);return i.readPixels(0,0,i.drawingBufferWidth,i.drawingBufferHeight,i.RGBA,i.UNSIGNED_BYTE,t),t}return i.bindFramebuffer(i.FRAMEBUFFER,r),this._canvasPixelComparison(n(e),t.canvasCopies.map(n),t.timeStamps)}_canvasPixelComparison(e,t,i){let r=i[1]-i[0];const n=e.length/4;for(let a=0;a<t.length;a++){const o=t[a];let s=0;for(let t=0;t<o.length;t+=4)o[t]===e[t]&&o[t+1]===e[t+1]&&o[t+2]===e[t+2]&&o[t+3]===e[t+3]&&(s+=1);r+=(i[a+2]-i[a+1])*(1-s/n)}return r}remove(){this._hash&&this._hash.remove();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==e.window&&(e.window.removeEventListener("resize",this._onWindowResize,!1),e.window.removeEventListener("orientationchange",this._onWindowResize,!1),e.window.removeEventListener("online",this._onWindowOnline,!1));const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),sn(this._canvasContainer),sn(this._controlContainer),sn(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new e.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(t){this._renderNextFrame=this._renderNextFrame||t,this.style&&!this._frame&&(this._frame=e.browser.frame((e=>{const t=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,t&&this._render(e)})))}_onWindowOnline(){this._update()}_onWindowResize(e){this._trackResize&&this.resize({originalEvent:e})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(e){this._speedIndexTiming!==e&&(this._speedIndexTiming=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}_setCacheLimits(t,i){e.setCacheLimits(t,i)}get version(){return e.version}},NavigationControl:class{constructor(t){this.options=e.extend({},ln,t),this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(e.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(e=>this._map.zoomIn({},{originalEvent:e}))),n.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(e=>this._map.zoomOut({},{originalEvent:e}))),n.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(e.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})})),this._compassIcon=n.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const e=this._map.getZoom(),t=e===this._map.getMaxZoom(),i=e===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=i,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",i.toString())}_rotateCompassArrow(){const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new cn(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){n.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(e,t){const i=n.create("button",e,this._container);return i.type="button",i.addEventListener("click",t),i}_setButtonTitle(e,t){const i=this._map._getUIString(`NavigationControl.${t}`);e.title=i,e.setAttribute("aria-label",i)}},GeolocateControl:class extends e.Evented{constructor(t){super(),this.options=e.extend({},fn,t),e.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(t){var i;return this._map=t,this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),i=this._setupUI,void 0!==mn?i(mn):void 0!==e.window.navigator.permissions?e.window.navigator.permissions.query({name:"geolocation"}).then((e=>{mn="denied"!==e.state,i(mn)})):(mn=!!e.window.navigator.geolocation,i(mn)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(e.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),n.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,gn=0,yn=!1}_isOutOfMapMaxBounds(e){const t=this._map.getMaxBounds(),i=e.coords;return t&&(i.longitude<t.getWest()||i.longitude>t.getEast()||i.latitude<t.getSouth()||i.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(t){if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new e.Event("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new e.Event("geolocate",t)),this._finish()}}_updateCamera(t){const i=new e.LngLat(t.coords.longitude,t.coords.latitude),r=t.coords.accuracy,n=this._map.getBearing(),a=e.extend({bearing:n},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(r),a,{geolocateSource:!0})}_updateMarker(t){if(t){const i=new e.LngLat(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const e=this._map._container.clientHeight/2,t=this._map.unproject([0,e]),i=this._map.unproject([1,e]),r=t.distanceTo(i),n=Math.ceil(2*this._accuracy/r);this._circleElement.style.width=`${n}px`,this._circleElement.style.height=`${n}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(t){if(this._map){if(this.options.trackUserLocation)if(1===t.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===t.code&&yn)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new e.Event("error",t)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(t){if(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=n.create("button","mapboxgl-ctrl-geolocate",this._container),n.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===t){e.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=n.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new pn(this._dotElement),this._circleElement=n.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new pn({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new e.Event("trackuserlocationend")))}))}trigger(){if(!this._setup)return e.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new e.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":gn--,yn=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new e.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new e.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let t;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),gn++,gn>1?(t={maximumAge:6e5,timeout:0},yn=!0):(t=this.options.positionOptions,yn=!1),this._geolocationWatchID=e.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,t)}}else e.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){e.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Kr,ScaleControl:class{constructor(t){this.options=e.extend({},vn,t),e.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){_n(this._map,this._container,this.options)}onAdd(e){return this._map=e,this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",e.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){n.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(e){this.options.unit=e,_n(this._map,this._container,this.options)}},FullscreenControl:class{constructor(t){this._fullscreen=!1,t&&t.container&&(t.container instanceof e.window.HTMLElement?this._container=t.container:e.warnOnce("Full screen control 'container' must be a DOM element.")),e.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in e.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in e.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",e.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){n.remove(this._controlContainer),this._map=null,e.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!e.window.document.fullscreenEnabled&&!e.window.document.webkitFullscreenEnabled)}_setupUI(){const t=this._fullscreenButton=n.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);n.create("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden",!0),t.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),e.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.title=e}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(e.window.document.fullscreenElement||e.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?e.window.document.exitFullscreen?e.window.document.exitFullscreen():e.window.document.webkitCancelFullScreen&&e.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends e.Evented{constructor(t){super(),this.options=e.extend(Object.create(bn),t),e.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new e.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&n.remove(this._content),this._container&&(n.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new e.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=e.LngLat.convert(t),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(t){return this.setDOMContent(e.window.document.createTextNode(t))}setHTML(t){const i=e.window.document.createDocumentFragment(),r=e.window.document.createElement("body");let n;for(r.innerHTML=t;n=r.firstChild,n;)i.appendChild(n);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=n.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(e),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(e){this._container&&this._container.classList.add(e)}removeClassName(e){this._container&&this._container.classList.remove(e)}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){if(this._container)return this._container.classList.toggle(e)}_createCloseButton(){this.options.closeButton&&(this._closeButton=n.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(e){this._update(e.point)}_onMouseMove(e){this._update(e.point)}_onDrag(e){this._update(e.point)}_update(t){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(this._container||(this._container=n.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=n.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach((e=>this._container.classList.add(e))),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=hn(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!t)return;const i=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);let r=this.options.anchor;const a=function t(i){if(i){if("number"==typeof i){const t=Math.round(Math.sqrt(.5*Math.pow(i,2)));return{center:new e.Point(0,0),top:new e.Point(0,i),"top-left":new e.Point(t,t),"top-right":new e.Point(-t,t),bottom:new e.Point(0,-i),"bottom-left":new e.Point(t,-t),"bottom-right":new e.Point(-t,-t),left:new e.Point(i,0),right:new e.Point(-i,0)}}if(i instanceof e.Point||Array.isArray(i)){const t=e.Point.convert(i);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:e.Point.convert(i.center||[0,0]),top:e.Point.convert(i.top||[0,0]),"top-left":e.Point.convert(i["top-left"]||[0,0]),"top-right":e.Point.convert(i["top-right"]||[0,0]),bottom:e.Point.convert(i.bottom||[0,0]),"bottom-left":e.Point.convert(i["bottom-left"]||[0,0]),"bottom-right":e.Point.convert(i["bottom-right"]||[0,0]),left:e.Point.convert(i.left||[0,0]),right:e.Point.convert(i.right||[0,0])}}return t(new e.Point(0,0))}(this.options.offset);if(!r){const e=this._container.offsetWidth,t=this._container.offsetHeight;let n;n=i.y+a.bottom.y<t?["top"]:i.y>this._map.transform.height-t?["bottom"]:[],i.x<e/2?n.push("left"):i.x>this._map.transform.width-e/2&&n.push("right"),r=0===n.length?"bottom":n.join("-")}const o=i.add(a[r]).round();n.setTransform(this._container,`${un[r]} translate(${o.x}px,${o.y}px)`),dn(this._container,r,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector(wn);e&&e.focus()}_onClose(){this.remove()}},Marker:pn,Style:Ze,LngLat:e.LngLat,LngLatBounds:e.LngLatBounds,Point:e.Point,MercatorCoordinate:e.MercatorCoordinate,FreeCameraOptions:er,Evented:e.Evented,config:e.config,prewarm:function(){G().acquire(U)},clearPrewarmedResources:function(){const e=V;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(U),V=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return e.config.ACCESS_TOKEN},set accessToken(t){e.config.ACCESS_TOKEN=t},get baseApiUrl(){return e.config.API_URL},set baseApiUrl(t){e.config.API_URL=t},get workerCount(){return j.workerCount},set workerCount(e){j.workerCount=e},get maxParallelImageRequests(){return e.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(t){e.config.MAX_PARALLEL_IMAGE_REQUESTS=t},clearStorage(t){e.clearTileCache(t)},workerUrl:"",workerClass:null,setNow:e.browser.setNow,restoreNow:e.browser.restoreNow};return Mn})),i}()},830:(e,t)=>{t.encode=function(e){var t="";for(var i in e)e.hasOwnProperty(i)&&(t.length&&(t+="&"),t+=encodeURIComponent(i)+"="+encodeURIComponent(e[i]));return t},t.decode=function(e){for(var t={},i=e.split("&"),r=0,n=i.length;r<n;r++){var a=i[r].split("=");t[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}return t}},187:e=>{var t=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];e.exports=function(e){var r,n,a=e,o=e.indexOf("["),s=e.indexOf("]");-1!=o&&-1!=s&&(e=e.substring(0,o)+e.substring(o,s).replace(/:/g,";")+e.substring(s,e.length));for(var l,c,h=t.exec(e||""),u={},d=14;d--;)u[i[d]]=h[d]||"";return-1!=o&&-1!=s&&(u.source=a,u.host=u.host.substring(1,u.host.length-1).replace(/;/g,":"),u.authority=u.authority.replace("[","").replace("]","").replace(/;/g,":"),u.ipv6uri=!0),u.pathNames=(r=u.path,n=r.replace(/\/{2,9}/g,"/").split("/"),"/"!=r.substr(0,1)&&0!==r.length||n.splice(0,1),"/"==r.substr(r.length-1,1)&&n.splice(n.length-1,1),n),u.queryKey=(l=u.query,c={},l.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,i){t&&(c[t]=i)})),c),u}},751:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.io=t.Socket=t.Manager=t.protocol=void 0;const r=i(744),n=i(703),a=i(669)("socket.io-client");e.exports=t=s;const o=t.managers={};function s(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};const i=r.url(e,t.path||"/socket.io"),s=i.source,l=i.id,c=i.path,h=o[l]&&c in o[l].nsps;let u;return t.forceNew||t["force new connection"]||!1===t.multiplex||h?(a("ignoring socket cache for %s",s),u=new n.Manager(s,t)):(o[l]||(a("new io instance for %s",s),o[l]=new n.Manager(s,t)),u=o[l]),i.query&&!t.query&&(t.query=i.queryKey),u.socket(i.path,t)}t.io=s;var l=i(369);Object.defineProperty(t,"protocol",{enumerable:!0,get:function(){return l.protocol}}),t.connect=s;var c=i(703);Object.defineProperty(t,"Manager",{enumerable:!0,get:function(){return c.Manager}});var h=i(277);Object.defineProperty(t,"Socket",{enumerable:!0,get:function(){return h.Socket}}),t.default=s},703:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Manager=void 0;const r=i(983),n=i(277),a=i(369),o=i(657),s=i(10),l=i(791),c=i(669)("socket.io-client:manager");class h extends l.StrictEventEmitter{constructor(e,t){super(),this.nsps={},this.subs=[],e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new s({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=e;const i=t.parser||a;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(c("readyState %s",this._readyState),~this._readyState.indexOf("open"))return this;c("opening %s",this.uri),this.engine=r(this.uri,this.opts);const t=this.engine,i=this;this._readyState="opening",this.skipReconnect=!1;const n=o.on(t,"open",(function(){i.onopen(),e&&e()})),a=o.on(t,"error",(t=>{c("error"),i.cleanup(),i._readyState="closed",this.emitReserved("error",t),e?e(t):i.maybeReconnectOnOpen()}));if(!1!==this._timeout){const e=this._timeout;c("connect attempt will timeout after %d",e),0===e&&n();const i=setTimeout((()=>{c("connect attempt timed out after %d",e),n(),t.close(),t.emit("error",new Error("timeout"))}),e);this.opts.autoUnref&&i.unref(),this.subs.push((function(){clearTimeout(i)}))}return this.subs.push(n),this.subs.push(a),this}connect(e){return this.open(e)}onopen(){c("open"),this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(o.on(e,"ping",this.onping.bind(this)),o.on(e,"data",this.ondata.bind(this)),o.on(e,"error",this.onerror.bind(this)),o.on(e,"close",this.onclose.bind(this)),o.on(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){this.decoder.add(e)}ondecoded(e){this.emitReserved("packet",e)}onerror(e){c("error",e),this.emitReserved("error",e)}socket(e,t){let i=this.nsps[e];return i||(i=new n.Socket(this,e,t),this.nsps[e]=i),i}_destroy(e){const t=Object.keys(this.nsps);for(const e of t)if(this.nsps[e].active)return void c("socket %s is still active, skipping close",e);this._close()}_packet(e){c("writing packet %j",e);const t=this.encoder.encode(e);for(let i=0;i<t.length;i++)this.engine.write(t[i],e.options)}cleanup(){c("cleanup"),this.subs.forEach((e=>e())),this.subs.length=0,this.decoder.destroy()}_close(){c("disconnect"),this.skipReconnect=!0,this._reconnecting=!1,"opening"===this._readyState&&this.cleanup(),this.backoff.reset(),this._readyState="closed",this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e){c("onclose"),this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)c("reconnect failed"),this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();c("will wait %dms before reconnect attempt",t),this._reconnecting=!0;const i=setTimeout((()=>{e.skipReconnect||(c("attempting reconnect"),this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open((t=>{t?(c("reconnect attempt error"),e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):(c("reconnect success"),e.onreconnect())})))}),t);this.opts.autoUnref&&i.unref(),this.subs.push((function(){clearTimeout(i)}))}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}t.Manager=h},657:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.on=void 0,t.on=function(e,t,i){return e.on(t,i),function(){e.off(t,i)}}},277:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Socket=void 0;const r=i(369),n=i(657),a=i(791),o=i(669)("socket.io-client:socket"),s=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class l extends a.StrictEventEmitter{constructor(e,t,i){super(),this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},i&&i.auth&&(this.auth=i.auth),this.io._autoConnect&&this.open()}subEvents(){if(this.subs)return;const e=this.io;this.subs=[n.on(e,"open",this.onopen.bind(this)),n.on(e,"packet",this.onpacket.bind(this)),n.on(e,"error",this.onerror.bind(this)),n.on(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(s.hasOwnProperty(e))throw new Error('"'+e+'" is a reserved event name');t.unshift(e);const i={type:r.PacketType.EVENT,data:t,options:{}};i.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(o("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),i.id=this.ids++);const n=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return!this.flags.volatile||n&&this.connected?this.connected?this.packet(i):this.sendBuffer.push(i):o("discard packet as the transport is not currently writable"),this.flags={},this}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){o("transport is open - connecting"),"function"==typeof this.auth?this.auth((e=>{this.packet({type:r.PacketType.CONNECT,data:e})})):this.packet({type:r.PacketType.CONNECT,data:this.auth})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e){o("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emitReserved("disconnect",e)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case r.PacketType.CONNECT:if(e.data&&e.data.sid){const t=e.data.sid;this.onconnect(t)}else this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case r.PacketType.EVENT:case r.PacketType.BINARY_EVENT:this.onevent(e);break;case r.PacketType.ACK:case r.PacketType.BINARY_ACK:this.onack(e);break;case r.PacketType.DISCONNECT:this.ondisconnect();break;case r.PacketType.CONNECT_ERROR:const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){const t=e.data||[];o("emitting event %j",t),null!=e.id&&(o("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const i of t)i.apply(this,e)}super.emit.apply(this,e)}ack(e){const t=this;let i=!1;return function(...n){i||(i=!0,o("sending ack %j",n),t.packet({type:r.PacketType.ACK,id:e,data:n}))}}onack(e){const t=this.acks[e.id];"function"==typeof t?(o("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):o("bad ack %s",e.id)}onconnect(e){o("socket connected with id %s",e),this.id=e,this.connected=!0,this.disconnected=!1,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach((e=>this.emitEvent(e))),this.receiveBuffer=[],this.sendBuffer.forEach((e=>this.packet(e))),this.sendBuffer=[]}ondisconnect(){o("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((e=>e())),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&(o("performing disconnect (%s)",this.nsp),this.packet({type:r.PacketType.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let i=0;i<t.length;i++)if(e===t[i])return t.splice(i,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}}t.Socket=l},791:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StrictEventEmitter=void 0;const r=i(767);t.StrictEventEmitter=class extends r{on(e,t){return super.on(e,t),this}once(e,t){return super.once(e,t),this}emit(e,...t){return super.emit(e,...t),this}emitReserved(e,...t){return super.emit(e,...t),this}listeners(e){return super.listeners(e)}}},744:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.url=void 0;const r=i(187),n=i(669)("socket.io-client:url");t.url=function(e,t="",i){let a=e;i=i||"undefined"!=typeof location&&location,null==e&&(e=i.protocol+"//"+i.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?i.protocol+e:i.host+e),/^(https?|wss?):\/\//.test(e)||(n("protocol-less url %s",e),e=void 0!==i?i.protocol+"//"+e:"https://"+e),n("parse %s",e),a=r(e)),a.port||(/^(http|ws)$/.test(a.protocol)?a.port="80":/^(http|ws)s$/.test(a.protocol)&&(a.port="443")),a.path=a.path||"/";const o=-1!==a.host.indexOf(":")?"["+a.host+"]":a.host;return a.id=a.protocol+"://"+o+":"+a.port+t,a.href=a.protocol+"://"+o+(i&&i.port===a.port?"":":"+a.port),a}},669:(e,t,i)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const i="color: "+this.color;t.splice(1,0,i,"color: inherit");let r=0,n=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(r++,"%c"===e&&(n=r))})),t.splice(n,0,i)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=i(231)(t);const{formatters:r}=e.exports;r.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},231:(e,t,i)=>{e.exports=function(e){function t(e){let i,n=null;function a(...e){if(!a.enabled)return;const r=a,n=Number(new Date),o=n-(i||n);r.diff=o,r.prev=i,r.curr=n,i=n,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((i,n)=>{if("%%"===i)return"%";s++;const a=t.formatters[n];if("function"==typeof a){const t=e[s];i=a.call(r,t),e.splice(s,1),s--}return i})),t.formatArgs.call(r,e),(r.log||t.log).apply(r,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=r,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null===n?t.enabled(e):n,set:e=>{n=e}}),"function"==typeof t.init&&t.init(a),a}function r(e,i){const r=t(this.namespace+(void 0===i?":":i)+e);return r.log=this.log,r}function n(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(n),...t.skips.map(n).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let i;t.save(e),t.names=[],t.skips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),n=r.length;for(i=0;i<n;i++)r[i]&&("-"===(e=r[i].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let i,r;for(i=0,r=t.skips.length;i<r;i++)if(t.skips[i].test(e))return!1;for(i=0,r=t.names.length;i<r;i++)if(t.names[i].test(e))return!0;return!1},t.humanize=i(241),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((i=>{t[i]=e[i]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let i=0;for(let t=0;t<e.length;t++)i=(i<<5)-i+e.charCodeAt(t),i|=0;return t.colors[Math.abs(i)%t.colors.length]},t.enable(t.load()),t}},241:e=>{var t=1e3,i=60*t,r=60*i,n=24*r;function a(e,t,i,r){var n=t>=1.5*i;return Math.round(e/i)+" "+r+(n?"s":"")}e.exports=function(e,o){o=o||{};var s,l,c=typeof e;if("string"===c&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(a){var o=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"weeks":case"week":case"w":return 6048e5*o;case"days":case"day":case"d":return o*n;case"hours":case"hour":case"hrs":case"hr":case"h":return o*r;case"minutes":case"minute":case"mins":case"min":case"m":return o*i;case"seconds":case"second":case"secs":case"sec":case"s":return o*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}}}(e);if("number"===c&&isFinite(e))return o.long?(s=e,(l=Math.abs(s))>=n?a(s,l,n,"day"):l>=r?a(s,l,r,"hour"):l>=i?a(s,l,i,"minute"):l>=t?a(s,l,t,"second"):s+" ms"):function(e){var a=Math.abs(e);return a>=n?Math.round(e/n)+"d":a>=r?Math.round(e/r)+"h":a>=i?Math.round(e/i)+"m":a>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},383:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.reconstructPacket=t.deconstructPacket=void 0;const r=i(608);function n(e,t){if(!e)return e;if(r.isBinary(e)){const i={_placeholder:!0,num:t.length};return t.push(e),i}if(Array.isArray(e)){const i=new Array(e.length);for(let r=0;r<e.length;r++)i[r]=n(e[r],t);return i}if("object"==typeof e&&!(e instanceof Date)){const i={};for(const r in e)e.hasOwnProperty(r)&&(i[r]=n(e[r],t));return i}return e}function a(e,t){if(!e)return e;if(e&&e._placeholder)return t[e.num];if(Array.isArray(e))for(let i=0;i<e.length;i++)e[i]=a(e[i],t);else if("object"==typeof e)for(const i in e)e.hasOwnProperty(i)&&(e[i]=a(e[i],t));return e}t.deconstructPacket=function(e){const t=[],i=e.data,r=e;return r.data=n(i,t),r.attachments=t.length,{packet:r,buffers:t}},t.reconstructPacket=function(e,t){return e.data=a(e.data,t),e.attachments=void 0,e}},369:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Decoder=t.Encoder=t.PacketType=t.protocol=void 0;const r=i(767),n=i(383),a=i(608),o=i(669)("socket.io-parser");var s;t.protocol=5,function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(s=t.PacketType||(t.PacketType={})),t.Encoder=class{encode(e){return o("encoding packet %j",e),e.type!==s.EVENT&&e.type!==s.ACK||!a.hasBinary(e)?[this.encodeAsString(e)]:(e.type=e.type===s.EVENT?s.BINARY_EVENT:s.BINARY_ACK,this.encodeAsBinary(e))}encodeAsString(e){let t=""+e.type;return e.type!==s.BINARY_EVENT&&e.type!==s.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data)),o("encoded %j as %s",e,t),t}encodeAsBinary(e){const t=n.deconstructPacket(e),i=this.encodeAsString(t.packet),r=t.buffers;return r.unshift(i),r}};class l extends r{constructor(){super()}add(e){let t;if("string"==typeof e)t=this.decodeString(e),t.type===s.BINARY_EVENT||t.type===s.BINARY_ACK?(this.reconstructor=new c(t),0===t.attachments&&super.emit("decoded",t)):super.emit("decoded",t);else{if(!a.isBinary(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emit("decoded",t))}}decodeString(e){let t=0;const i={type:Number(e.charAt(0))};if(void 0===s[i.type])throw new Error("unknown packet type "+i.type);if(i.type===s.BINARY_EVENT||i.type===s.BINARY_ACK){const r=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const n=e.substring(r,t);if(n!=Number(n)||"-"!==e.charAt(t))throw new Error("Illegal attachments");i.attachments=Number(n)}if("/"===e.charAt(t+1)){const r=t+1;for(;++t&&","!==e.charAt(t)&&t!==e.length;);i.nsp=e.substring(r,t)}else i.nsp="/";const r=e.charAt(t+1);if(""!==r&&Number(r)==r){const r=t+1;for(;++t;){const i=e.charAt(t);if(null==i||Number(i)!=i){--t;break}if(t===e.length)break}i.id=Number(e.substring(r,t+1))}if(e.charAt(++t)){const r=function(e){try{return JSON.parse(e)}catch(e){return!1}}(e.substr(t));if(!l.isPayloadValid(i.type,r))throw new Error("invalid payload");i.data=r}return o("decoded %s as %j",e,i),i}static isPayloadValid(e,t){switch(e){case s.CONNECT:return"object"==typeof t;case s.DISCONNECT:return void 0===t;case s.CONNECT_ERROR:return"string"==typeof t||"object"==typeof t;case s.EVENT:case s.BINARY_EVENT:return Array.isArray(t)&&t.length>0;case s.ACK:case s.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}t.Decoder=l;class c{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=n.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}},608:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hasBinary=t.isBinary=void 0;const i="function"==typeof ArrayBuffer,r=Object.prototype.toString,n="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===r.call(Blob),a="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===r.call(File);function o(e){return i&&(e instanceof ArrayBuffer||(e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer)(e))||n&&e instanceof Blob||a&&e instanceof File}t.isBinary=o,t.hasBinary=function e(t,i){if(!t||"object"!=typeof t)return!1;if(Array.isArray(t)){for(let i=0,r=t.length;i<r;i++)if(e(t[i]))return!0;return!1}if(o(t))return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return e(t.toJSON(),!0);for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&e(t[i]))return!0;return!1}},25:(e,t)=>{var r,n,a;!function e(t,i,r){function n(o,s){if(!i[o]){if(!t[o]){if(a)return a(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var c=i[o]={exports:{}};t[o][0].call(c.exports,(function(e){return n(t[o][1][e]||e)}),c,c.exports,e,t,i,r)}return i[o].exports}for(var a=void 0,o=0;o<r.length;o++)n(r[o]);return n}({1:[function(e,t,i){window.Threebox=e("./src/Threebox.js"),window.THREE=e("./src/three.js")},{"./src/Threebox.js":2,"./src/three.js":23}],2:[function(e,t,i){const r=e("./three.js"),n=e("./camera/CameraSync.js"),a=e("./utils/utils.js"),o=e("./utils/suncalc.js"),s=e("./utils/constants.js"),l=e("./objects/objects.js"),c=e("./utils/material.js"),h=e("./objects/sphere.js"),u=e("./objects/extrusion.js"),d=e("./objects/label.js"),p=e("./objects/tooltip.js"),f=e("./objects/loadObj.js"),m=e("./objects/Object3D.js"),g=e("./objects/line.js"),y=e("./objects/tube.js"),v=e("./objects/LabelRenderer.js"),_=e("./objects/effects/BuildingShadows.js");function x(e,t,i){this.init(e,t,i)}x.prototype={repaint:function(){this.map.repaint=!0},init:function(e,t,i){this.options=a._validate(i||{},b),this.map=e,this.map.tb=this,this.objects=new l,this.renderer=new r.WebGLRenderer({alpha:!0,antialias:!0,canvas:e.getCanvas(),context:t}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.map.getCanvas().clientWidth,this.map.getCanvas().clientHeight),this.renderer.outputEncoding=r.sRGBEncoding,this.renderer.autoClear=!1,this.labelRenderer=new v(this.map),this.scene=new r.Scene,this.world=new r.Group,this.world.name="world",this.scene.add(this.world),this.objectsCache=new Map,this.zoomLayers=[],this.fov=this.options.fov,this.orthographic=this.options.orthographic||!1,this.raycaster=new r.Raycaster,this.raycaster.layers.set(0),this.mapCenter=this.map.getCenter(),this.mapCenterUnits=a.projectToWorld([this.mapCenter.lng,this.mapCenter.lat]),this.lightDateTime=new Date,this.lightLng=this.mapCenter.lng,this.lightLat=this.mapCenter.lat,this.sunPosition,this.rotationStep=5,this.gridStep=6,this.altitudeStep=.1,this.lights=this.initLights,this.options.defaultLights&&this.defaultLights(),this.options.realSunlight&&this.realSunlight(this.options.realSunlightHelper),this.enableSelectingFeatures=this.options.enableSelectingFeatures||!1,this.enableSelectingObjects=this.options.enableSelectingObjects||!1,this.enableDraggingObjects=this.options.enableDraggingObjects||!1,this.enableRotatingObjects=this.options.enableRotatingObjects||!1,this.enableTooltips=this.options.enableTooltips||!1,this.multiLayer=this.options.multiLayer||!1,this.map.on("style.load",(function(){this.tb.zoomLayers=[],this.tb.options.multiLayer&&this.addLayer({id:"threebox_layer",type:"custom",renderingMode:"3d",map:this,onAdd:function(e,t){},render:function(e,t){this.map.tb.update()}})})),this.map.on("load",(function(){let t;this.selectedObject,this.selectedFeature,this.draggedObject,this.overedObject,this.overedFeature;let i,r=this.getCanvasContainer();this.getCanvasContainer().style.cursor="default";let n,o,s,l,c=[];function h(e){var t=r.getBoundingClientRect();return{x:e.originalEvent.clientX-t.left-r.clientLeft,y:e.originalEvent.clientY-t.top-r.clientTop}}this.unselectObject=function(e){e.selected=!1,this.selectedObject=null},this.unselectFeature=function(e){void 0!==e.id&&(this.setFeatureState({source:e.source,sourceLayer:e.sourceLayer,id:e.id},{select:!1}),this.removeTooltip(e),(e=this.queryRenderedFeatures({layers:[e.layer.id],filter:["==",["id"],e.id]})[0])&&this.fire("SelectedFeatureChange",{detail:e}),this.selectedFeature=null)},this.selectFeature=function(e){this.selectedFeature=e,this.setFeatureState({source:this.selectedFeature.source,sourceLayer:this.selectedFeature.sourceLayer,id:this.selectedFeature.id},{select:!0}),this.selectedFeature=this.queryRenderedFeatures({layers:[this.selectedFeature.layer.id],filter:["==",["id"],this.selectedFeature.id]})[0],this.addTooltip(this.selectedFeature),this.fire("SelectedFeatureChange",{detail:this.selectedFeature})},this.unoverFeature=function(t){this.overedFeature&&void 0!==this.overedFeature&&this.overedFeature.id!=t&&(e.setFeatureState({source:this.overedFeature.source,sourceLayer:this.overedFeature.sourceLayer,id:this.overedFeature.id},{hover:!1}),this.removeTooltip(this.overedFeature),this.overedFeature=null)},this.addTooltip=function(e){if(!this.tb.enableTooltips)return;let t=this.tb.getFeatureCenter(e),i=this.tb.tooltip({text:e.properties.name||e.id||e.type,mapboxStyle:!0,feature:e});i.setCoords(t),this.tb.add(i,e.layer.id),e.tooltip=i,e.tooltip.tooltip.visible=!0},this.removeTooltip=function(e){e.tooltip&&(e.tooltip.visibility=!1,this.tb.remove(e.tooltip),e.tooltip=null)},e.onContextMenu=function(e){alert("contextMenu")},this.onClick=function(t){let i,r=[];if(e.tb.enableSelectingObjects&&(r=this.tb.queryRenderedFeatures(t.point)),i="object"==typeof r[0],i){let e=x.prototype.findParent3DObject(r[0]);if(e){if(this.selectedFeature&&this.unselectFeature(this.selectedFeature),this.selectedObject){if(this.selectedObject.uuid!=e.uuid)this.selectedObject.selected=!1,e.selected=!0,this.selectedObject=e;else if(this.selectedObject.uuid==e.uuid)return void this.unselectObject(this.selectedObject)}else this.selectedObject=e,this.selectedObject.selected=!0;this.selectedObject.dispatchEvent(new CustomEvent("Wireframed",{detail:this.selectedObject,bubbles:!0,cancelable:!0})),this.selectedObject.dispatchEvent(new CustomEvent("IsPlayingChanged",{detail:this.selectedObject,bubbles:!0,cancelable:!0})),this.repaint=!0,t.preventDefault()}}else{let i=[];if(e.tb.enableSelectingFeatures&&(i=this.queryRenderedFeatures(t.point)),i.length>0&&"fill-extrusion"==i[0].layer.type&&void 0!==i[0].id)if(this.selectedObject&&this.unselectObject(this.selectedObject),this.selectedFeature){if(this.selectedFeature.id!=i[0].id)this.unselectFeature(this.selectedFeature),this.selectFeature(i[0]);else if(this.selectedFeature.id==i[0].id)return void this.unselectFeature(this.selectedFeature)}else this.selectFeature(i[0])}},this.onMouseMove=function(r){let a,c=h(r);if(this.getCanvasContainer().style.cursor="default",r.originalEvent.altKey&&this.draggedObject){if(!e.tb.enableRotatingObjects)return;t="rotate",this.getCanvasContainer().style.cursor="move",Math.min(i.x,c.x),Math.max(i.x,c.x),Math.min(i.y,c.y),Math.max(i.y,c.y);let r={x:0,y:0,z:Math.round(l[2]+~~((c.x-i.x)/this.tb.rotationStep)%360*this.tb.rotationStep%360)};return this.draggedObject.setRotation(r),void this.draggedObject.addHelp("rot: "+r.z+"&#176;")}if(r.originalEvent.shiftKey&&this.draggedObject){if(!e.tb.enableDraggingObjects)return;t="translate",this.getCanvasContainer().style.cursor="move";let i=r.lngLat,a=[Number((i.lng+n).toFixed(this.tb.gridStep)),Number((i.lat+o).toFixed(this.tb.gridStep)),this.draggedObject.modelHeight];return this.draggedObject.setCoords(a),void this.draggedObject.addHelp("lng: "+a[0]+"&#176;, lat: "+a[1]+"&#176;")}if(r.originalEvent.ctrlKey&&this.draggedObject){if(!e.tb.enableDraggingObjects)return;t="altitude",this.getCanvasContainer().style.cursor="move";let i=r.point.y*this.tb.altitudeStep,n=[this.draggedObject.coordinates[0],this.draggedObject.coordinates[1],Number((-i-s).toFixed(this.tb.gridStep))];return this.draggedObject.setCoords(n),void this.draggedObject.addHelp("alt: "+n[2]+"m")}let u=[];if(e.tb.enableSelectingObjects&&(u=this.tb.queryRenderedFeatures(r.point)),a="object"==typeof u[0],a){let e=x.prototype.findParent3DObject(u[0]);e&&(this.unoverFeature(this.overedFeature),this.getCanvasContainer().style.cursor="pointer",this.selectedObject&&e.uuid==this.selectedObject.uuid||(this.overedObject&&(this.overedObject.over=!1,this.overedObject=null),e.over=!0,this.overedObject=e),this.repaint=!0,r.preventDefault())}else{this.overedObject&&(this.overedObject.over=!1,this.overedObject=null);let t=[];e.tb.enableSelectingFeatures&&(t=this.queryRenderedFeatures(r.point)),t.length>0&&(this.unoverFeature(t[0]),"fill-extrusion"==t[0].layer.type&&void 0!==t[0].id&&(this.selectedFeature&&this.selectedFeature.id==t[0].id||(this.getCanvasContainer().style.cursor="pointer",this.overedFeature=t[0],this.setFeatureState({source:this.overedFeature.source,sourceLayer:this.overedFeature.sourceLayer,id:this.overedFeature.id},{hover:!0}),this.overedFeature=e.queryRenderedFeatures({layers:[this.overedFeature.layer.id],filter:["==",["id"],this.overedFeature.id]})[0],this.addTooltip(this.overedFeature))))}},this.onMouseDown=function(t){(t.originalEvent.shiftKey||t.originalEvent.altKey||t.originalEvent.ctrlKey)&&0===t.originalEvent.button&&this.selectedObject&&(e.tb.enableDraggingObjects||e.tb.enableRotatingObjects)&&(t.preventDefault(),e.getCanvasContainer().style.cursor="move",e.once("mouseup",this.onMouseUp),this.draggedObject=this.selectedObject,i=h(t),c=this.draggedObject.coordinates,l=a.degreeify(this.draggedObject.rotation),n=c[0]-t.lngLat.lng,o=c[1]-t.lngLat.lat,s=-this.draggedObject.modelHeight-t.point.y*this.tb.altitudeStep)},this.onMouseUp=function(e){this.getCanvasContainer().style.cursor="default",this.off("mouseup",this.onMouseUp),this.off("mouseout",this.onMouseUp),this.dragPan.enable(),this.draggedObject&&(this.draggedObject.dispatchEvent(new CustomEvent("ObjectDragged",{detail:{draggedObject:this.draggedObject,draggedAction:t},bubbles:!0,cancelable:!0})),this.draggedObject.removeHelp(),this.draggedObject=null,t=null)},this.onMouseOut=function(e){if(this.overedFeature){let t=this.queryRenderedFeatures(e.point);t.length>0&&this.overedFeature.id!=t[0].id&&(this.getCanvasContainer().style.cursor="default",this.unoverFeature(t[0]))}},this.onZoomEnd=function(e){this.tb.zoomLayers.forEach((e=>{this.tb.toggleLayer(e)}))};let u=!1,d=!1;dK=68,this.on("click",this.onClick),this.on("mousemove",this.onMouseMove),this.on("mouseout",this.onMouseOut),this.on("mousedown",this.onMouseDown),this.on("zoom",this.onZoomEnd),document.addEventListener("keydown",function(e){17!==e.which&&91!==e.which||(u=!0),16===e.which&&(d=!0);let t=this.selectedObject;if(d&&83===e.which&&t){let e=a.toDecimal;if(t.help)t.removeHelp();else{let i=t.modelSize,r=1;"meters"!==t.userData.units&&(r=a.projectedUnitsPerMeter(t.coordinates[1]),r||(r=1),r=e(r,7)),t.addHelp("size(m): "+e(i.x/r,3)+" W, "+e(i.y/r,3)+" L, "+e(i.z/r,3)+" H"),this.repaint=!0}return!1}}.bind(this),!0),document.addEventListener("keyup",function(e){17!=e.which&&91!=e.which||(u=!1),16===e.which&&(d=!1)}.bind(this))}))},get fov(){return this.options.fov},set fov(e){this.camera instanceof r.PerspectiveCamera&&this.options.fov!==e&&(this.map.transform.fov=e,this.camera.fov=this.map.transform.fov,this.cameraSync.setupCamera(),this.map.repaint=!0,this.options.fov=e)},get orthographic(){return this.options.orthographic},set orthographic(e){const t=this.map.getCanvas().clientHeight,i=this.map.getCanvas().clientWidth;e?(this.map.transform.fov=0,this.camera=new r.OrthographicCamera(i/-2,i/2,t/2,t/-2,1,1e21)):(this.map.transform.fov=this.fov,this.camera=new r.PerspectiveCamera(this.map.transform.fov,i/t,1,1e21)),this.camera.layers.enable(0),this.camera.layers.enable(1),this.cameraSync=new n(this.map,this.camera,this.world),this.map.repaint=!0,this.options.orthographic=e},sphere:function(e){return this.setDefaultView(e,this.options),h(e,this.world)},line:g,label:d,tooltip:p,tube:function(e){return this.setDefaultView(e,this.options),y(e,this.world)},extrusion:function(e){return this.setDefaultView(e,this.options),u(e)},Object3D:function(e){return this.setDefaultView(e,this.options),m(e)},loadObj:async function(e,t){this.setDefaultView(e,this.options);let i=this.objectsCache.get(e.obj);i?i.promise.then((i=>{t(i.duplicate(e))})).catch((t=>{this.objectsCache.delete(e.obj),console.error("Could not load model file: "+e.obj)})):this.objectsCache.set(e.obj,{promise:new Promise((async(i,r)=>{f(e,t,(async e=>{e.duplicate?i(e.duplicate()):r(e)}))}))})},material:function(e){return c(e)},initLights:{ambientLight:null,dirLight:null,dirLightBack:null,dirLightHelper:null,hemiLight:null,pointLight:null},utils:a,SunCalc:o,Constants:s,projectToWorld:function(e){return this.utils.projectToWorld(e)},unprojectFromWorld:function(e){return this.utils.unprojectFromWorld(e)},projectedUnitsPerMeter:function(e){return this.utils.projectedUnitsPerMeter(e)},getFeatureCenter:function(e,t,i){return a.getFeatureCenter(e,t,i)},getObjectHeightOnFloor:function(e,t,i){return a.getObjectHeightOnFloor(e,t,i)},queryRenderedFeatures:function(e){let t=new r.Vector2;return t.x=e.x/this.map.transform.width*2-1,t.y=1-e.y/this.map.transform.height*2,this.raycaster.setFromCamera(t,this.camera),this.raycaster.intersectObjects(this.world.children,!0)},findParent3DObject:function(e){var t;return e.object.traverseAncestors((function(e){e.parent&&"Group"==e.parent.type&&e.userData.obj&&(t=e)})),t},setLayoutProperty:function(e,t,i){this.map.setLayoutProperty(e,t,i),null==i||"visibility"!==t||this.world.children.forEach((function(t){t.layer===e&&(t.visibility=i)}))},setLayerZoomRange:function(e,t,i){this.map.getLayer(e)&&(this.map.setLayerZoomRange(e,t,i),this.zoomLayers.includes(e)||this.zoomLayers.push(e),this.toggleLayer(e))},setLayerHeigthProperty:function(e,t){let i=this.map.getLayer(e);if(i)if("fill-extrusion"==i.type){let e=this.map.getStyle().sources[i.source].data;e.features.forEach((function(e){e.properties.level=t})),this.map.getSource(i.source).setData(e)}else"custom"==i.type&&this.world.children.forEach((function(i){let r=i.userData.feature;if(r&&r.layer===e){let e=this.tb.getFeatureCenter(r,i,t);i.setCoords(e)}}))},setStyle:function(e,t){this.clear().then((()=>{this.map.setStyle(e,t)}))},toggleLayer:function(e,t=!0){let i=this.map.getLayer(e);if(i){if(!t)return void this.toggle(i.id,!1);let e=this.map.getZoom();if(i.minzoom&&e<i.minzoom)return void this.toggle(i.id,!1);if(i.maxzoom&&e>=i.maxzoom)return void this.toggle(i.id,!1);this.toggle(i.id,!0)}},toggle:function(e,t){this.setLayoutProperty(e,"visibility",t?"visible":"none"),this.labelRenderer.toggleLabels(e,t)},update:function(){this.map.repaint&&(this.map.repaint=!1);var e=Date.now();this.objects.animationManager.update(e),this.updateLightHelper(),this.renderer.state.reset(),this.renderer.render(this.scene,this.camera),this.labelRenderer.render(this.scene,this.camera),!1===this.options.passiveRendering&&this.map.triggerRepaint()},add:function(e,t,i){if(!this.enableTooltips&&e.tooltip&&(e.tooltip.visibility=!1),this.world.add(e),t){e.layer=t,e.source=i;let r=this.map.getLayer(t);if(r){let t=r.visibility,i=void 0===t;e.visibility=!(!i&&"visible"!==t)}}},remove:function(e){this.map.selectedObject&&e.uuid==this.map.selectedObject.uuid&&this.map.unselectObject(this.map.selectedObject),this.map.draggedObject&&e.uuid==this.map.draggedObject.uuid&&(this.map.draggedObject=null),e.dispose&&e.dispose(),this.world.remove(e),e=null},clear:async function(e=null,t=!1){return new Promise(((i,r)=>{let n=[];this.world.children.forEach((function(e){n.push(e)}));for(let t=0;t<n.length;t++){let i=n[t];i.layer!==e&&e||this.remove(i)}t&&this.objectsCache.forEach((e=>{e.promise.then((e=>{e.dispose(),e=null}))})),i("clear")}))},removeLayer:function(e){this.clear(e,!0).then((()=>{this.map.removeLayer(e)}))},getSunPosition:function(e,t){return o.getPosition(e,t[1],t[0])},getSunTimes:function(e,t){return o.getTimes(e,t[1],t[0],t[2]?t[2]:0)},setBuildingShadows:function(e){if(this.map.getLayer(e.buildingsLayerId)){let t=new _(e,this);this.map.addLayer(t,e.buildingsLayerId)}else console.warn("The layer '"+e.buildingsLayerId+"' does not exist in the map.")},setSunlight:function(e=new Date,t){if(!this.lights.dirLight||!this.options.realSunlight)return void console.warn("To use setSunlight it's required to set realSunlight : true in Threebox initial options.");var i=new Date(e.getTime());if(t?t.lng&&t.lat?this.mapCenter=t:this.mapCenter={lng:t[0],lat:t[1]}:this.mapCenter=this.map.getCenter(),this.lightDateTime&&this.lightDateTime.getTime()===i.getTime()&&this.lightLng===this.mapCenter.lng&&this.lightLat===this.mapCenter.lat)return;this.lightDateTime=i,this.lightLng=this.mapCenter.lng,this.lightLat=this.mapCenter.lat,this.sunPosition=this.getSunPosition(i,[this.mapCenter.lng,this.mapCenter.lat]);let r=this.sunPosition.altitude,n=Math.PI+this.sunPosition.azimuth,a=s.WORLD_SIZE/2,o=Math.sin(r),l=Math.cos(r),c=Math.cos(n)*l,h=Math.sin(n)*l;this.lights.dirLight.position.set(h,c,o),this.lights.dirLight.position.multiplyScalar(a),this.lights.dirLight.intensity=Math.max(o,-.15),this.lights.dirLight.updateMatrixWorld(),this.updateLightHelper(),this.map.loaded()&&this.map.setLight({anchor:"map",position:[1.5,180+180*this.sunPosition.azimuth/Math.PI,90-180*this.sunPosition.altitude/Math.PI],"position-transition":{duration:0},color:`hsl(40, ${50*Math.cos(this.sunPosition.altitude)}%, ${96*Math.sin(this.sunPosition.altitude)}%)`},{duration:0})},updateLightHelper:function(){this.lights.dirLightHelper&&(this.lights.dirLightHelper.position.setFromMatrixPosition(this.lights.dirLight.matrixWorld),this.lights.dirLightHelper.updateMatrix(),this.lights.dirLightHelper.update())},dispose:async function(){return console.log(this.memory()),new Promise((e=>{e(this.clear(null,!0).then((e=>(this.map.remove(),this.map={},this.scene.remove(this.world),this.scene.dispose(),this.world.children=[],this.world=null,this.objectsCache.clear(),this.labelRenderer.dispose(),console.log(this.memory()),this.renderer.dispose(),e))))}))},defaultLights:function(){this.lights.ambientLight=new r.AmbientLight(new r.Color("hsl(0, 0%, 100%)"),.75),this.scene.add(this.lights.ambientLight),this.lights.dirLightBack=new r.DirectionalLight(new r.Color("hsl(0, 0%, 100%)"),.25),this.lights.dirLightBack.position.set(30,100,100),this.scene.add(this.lights.dirLightBack),this.lights.dirLight=new r.DirectionalLight(new r.Color("hsl(0, 0%, 100%)"),.25),this.lights.dirLight.position.set(-30,100,-100),this.scene.add(this.lights.dirLight)},realSunlight:function(e=!1){this.renderer.shadowMap.enabled=!0,this.lights.dirLight=new r.DirectionalLight(16777215,1),this.scene.add(this.lights.dirLight),e&&(this.lights.dirLightHelper=new r.DirectionalLightHelper(this.lights.dirLight,5),this.scene.add(this.lights.dirLightHelper)),this.lights.dirLight.castShadow=!0,this.lights.dirLight.shadow.radius=2,this.lights.dirLight.shadow.mapSize.width=8192,this.lights.dirLight.shadow.mapSize.height=8192,this.lights.dirLight.shadow.camera.top=this.lights.dirLight.shadow.camera.right=1e3,this.lights.dirLight.shadow.camera.bottom=this.lights.dirLight.shadow.camera.left=-1e3,this.lights.dirLight.shadow.camera.near=1,this.lights.dirLight.shadow.camera.visible=!0,this.lights.dirLight.shadow.camera.far=4e8,this.lights.hemiLight=new r.HemisphereLight(new r.Color(16777215),new r.Color(16777215),.6),this.lights.hemiLight.color.setHSL(.661,.96,.12),this.lights.hemiLight.groundColor.setHSL(.11,.96,.14),this.lights.hemiLight.position.set(0,0,50),this.scene.add(this.lights.hemiLight),this.setSunlight()},setDefaultView:function(e,t){e.bbox=e.bbox||t.enableSelectingObjects,e.tooltip=e.tooltip||t.enableTooltips},memory:function(){return this.renderer.info.memory},programs:function(){return this.renderer.info.programs.length},version:"2.1.6"};var b={defaultLights:!1,realSunlight:!1,realSunlightHelper:!1,passiveRendering:!0,enableSelectingFeatures:!1,enableSelectingObjects:!1,enableDraggingObjects:!1,enableRotatingObjects:!1,enableTooltips:!1,multiLayer:!1,orthographic:!1,fov:s.FOV_DEGREES};t.exports=x},{"./camera/CameraSync.js":4,"./objects/LabelRenderer.js":6,"./objects/Object3D.js":7,"./objects/effects/BuildingShadows.js":9,"./objects/extrusion.js":10,"./objects/label.js":11,"./objects/line.js":12,"./objects/loadObj.js":13,"./objects/objects.js":19,"./objects/sphere.js":20,"./objects/tooltip.js":21,"./objects/tube.js":22,"./three.js":23,"./utils/constants.js":24,"./utils/material.js":25,"./utils/suncalc.js":26,"./utils/utils.js":27}],3:[function(e,t,i){const r=e("../three.js"),n=e("../utils/utils.js");function a(e){this.map=e,this.enrolledObjects=[],this.previousFrameTime}a.prototype={unenroll:function(e){this.enrolledObjects.splice(this.enrolledObjects.indexOf(e),1)},enroll:function(e){if(e.clock=new r.Clock,e.hasDefaultAnimation=!1,e.defaultAction,e.actions=[],e.mixer,e.animations&&e.animations.length>0){e.hasDefaultAnimation=!0;let i=e.userData.defaultAnimation?e.userData.defaultAnimation:0;e.mixer=new r.AnimationMixer(e),t(i)}function t(t){for(let i=0;i<e.animations.length;i++){t>e.animations.length&&console.log("The animation index "+t+" doesn't exist for this object");let r=e.animations[i],n=e.mixer.clipAction(r);e.actions.push(n),t===i?(e.defaultAction=n,n.setEffectiveWeight(1)):n.setEffectiveWeight(0),n.play()}}let i=!1;Object.defineProperty(e,"isPlaying",{get:()=>i,set(t){i!=t&&(i=t,e.dispatchEvent(new CustomEvent("IsPlayingChanged",{detail:e,bubbles:!0,cancelable:!0})))}}),this.enrolledObjects.push(e),e.animationQueue=[],e.set=function(t){if(t.duration>0){let i={start:Date.now(),expiration:Date.now()+t.duration,endState:{}};n.extend(t,i);let a=t.coords,o=t.rotation,s=t.scale||t.scaleX||t.scaleY||t.scaleZ;if(o){let i=e.rotation;t.startRotation=[i.x,i.y,i.z],t.endState.rotation=n.types.rotation(t.rotation,t.startRotation),t.rotationPerMs=t.endState.rotation.map((function(e,i){return(e-t.startRotation[i])/t.duration}))}if(s){let i=e.scale;t.startScale=[i.x,i.y,i.z],t.endState.scale=n.types.scale(t.scale,t.startScale),t.scalePerMs=t.endState.scale.map((function(e,i){return(e-t.startScale[i])/t.duration}))}a&&(t.pathCurve=new r.CatmullRomCurve3(n.lnglatsToWorld([e.coordinates,t.coords])));let l={type:"set",parameters:t};this.animationQueue.push(l),tb.map.repaint=!0}else this.stop(),t.rotation=n.radify(t.rotation),this._setObject(t);return this},e.animationMethod=null,e.stop=function(t){return e.mixer&&(e.isPlaying=!1,cancelAnimationFrame(e.animationMethod)),this.animationQueue=[],this},e.followPath=function(e,t){let i={type:"followPath",parameters:n._validate(e,o.followPath)};return n.extend(i.parameters,{pathCurve:new r.CatmullRomCurve3(n.lnglatsToWorld(e.path)),start:Date.now(),expiration:Date.now()+i.parameters.duration,cb:t}),this.animationQueue.push(i),tb.map.repaint=!0,this},e._setObject=function(e){let t=e.position,i=e.rotation,r=e.scale,a=e.worldCoordinates,o=e.quaternion,s=e.translate;if(t){this.coordinates=t;let e=n.projectToWorld(t);this.position.copy(e)}if(s){this.coordinates=[this.coordinates[0]+s[0],this.coordinates[1]+s[1],this.coordinates[2]+s[2]];let e=n.projectToWorld(s);this.translateX(e.x),this.translateY(e.y),this.translateZ(e.z)}if(i&&this.rotation.set(i[0],i[1],i[2]),r&&this.scale.set(r[0],r[1],r[2]),o&&this.quaternion.setFromAxisAngle(o[0],o[1]),a){this.position.copy(a);let e=n.unprojectFromWorld(a);this.coordinates=e}this.updateMatrixWorld(),tb.map.repaint=!0},e.playDefault=function(t){if(e.mixer&&e.hasDefaultAnimation){let i={start:Date.now(),expiration:Date.now()+t.duration,endState:{}};n.extend(t,i),e.mixer.timeScale=t.speed||1;let r={type:"playDefault",parameters:t};return this.animationQueue.push(r),tb.map.repaint=!0,this}},e.playAnimation=function(i){e.mixer&&(i.animation&&t(i.animation),e.playDefault(i))},e.pauseAllActions=function(){e.mixer&&e.actions.forEach((function(e){e.paused=!0}))},e.unPauseAllActions=function(){e.mixer&&e.actions.forEach((function(e){e.paused=!1}))},e.deactivateAllActions=function(){e.mixer&&e.actions.forEach((function(e){e.stop()}))},e.activateAllActions=function(){e.mixer&&e.actions.forEach((function(e){e.play()}))},e.idle=function(){return e.mixer&&e.mixer.update(.01),tb.map.repaint=!0,this}},update:function(e){if(void 0===this.previousFrameTime&&(this.previousFrameTime=e),!this.enrolledObjects)return!1;for(let t=this.enrolledObjects.length-1;t>=0;t--){let i=this.enrolledObjects[t];if(i.animationQueue&&0!==i.animationQueue.length)for(let t=i.animationQueue.length-1;t>=0;t--){let n=i.animationQueue[t];if(!n)continue;let a=n.parameters;if(!a.expiration)return i.animationQueue.splice(t,1),void(i.animationQueue[t]&&(i.animationQueue[t].parameters.start=e));if(e>=a.expiration)a.expiration=!1,"playDefault"===n.type?i.stop():(a.endState&&i._setObject(a.endState),void 0!==a.cb&&a.cb());else{let t=(e-a.start)/a.duration;if("set"===n.type){let e={};a.pathCurve&&(e.worldCoordinates=a.pathCurve.getPoint(t)),a.rotationPerMs&&(e.rotation=a.startRotation.map((function(e,i){return e+a.rotationPerMs[i]*t*a.duration}))),a.scalePerMs&&(e.scale=a.startScale.map((function(e,i){return e+a.scalePerMs[i]*t*a.duration}))),i._setObject(e)}if("followPath"===n.type){let e=a.pathCurve.getPointAt(t);if(objectState={worldCoordinates:e},a.trackHeading){let e=a.pathCurve.getTangentAt(t).normalize(),i=new r.Vector3(0,0,0),n=new r.Vector3(0,1,0);i.crossVectors(n,e).normalize();let o=Math.acos(n.dot(e));objectState.quaternion=[i,o]}i._setObject(objectState)}"playDefault"===n.type&&(i.activateAllActions(),i.isPlaying=!0,i.animationMethod=requestAnimationFrame(this.update),i.mixer.update(i.clock.getDelta()),tb.map.repaint=!0)}}}this.previousFrameTime=e}};const o={followPath:{path:null,duration:1e3,trackHeading:!0}};t.exports=a},{"../three.js":23,"../utils/utils.js":27}],4:[function(e,t,i){const r=e("../three.js"),n=e("../utils/utils.js"),a=e("../utils/constants.js");function o(e,t,i){this.map=e,this.camera=t,this.active=!0,this.camera.matrixAutoUpdate=!1,this.world=i||new r.Group,this.world.position.x=this.world.position.y=a.WORLD_SIZE/2,this.world.matrixAutoUpdate=!1,this.state={translateCenter:(new r.Matrix4).makeTranslation(a.WORLD_SIZE/2,-a.WORLD_SIZE/2,0),worldSizeRatio:a.TILE_SIZE/a.WORLD_SIZE,worldSize:a.TILE_SIZE*this.map.transform.scale};let n=this;this.map.on("move",(function(){n.updateCamera()})).on("resize",(function(){n.setupCamera()})),this.setupCamera()}o.prototype={setupCamera:function(){this.state.fov=this.map.transform._fov;const e=this.map.transform;this.camera.aspect=e.width/e.height,this.camera.updateProjectionMatrix(),this.halfFov=this.state.fov/2;const t={x:e.width/2,y:e.height/2},i=.5/Math.tan(this.halfFov)*e.height,n=e._maxPitch*Math.PI/180;this.acuteAngle=Math.PI/2-n,this.state.cameraToCenterDistance=i,this.state.offset=t,this.state.cameraTranslateZ=(new r.Matrix4).makeTranslation(0,0,this.state.cameraToCenterDistance),this.state.maxFurthestDistance=.95*this.state.cameraToCenterDistance*(Math.cos(this.acuteAngle)*Math.sin(this.halfFov)/Math.sin(Math.max(.01,Math.min(Math.PI-.01,this.acuteAngle-this.halfFov)))+1),this.updateCamera()},updateCamera:function(e){if(!this.camera)return void console.log("nocamera");const t=this.map.transform,i=Math.PI/2+t._pitch;this.cameraToCenterDistance=.5/Math.tan(this.halfFov)*t.height,this.state.cameraTranslateZ=(new r.Matrix4).makeTranslation(0,0,this.cameraToCenterDistance);const a=Math.sin(this.halfFov)*this.state.cameraToCenterDistance/Math.sin(Math.PI-i-this.halfFov),o=Math.cos(Math.PI/2-t._pitch),s=1.01*(o*a+this.state.cameraToCenterDistance),l=t.height/50,c=Math.max(l*o,l),h=t.height,u=t.width;this.camera instanceof r.OrthographicCamera?this.camera.projectionMatrix=n.makeOrthographicMatrix(u/-2,u/2,h/2,h/-2,c,s):this.camera.projectionMatrix=n.makePerspectiveMatrix(this.state.fov,u/h,c,s);let d=this.calcCameraMatrix(t._pitch,t.angle);this.camera.matrixWorld.copy(d);let p=t.scale*this.state.worldSizeRatio,f=new r.Matrix4,m=new r.Matrix4,g=new r.Matrix4;f.makeScale(p,p,p);let y=t.x||t.point.x,v=t.y||t.point.y;m.makeTranslation(-y,v,0),g.makeRotationZ(Math.PI),this.world.matrix=(new r.Matrix4).premultiply(g).premultiply(this.state.translateCenter).premultiply(f).premultiply(m)},calcCameraMatrix(e,t,i){const n=this.map.transform,a=void 0===e?n._pitch:e,o=void 0===t?n.angle:t,s=void 0===i?this.state.cameraTranslateZ:i;return(new r.Matrix4).premultiply(s).premultiply((new r.Matrix4).makeRotationX(a)).premultiply((new r.Matrix4).makeRotationZ(o))}},t.exports=o},{"../three.js":23,"../utils/constants.js":24,"../utils/utils.js":27}],5:[function(e,t,i){const r=e("../three.js");r.CSS2DObject=function(e){r.Object3D.call(this),this.element=e||document.createElement("div"),this.element.style.position="absolute",this.alwaysVisible=!1,Object.defineProperty(this,"layer",{get(){return this.parent&&this.parent.parent?this.parent.parent.layer:null}}),this.dispose=function(){this.remove(),this.element=null},this.remove=function(){this.element instanceof Element&&null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element)},this.addEventListener("removed",(function(){this.remove()}))},r.CSS2DObject.prototype=Object.assign(Object.create(r.Object3D.prototype),{constructor:r.CSS2DObject,copy:function(e,t){return r.Object3D.prototype.copy.call(this,e,t),this.element=e.element.cloneNode(!0),this}}),r.CSS2DRenderer=function(){var e,t,i,n,a=this,o=new r.Vector3,s=new r.Matrix4,l=new r.Matrix4,c={objects:new WeakMap,list:new Map};this.cacheList=c.list;var h=document.createElement("div");h.style.overflow="hidden",this.domElement=h,this.getSize=function(){return{width:e,height:t}},this.setSize=function(r,a){i=(e=r)/2,n=(t=a)/2,h.style.width=r+"px",h.style.height=a+"px"},this.renderObject=function(e,t,s){if(e instanceof r.CSS2DObject)if(e.visible){e.onBeforeRender(a,t,s),o.setFromMatrixPosition(e.matrixWorld),o.applyMatrix4(l);var u=e.element,d="translate(-50%,-50%) translate("+(o.x*i+i)+"px,"+(-o.y*n+n)+"px)";u.style.WebkitTransform=d,u.style.MozTransform=d,u.style.oTransform=d,u.style.transform=d,u.style.display=e.visible&&o.z>=-1&&o.z<=1?"":"none";var f={distanceToCameraSquared:p(s,e)};c.objects.set({key:e.uuid},f),c.list.set(e.uuid,e),u.parentNode!==h&&h.appendChild(u),e.onAfterRender(a,t,s)}else c.objects.delete({key:e.uuid}),c.list.delete(e.uuid),e.remove();for(var m=0,g=e.children.length;m<g;m++)this.renderObject(e.children[m],t,s)};var u,d,p=(u=new r.Vector3,d=new r.Vector3,function(e,t){return u.setFromMatrixPosition(e.matrixWorld),d.setFromMatrixPosition(t.matrixWorld),u.distanceToSquared(d)});this.render=function(e,t){!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),s.copy(t.matrixWorldInverse),l.multiplyMatrices(t.projectionMatrix,s),this.renderObject(e,e,t),function(e){for(var t=function(e){var t=[];return e.traverse((function(e){e instanceof r.CSS2DObject&&t.push(e)})),t}(e).sort((function(e,t){let i=c.objects.get({key:e.uuid}),r=c.objects.get({key:t.uuid});if(i&&r)return i.distanceToCameraSquared-r.distanceToCameraSquared})),i=t.length,n=0,a=t.length;n<a;n++)t[n].element.style.zIndex=i-n}(e)}},t.exports={CSS2DRenderer:r.CSS2DRenderer,CSS2DObject:r.CSS2DObject}},{"../three.js":23}],6:[function(e,t,i){const r=e("./CSS2DRenderer.js");t.exports=function(e){this.map=e,this.renderer=new r.CSS2DRenderer,this.renderer.setSize(this.map.getCanvas().clientWidth,this.map.getCanvas().clientHeight),this.renderer.domElement.style.position="absolute",this.renderer.domElement.id="labelCanvas",this.renderer.domElement.style.top=0,this.renderer.domElement.style.zIndex="0",this.map.getCanvasContainer().appendChild(this.renderer.domElement),this.scene,this.camera,this.dispose=function(){this.map.getCanvasContainer().removeChild(this.renderer.domElement),this.renderer.domElement.remove(),this.renderer={}},this.setSize=function(e,t){this.renderer.setSize(e,t)},this.map.on("resize",function(){this.renderer.setSize(this.map.getCanvas().clientWidth,this.map.getCanvas().clientHeight)}.bind(this)),this.state={reset:function(){}},this.render=async function(e,t){return this.scene=e,this.camera=t,new Promise((i=>{i(this.renderer.render(e,t))}))},this.toggleLabels=async function(e,t){return new Promise((i=>{i(this.setVisibility(e,t,this.scene,this.camera,this.renderer))}))},this.setVisibility=function(e,t,i,r,n){this.renderer.cacheList.forEach((function(a){a.visible!=t&&a.layer===e&&(t&&a.alwaysVisible||!t)&&(a.visible=t,n.renderObject(a,i,r))}))}}},{"./CSS2DRenderer.js":5}],7:[function(e,t,i){const r=e("./objects.js"),n=e("../utils/utils.js");t.exports=function(e){let t=(e=n._validate(e,r.prototype._defaults.Object3D)).obj;const i=n.types.rotation(e.rotation,[0,0,0]),a=n.types.scale(e.scale,[1,1,1]);t.rotation.set(i[0],i[1],i[2]),t.scale.set(a[0],a[1],a[2]),t.name="model";let o=r.prototype._makeGroup(t,e);return e.obj.name="model",r.prototype._addMethods(o),o.setAnchor(e.anchor),o.setCenter(e.adjustment),o.raycasted=e.raycasted,o.visibility=!0,o}},{"../utils/utils.js":27,"./objects.js":19}],8:[function(e,t,i){var r={},n=void 0,a=r;function o(e,t){var i,r=e.split("."),o=a;!(r[0]in o)&&o.execScript&&o.execScript("var "+r[0]);for(;r.length&&(i=r.shift());)r.length||t===n?o=o[i]?o[i]:o[i]={}:o[i]=t}var s="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function l(e){var t,i,r,n,a,o,l,c,h,u,d=e.length,p=0,f=Number.POSITIVE_INFINITY;for(c=0;c<d;++c)e[c]>p&&(p=e[c]),e[c]<f&&(f=e[c]);for(t=1<<p,i=new(s?Uint32Array:Array)(t),r=1,n=0,a=2;r<=p;){for(c=0;c<d;++c)if(e[c]===r){for(o=0,l=n,h=0;h<r;++h)o=o<<1|1&l,l>>=1;for(u=r<<16|c,h=o;h<t;h+=a)i[h]=u;++n}++r,n<<=1,a<<=1}return[i,p,f]}function c(e,t){switch(this.g=[],this.h=32768,this.d=this.f=this.a=this.l=0,this.input=s?new Uint8Array(e):e,this.m=!1,this.i=u,this.r=!1,!t&&(t={})||(t.index&&(this.a=t.index),t.bufferSize&&(this.h=t.bufferSize),t.bufferType&&(this.i=t.bufferType),t.resize&&(this.r=t.resize)),this.i){case h:this.b=32768,this.c=new(s?Uint8Array:Array)(32768+this.h+258);break;case u:this.b=0,this.c=new(s?Uint8Array:Array)(this.h),this.e=this.z,this.n=this.v,this.j=this.w;break;default:throw Error("invalid inflate mode")}}var h=0,u=1,d={t:h,s:u};c.prototype.k=function(){for(;!this.m;){var e=I(this,3);switch(1&e&&(this.m=!0),e>>>=1){case 0:var t=this.input,i=this.a,r=this.c,a=this.b,o=t.length,c=n,d=r.length,p=n;if(this.d=this.f=0,i+1>=o)throw Error("invalid uncompressed block header: LEN");if(c=t[i++]|t[i++]<<8,i+1>=o)throw Error("invalid uncompressed block header: NLEN");if(c===~(t[i++]|t[i++]<<8))throw Error("invalid uncompressed block header: length verify");if(i+c>t.length)throw Error("input buffer is broken");switch(this.i){case h:for(;a+c>r.length;){if(c-=p=d-a,s)r.set(t.subarray(i,i+p),a),a+=p,i+=p;else for(;p--;)r[a++]=t[i++];this.b=a,r=this.e(),a=this.b}break;case u:for(;a+c>r.length;)r=this.e({p:2});break;default:throw Error("invalid inflate mode")}if(s)r.set(t.subarray(i,i+c),a),a+=c,i+=c;else for(;c--;)r[a++]=t[i++];this.a=i,this.b=a,this.c=r;break;case 1:this.j(C,P);break;case 2:var f,m,y,v,_=I(this,5)+257,x=I(this,5)+1,b=I(this,4)+4,w=new(s?Uint8Array:Array)(g.length),M=n,T=n,S=n,E=n,A=n;for(A=0;A<b;++A)w[g[A]]=I(this,3);if(!s)for(A=b,b=w.length;A<b;++A)w[g[A]]=0;for(f=l(w),M=new(s?Uint8Array:Array)(_+x),A=0,v=_+x;A<v;)switch(T=R(this,f),T){case 16:for(E=3+I(this,2);E--;)M[A++]=S;break;case 17:for(E=3+I(this,3);E--;)M[A++]=0;S=0;break;case 18:for(E=11+I(this,7);E--;)M[A++]=0;S=0;break;default:S=M[A++]=T}m=l(s?M.subarray(0,_):M.slice(0,_)),y=l(s?M.subarray(_):M.slice(_)),this.j(m,y);break;default:throw Error("unknown BTYPE: "+e)}}return this.n()};var p,f,m=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],g=s?new Uint16Array(m):m,y=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],v=s?new Uint16Array(y):y,_=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],x=s?new Uint8Array(_):_,b=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],w=s?new Uint16Array(b):b,M=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],T=s?new Uint8Array(M):M,S=new(s?Uint8Array:Array)(288);for(p=0,f=S.length;p<f;++p)S[p]=143>=p?8:255>=p?9:279>=p?7:8;var E,A,C=l(S),L=new(s?Uint8Array:Array)(30);for(E=0,A=L.length;E<A;++E)L[E]=5;var P=l(L);function I(e,t){for(var i,r=e.f,n=e.d,a=e.input,o=e.a,s=a.length;n<t;){if(o>=s)throw Error("input buffer is broken");r|=a[o++]<<n,n+=8}return i=r&(1<<t)-1,e.f=r>>>t,e.d=n-t,e.a=o,i}function R(e,t){for(var i,r,n=e.f,a=e.d,o=e.input,s=e.a,l=o.length,c=t[0],h=t[1];a<h&&!(s>=l);)n|=o[s++]<<a,a+=8;if((r=(i=c[n&(1<<h)-1])>>>16)>a)throw Error("invalid code length: "+r);return e.f=n>>r,e.d=a-r,e.a=s,65535&i}function D(e,t){var i,r;switch(this.input=e,this.a=0,!t&&(t={})||(t.index&&(this.a=t.index),t.verify&&(this.A=t.verify)),i=e[this.a++],r=e[this.a++],15&i){case k:this.method=k;break;default:throw Error("unsupported compression method")}if(0!=((i<<8)+r)%31)throw Error("invalid fcheck flag:"+((i<<8)+r)%31);if(32&r)throw Error("fdict flag is not supported");this.q=new c(e,{index:this.a,bufferSize:t.bufferSize,bufferType:t.bufferType,resize:t.resize})}c.prototype.j=function(e,t){var i=this.c,r=this.b;this.o=e;for(var n,a,o,s,l=i.length-258;256!==(n=R(this,e));)if(256>n)r>=l&&(this.b=r,i=this.e(),r=this.b),i[r++]=n;else for(s=v[a=n-257],0<x[a]&&(s+=I(this,x[a])),n=R(this,t),o=w[n],0<T[n]&&(o+=I(this,T[n])),r>=l&&(this.b=r,i=this.e(),r=this.b);s--;)i[r]=i[r++-o];for(;8<=this.d;)this.d-=8,this.a--;this.b=r},c.prototype.w=function(e,t){var i=this.c,r=this.b;this.o=e;for(var n,a,o,s,l=i.length;256!==(n=R(this,e));)if(256>n)r>=l&&(l=(i=this.e()).length),i[r++]=n;else for(s=v[a=n-257],0<x[a]&&(s+=I(this,x[a])),n=R(this,t),o=w[n],0<T[n]&&(o+=I(this,T[n])),r+s>l&&(l=(i=this.e()).length);s--;)i[r]=i[r++-o];for(;8<=this.d;)this.d-=8,this.a--;this.b=r},c.prototype.e=function(){var e,t,i=new(s?Uint8Array:Array)(this.b-32768),r=this.b-32768,n=this.c;if(s)i.set(n.subarray(32768,i.length));else for(e=0,t=i.length;e<t;++e)i[e]=n[e+32768];if(this.g.push(i),this.l+=i.length,s)n.set(n.subarray(r,r+32768));else for(e=0;32768>e;++e)n[e]=n[r+e];return this.b=32768,n},c.prototype.z=function(e){var t,i,r,n=this.input.length/this.a+1|0,a=this.input,o=this.c;return e&&("number"==typeof e.p&&(n=e.p),"number"==typeof e.u&&(n+=e.u)),i=2>n?(r=(a.length-this.a)/this.o[2]/2*258|0)<o.length?o.length+r:o.length<<1:o.length*n,s?(t=new Uint8Array(i)).set(o):t=o,this.c=t},c.prototype.n=function(){var e,t,i,r,n,a=0,o=this.c,l=this.g,c=new(s?Uint8Array:Array)(this.l+(this.b-32768));if(0===l.length)return s?this.c.subarray(32768,this.b):this.c.slice(32768,this.b);for(t=0,i=l.length;t<i;++t)for(r=0,n=(e=l[t]).length;r<n;++r)c[a++]=e[r];for(t=32768,i=this.b;t<i;++t)c[a++]=o[t];return this.g=[],this.buffer=c},c.prototype.v=function(){var e,t=this.b;return s?this.r?(e=new Uint8Array(t)).set(this.c.subarray(0,t)):e=this.c.subarray(0,t):(this.c.length>t&&(this.c.length=t),e=this.c),this.buffer=e},D.prototype.k=function(){var e,t,i=this.input;if(e=this.q.k(),this.a=this.q.a,this.A){t=(i[this.a++]<<24|i[this.a++]<<16|i[this.a++]<<8|i[this.a++])>>>0;var r=e;if("string"==typeof r){var n,a,o=r.split("");for(n=0,a=o.length;n<a;n++)o[n]=(255&o[n].charCodeAt(0))>>>0;r=o}for(var s,l=1,c=0,h=r.length,u=0;0<h;){h-=s=1024<h?1024:h;do{c+=l+=r[u++]}while(--s);l%=65521,c%=65521}if(t!==(c<<16|l)>>>0)throw Error("invalid adler-32 checksum")}return e};var k=8;o("Zlib.Inflate",D),o("Zlib.Inflate.prototype.decompress",D.prototype.k);var z,O,B,F,N={ADAPTIVE:d.s,BLOCK:d.t};if(Object.keys)z=Object.keys(N);else for(O in z=[],B=0,N)z[B++]=O;for(B=0,F=z.length;B<F;++B)o("Zlib.Inflate.BufferType."+(O=z[B]),N[O]);var U=r.Zlib;t.exports=U},{}],9:[function(e,t,i){e("../../utils/suncalc.js"),t.exports=class{constructor(e,t){this.id=e.layerId,this.type="custom",this.renderingMode="3d",this.opacity=.5,this.buildingsLayerId=e.buildingsLayerId,this.minAltitude=e.minAltitude||.1,this.tb=t}onAdd(e,t){this.map=e;const i=t.createShader(t.VERTEX_SHADER);t.shaderSource(i,"\n\t\t\tuniform mat4 u_matrix;\n\t\t\tuniform float u_height_factor;\n\t\t\tuniform float u_altitude;\n\t\t\tuniform float u_azimuth;\n\t\t\tattribute vec2 a_pos;\n\t\t\tattribute vec4 a_normal_ed;\n\t\t\tattribute lowp vec2 a_base;\n\t\t\tattribute lowp vec2 a_height;\n\t\t\tvoid main() {\n\t\t\t\tfloat base = max(0.0, a_base.x);\n\t\t\t\tfloat height = max(0.0, a_height.x);\n\t\t\t\tfloat t = mod(a_normal_ed.x, 2.0);\n\t\t\t\tvec4 pos = vec4(a_pos, t > 0.0 ? height : base, 1);\n\t\t\t\tfloat len = pos.z * u_height_factor / tan(u_altitude);\n\t\t\t\tpos.x += cos(u_azimuth) * len;\n\t\t\t\tpos.y += sin(u_azimuth) * len;\n\t\t\t\tpos.z = 0.0;\n\t\t\t\tgl_Position = u_matrix * pos;\n\t\t\t}\n\t\t\t"),t.compileShader(i);const r=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(r,"\n\t\t\tvoid main() {\n\t\t\t\tgl_FragColor = vec4(0.0, 0.0, 0.0, 0.7);\n\t\t\t}\n\t\t\t"),t.compileShader(r),this.program=t.createProgram(),t.attachShader(this.program,i),t.attachShader(this.program,r),t.linkProgram(this.program),t.validateProgram(this.program),this.uMatrix=t.getUniformLocation(this.program,"u_matrix"),this.uHeightFactor=t.getUniformLocation(this.program,"u_height_factor"),this.uAltitude=t.getUniformLocation(this.program,"u_altitude"),this.uAzimuth=t.getUniformLocation(this.program,"u_azimuth"),this.aPos=t.getAttribLocation(this.program,"a_pos"),this.aNormal=t.getAttribLocation(this.program,"a_normal_ed"),this.aBase=t.getAttribLocation(this.program,"a_base"),this.aHeight=t.getAttribLocation(this.program,"a_height")}render(e,t){e.useProgram(this.program);const i=this.map.style.sourceCaches.composite,r=i.getVisibleCoordinates().reverse(),n=this.map.getLayer(this.buildingsLayerId),a=this.map.painter.context,{lng:o,lat:s}=this.map.getCenter(),l=this.tb.getSunPosition(this.tb.lightDateTime,[o,s]);e.uniform1f(this.uAltitude,l.altitude>this.minAltitude?l.altitude:0),e.uniform1f(this.uAzimuth,l.azimuth+3*Math.PI/2),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.getExtension("EXT_blend_minmax"),e.disable(e.DEPTH_TEST);for(const t of r){const r=i.getTile(t),o=r.getBucket(n);if(!o)continue;const[s,l]=o.programConfigurations.programConfigurations[this.buildingsLayerId]._buffers;e.uniformMatrix4fv(this.uMatrix,!1,t.posMatrix),e.uniform1f(this.uHeightFactor,Math.pow(2,t.overscaledZ)/r.tileSize/8);for(const t of o.segments.get()){const i=a.currentNumAttributes||0,r=2;for(let t=r;t<i;t++)e.disableVertexAttribArray(t);const n=t.vertexOffset||0;e.enableVertexAttribArray(this.aPos),e.enableVertexAttribArray(this.aNormal),e.enableVertexAttribArray(this.aHeight),e.enableVertexAttribArray(this.aBase),o.layoutVertexBuffer.bind(),e.vertexAttribPointer(this.aPos,2,e.SHORT,!1,12,12*n),e.vertexAttribPointer(this.aNormal,4,e.SHORT,!1,12,4+12*n),s.bind(),e.vertexAttribPointer(this.aHeight,1,e.FLOAT,!1,4,4*n),l.bind(),e.vertexAttribPointer(this.aBase,1,e.FLOAT,!1,4,4*n),o.indexBuffer.bind(),a.currentNumAttributes=r,e.drawElements(e.TRIANGLES,3*t.primitiveLength,e.UNSIGNED_SHORT,3*t.primitiveOffset*2)}}}}},{"../../utils/suncalc.js":26}],10:[function(e,t,i){const r=e("./objects.js"),n=e("../utils/utils.js"),a=e("../three.js"),o=e("./Object3D.js");function s(e){e=n._validate(e,r.prototype._defaults.extrusion);let t=s.prototype.buildShape(e.coordinates),i=s.prototype.buildGeometry(t,e.geometryOptions),l=new a.Mesh(i,e.materials);return e.obj=l,new o(e)}s.prototype={buildShape:function(e){if(e[0]instanceof(a.Vector2||a.Vector3))return new a.Shape(e);let t=new a.Shape;for(let i=0;i<e.length;i++)0===i?t=new a.Shape(this.buildPoints(e[0],e[0])):t.holes.push(new a.Path(this.buildPoints(e[i],e[0])));return t},buildPoints:function(e,t){const i=[];let r=n.projectToWorld([t[0][0],t[0][1],0]);for(let t=0;t<e.length;t++){let o=n.projectToWorld([e[t][0],e[t][1],0]);i.push(new a.Vector2(n.toDecimal(o.x-r.x,9),n.toDecimal(o.y-r.y,9)))}return i},buildGeometry:function(e,t){let i=new a.ExtrudeBufferGeometry(e,t);return i.computeBoundingBox(),i}},t.exports=s},{"../three.js":23,"../utils/utils.js":27,"./Object3D.js":7,"./objects.js":19}],11:[function(e,t,i){const r=e("../utils/utils.js"),n=e("./objects.js"),a=e("./CSS2DRenderer.js");t.exports=function(e){e=r._validate(e,n.prototype._defaults.label);let t=n.prototype.drawLabelHTML(e.htmlElement,e.cssClass),i=new a.CSS2DObject(t);i.name="label",i.visible=e.alwaysVisible,i.alwaysVisible=e.alwaysVisible;var o=n.prototype._makeGroup(i,e);return n.prototype._addMethods(o),o.visibility=e.alwaysVisible,o}},{"../utils/utils.js":27,"./CSS2DRenderer.js":5,"./objects.js":19}],12:[function(e,t,i){const r=e("../three.js"),n=e("../utils/utils.js"),a=e("./objects.js");function o(e){e=n._validate(e,a.prototype._defaults.line);var t=n.lnglatsToWorld(e.geometry),i=n.normalizeVertices(t),s=n.flattenVectors(i.vertices);console.log("line",i.vertices);var l=new r.LineGeometry;return l.setPositions(s),matLine=new r.LineMaterial({color:e.color,linewidth:e.width,dashed:!1,opacity:e.opacity}),matLine.resolution.set(window.innerWidth,window.innerHeight),matLine.isMaterial=!0,matLine.transparent=!0,matLine.depthWrite=!1,(o=new r.Line2(l,matLine)).position.copy(i.position),o.computeLineDistances(),o}var s,l,c,h;t.exports=o,r.LineSegmentsGeometry=function(){r.InstancedBufferGeometry.call(this),this.type="LineSegmentsGeometry",new r.BufferGeometry,this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new r.Float32BufferAttribute([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new r.Float32BufferAttribute([0,1,1,1,0,.5,1,.5,0,.5,1,.5,0,0,1,0],2))},r.LineSegmentsGeometry.prototype=Object.assign(Object.create(r.InstancedBufferGeometry.prototype),{constructor:r.LineSegmentsGeometry,isLineSegmentsGeometry:!0,applyMatrix:function(e){var t=this.attributes.instanceStart,i=this.attributes.instanceEnd;return void 0!==t&&(e.applyToBufferAttribute(t),e.applyToBufferAttribute(i),t.data.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},setPositions:function(e){var t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));var i=new r.InstancedInterleavedBuffer(t,6,1);return this.setAttribute("instanceStart",new r.InterleavedBufferAttribute(i,3,0)),this.setAttribute("instanceEnd",new r.InterleavedBufferAttribute(i,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this},setColors:function(e){var t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));var i=new r.InstancedInterleavedBuffer(t,6,1);return this.setAttribute("instanceColorStart",new r.InterleavedBufferAttribute(i,3,0)),this.setAttribute("instanceColorEnd",new r.InterleavedBufferAttribute(i,3,3)),this},fromWireframeGeometry:function(e){return this.setPositions(e.attributes.position.array),this},fromEdgesGeometry:function(e){return this.setPositions(e.attributes.position.array),this},fromMesh:function(e){return this.fromWireframeGeometry(new r.WireframeGeometry(e.geometry)),this},fromLineSegements:function(e){var t=e.geometry;return t.isGeometry?this.setPositions(t.vertices):t.isBufferGeometry&&this.setPositions(t.position.array),this},computeBoundingBox:(l=new r.Box3,function(){null===this.boundingBox&&(this.boundingBox=new r.Box3);var e=this.attributes.instanceStart,t=this.attributes.instanceEnd;void 0!==e&&void 0!==t&&(this.boundingBox.setFromBufferAttribute(e),l.setFromBufferAttribute(t),this.boundingBox.union(l))}),computeBoundingSphere:(s=new r.Vector3,function(){null===this.boundingSphere&&(this.boundingSphere=new r.Sphere),null===this.boundingBox&&this.computeBoundingBox();var e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(void 0!==e&&void 0!==t){var i=this.boundingSphere.center;this.boundingBox.getCenter(i);for(var n=0,a=0,o=e.count;a<o;a++)s.fromBufferAttribute(e,a),n=Math.max(n,i.distanceToSquared(s)),s.fromBufferAttribute(t,a),n=Math.max(n,i.distanceToSquared(s));this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}),toJSON:function(){},clone:function(){},copy:function(e){return this}}),r.LineGeometry=function(){r.LineSegmentsGeometry.call(this),this.type="LineGeometry"},r.LineGeometry.prototype=Object.assign(Object.create(r.LineSegmentsGeometry.prototype),{constructor:r.LineGeometry,isLineGeometry:!0,setPositions:function(e){for(var t=e.length-3,i=new Float32Array(2*t),n=0;n<t;n+=3)i[2*n]=e[n],i[2*n+1]=e[n+1],i[2*n+2]=e[n+2],i[2*n+3]=e[n+3],i[2*n+4]=e[n+4],i[2*n+5]=e[n+5];return r.LineSegmentsGeometry.prototype.setPositions.call(this,i),this},setColors:function(e){for(var t=e.length-3,i=new Float32Array(2*t),n=0;n<t;n+=3)i[2*n]=e[n],i[2*n+1]=e[n+1],i[2*n+2]=e[n+2],i[2*n+3]=e[n+3],i[2*n+4]=e[n+4],i[2*n+5]=e[n+5];return r.LineSegmentsGeometry.prototype.setColors.call(this,i),this},fromLine:function(e){var t=e.geometry;return t.isGeometry?this.setPositions(t.vertices):t.isBufferGeometry&&this.setPositions(t.position.array),this},copy:function(e){return this}}),r.WireframeGeometry2=function(e){r.LineSegmentsGeometry.call(this),this.type="WireframeGeometry2",this.fromWireframeGeometry(new r.WireframeGeometry(e))},r.WireframeGeometry2.prototype=Object.assign(Object.create(r.LineSegmentsGeometry.prototype),{constructor:r.WireframeGeometry2,isWireframeGeometry2:!0,copy:function(e){return this}}),r.UniformsLib.line={linewidth:{value:1},resolution:{value:new r.Vector2(1,1)},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},r.ShaderLib.line={uniforms:r.UniformsUtils.merge([r.UniformsLib.common,r.UniformsLib.fog,r.UniformsLib.line]),vertexShader:"\n\t\t#include <common>\n\t\t#include <color_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <clipping_planes_pars_vertex>\n\n\t\tuniform float linewidth;\n\t\tuniform vec2 resolution;\n\n\t\tattribute vec3 instanceStart;\n\t\tattribute vec3 instanceEnd;\n\n\t\tattribute vec3 instanceColorStart;\n\t\tattribute vec3 instanceColorEnd;\n\n\t\tvarying vec2 vUv;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashScale;\n\t\t\tattribute float instanceDistanceStart;\n\t\t\tattribute float instanceDistanceEnd;\n\t\t\tvarying float vLineDistance;\n\n\t\t#endif\n\n\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t// conservative estimate of the near plane\n\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#ifdef USE_COLOR\n\n\t\t\t\tvColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t#endif\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\n\t\t\t#endif\n\n\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\tvUv = uv;\n\n\t\t\t// camera space\n\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\tif ( perspective ) {\n\n\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// clip space\n\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t// ndc space\n\t\t\tvec2 ndcStart = clipStart.xy / clipStart.w;\n\t\t\tvec2 ndcEnd = clipEnd.xy / clipEnd.w;\n\n\t\t\t// direction\n\t\t\tvec2 dir = ndcEnd - ndcStart;\n\n\t\t\t// account for clip-space aspect ratio\n\t\t\tdir.x *= aspect;\n\t\t\tdir = normalize( dir );\n\n\t\t\t// perpendicular to dir\n\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\n\t\t\t// undo aspect ratio adjustment\n\t\t\tdir.x /= aspect;\n\t\t\toffset.x /= aspect;\n\n\t\t\t// sign flip\n\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t// endcaps\n\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\toffset += - dir;\n\n\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\toffset += dir;\n\n\t\t\t}\n\n\t\t\t// adjust for linewidth\n\t\t\toffset *= linewidth;\n\n\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\toffset /= resolution.y;\n\n\t\t\t// select end\n\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t// back to clip space\n\t\t\toffset *= clip.w;\n\n\t\t\tclip.xy += offset;\n\n\t\t\tgl_Position = clip;\n\n\t\t\t#include <logdepthbuf_vertex>\n\n\t\t\t#include <worldpos_vertex>\n\t\t\t#include <clipping_planes_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}\n\t\t",fragmentShader:"\n\t\tuniform vec3 diffuse;\n\t\tuniform float opacity;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashSize;\n\t\t\tuniform float gapSize;\n\n\t\t#endif\n\n\t\tvarying float vLineDistance;\n\n\t\t#include <common>\n\t\t#include <color_pars_fragment>\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\t\t#include <clipping_planes_pars_fragment>\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tif ( vUv.y < 0.5 || vUv.y > 0.5 ) discard; // discard endcaps\n\n\t\t\t\tif ( mod( vLineDistance, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t#endif\n\n\t\t\tif ( vUv.y < 0.5 || vUv.y > 0.5 ) {\n\n\t\t\t\tfloat a = vUv.x - 0.5;\n\t\t\t\tfloat b = vUv.y - 0.5;\n\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\tif ( len2 > 0.25 ) discard;\n\n\t\t\t}\n\n\t\t\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t\t\t#include <logdepthbuf_fragment>\n\t\t\t#include <color_fragment>\n\n\t\t\tgl_FragColor = vec4( diffuseColor.rgb, opacity );\n\n\t\t\t#include <premultiplied_alpha_fragment>\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\t\t\t#include <fog_fragment>\n\n\t\t}\n\t\t"},r.LineMaterial=function(e){var t=r.UniformsUtils.clone(r.ShaderLib.line.uniforms);t.opacity.value=e.opacity,r.ShaderMaterial.call(this,{type:"LineMaterial",uniforms:t,vertexShader:r.ShaderLib.line.vertexShader,fragmentShader:r.ShaderLib.line.fragmentShader}),this.dashed=!1,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(e){this.uniforms.linewidth.value=e}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(e){this.uniforms.dashScale.value=e}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(e){this.uniforms.dashSize.value=e}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(e){this.uniforms.gapSize.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}}}),this.setValues(e)},r.LineMaterial.prototype=Object.create(r.ShaderMaterial.prototype),r.LineMaterial.prototype.constructor=r.LineMaterial,r.LineMaterial.prototype.isLineMaterial=!0,r.LineMaterial.prototype.copy=function(e){return r.ShaderMaterial.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.resolution=e.resolution,this},r.LineSegments2=function(e,t){r.Mesh.call(this),this.type="LineSegments2",this.geometry=void 0!==e?e:new r.LineSegmentsGeometry,this.material=void 0!==t?t:new r.LineMaterial({color:16777215*Math.random()})},r.LineSegments2.prototype=Object.assign(Object.create(r.Mesh.prototype),{constructor:r.LineSegments2,isLineSegments2:!0,computeLineDistances:(c=new r.Vector3,h=new r.Vector3,function(){for(var e=this.geometry,t=e.attributes.instanceStart,i=e.attributes.instanceEnd,n=new Float32Array(2*t.data.count),a=0,o=0,s=t.data.count;a<s;a++,o+=2)c.fromBufferAttribute(t,a),h.fromBufferAttribute(i,a),n[o]=0===o?0:n[o-1],n[o+1]=n[o]+c.distanceTo(h);var l=new r.InstancedInterleavedBuffer(n,2,1);return e.setAttribute("instanceDistanceStart",new r.InterleavedBufferAttribute(l,1,0)),e.setAttribute("instanceDistanceEnd",new r.InterleavedBufferAttribute(l,1,1)),this}),copy:function(e){return this}}),r.Line2=function(e,t){r.LineSegments2.call(this),this.type="Line2",this.geometry=void 0!==e?e:new r.LineGeometry,this.material=void 0!==t?t:new r.LineMaterial({color:16777215*Math.random()})},r.Line2.prototype=Object.assign(Object.create(r.LineSegments2.prototype),{constructor:r.Line2,isLine2:!0,copy:function(e){return this}}),r.Wireframe=function(e,t){r.Mesh.call(this),this.type="Wireframe",this.geometry=void 0!==e?e:new r.LineSegmentsGeometry,this.material=void 0!==t?t:new r.LineMaterial({color:16777215*Math.random()})},r.Wireframe.prototype=Object.assign(Object.create(r.Mesh.prototype),{constructor:r.Wireframe,isWireframe:!0,computeLineDistances:function(){var e=new r.Vector3,t=new r.Vector3;return function(){for(var i=this.geometry,n=i.attributes.instanceStart,a=i.attributes.instanceEnd,o=new Float32Array(2*n.data.count),s=0,l=0,c=n.data.count;s<c;s++,l+=2)e.fromBufferAttribute(n,s),t.fromBufferAttribute(a,s),o[l]=0===l?0:o[l-1],o[l+1]=o[l]+e.distanceTo(t);var h=new r.InstancedInterleavedBuffer(o,2,1);return i.setAttribute("instanceDistanceStart",new r.InterleavedBufferAttribute(h,1,0)),i.setAttribute("instanceDistanceEnd",new r.InterleavedBufferAttribute(h,1,1)),this}}(),copy:function(e){return this}})},{"../three.js":23,"../utils/utils.js":27,"./objects.js":19}],13:[function(e,t,i){const r=e("../utils/utils.js"),n=e("./objects.js"),a=e("./loaders/OBJLoader.js"),o=e("./loaders/MTLLoader.js"),s=e("./loaders/FBXLoader.js"),l=e("./loaders/GLTFLoader.js"),c=e("./loaders/ColladaLoader.js"),h=new a,u=new o,d=new l,p=new s,f=new c;t.exports=function(e,t,i){if(void 0===e)return console.error("Invalid options provided to loadObj()");let a;switch((e=r._validate(e,n.prototype._defaults.loadObj)).type||(e.type="mtl"),e.type){case"mtl":a=h;break;case"gltf":case"glb":a=d;break;case"fbx":a=p;break;case"dae":a=f}u.load(e.mtl,(function(o){o&&"mtl"==e.type&&(o.preload(),a.setMaterials(o)),a.load(e.obj,(a=>{let o=[];switch(e.type){case"mtl":a=a.children[0];break;case"gltf":case"glb":case"dae":o=a.animations,a=a.scene;break;case"fbx":o=a.animations}a.animations=o;const s=r.types.rotation(e.rotation,[0,0,0]),l=r.types.scale(e.scale,[1,1,1]);a.rotation.set(s[0],s[1],s[2]),a.scale.set(l[0],l[1],l[2]),e.normalize&&a.traverse((function(e){if(e.isMesh){let t;"MeshStandardMaterial"==e.material.type?(e.material.metalness&&(e.material.metalness*=.1),e.material.glossiness&&(e.material.glossiness*=.25),t=new THREE.Color(12,12,12)):"MeshPhongMaterial"==e.material.type&&(e.material.shininess=.1,t=new THREE.Color(20,20,20)),e.material.specular&&e.material.specular.isColor&&(e.material.specular=t)}})),a.name="model";let c=n.prototype._makeGroup(a,e);n.prototype._addMethods(c),c.setAnchor(e.anchor),c.setCenter(e.adjustment),c.raycasted=e.raycasted,i(c),t(c),c.idle()}),(()=>null),(t=>{console.error("Could not load model file: "+e.obj+" \n "+t.stack),i("Error loading the model")}))}),(()=>null),(e=>{console.warn("No material file found for SymbolLayer3D model "+m)}))}},{"../utils/utils.js":27,"./loaders/ColladaLoader.js":14,"./loaders/FBXLoader.js":15,"./loaders/GLTFLoader.js":16,"./loaders/MTLLoader.js":17,"./loaders/OBJLoader.js":18,"./objects.js":19}],14:[function(e,t,i){const r=e("../../three.js");r.ColladaLoader=function(e){r.Loader.call(this,e)},r.ColladaLoader.prototype=Object.assign(Object.create(r.Loader.prototype),{constructor:r.ColladaLoader,load:function(e,t,i,n){var a=this,o=""===a.path?r.LoaderUtils.extractUrlBase(e):a.path,s=new r.FileLoader(a.manager);s.setPath(a.path),s.load(e,(function(i){try{t(a.parse(i,o))}catch(t){n?n(t):console.error(t),a.manager.itemError(e)}}),i,n)},options:{set convertUpAxis(e){console.warn("THREE.ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},parse:function(e,t){function i(e,t){for(var i=[],r=e.childNodes,n=0,a=r.length;n<a;n++){var o=r[n];o.nodeName===t&&i.push(o)}return i}function n(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),i=new Array(t.length),r=0,n=t.length;r<n;r++)i[r]=t[r];return i}function a(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),i=new Array(t.length),r=0,n=t.length;r<n;r++)i[r]=parseFloat(t[r]);return i}function o(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),i=new Array(t.length),r=0,n=t.length;r<n;r++)i[r]=parseInt(t[r]);return i}function s(e){return e.substring(1)}function l(e){return 0===Object.keys(e).length}function c(e){return void 0!==e&&!0===e.hasAttribute("meter")?parseFloat(e.getAttribute("meter")):1}function h(e){return void 0!==e?e.textContent:"Y_UP"}function u(e,t,r,n){var a=i(e,t)[0];if(void 0!==a)for(var o=i(a,r),s=0;s<o.length;s++)n(o[s])}function d(e,t){for(var i in e)e[i].build=t(e[i])}function p(e,t){return void 0!==e.build||(e.build=t(e)),e.build}function f(e){for(var t={inputs:{}},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"input":var a=s(n.getAttribute("source")),o=n.getAttribute("semantic");t.inputs[o]=a}}return t}function m(e){var t={},i=e.getAttribute("target").split("/"),r=i.shift(),n=i.shift(),a=-1!==n.indexOf("("),o=-1!==n.indexOf(".");if(o)i=n.split("."),n=i.shift(),t.member=i.shift();else if(a){var l=n.split("(");n=l.shift();for(var c=0;c<l.length;c++)l[c]=parseInt(l[c].replace(/\)/,""));t.indices=l}return t.id=r,t.sid=n,t.arraySyntax=a,t.memberSyntax=o,t.sampler=s(e.getAttribute("source")),t}function g(e){var t=[],i=e.channels,r=e.samplers,n=e.sources;for(var a in i)if(i.hasOwnProperty(a)){var o=i[a],s=r[o.sampler],l=s.inputs.INPUT,c=s.inputs.OUTPUT;w(v(o,n[l],n[c]),t)}return t}function y(e){return p(Ye.animations[e],g)}function v(e,t,i){var r,n,a,o,s,l,c=Ye.nodes[e.id],h=Oe(c.id),u=c.transforms[e.sid],d=c.matrix.clone().transpose(),p={};switch(u){case"matrix":for(a=0,o=t.array.length;a<o;a++)if(r=t.array[a],n=a*i.stride,void 0===p[r]&&(p[r]={}),!0===e.arraySyntax){var f=i.array[n],m=e.indices[0]+4*e.indices[1];p[r][m]=f}else for(s=0,l=i.stride;s<l;s++)p[r][s]=i.array[n+s];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',u)}var g=function(e,t){var i=[];for(var r in e)i.push({time:parseFloat(r),value:e[r]});i.sort((function(e,t){return e.time-t.time}));for(var n=0;n<16;n++)M(i,n,t.elements[n]);return i}(p,d);return{name:h.uuid,keyframes:g}}var _=new r.Vector3,x=new r.Vector3,b=new r.Quaternion;function w(e,t){for(var i=e.keyframes,n=e.name,a=[],o=[],s=[],l=[],c=0,h=i.length;c<h;c++){var u=i[c],d=u.time,p=u.value;Se.fromArray(p).transpose(),Se.decompose(_,b,x),a.push(d),o.push(_.x,_.y,_.z),s.push(b.x,b.y,b.z,b.w),l.push(x.x,x.y,x.z)}return o.length>0&&t.push(new r.VectorKeyframeTrack(n+".position",a,o)),s.length>0&&t.push(new r.QuaternionKeyframeTrack(n+".quaternion",a,s)),l.length>0&&t.push(new r.VectorKeyframeTrack(n+".scale",a,l)),t}function M(e,t,i){var r,n,a,o=!0;for(n=0,a=e.length;n<a;n++)void 0===(r=e[n]).value[t]?r.value[t]=null:o=!1;if(!0===o)for(n=0,a=e.length;n<a;n++)(r=e[n]).value[t]=i;else!function(e,t){for(var i,r,n=0,a=e.length;n<a;n++){var o=e[n];if(null===o.value[t]){if(i=T(e,n,t),r=S(e,n,t),null===i){o.value[t]=r.value[t];continue}if(null===r){o.value[t]=i.value[t];continue}E(o,i,r,t)}}}(e,t)}function T(e,t,i){for(;t>=0;){var r=e[t];if(null!==r.value[i])return r;t--}return null}function S(e,t,i){for(;t<e.length;){var r=e[t];if(null!==r.value[i])return r;t++}return null}function E(e,t,i,r){i.time-t.time!=0?e.value[r]=(e.time-t.time)*(i.value[r]-t.value[r])/(i.time-t.time)+t.value[r]:e.value[r]=t.value[r]}function A(e){for(var t=[],i=e.name,n=e.end-e.start||-1,a=e.animations,o=0,s=a.length;o<s;o++)for(var l=y(a[o]),c=0,h=l.length;c<h;c++)t.push(l[c]);return new r.AnimationClip(i,n,t)}function C(e){return p(Ye.clips[e],A)}function L(e){for(var t={sources:{}},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=a(n.textContent);break;case"source":var o=n.getAttribute("id");t.sources[o]=ae(n);break;case"joints":t.joints=P(n);break;case"vertex_weights":t.vertexWeights=I(n)}}return t}function P(e){for(var t={inputs:{}},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"input":var a=n.getAttribute("semantic"),o=s(n.getAttribute("source"));t.inputs[a]=o}}return t}function I(e){for(var t={inputs:{}},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"input":var a=n.getAttribute("semantic"),l=s(n.getAttribute("source")),c=parseInt(n.getAttribute("offset"));t.inputs[a]={id:l,offset:c};break;case"vcount":t.vcount=o(n.textContent);break;case"v":t.v=o(n.textContent)}}return t}function R(e){var t={id:e.id},i=Ye.geometries[t.id];return void 0!==e.skin&&(t.skin=function(e){var t,i,n,a={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},o=e.sources,s=e.vertexWeights,l=s.vcount,c=s.v,h=s.inputs.JOINT.offset,u=s.inputs.WEIGHT.offset,d=e.sources[e.joints.inputs.JOINT],p=e.sources[e.joints.inputs.INV_BIND_MATRIX],f=o[s.inputs.WEIGHT.id].array,m=0;for(t=0,n=l.length;t<n;t++){var g=l[t],y=[];for(i=0;i<g;i++){var v=c[m+h],_=f[c[m+u]];y.push({index:v,weight:_}),m+=2}for(y.sort(M),i=0;i<4;i++){var x=y[i];void 0!==x?(a.indices.array.push(x.index),a.weights.array.push(x.weight)):(a.indices.array.push(0),a.weights.array.push(0))}}for(e.bindShapeMatrix?a.bindMatrix=(new r.Matrix4).fromArray(e.bindShapeMatrix).transpose():a.bindMatrix=(new r.Matrix4).identity(),t=0,n=d.array.length;t<n;t++){var b=d.array[t],w=(new r.Matrix4).fromArray(p.array,t*p.stride).transpose();a.joints.push({name:b,boneInverse:w})}return a;function M(e,t){return t.weight-e.weight}}(e.skin),i.sources.skinIndices=t.skin.indices,i.sources.skinWeights=t.skin.weights),t}function D(e){return void 0!==e.build?e.build:e.init_from}function k(e){var t=Ye.images[e];return void 0!==t?p(t,D):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",e),null)}function z(e){for(var t={surfaces:{},samplers:{}},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"newparam":O(n,t);break;case"technique":t.technique=N(n);break;case"extra":t.extra=W(n)}}return t}function O(e,t){for(var i=e.getAttribute("sid"),r=0,n=e.childNodes.length;r<n;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"surface":t.surfaces[i]=B(a);break;case"sampler2D":t.samplers[i]=F(a)}}}function B(e){for(var t={},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"init_from":t.init_from=n.textContent}}return t}function F(e){for(var t={},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"source":t.source=n.textContent}}return t}function N(e){for(var t={},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=n.nodeName,t.parameters=U(n)}}return t}function U(e){for(var t={},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":t[n.nodeName]=j(n);break;case"transparent":t[n.nodeName]={opaque:n.getAttribute("opaque"),data:j(n)}}}return t}function j(e){for(var t={},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"color":t[n.nodeName]=a(n.textContent);break;case"float":t[n.nodeName]=parseFloat(n.textContent);break;case"texture":t[n.nodeName]={id:n.getAttribute("texture"),extra:V(n)}}}return t}function V(e){for(var t={technique:{}},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"extra":G(n,t)}}return t}function G(e,t){for(var i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"technique":H(n,t)}}}function H(e,t){for(var i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[n.nodeName]=parseFloat(n.textContent);break;case"wrapU":case"wrapV":"TRUE"===n.textContent.toUpperCase()?t.technique[n.nodeName]=1:"FALSE"===n.textContent.toUpperCase()?t.technique[n.nodeName]=0:t.technique[n.nodeName]=parseInt(n.textContent)}}}function W(e){for(var t={},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"technique":t.technique=q(n)}}return t}function q(e){for(var t={},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"double_sided":t[n.nodeName]=parseInt(n.textContent)}}return t}function Z(e){return e}function X(e){var t,i,n=(t=e.url,p(Ye.effects[t],Z)),a=n.profile.technique,o=n.profile.extra;switch(a.type){case"phong":case"blinn":i=new r.MeshPhongMaterial;break;case"lambert":i=new r.MeshLambertMaterial;break;default:i=new r.MeshBasicMaterial}function s(e){var t=n.profile.samplers[e.id],i=null;if(void 0!==t?i=k(n.profile.surfaces[t.source].init_from):(console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),i=k(e.id)),null!==i){var a=function(e){var t,i=e.slice(2+(e.lastIndexOf(".")-1>>>0));switch(i=i.toLowerCase()){case"tga":t=He;break;default:t=qe}return t}(i);if(void 0!==a){var o=a.load(i),s=e.extra;if(void 0!==s&&void 0!==s.technique&&!1===l(s.technique)){var c=s.technique;o.wrapS=c.wrapU?r.RepeatWrapping:r.ClampToEdgeWrapping,o.wrapT=c.wrapV?r.RepeatWrapping:r.ClampToEdgeWrapping,o.offset.set(c.offsetU||0,c.offsetV||0),o.repeat.set(c.repeatU||1,c.repeatV||1)}else o.wrapS=r.RepeatWrapping,o.wrapT=r.RepeatWrapping;return o}return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",i),null}return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",e.id),null}i.name=e.name||"";var c=a.parameters;for(var h in c){var u=c[h];switch(h){case"diffuse":u.color&&i.color.fromArray(u.color),u.texture&&(i.map=s(u.texture));break;case"specular":u.color&&i.specular&&i.specular.fromArray(u.color),u.texture&&(i.specularMap=s(u.texture));break;case"bump":u.texture&&(i.normalMap=s(u.texture));break;case"ambient":u.texture&&(i.lightMap=s(u.texture));break;case"shininess":u.float&&i.shininess&&(i.shininess=u.float);break;case"emission":u.color&&i.emissive&&i.emissive.fromArray(u.color),u.texture&&(i.emissiveMap=s(u.texture))}}var d=c.transparent,f=c.transparency;if(void 0===f&&d&&(f={float:1}),void 0===d&&f&&(d={opaque:"A_ONE",data:{color:[1,1,1,1]}}),d&&f)if(d.data.texture)i.transparent=!0;else{var m=d.data.color;switch(d.opaque){case"A_ONE":i.opacity=m[3]*f.float;break;case"RGB_ZERO":i.opacity=1-m[0]*f.float;break;case"A_ZERO":i.opacity=1-m[3]*f.float;break;case"RGB_ONE":i.opacity=m[0]*f.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',d.opaque)}i.opacity<1&&(i.transparent=!0)}return void 0!==o&&void 0!==o.technique&&1===o.technique.double_sided&&(i.side=r.DoubleSide),i}function $(e){return p(Ye.materials[e],X)}function Y(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"technique_common":return J(i)}}return{}}function J(e){for(var t={},i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];switch(r.nodeName){case"perspective":case"orthographic":t.technique=r.nodeName,t.parameters=K(r)}}return t}function K(e){for(var t={},i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];switch(r.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[r.nodeName]=parseFloat(r.textContent)}}return t}function Q(e){var t;switch(e.optics.technique){case"perspective":t=new r.PerspectiveCamera(e.optics.parameters.yfov,e.optics.parameters.aspect_ratio,e.optics.parameters.znear,e.optics.parameters.zfar);break;case"orthographic":var i=e.optics.parameters.ymag,n=e.optics.parameters.xmag,a=e.optics.parameters.aspect_ratio;n=void 0===n?i*a:n,i=void 0===i?n/a:i,n*=.5,i*=.5,t=new r.OrthographicCamera(-n,n,i,-i,e.optics.parameters.znear,e.optics.parameters.zfar);break;default:t=new r.PerspectiveCamera}return t.name=e.name||"",t}function ee(e){var t=Ye.cameras[e];return void 0!==t?p(t,Q):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",e),null)}function te(e){for(var t={},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=n.nodeName,t.parameters=ie(n)}}return t}function ie(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"color":var s=a(o.textContent);t.color=(new r.Color).fromArray(s);break;case"falloff_angle":t.falloffAngle=parseFloat(o.textContent);break;case"quadratic_attenuation":var l=parseFloat(o.textContent);t.distance=l?Math.sqrt(1/l):0}}return t}function re(e){var t;switch(e.technique){case"directional":t=new r.DirectionalLight;break;case"point":t=new r.PointLight;break;case"spot":t=new r.SpotLight;break;case"ambient":t=new r.AmbientLight}return e.parameters.color&&t.color.copy(e.parameters.color),e.parameters.distance&&(t.distance=e.parameters.distance),t}function ne(e){var t=Ye.lights[e];return void 0!==t?p(t,re):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",e),null)}function ae(e){for(var t={array:[],stride:3},r=0;r<e.childNodes.length;r++){var o=e.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"float_array":t.array=a(o.textContent);break;case"Name_array":t.array=n(o.textContent);break;case"technique_common":var s=i(o,"accessor")[0];void 0!==s&&(t.stride=parseInt(s.getAttribute("stride")))}}return t}function oe(e){for(var t={},i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];1===r.nodeType&&(t[r.getAttribute("semantic")]=s(r.getAttribute("source")))}return t}function se(e){for(var t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0,hasUV:!1},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"input":var a=s(n.getAttribute("source")),l=n.getAttribute("semantic"),c=parseInt(n.getAttribute("offset")),h=parseInt(n.getAttribute("set")),u=h>0?l+h:l;t.inputs[u]={id:a,offset:c},t.stride=Math.max(t.stride,c+1),"TEXCOORD"===l&&(t.hasUV=!0);break;case"vcount":t.vcount=o(n.textContent);break;case"p":t.p=o(n.textContent)}}return t}function le(e){for(var t=0,i=0,r=e.length;i<r;i++)!0===e[i].hasUV&&t++;t>0&&t<e.length&&(e.uvsNeedsFix=!0)}function ce(e){var t={},i=e.sources,r=e.vertices,n=e.primitives;if(0===n.length)return{};var a=function(e){for(var t={},i=0;i<e.length;i++){var r=e[i];void 0===t[r.type]&&(t[r.type]=[]),t[r.type].push(r)}return t}(n);for(var o in a){var s=a[o];le(s),t[o]=he(s,i,r)}return t}function he(e,t,i){for(var n={},a={array:[],stride:0},o={array:[],stride:0},s={array:[],stride:0},l={array:[],stride:0},c={array:[],stride:0},h=[],u=[],d=new r.BufferGeometry,p=[],f=0,m=0;m<e.length;m++){var g=e[m],y=g.inputs,v=0;switch(g.type){case"lines":case"linestrips":v=2*g.count;break;case"triangles":v=3*g.count;break;case"polylist":for(var _=0;_<g.count;_++){var x=g.vcount[_];switch(x){case 3:v+=3;break;case 4:v+=6;break;default:v+=3*(x-2)}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",g.type)}for(var b in d.addGroup(f,v,m),f+=v,g.material&&p.push(g.material),y){var w=y[b];switch(b){case"VERTEX":for(var M in i){var T=i[M];switch(M){case"POSITION":var S=a.array.length;if(ue(g,t[T],w.offset,a.array),a.stride=t[T].stride,t.skinWeights&&t.skinIndices&&(ue(g,t.skinIndices,w.offset,h),ue(g,t.skinWeights,w.offset,u)),!1===g.hasUV&&!0===e.uvsNeedsFix){v=(a.array.length-S)/a.stride;for(var E=0;E<v;E++)s.array.push(0,0)}break;case"NORMAL":ue(g,t[T],w.offset,o.array),o.stride=t[T].stride;break;case"COLOR":ue(g,t[T],w.offset,c.array),c.stride=t[T].stride;break;case"TEXCOORD":ue(g,t[T],w.offset,s.array),s.stride=t[T].stride;break;case"TEXCOORD1":ue(g,t[T],w.offset,l.array),s.stride=t[T].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',M)}}break;case"NORMAL":ue(g,t[w.id],w.offset,o.array),o.stride=t[w.id].stride;break;case"COLOR":ue(g,t[w.id],w.offset,c.array),c.stride=t[w.id].stride;break;case"TEXCOORD":ue(g,t[w.id],w.offset,s.array),s.stride=t[w.id].stride;break;case"TEXCOORD1":ue(g,t[w.id],w.offset,l.array),l.stride=t[w.id].stride}}}return a.array.length>0&&d.setAttribute("position",new r.Float32BufferAttribute(a.array,a.stride)),o.array.length>0&&d.setAttribute("normal",new r.Float32BufferAttribute(o.array,o.stride)),c.array.length>0&&d.setAttribute("color",new r.Float32BufferAttribute(c.array,c.stride)),s.array.length>0&&d.setAttribute("uv",new r.Float32BufferAttribute(s.array,s.stride)),l.array.length>0&&d.setAttribute("uv2",new r.Float32BufferAttribute(l.array,l.stride)),h.length>0&&d.setAttribute("skinIndex",new r.Float32BufferAttribute(h,4)),u.length>0&&d.setAttribute("skinWeight",new r.Float32BufferAttribute(u,4)),n.data=d,n.type=e[0].type,n.materialKeys=p,n}function ue(e,t,i,r){var n=e.p,a=e.stride,o=e.vcount;function s(e){for(var t=n[e+i]*c,a=t+c;t<a;t++)r.push(l[t])}var l=t.array,c=t.stride;if(void 0!==e.vcount)for(var h=0,u=0,d=o.length;u<d;u++){var p=o[u];if(4===p){var f=h+1*a,m=h+2*a,g=h+3*a;s(h+0*a),s(f),s(g),s(f),s(m),s(g)}else if(3===p)f=h+1*a,m=h+2*a,s(h+0*a),s(f),s(m);else if(p>4)for(var y=1,v=p-2;y<=v;y++)f=h+a*y,m=h+a*(y+1),s(h+0*a),s(f),s(m);h+=a*p}else for(u=0,d=n.length;u<d;u+=a)s(u)}function de(e){return p(Ye.geometries[e],ce)}function pe(e){return void 0!==e.build?e.build:e}function fe(e,t){for(var i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"joint":t.joints[r.getAttribute("sid")]=me(r);break;case"link":t.links.push(ye(r))}}}function me(e){for(var t,i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"prismatic":case"revolute":t=ge(r)}}return t}function ge(e,t){t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",axis:new r.Vector3,limits:{min:0,max:0},type:e.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(var i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"axis":var o=a(n.textContent);t.axis.fromArray(o);break;case"limits":var s=n.getElementsByTagName("max")[0],l=n.getElementsByTagName("min")[0];t.limits.max=parseFloat(s.textContent),t.limits.min=parseFloat(l.textContent)}}return t.limits.min>=t.limits.max&&(t.static=!0),t.middlePosition=(t.limits.min+t.limits.max)/2,t}function ye(e){for(var t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",attachments:[],transforms:[]},i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"attachment_full":t.attachments.push(ve(r));break;case"matrix":case"translate":case"rotate":t.transforms.push(_e(r))}}return t}function ve(e){for(var t={joint:e.getAttribute("joint").split("/").pop(),transforms:[],links:[]},i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"link":t.links.push(ye(r));break;case"matrix":case"translate":case"rotate":t.transforms.push(_e(r))}}return t}function _e(e){var t={type:e.nodeName},i=a(e.textContent);switch(t.type){case"matrix":t.obj=new r.Matrix4,t.obj.fromArray(i).transpose();break;case"translate":t.obj=new r.Vector3,t.obj.fromArray(i);break;case"rotate":t.obj=new r.Vector3,t.obj.fromArray(i),t.angle=r.MathUtils.degToRad(i[3])}return t}function xe(e,t){for(var i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"technique_common":be(r,t)}}}function be(e,t){for(var i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"inertia":t.inertia=a(r.textContent);break;case"mass":t.mass=a(r.textContent)[0]}}}function we(e){for(var t={target:e.getAttribute("target").split("/").pop()},i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"axis":var n=r.getElementsByTagName("param")[0];t.axis=n.textContent;var a=t.axis.split("inst_").pop().split("axis")[0];t.jointIndex=a.substr(0,a.length-1)}}return t}function Me(e){return void 0!==e.build?e.build:e}function Te(e){for(var t=[],i=Ue.querySelector('[id="'+e.id+'"]'),n=0;n<i.childNodes.length;n++){var o=i.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"matrix":var s=a(o.textContent),l=(new r.Matrix4).fromArray(s).transpose();t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:l});break;case"translate":case"scale":s=a(o.textContent);var c=(new r.Vector3).fromArray(s);t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:c});break;case"rotate":s=a(o.textContent),c=(new r.Vector3).fromArray(s);var h=r.MathUtils.degToRad(s[3]);t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:c,angle:h})}}return t}var Se=new r.Matrix4,Ee=new r.Vector3;function Ae(e){for(var t={name:e.getAttribute("name")||"",type:e.getAttribute("type"),id:e.getAttribute("id"),sid:e.getAttribute("sid"),matrix:new r.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"node":t.nodes.push(n.getAttribute("id")),Ae(n);break;case"instance_camera":t.instanceCameras.push(s(n.getAttribute("url")));break;case"instance_controller":t.instanceControllers.push(Ce(n));break;case"instance_light":t.instanceLights.push(s(n.getAttribute("url")));break;case"instance_geometry":t.instanceGeometries.push(Ce(n));break;case"instance_node":t.instanceNodes.push(s(n.getAttribute("url")));break;case"matrix":var o=a(n.textContent);t.matrix.multiply(Se.fromArray(o).transpose()),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"translate":o=a(n.textContent),Ee.fromArray(o),t.matrix.multiply(Se.makeTranslation(Ee.x,Ee.y,Ee.z)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"rotate":o=a(n.textContent);var l=r.MathUtils.degToRad(o[3]);t.matrix.multiply(Se.makeRotationAxis(Ee.fromArray(o),l)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"scale":o=a(n.textContent),t.matrix.scale(Ee.fromArray(o)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"extra":break;default:console.log(n)}}return ze(t.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",t.id):Ye.nodes[t.id]=t,t}function Ce(e){for(var t={id:s(e.getAttribute("url")),materials:{},skeletons:[]},i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];switch(r.nodeName){case"bind_material":for(var n=r.getElementsByTagName("instance_material"),a=0;a<n.length;a++){var o=n[a],l=o.getAttribute("symbol"),c=o.getAttribute("target");t.materials[l]=s(c)}break;case"skeleton":t.skeletons.push(s(r.textContent))}}return t}function Le(e,t){var i,n,a,o=[],s=[];for(i=0;i<e.length;i++){var l=e[i];if(ze(l))Pe(Oe(l),t,o);else if(a=l,void 0!==Ye.visualScenes[a])for(var c=Ye.visualScenes[l].children,h=0;h<c.length;h++){var u=c[h];"JOINT"===u.type&&Pe(Oe(u.id),t,o)}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",l)}for(i=0;i<t.length;i++)for(h=0;h<o.length;h++)if((n=o[h]).bone.name===t[i].name){s[i]=n,n.processed=!0;break}for(i=0;i<o.length;i++)!1===(n=o[i]).processed&&(s.push(n),n.processed=!0);var d=[],p=[];for(i=0;i<s.length;i++)n=s[i],d.push(n.bone),p.push(n.boneInverse);return new r.Skeleton(d,p)}function Pe(e,t,i){e.traverse((function(e){if(!0===e.isBone){for(var n,a=0;a<t.length;a++){var o=t[a];if(o.name===e.name){n=o.boneInverse;break}}void 0===n&&(n=new r.Matrix4),i.push({bone:e,boneInverse:n,processed:!1})}}))}function Ie(e){for(var t,i=[],n=e.matrix,a=e.nodes,o=e.type,s=e.instanceCameras,l=e.instanceControllers,c=e.instanceLights,h=e.instanceGeometries,u=e.instanceNodes,d=0,f=a.length;d<f;d++)i.push(Oe(a[d]));for(d=0,f=s.length;d<f;d++){var m=ee(s[d]);null!==m&&i.push(m.clone())}for(d=0,f=l.length;d<f;d++)for(var g=l[d],y=(t=g.id,p(Ye.controllers[t],R)),v=ke(de(y.id),g.materials),_=Le(g.skeletons,y.skin.joints),x=0,b=v.length;x<b;x++){var w;(w=v[x]).isSkinnedMesh&&(w.bind(_,y.skin.bindMatrix),w.normalizeSkinWeights()),i.push(w)}for(d=0,f=c.length;d<f;d++){var M=ne(c[d]);null!==M&&i.push(M.clone())}for(d=0,f=h.length;d<f;d++)for(x=0,b=(v=ke(de((g=h[d]).id),g.materials)).length;x<b;x++)i.push(v[x]);for(d=0,f=u.length;d<f;d++)i.push(Oe(u[d]).clone());if(0===a.length&&1===i.length)w=i[0];else for(w="JOINT"===o?new r.Bone:new r.Group,d=0;d<i.length;d++)w.add(i[d]);return w.name="JOINT"===o?e.sid:e.name,w.matrix.copy(n),w.matrix.decompose(w.position,w.quaternion,w.scale),w}var Re=new r.MeshBasicMaterial({color:16711935});function De(e,t){for(var i=[],r=0,n=e.length;r<n;r++){var a=t[e[r]];void 0===a?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",e[r]),i.push(Re)):i.push($(a))}return i}function ke(e,t){var i=[];for(var n in e){var a=e[n],o=De(a.materialKeys,t);0===o.length&&("lines"===n||"linestrips"===n?o.push(new r.LineBasicMaterial):o.push(new r.MeshPhongMaterial));var s=void 0!==a.data.attributes.skinIndex;if(s)for(var l=0,c=o.length;l<c;l++)o[l].skinning=!0;var h,u=1===o.length?o[0]:o;switch(n){case"lines":h=new r.LineSegments(a.data,u);break;case"linestrips":h=new r.Line(a.data,u);break;case"triangles":case"polylist":h=s?new r.SkinnedMesh(a.data,u):new r.Mesh(a.data,u)}i.push(h)}return i}function ze(e){return void 0!==Ye.nodes[e]}function Oe(e){return p(Ye.nodes[e],Ie)}function Be(e){var t=new r.Group;t.name=e.name;for(var i=e.children,n=0;n<i.length;n++){var a=i[n];t.add(Oe(a.id))}return t}function Fe(e){return p(Ye.visualScenes[e],Be)}if(0===e.length)return{scene:new r.Scene};var Ne=(new DOMParser).parseFromString(e,"application/xml"),Ue=i(Ne,"COLLADA")[0],je=Ne.getElementsByTagName("parsererror")[0];if(void 0!==je){var Ve,Ge=i(je,"div")[0];return Ve=Ge?Ge.textContent:function(e){for(var t="",i=[e];i.length;){var r=i.shift();r.nodeType===Node.TEXT_NODE?t+=r.textContent:(t+="\n",i.push.apply(i,r.childNodes))}return t.trim()}(je),console.error("THREE.ColladaLoader: Failed to parse collada file.\n",Ve),null}Ue.getAttribute("version");var He,We=function(e){return{unit:c(i(e,"unit")[0]),upAxis:h(i(e,"up_axis")[0])}}(i(Ue,"asset")[0]),qe=new r.TextureLoader(this.manager);qe.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),r.TGALoader&&(He=new r.TGALoader(this.manager)).setPath(this.resourcePath||t);var Ze=[],Xe={},$e=0,Ye={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};u(Ue,"library_animations","animation",(function e(t){for(var i={sources:{},samplers:{},channels:{}},n=!1,a=0,o=t.childNodes.length;a<o;a++){var s,l=t.childNodes[a];if(1===l.nodeType)switch(l.nodeName){case"source":s=l.getAttribute("id"),i.sources[s]=ae(l);break;case"sampler":s=l.getAttribute("id"),i.samplers[s]=f(l);break;case"channel":s=l.getAttribute("target"),i.channels[s]=m(l);break;case"animation":e(l),n=!0;break;default:console.log(l)}}!1===n&&(Ye.animations[t.getAttribute("id")||r.MathUtils.generateUUID()]=i)})),u(Ue,"library_animation_clips","animation_clip",(function(e){for(var t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"instance_animation":t.animations.push(s(n.getAttribute("url")))}}Ye.clips[e.getAttribute("id")]=t})),u(Ue,"library_controllers","controller",(function(e){for(var t={},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"skin":t.id=s(n.getAttribute("source")),t.skin=L(n);break;case"morph":t.id=s(n.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}Ye.controllers[e.getAttribute("id")]=t})),u(Ue,"library_images","image",(function(e){var t={init_from:i(e,"init_from")[0].textContent};Ye.images[e.getAttribute("id")]=t})),u(Ue,"library_effects","effect",(function(e){for(var t={},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"profile_COMMON":t.profile=z(n)}}Ye.effects[e.getAttribute("id")]=t})),u(Ue,"library_materials","material",(function(e){for(var t={name:e.getAttribute("name")},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"instance_effect":t.url=s(n.getAttribute("url"))}}Ye.materials[e.getAttribute("id")]=t})),u(Ue,"library_cameras","camera",(function(e){for(var t={name:e.getAttribute("name")},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"optics":t.optics=Y(n)}}Ye.cameras[e.getAttribute("id")]=t})),u(Ue,"library_lights","light",(function(e){for(var t={},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"technique_common":t=te(n)}}Ye.lights[e.getAttribute("id")]=t})),u(Ue,"library_geometries","geometry",(function(e){var t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},r=i(e,"mesh")[0];if(void 0!==r){for(var n=0;n<r.childNodes.length;n++){var a=r.childNodes[n];if(1===a.nodeType){var o=a.getAttribute("id");switch(a.nodeName){case"source":t.sources[o]=ae(a);break;case"vertices":t.vertices=oe(a);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",a.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(se(a));break;default:console.log(a)}}}Ye.geometries[e.getAttribute("id")]=t}})),u(Ue,"library_nodes","node",Ae),u(Ue,"library_visual_scenes","visual_scene",(function(e){var t={name:e.getAttribute("name"),children:[]};!function(e){for(var t=e.getElementsByTagName("node"),i=0;i<t.length;i++){var r=t[i];!1===r.hasAttribute("id")&&r.setAttribute("id","three_default_"+$e++)}}(e);for(var r=i(e,"node"),n=0;n<r.length;n++)t.children.push(Ae(r[n]));Ye.visualScenes[e.getAttribute("id")]=t})),u(Ue,"library_kinematics_models","kinematics_model",(function(e){for(var t={name:e.getAttribute("name")||"",joints:{},links:[]},i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"technique_common":fe(r,t)}}Ye.kinematicsModels[e.getAttribute("id")]=t})),u(Ue,"library_physics_models","physics_model",(function(e){for(var t={name:e.getAttribute("name")||"",rigidBodies:{}},i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"rigid_body":t.rigidBodies[r.getAttribute("name")]={},xe(r,t.rigidBodies[r.getAttribute("name")])}}Ye.physicsModels[e.getAttribute("id")]=t})),u(Ue,"scene","instance_kinematics_scene",(function(e){for(var t={bindJointAxis:[]},i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"bind_joint_axis":t.bindJointAxis.push(we(r))}}Ye.kinematicsScenes[s(e.getAttribute("url"))]=t})),d(Ye.animations,g),d(Ye.clips,A),d(Ye.controllers,R),d(Ye.images,D),d(Ye.effects,Z),d(Ye.materials,X),d(Ye.cameras,Q),d(Ye.lights,re),d(Ye.geometries,ce),d(Ye.visualScenes,Be),function(){var e=Ye.clips;if(!0===l(e)){if(!1===l(Ye.animations)){var t=[];for(var i in Ye.animations)for(var n=y(i),a=0,o=n.length;a<o;a++)t.push(n[a]);Ze.push(new r.AnimationClip("default",-1,t))}}else for(var i in e)Ze.push(C(i))}(),function(){var e=Object.keys(Ye.kinematicsModels)[0],t=Object.keys(Ye.kinematicsScenes)[0],i=Object.keys(Ye.visualScenes)[0];if(void 0!==e&&void 0!==t){for(var n,a=(n=e,p(Ye.kinematicsModels[n],pe)),o=function(e){return p(Ye.kinematicsScenes[e],Me)}(t),s=Fe(i),l=o.bindJointAxis,c={},h=0,u=l.length;h<u;h++){var d=l[h],f=Ue.querySelector('[sid="'+d.target+'"]');if(f){var m=f.parentElement;y(d.jointIndex,m)}}var g=new r.Matrix4;Xe={joints:a&&a.joints,getJointValue:function(e){var t=c[e];if(t)return t.position;console.warn("THREE.ColladaLoader: Joint "+e+" doesn't exist.")},setJointValue:function(e,t){var i=c[e];if(i){var n=i.joint;if(t>n.limits.max||t<n.limits.min)console.warn("THREE.ColladaLoader: Joint "+e+" value "+t+" outside of limits (min: "+n.limits.min+", max: "+n.limits.max+").");else if(n.static)console.warn("THREE.ColladaLoader: Joint "+e+" is static.");else{var a=i.object,o=n.axis,s=i.transforms;Se.identity();for(var l=0;l<s.length;l++){var h=s[l];if(h.sid&&-1!==h.sid.indexOf(e))switch(n.type){case"revolute":Se.multiply(g.makeRotationAxis(o,r.MathUtils.degToRad(t)));break;case"prismatic":Se.multiply(g.makeTranslation(o.x*t,o.y*t,o.z*t));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+n.type)}else switch(h.type){case"matrix":Se.multiply(h.obj);break;case"translate":Se.multiply(g.makeTranslation(h.obj.x,h.obj.y,h.obj.z));break;case"scale":Se.scale(h.obj);break;case"rotate":Se.multiply(g.makeRotationAxis(h.obj,h.angle))}}a.matrix.copy(Se),a.matrix.decompose(a.position,a.quaternion,a.scale),c[e].position=t}}else console.log("THREE.ColladaLoader: "+e+" does not exist.")}}}function y(e,t){var i=t.getAttribute("name"),r=a.joints[e];s.traverse((function(n){n.name===i&&(c[e]={object:n,transforms:Te(t),joint:r,position:r.zeroPosition})}))}}();var Je=function(e){return Fe(s(i(e,"instance_visual_scene")[0].getAttribute("url")))}(i(Ue,"scene")[0]);return"Z_UP"===We.upAxis&&Je.quaternion.setFromEuler(new r.Euler(-Math.PI/2,0,0)),Je.scale.multiplyScalar(We.unit),{animations:Ze,kinematics:Xe,library:Ye,scene:Je}}}),t.exports=r.ColladaLoader},{"../../three.js":23}],15:[function(e,t,i){const r=e("../../three.js"),n=e("../Zlib.Inflate.js");r.FBXLoader=function(){var e,t,i;function a(e){r.Loader.call(this,e)}function o(e,t){this.textureLoader=e,this.manager=t}function s(){}function l(){}function c(){}function h(){}function u(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}function d(){}function p(e){var t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function f(e){return e/46186158e3}a.prototype=Object.assign(Object.create(r.Loader.prototype),{constructor:a,load:function(e,t,i,n){var a=this,o=""===a.path?r.LoaderUtils.extractUrlBase(e):a.path,s=new r.FileLoader(this.manager);s.setPath(a.path),s.setResponseType("arraybuffer"),s.load(e,(function(i){try{t(a.parse(i,o))}catch(t){n?n(t):console.error(t),a.manager.itemError(e)}}),i,n)},parse:function(t,i){if(s="Kaydara FBX Binary  \0",(a=t).byteLength>=s.length&&s===w(a,0,s.length))e=(new h).parse(t);else{var n=w(t);if(!function(e){var t,i,r=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],n=0;for(var a=0;a<r.length;++a)if(i=void 0,i=e[(t=1)-1],e=e.slice(n+t),n++,i===r[a])return!1;return!0}(n))throw new Error("THREE.FBXLoader: Unknown format.");if(p(n)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+p(n));e=(new c).parse(n)}var a,s;return new o(new r.TextureLoader(this.manager).setPath(this.resourcePath||i).setCrossOrigin(this.crossOrigin),this.manager).parse(e)}}),o.prototype={constructor:o,parse:function(){t=this.parseConnections();var e=this.parseImages(),r=this.parseTextures(e),n=this.parseMaterials(r),a=this.parseDeformers(),o=(new s).parse(a);return this.parseScene(a,o,n),i},parseConnections:function(){var t=new Map;return"Connections"in e&&e.Connections.connections.forEach((function(e){var i=e[0],r=e[1],n=e[2];t.has(i)||t.set(i,{parents:[],children:[]});var a={ID:r,relationship:n};t.get(i).parents.push(a),t.has(r)||t.set(r,{parents:[],children:[]});var o={ID:i,relationship:n};t.get(r).children.push(o)})),t},parseImages:function(){var t={},i={};if("Video"in e.Objects){var r=e.Objects.Video;for(var n in r){var a=r[n];if(t[c=parseInt(n)]=a.RelativeFilename||a.Filename,"Content"in a){var o=a.Content instanceof ArrayBuffer&&a.Content.byteLength>0,s="string"==typeof a.Content&&""!==a.Content;if(o||s){var l=this.parseImage(r[n]);i[a.RelativeFilename||a.Filename]=l}}}}for(var c in t){var h=t[c];void 0!==i[h]?t[c]=i[h]:t[c]=t[c].split("\\").pop()}return t},parseImage:function(e){var t,i=e.Content,r=e.RelativeFilename||e.Filename,n=r.slice(r.lastIndexOf(".")+1).toLowerCase();switch(n){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",r),t="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+n+'" is not supported.')}if("string"==typeof i)return"data:"+t+";base64,"+i;var a=new Uint8Array(i);return window.URL.createObjectURL(new Blob([a],{type:t}))},parseTextures:function(t){var i=new Map;if("Texture"in e.Objects){var r=e.Objects.Texture;for(var n in r){var a=this.parseTexture(r[n],t);i.set(parseInt(n),a)}}return i},parseTexture:function(e,t){var i=this.loadTexture(e,t);i.ID=e.id,i.name=e.attrName;var n=e.WrapModeU,a=e.WrapModeV,o=void 0!==n?n.value:0,s=void 0!==a?a.value:0;if(i.wrapS=0===o?r.RepeatWrapping:r.ClampToEdgeWrapping,i.wrapT=0===s?r.RepeatWrapping:r.ClampToEdgeWrapping,"Scaling"in e){var l=e.Scaling.value;i.repeat.x=l[0],i.repeat.y=l[1]}return i},loadTexture:function(e,i){var n,a,o=this.textureLoader.path,s=t.get(e.id).children;void 0!==s&&s.length>0&&void 0!==i[s[0].ID]&&(0!==(n=i[s[0].ID]).indexOf("blob:")&&0!==n.indexOf("data:")||this.textureLoader.setPath(void 0));var l=e.FileName.slice(-3).toLowerCase();if("tga"===l){var c=this.manager.getHandler(".tga");null===c?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),a=new r.Texture):a=c.load(n)}else"psd"===l?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),a=new r.Texture):a=this.textureLoader.load(n);return this.textureLoader.setPath(o),a},parseMaterials:function(t){var i=new Map;if("Material"in e.Objects){var r=e.Objects.Material;for(var n in r){var a=this.parseMaterial(r[n],t);null!==a&&i.set(parseInt(n),a)}}return i},parseMaterial:function(e,i){var n=e.id,a=e.attrName,o=e.ShadingModel;if("object"==typeof o&&(o=o.value),!t.has(n))return null;var s,l=this.parseParameters(e,i,n);switch(o.toLowerCase()){case"phong":s=new r.MeshPhongMaterial;break;case"lambert":s=new r.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',o),s=new r.MeshPhongMaterial}return s.setValues(l),s.name=a,s},parseParameters:function(e,i,n){var a={};e.BumpFactor&&(a.bumpScale=e.BumpFactor.value),e.Diffuse?a.color=(new r.Color).fromArray(e.Diffuse.value):e.DiffuseColor&&"Color"===e.DiffuseColor.type&&(a.color=(new r.Color).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(a.displacementScale=e.DisplacementFactor.value),e.Emissive?a.emissive=(new r.Color).fromArray(e.Emissive.value):e.EmissiveColor&&"Color"===e.EmissiveColor.type&&(a.emissive=(new r.Color).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(a.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(a.opacity=parseFloat(e.Opacity.value)),a.opacity<1&&(a.transparent=!0),e.ReflectionFactor&&(a.reflectivity=e.ReflectionFactor.value),e.Shininess&&(a.shininess=e.Shininess.value),e.Specular?a.specular=(new r.Color).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(a.specular=(new r.Color).fromArray(e.SpecularColor.value));var o=this;return t.get(n).children.forEach((function(e){var t=e.relationship;switch(t){case"Bump":a.bumpMap=o.getTexture(i,e.ID);break;case"Maya|TEX_ao_map":a.aoMap=o.getTexture(i,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":a.map=o.getTexture(i,e.ID),a.map.encoding=r.sRGBEncoding;break;case"DisplacementColor":a.displacementMap=o.getTexture(i,e.ID);break;case"EmissiveColor":a.emissiveMap=o.getTexture(i,e.ID),a.emissiveMap.encoding=r.sRGBEncoding;break;case"NormalMap":case"Maya|TEX_normal_map":a.normalMap=o.getTexture(i,e.ID);break;case"ReflectionColor":a.envMap=o.getTexture(i,e.ID),a.envMap.mapping=r.EquirectangularReflectionMapping,a.envMap.encoding=r.sRGBEncoding;break;case"SpecularColor":a.specularMap=o.getTexture(i,e.ID),a.specularMap.encoding=r.sRGBEncoding;break;case"TransparentColor":case"TransparencyFactor":a.alphaMap=o.getTexture(i,e.ID),a.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",t)}})),a},getTexture:function(i,r){return"LayeredTexture"in e.Objects&&r in e.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),r=t.get(r).children[0].ID),i.get(r)},parseDeformers:function(){var i={},r={};if("Deformer"in e.Objects){var n=e.Objects.Deformer;for(var a in n){var o=n[a],s=t.get(parseInt(a));if("Skin"===o.attrType){var l=this.parseSkeleton(s,n);l.ID=a,s.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),l.geometryID=s.parents[0].ID,i[a]=l}else if("BlendShape"===o.attrType){var c={id:a};c.rawTargets=this.parseMorphTargets(s,n),c.id=a,s.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),r[a]=c}}}return{skeletons:i,morphTargets:r}},parseSkeleton:function(e,t){var i=[];return e.children.forEach((function(e){var n=t[e.ID];if("Cluster"===n.attrType){var a={ID:e.ID,indices:[],weights:[],transformLink:(new r.Matrix4).fromArray(n.TransformLink.a)};"Indexes"in n&&(a.indices=n.Indexes.a,a.weights=n.Weights.a),i.push(a)}})),{rawBones:i,bones:[]}},parseMorphTargets:function(e,i){for(var r=[],n=0;n<e.children.length;n++){var a=e.children[n],o=i[a.ID],s={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if("BlendShapeChannel"!==o.attrType)return;s.geoID=t.get(parseInt(a.ID)).children.filter((function(e){return void 0===e.relationship}))[0].ID,r.push(s)}return r},parseScene:function(n,a,o){i=new r.Group;var s=this.parseModels(n.skeletons,a,o),c=e.Objects.Model,h=this;s.forEach((function(e){var r=c[e.ID];h.setLookAtProperties(e,r),t.get(e.ID).parents.forEach((function(t){var i=s.get(t.ID);void 0!==i&&i.add(e)})),null===e.parent&&i.add(e)})),this.bindSkeleton(n.skeletons,a,s),this.createAmbientLight(),this.setupMorphMaterials(),i.traverse((function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrixWorld=e.parent.matrix);var t=_(e.userData.transformData);e.applyMatrix4(t)}}));var u=(new l).parse();1===i.children.length&&i.children[0].isGroup&&(i.children[0].animations=u,i=i.children[0]),i.animations=u},parseModels:function(i,n,a){var o=new Map,s=e.Objects.Model;for(var l in s){var c=parseInt(l),h=s[l],u=t.get(c),d=this.buildSkeleton(u,i,c,h.attrName);if(!d){switch(h.attrType){case"Camera":d=this.createCamera(u);break;case"Light":d=this.createLight(u);break;case"Mesh":d=this.createMesh(u,n,a);break;case"NurbsCurve":d=this.createCurve(u,n);break;case"LimbNode":case"Root":d=new r.Bone;break;case"Null":default:d=new r.Group}d.name=h.attrName?r.PropertyBinding.sanitizeNodeName(h.attrName):"",d.ID=c}this.getTransformData(d,h),o.set(c,d)}return o},buildSkeleton:function(e,t,i,n){var a=null;return e.parents.forEach((function(e){for(var o in t){var s=t[o];s.rawBones.forEach((function(t,o){if(t.ID===e.ID){var l=a;(a=new r.Bone).matrixWorld.copy(t.transformLink),a.name=n?r.PropertyBinding.sanitizeNodeName(n):"",a.ID=i,s.bones[o]=a,null!==l&&a.add(l)}}))}})),a},createCamera:function(t){var i,n;if(t.children.forEach((function(t){var i=e.Objects.NodeAttribute[t.ID];void 0!==i&&(n=i)})),void 0===n)i=new r.Object3D;else{var a=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(a=1);var o=1;void 0!==n.NearPlane&&(o=n.NearPlane.value/1e3);var s=1e3;void 0!==n.FarPlane&&(s=n.FarPlane.value/1e3);var l=window.innerWidth,c=window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(l=n.AspectWidth.value,c=n.AspectHeight.value);var h=l/c,u=45;void 0!==n.FieldOfView&&(u=n.FieldOfView.value);var d=n.FocalLength?n.FocalLength.value:null;switch(a){case 0:i=new r.PerspectiveCamera(u,h,o,s),null!==d&&i.setFocalLength(d);break;case 1:i=new r.OrthographicCamera(-l/2,l/2,c/2,-c/2,o,s);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+a+"."),i=new r.Object3D}}return i},createLight:function(t){var i,n;if(t.children.forEach((function(t){var i=e.Objects.NodeAttribute[t.ID];void 0!==i&&(n=i)})),void 0===n)i=new r.Object3D;else{var a;a=void 0===n.LightType?0:n.LightType.value;var o=16777215;void 0!==n.Color&&(o=(new r.Color).fromArray(n.Color.value));var s=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(s=0);var l=0;switch(void 0!==n.FarAttenuationEnd&&(l=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value),a){case 0:i=new r.PointLight(o,s,l,1);break;case 1:i=new r.DirectionalLight(o,s);break;case 2:var c=Math.PI/3;void 0!==n.InnerAngle&&(c=r.MathUtils.degToRad(n.InnerAngle.value));var h=0;void 0!==n.OuterAngle&&(h=r.MathUtils.degToRad(n.OuterAngle.value),h=Math.max(h,1)),i=new r.SpotLight(o,s,l,c,h,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a THREE.PointLight."),i=new r.PointLight(o,s)}void 0!==n.CastShadows&&1===n.CastShadows.value&&(i.castShadow=!0)}return i},createMesh:function(e,t,i){var n,a=null,o=null,s=[];return e.children.forEach((function(e){t.has(e.ID)&&(a=t.get(e.ID)),i.has(e.ID)&&s.push(i.get(e.ID))})),s.length>1?o=s:s.length>0?o=s[0]:(o=new r.MeshPhongMaterial({color:13421772}),s.push(o)),"color"in a.attributes&&s.forEach((function(e){e.vertexColors=!0})),a.FBX_Deformer?(s.forEach((function(e){e.skinning=!0})),(n=new r.SkinnedMesh(a,o)).normalizeSkinWeights()):n=new r.Mesh(a,o),n},createCurve:function(e,t){var i=e.children.reduce((function(e,i){return t.has(i.ID)&&(e=t.get(i.ID)),e}),null),n=new r.LineBasicMaterial({color:3342591,linewidth:1});return new r.Line(i,n)},getTransformData:function(e,t){var i={};"InheritType"in t&&(i.inheritType=parseInt(t.InheritType.value)),i.eulerOrder="RotationOrder"in t?x(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(i.translation=t.Lcl_Translation.value),"PreRotation"in t&&(i.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(i.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(i.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(i.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(i.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(i.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(i.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(i.rotationPivot=t.RotationPivot.value),e.userData.transformData=i},setLookAtProperties:function(n,a){"LookAtProperty"in a&&t.get(n.ID).children.forEach((function(t){if("LookAtProperty"===t.relationship){var a=e.Objects.Model[t.ID];if("Lcl_Translation"in a){var o=a.Lcl_Translation.value;void 0!==n.target?(n.target.position.fromArray(o),i.add(n.target)):n.lookAt((new r.Vector3).fromArray(o))}}}))},bindSkeleton:function(e,i,n){var a=this.parsePoseNodes();for(var o in e){var s=e[o];t.get(parseInt(s.ID)).parents.forEach((function(e){if(i.has(e.ID)){var o=e.ID;t.get(o).parents.forEach((function(e){n.has(e.ID)&&n.get(e.ID).bind(new r.Skeleton(s.bones),a[e.ID])}))}}))}},parsePoseNodes:function(){var t={};if("Pose"in e.Objects){var i=e.Objects.Pose;for(var n in i)if("BindPose"===i[n].attrType){var a=i[n].PoseNode;Array.isArray(a)?a.forEach((function(e){t[e.Node]=(new r.Matrix4).fromArray(e.Matrix.a)})):t[a.Node]=(new r.Matrix4).fromArray(a.Matrix.a)}}return t},createAmbientLight:function(){if("GlobalSettings"in e&&"AmbientColor"in e.GlobalSettings){var t=e.GlobalSettings.AmbientColor.value,n=t[0],a=t[1],o=t[2];if(0!==n||0!==a||0!==o){var s=new r.Color(n,a,o);i.add(new r.AmbientLight(s,1))}}},setupMorphMaterials:function(){var e=this;i.traverse((function(t){t.isMesh&&t.geometry.morphAttributes.position&&t.geometry.morphAttributes.position.length&&(Array.isArray(t.material)?t.material.forEach((function(i,r){e.setupMorphMaterial(t,i,r)})):e.setupMorphMaterial(t,t.material))}))},setupMorphMaterial:function(e,t,r){var n=e.uuid,a=t.uuid,o=!1;if(i.traverse((function(e){e.isMesh&&(Array.isArray(e.material)?e.material.forEach((function(t){t.uuid===a&&e.uuid!==n&&(o=!0)})):e.material.uuid===a&&e.uuid!==n&&(o=!0))})),!0===o){var s=t.clone();s.morphTargets=!0,void 0===r?e.material=s:e.material[r]=s}else t.morphTargets=!0}},s.prototype={constructor:s,parse:function(i){var r=new Map;if("Geometry"in e.Objects){var n=e.Objects.Geometry;for(var a in n){var o=t.get(parseInt(a)),s=this.parseGeometry(o,n[a],i);r.set(parseInt(a),s)}}return r},parseGeometry:function(e,t,i){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,i);case"NurbsCurve":return this.parseNurbsGeometry(t)}},parseMeshGeometry:function(t,i,r){var n=r.skeletons,a=[],o=t.parents.map((function(t){return e.Objects.Model[t.ID]}));if(0!==o.length){var s=t.children.reduce((function(e,t){return void 0!==n[t.ID]&&(e=n[t.ID]),e}),null);t.children.forEach((function(e){void 0!==r.morphTargets[e.ID]&&a.push(r.morphTargets[e.ID])}));var l=o[0],c={};"RotationOrder"in l&&(c.eulerOrder=x(l.RotationOrder.value)),"InheritType"in l&&(c.inheritType=parseInt(l.InheritType.value)),"GeometricTranslation"in l&&(c.translation=l.GeometricTranslation.value),"GeometricRotation"in l&&(c.rotation=l.GeometricRotation.value),"GeometricScaling"in l&&(c.scale=l.GeometricScaling.value);var h=_(c);return this.genGeometry(i,s,a,h)}},genGeometry:function(e,t,i,n){var a=new r.BufferGeometry;e.attrName&&(a.name=e.attrName);var o=this.parseGeoNode(e,t),s=this.genBuffers(o),l=new r.Float32BufferAttribute(s.vertex,3);if(l.applyMatrix4(n),a.setAttribute("position",l),s.colors.length>0&&a.setAttribute("color",new r.Float32BufferAttribute(s.colors,3)),t&&(a.setAttribute("skinIndex",new r.Uint16BufferAttribute(s.weightsIndices,4)),a.setAttribute("skinWeight",new r.Float32BufferAttribute(s.vertexWeights,4)),a.FBX_Deformer=t),s.normal.length>0){var c=(new r.Matrix3).getNormalMatrix(n),h=new r.Float32BufferAttribute(s.normal,3);h.applyNormalMatrix(c),a.setAttribute("normal",h)}if(s.uvs.forEach((function(e,t){var i="uv"+(t+1).toString();0===t&&(i="uv"),a.setAttribute(i,new r.Float32BufferAttribute(s.uvs[t],2))})),o.material&&"AllSame"!==o.material.mappingType){var u=s.materialIndex[0],d=0;if(s.materialIndex.forEach((function(e,t){e!==u&&(a.addGroup(d,t-d,u),u=e,d=t)})),a.groups.length>0){var p=a.groups[a.groups.length-1],f=p.start+p.count;f!==s.materialIndex.length&&a.addGroup(f,s.materialIndex.length-f,u)}0===a.groups.length&&a.addGroup(0,s.materialIndex.length,s.materialIndex[0])}return this.addMorphTargets(a,e,i,n),a},parseGeoNode:function(e,t){var i={};if(i.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],i.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(i.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(i.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(i.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){i.uv=[];for(var r=0;e.LayerElementUV[r];)i.uv.push(this.parseUVs(e.LayerElementUV[r])),r++}return i.weightTable={},null!==t&&(i.skeleton=t,t.rawBones.forEach((function(e,t){e.indices.forEach((function(r,n){void 0===i.weightTable[r]&&(i.weightTable[r]=[]),i.weightTable[r].push({id:t,weight:e.weights[n]})}))}))),i},genBuffers:function(e){var t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},i=0,r=0,n=!1,a=[],o=[],s=[],l=[],c=[],h=[],u=this;return e.vertexIndices.forEach((function(d,p){var f=!1;d<0&&(d^=-1,f=!0);var m=[],y=[];if(a.push(3*d,3*d+1,3*d+2),e.color){var v=g(p,i,d,e.color);s.push(v[0],v[1],v[2])}if(e.skeleton){if(void 0!==e.weightTable[d]&&e.weightTable[d].forEach((function(e){y.push(e.weight),m.push(e.id)})),y.length>4){n||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),n=!0);var _=[0,0,0,0],x=[0,0,0,0];y.forEach((function(e,t){var i=e,r=m[t];x.forEach((function(e,t,n){if(i>e){n[t]=i,i=e;var a=_[t];_[t]=r,r=a}}))})),m=_,y=x}for(;y.length<4;)y.push(0),m.push(0);for(var b=0;b<4;++b)c.push(y[b]),h.push(m[b])}if(e.normal&&(v=g(p,i,d,e.normal),o.push(v[0],v[1],v[2])),e.material&&"AllSame"!==e.material.mappingType)var w=g(p,i,d,e.material)[0];e.uv&&e.uv.forEach((function(e,t){var r=g(p,i,d,e);void 0===l[t]&&(l[t]=[]),l[t].push(r[0]),l[t].push(r[1])})),r++,f&&(u.genFace(t,e,a,w,o,s,l,c,h,r),i++,r=0,a=[],o=[],s=[],l=[],c=[],h=[])})),t},genFace:function(e,t,i,r,n,a,o,s,l,c){for(var h=2;h<c;h++)e.vertex.push(t.vertexPositions[i[0]]),e.vertex.push(t.vertexPositions[i[1]]),e.vertex.push(t.vertexPositions[i[2]]),e.vertex.push(t.vertexPositions[i[3*(h-1)]]),e.vertex.push(t.vertexPositions[i[3*(h-1)+1]]),e.vertex.push(t.vertexPositions[i[3*(h-1)+2]]),e.vertex.push(t.vertexPositions[i[3*h]]),e.vertex.push(t.vertexPositions[i[3*h+1]]),e.vertex.push(t.vertexPositions[i[3*h+2]]),t.skeleton&&(e.vertexWeights.push(s[0]),e.vertexWeights.push(s[1]),e.vertexWeights.push(s[2]),e.vertexWeights.push(s[3]),e.vertexWeights.push(s[4*(h-1)]),e.vertexWeights.push(s[4*(h-1)+1]),e.vertexWeights.push(s[4*(h-1)+2]),e.vertexWeights.push(s[4*(h-1)+3]),e.vertexWeights.push(s[4*h]),e.vertexWeights.push(s[4*h+1]),e.vertexWeights.push(s[4*h+2]),e.vertexWeights.push(s[4*h+3]),e.weightsIndices.push(l[0]),e.weightsIndices.push(l[1]),e.weightsIndices.push(l[2]),e.weightsIndices.push(l[3]),e.weightsIndices.push(l[4*(h-1)]),e.weightsIndices.push(l[4*(h-1)+1]),e.weightsIndices.push(l[4*(h-1)+2]),e.weightsIndices.push(l[4*(h-1)+3]),e.weightsIndices.push(l[4*h]),e.weightsIndices.push(l[4*h+1]),e.weightsIndices.push(l[4*h+2]),e.weightsIndices.push(l[4*h+3])),t.color&&(e.colors.push(a[0]),e.colors.push(a[1]),e.colors.push(a[2]),e.colors.push(a[3*(h-1)]),e.colors.push(a[3*(h-1)+1]),e.colors.push(a[3*(h-1)+2]),e.colors.push(a[3*h]),e.colors.push(a[3*h+1]),e.colors.push(a[3*h+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(r),e.materialIndex.push(r),e.materialIndex.push(r)),t.normal&&(e.normal.push(n[0]),e.normal.push(n[1]),e.normal.push(n[2]),e.normal.push(n[3*(h-1)]),e.normal.push(n[3*(h-1)+1]),e.normal.push(n[3*(h-1)+2]),e.normal.push(n[3*h]),e.normal.push(n[3*h+1]),e.normal.push(n[3*h+2])),t.uv&&t.uv.forEach((function(t,i){void 0===e.uvs[i]&&(e.uvs[i]=[]),e.uvs[i].push(o[i][0]),e.uvs[i].push(o[i][1]),e.uvs[i].push(o[i][2*(h-1)]),e.uvs[i].push(o[i][2*(h-1)+1]),e.uvs[i].push(o[i][2*h]),e.uvs[i].push(o[i][2*h+1])}))},addMorphTargets:function(t,i,r,n){if(0!==r.length){t.morphTargetsRelative=!0,t.morphAttributes.position=[];var a=this;r.forEach((function(r){r.rawTargets.forEach((function(r){var o=e.Objects.Geometry[r.geoID];void 0!==o&&a.genMorphGeometry(t,i,o,n,r.name)}))}))}},genMorphGeometry:function(e,t,i,n,a){for(var o=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],s=void 0!==i.Vertices?i.Vertices.a:[],l=void 0!==i.Indexes?i.Indexes.a:[],c=3*e.attributes.position.count,h=new Float32Array(c),u=0;u<l.length;u++){var d=3*l[u];h[d]=s[3*u],h[d+1]=s[3*u+1],h[d+2]=s[3*u+2]}var p={vertexIndices:o,vertexPositions:h},f=this.genBuffers(p),m=new r.Float32BufferAttribute(f.vertex,3);m.name=a||i.attrName,m.applyMatrix4(n),e.morphAttributes.position.push(m)},parseNormals:function(e){var t=e.MappingInformationType,i=e.ReferenceInformationType,r=e.Normals.a,n=[];return"IndexToDirect"===i&&("NormalIndex"in e?n=e.NormalIndex.a:"NormalsIndex"in e&&(n=e.NormalsIndex.a)),{dataSize:3,buffer:r,indices:n,mappingType:t,referenceType:i}},parseUVs:function(e){var t=e.MappingInformationType,i=e.ReferenceInformationType,r=e.UV.a,n=[];return"IndexToDirect"===i&&(n=e.UVIndex.a),{dataSize:2,buffer:r,indices:n,mappingType:t,referenceType:i}},parseVertexColors:function(e){var t=e.MappingInformationType,i=e.ReferenceInformationType,r=e.Colors.a,n=[];return"IndexToDirect"===i&&(n=e.ColorIndex.a),{dataSize:4,buffer:r,indices:n,mappingType:t,referenceType:i}},parseMaterialIndices:function(e){var t=e.MappingInformationType,i=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:i};for(var r=e.Materials.a,n=[],a=0;a<r.length;++a)n.push(a);return{dataSize:1,buffer:r,indices:n,mappingType:t,referenceType:i}},parseNurbsGeometry:function(e){if(void 0===r.NURBSCurve)return console.error("THREE.FBXLoader: The loader relies on THREE.NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new r.BufferGeometry;var t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new r.BufferGeometry;for(var i,n,a=t-1,o=e.KnotVector.a,s=[],l=e.Points.a,c=0,h=l.length;c<h;c+=4)s.push((new r.Vector4).fromArray(l,c));if("Closed"===e.Form)s.push(s[0]);else if("Periodic"===e.Form)for(i=a,n=o.length-1-i,c=0;c<a;++c)s.push(s[c]);var u=new r.NURBSCurve(a,o,s,i,n).getPoints(7*s.length),d=new Float32Array(3*u.length);u.forEach((function(e,t){e.toArray(d,3*t)}));var p=new r.BufferGeometry;return p.setAttribute("position",new r.BufferAttribute(d,3)),p}},l.prototype={constructor:l,parse:function(){var e=[],t=this.parseClips();if(void 0!==t)for(var i in t){var r=t[i],n=this.addClip(r);e.push(n)}return e},parseClips:function(){if(void 0!==e.Objects.AnimationCurve){var t=this.parseAnimationCurveNodes();this.parseAnimationCurves(t);var i=this.parseAnimationLayers(t);return this.parseAnimStacks(i)}},parseAnimationCurveNodes:function(){var t=e.Objects.AnimationCurveNode,i=new Map;for(var r in t){var n=t[r];if(null!==n.attrName.match(/S|R|T|DeformPercent/)){var a={id:n.id,attr:n.attrName,curves:{}};i.set(a.id,a)}}return i},parseAnimationCurves:function(i){var r=e.Objects.AnimationCurve;for(var n in r){var a={id:r[n].id,times:r[n].KeyTime.a.map(f),values:r[n].KeyValueFloat.a},o=t.get(a.id);if(void 0!==o){var s=o.parents[0].ID,l=o.parents[0].relationship;l.match(/X/)?i.get(s).curves.x=a:l.match(/Y/)?i.get(s).curves.y=a:l.match(/Z/)?i.get(s).curves.z=a:l.match(/d|DeformPercent/)&&i.has(s)&&(i.get(s).curves.morph=a)}}},parseAnimationLayers:function(n){var a=e.Objects.AnimationLayer,o=new Map;for(var s in a){var l=[],c=t.get(parseInt(s));void 0!==c&&(c.children.forEach((function(a,o){if(n.has(a.ID)){var s=n.get(a.ID);if(void 0!==s.curves.x||void 0!==s.curves.y||void 0!==s.curves.z){if(void 0===l[o]&&void 0!==(f=t.get(a.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID)){if(void 0===(h=e.Objects.Model[f.toString()]))return void console.warn("THREE.FBXLoader: Encountered a unused curve.",a);var c={modelName:h.attrName?r.PropertyBinding.sanitizeNodeName(h.attrName):"",ID:h.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};i.traverse((function(e){e.ID===h.id&&(c.transform=e.matrix,e.userData.transformData&&(c.eulerOrder=e.userData.transformData.eulerOrder))})),c.transform||(c.transform=new r.Matrix4),"PreRotation"in h&&(c.preRotation=h.PreRotation.value),"PostRotation"in h&&(c.postRotation=h.PostRotation.value),l[o]=c}l[o]&&(l[o][s.attr]=s)}else if(void 0!==s.curves.morph){if(void 0===l[o]){var h,u=t.get(a.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID,d=t.get(u).parents[0].ID,p=t.get(d).parents[0].ID,f=t.get(p).parents[0].ID;c={modelName:(h=e.Objects.Model[f]).attrName?r.PropertyBinding.sanitizeNodeName(h.attrName):"",morphName:e.Objects.Deformer[u].attrName},l[o]=c}l[o][s.attr]=s}}})),o.set(parseInt(s),l))}return o},parseAnimStacks:function(i){var r=e.Objects.AnimationStack,n={};for(var a in r){var o=t.get(parseInt(a)).children;o.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var s=i.get(o[0].ID);n[a]={name:r[a].attrName,layer:s}}return n},addClip:function(e){var t=[],i=this;return e.layer.forEach((function(e){t=t.concat(i.generateTracks(e))})),new r.AnimationClip(e.name,-1,t)},generateTracks:function(e){var t=[],i=new r.Vector3,n=new r.Quaternion,a=new r.Vector3;if(e.transform&&e.transform.decompose(i,n,a),i=i.toArray(),n=(new r.Euler).setFromQuaternion(n,e.eulerOrder).toArray(),a=a.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){var o=this.generateVectorTrack(e.modelName,e.T.curves,i,"position");void 0!==o&&t.push(o)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){var s=this.generateRotationTrack(e.modelName,e.R.curves,n,e.preRotation,e.postRotation,e.eulerOrder);void 0!==s&&t.push(s)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){var l=this.generateVectorTrack(e.modelName,e.S.curves,a,"scale");void 0!==l&&t.push(l)}if(void 0!==e.DeformPercent){var c=this.generateMorphTrack(e);void 0!==c&&t.push(c)}return t},generateVectorTrack:function(e,t,i,n){var a=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(a,t,i);return new r.VectorKeyframeTrack(e+"."+n,a,o)},generateRotationTrack:function(e,t,i,n,a,o){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(r.MathUtils.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(r.MathUtils.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(r.MathUtils.degToRad));var s=this.getTimesForAllAxes(t),l=this.getKeyframeTrackValues(s,t,i);void 0!==n&&((n=n.map(r.MathUtils.degToRad)).push(o),n=(new r.Euler).fromArray(n),n=(new r.Quaternion).setFromEuler(n)),void 0!==a&&((a=a.map(r.MathUtils.degToRad)).push(o),a=(new r.Euler).fromArray(a),a=(new r.Quaternion).setFromEuler(a).inverse());for(var c=new r.Quaternion,h=new r.Euler,u=[],d=0;d<l.length;d+=3)h.set(l[d],l[d+1],l[d+2],o),c.setFromEuler(h),void 0!==n&&c.premultiply(n),void 0!==a&&c.multiply(a),c.toArray(u,d/3*4);return new r.QuaternionKeyframeTrack(e+".quaternion",s,u)},generateMorphTrack:function(e){var t=e.DeformPercent.curves.morph,n=t.values.map((function(e){return e/100})),a=i.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new r.NumberKeyframeTrack(e.modelName+".morphTargetInfluences["+a+"]",t.times,n)},getTimesForAllAxes:function(e){var t=[];return void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t.sort((function(e,t){return e-t})).filter((function(e,t,i){return i.indexOf(e)==t}))},getKeyframeTrackValues:function(e,t,i){var r=i,n=[],a=-1,o=-1,s=-1;return e.forEach((function(e){if(t.x&&(a=t.x.times.indexOf(e)),t.y&&(o=t.y.times.indexOf(e)),t.z&&(s=t.z.times.indexOf(e)),-1!==a){var i=t.x.values[a];n.push(i),r[0]=i}else n.push(r[0]);if(-1!==o){var l=t.y.values[o];n.push(l),r[1]=l}else n.push(r[1]);if(-1!==s){var c=t.z.values[s];n.push(c),r[2]=c}else n.push(r[2])})),n},interpolateRotations:function(e){for(var t=1;t<e.values.length;t++){var i=e.values[t-1],r=e.values[t]-i,n=Math.abs(r);if(n>=180){for(var a=n/180,o=r/a,s=i+o,l=e.times[t-1],c=(e.times[t]-l)/a,h=l+c,u=[],d=[];h<e.times[t];)u.push(h),h+=c,d.push(s),s+=o;e.times=M(e.times,t,u),e.values=M(e.values,t,d)}}}},c.prototype={constructor:c,getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(e){this.nodeStack.push(e),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(e,t){this.currentProp=e,this.currentPropName=t},parse:function(e){this.currentIndent=0,this.allNodes=new d,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var t=this,i=e.split(/[\r\n]+/);return i.forEach((function(e,r){var n=e.match(/^[\s\t]*;/),a=e.match(/^[\s\t]*$/);if(!n&&!a){var o=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),s=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=e.match("^\\t{"+(t.currentIndent-1)+"}}");o?t.parseNodeBegin(e,o):s?t.parseNodeProperty(e,s,i[++r]):l?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)}})),this.allNodes},parseNodeBegin:function(e,t){var i=t[1].trim().replace(/^"/,"").replace(/"$/,""),r=t[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),n={name:i},a=this.parseNodeAttr(r),o=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(i,n):i in o?("PoseNode"===i?o.PoseNode.push(n):void 0!==o[i].id&&(o[i]={},o[i][o[i].id]=o[i]),""!==a.id&&(o[i][a.id]=n)):"number"==typeof a.id?(o[i]={},o[i][a.id]=n):"Properties70"!==i&&(o[i]="PoseNode"===i?[n]:n),"number"==typeof a.id&&(n.id=a.id),""!==a.name&&(n.attrName=a.name),""!==a.type&&(n.attrType=a.type),this.pushStack(n)},parseNodeAttr:function(e){var t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));var i="",r="";return e.length>1&&(i=e[1].replace(/^(\w+)::/,""),r=e[2]),{id:t,name:i,type:r}},parseNodeProperty:function(e,t,i){var r=t[1].replace(/^"/,"").replace(/"$/,"").trim(),n=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===r&&","===n&&(n=i.replace(/"/g,"").replace(/,$/,"").trim());var a=this.getCurrentNode();if("Properties70"!==a.name){if("C"===r){var o=n.split(",").slice(1),s=parseInt(o[0]),l=parseInt(o[1]),c=n.split(",").slice(3);r="connections",function(e,t){for(var i=0,r=e.length,n=t.length;i<n;i++,r++)e[r]=t[i]}(n=[s,l],c=c.map((function(e){return e.trim().replace(/^"/,"")}))),void 0===a[r]&&(a[r]=[])}"Node"===r&&(a.id=n),r in a&&Array.isArray(a[r])?a[r].push(n):"a"!==r?a[r]=n:a.a=n,this.setCurrentProp(a,r),"a"===r&&","!==n.slice(-1)&&(a.a=b(n))}else this.parseNodeSpecialProperty(e,r,n)},parseNodePropertyContinued:function(e){var t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=b(t.a))},parseNodeSpecialProperty:function(e,t,i){var r=i.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")})),n=r[0],a=r[1],o=r[2],s=r[3],l=r[4];switch(a){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=b(l)}this.getPrevNode()[n]={type:a,type2:o,flag:s,value:l},this.setCurrentProp(this.getPrevNode(),n)}},h.prototype={constructor:h,parse:function(e){var t=new u(e);t.skip(23);for(var i=t.getUint32(),r=new d;!this.endOfContent(t);){var n=this.parseNode(t,i);null!==n&&r.add(n.name,n)}return r},endOfContent:function(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()},parseNode:function(e,t){var i={},r=t>=7500?e.getUint64():e.getUint32(),n=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();var a=e.getUint8(),o=e.getString(a);if(0===r)return null;for(var s=[],l=0;l<n;l++)s.push(this.parseProperty(e));var c=s.length>0?s[0]:"",h=s.length>1?s[1]:"",u=s.length>2?s[2]:"";for(i.singleProperty=1===n&&e.getOffset()===r;r>e.getOffset();){var d=this.parseNode(e,t);null!==d&&this.parseSubNode(o,i,d)}return i.propertyList=s,"number"==typeof c&&(i.id=c),""!==h&&(i.attrName=h),""!==u&&(i.attrType=u),""!==o&&(i.name=o),i},parseSubNode:function(e,t,i){if(!0===i.singleProperty){var r=i.propertyList[0];Array.isArray(r)?(t[i.name]=i,i.a=r):t[i.name]=r}else if("Connections"===e&&"C"===i.name){var n=[];i.propertyList.forEach((function(e,t){0!==t&&n.push(e)})),void 0===t.connections&&(t.connections=[]),t.connections.push(n)}else if("Properties70"===i.name)Object.keys(i).forEach((function(e){t[e]=i[e]}));else if("Properties70"===e&&"P"===i.name){var a,o=i.propertyList[0],s=i.propertyList[1],l=i.propertyList[2],c=i.propertyList[3];0===o.indexOf("Lcl ")&&(o=o.replace("Lcl ","Lcl_")),0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),a="Color"===s||"ColorRGB"===s||"Vector"===s||"Vector3D"===s||0===s.indexOf("Lcl_")?[i.propertyList[4],i.propertyList[5],i.propertyList[6]]:i.propertyList[4],t[o]={type:s,type2:l,flag:c,value:a}}else void 0===t[i.name]?"number"==typeof i.id?(t[i.name]={},t[i.name][i.id]=i):t[i.name]=i:"PoseNode"===i.name?(Array.isArray(t[i.name])||(t[i.name]=[t[i.name]]),t[i.name].push(i)):void 0===t[i.name][i.id]&&(t[i.name][i.id]=i)},parseProperty:function(e){var t=e.getString(1);switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":var i=e.getUint32();return e.getArrayBuffer(i);case"S":return i=e.getUint32(),e.getString(i);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var r=e.getUint32(),a=e.getUint32(),o=e.getUint32();if(0===a)switch(t){case"b":case"c":return e.getBooleanArray(r);case"d":return e.getFloat64Array(r);case"f":return e.getFloat32Array(r);case"i":return e.getInt32Array(r);case"l":return e.getInt64Array(r)}void 0===n&&console.error("THREE.FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var s=new u(new n.Inflate(new Uint8Array(e.getArrayBuffer(o))).decompress().buffer);switch(t){case"b":case"c":return s.getBooleanArray(r);case"d":return s.getFloat64Array(r);case"f":return s.getFloat32Array(r);case"i":return s.getInt32Array(r);case"l":return s.getInt64Array(r)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}},u.prototype={constructor:u,getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(e){this.offset+=e},getBoolean:function(){return 1==(1&this.getUint8())},getBooleanArray:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getBoolean());return t},getUint8:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e},getInt16:function(){var e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e},getInt32:function(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},getInt32Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getInt32());return t},getUint32:function(){var e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e},getInt64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,4294967295==(e=4294967295&~e)&&(t=t+1&4294967295),-(4294967296*t+(e=e+1&4294967295))):4294967296*t+e},getInt64Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getInt64());return t},getUint64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e},getFloat32:function(){var e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e},getFloat32Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getFloat32());return t},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},getFloat64Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getFloat64());return t},getArrayBuffer:function(e){var t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t},getString:function(e){for(var t=[],i=0;i<e;i++)t[i]=this.getUint8();var n=t.indexOf(0);return n>=0&&(t=t.slice(0,n)),r.LoaderUtils.decodeText(new Uint8Array(t))}},d.prototype={constructor:d,add:function(e,t){this[e]=t}};var m=[];function g(e,t,i,r){var n;switch(r.mappingType){case"ByPolygonVertex":n=e;break;case"ByPolygon":n=t;break;case"ByVertice":n=i;break;case"AllSame":n=r.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+r.mappingType)}"IndexToDirect"===r.referenceType&&(n=r.indices[n]);var a=n*r.dataSize,o=a+r.dataSize;return function(e,t,i,r){for(var n=i,a=0;n<r;n++,a++)e[a]=t[n];return e}(m,r.buffer,a,o)}var y=new r.Euler,v=new r.Vector3;function _(e){var t,i=new r.Matrix4,n=new r.Matrix4,a=new r.Matrix4,o=new r.Matrix4,s=new r.Matrix4,l=new r.Matrix4,c=new r.Matrix4,h=new r.Matrix4,u=new r.Matrix4,d=new r.Matrix4,p=new r.Matrix4,f=e.inheritType?e.inheritType:0;e.translation&&i.setPosition(v.fromArray(e.translation)),e.preRotation&&((t=e.preRotation.map(r.MathUtils.degToRad)).push(e.eulerOrder),n.makeRotationFromEuler(y.fromArray(t))),e.rotation&&((t=e.rotation.map(r.MathUtils.degToRad)).push(e.eulerOrder),a.makeRotationFromEuler(y.fromArray(t))),e.postRotation&&((t=e.postRotation.map(r.MathUtils.degToRad)).push(e.eulerOrder),o.makeRotationFromEuler(y.fromArray(t))),e.scale&&s.scale(v.fromArray(e.scale)),e.scalingOffset&&c.setPosition(v.fromArray(e.scalingOffset)),e.scalingPivot&&l.setPosition(v.fromArray(e.scalingPivot)),e.rotationOffset&&h.setPosition(v.fromArray(e.rotationOffset)),e.rotationPivot&&u.setPosition(v.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(d=e.parentMatrixWorld);var m=n.multiply(a).multiply(o),g=new r.Matrix4;d.extractRotation(g),(new r.Matrix4).copyPosition(d);var _=new r.Matrix4;_.getInverse(g).multiply(d);var x=new r.Matrix4;if(0===f)x.copy(g).multiply(m).multiply(_).multiply(s);else if(1===f)x.copy(g).multiply(_).multiply(m).multiply(s);else{var b=(new r.Matrix4).getInverse(s),w=(new r.Matrix4).multiply(_).multiply(b);x.copy(g).multiply(m).multiply(w).multiply(s)}var M=(new r.Matrix4).getInverse(u),T=(new r.Matrix4).getInverse(l),S=new r.Matrix4;S.copy(i).multiply(h).multiply(u).multiply(n).multiply(a).multiply(o).multiply(M).multiply(c).multiply(l).multiply(s).multiply(T);var E=(new r.Matrix4).copyPosition(S),A=(new r.Matrix4).copy(d).multiply(E);return p.copyPosition(A),(new r.Matrix4).multiply(p).multiply(x)}function x(e){var t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function b(e){return e.split(",").map((function(e){return parseFloat(e)}))}function w(e,t,i){return void 0===t&&(t=0),void 0===i&&(i=e.byteLength),r.LoaderUtils.decodeText(new Uint8Array(e,t,i))}function M(e,t,i){return e.slice(0,t).concat(i).concat(e.slice(t))}return a}(),t.exports=r.FBXLoader},{"../../three.js":23,"../Zlib.Inflate.js":8}],16:[function(e,t,i){const r=e("../../three.js");r.GLTFLoader=function(){function e(e){r.Loader.call(this,e),this.dracoLoader=null,this.ddsLoader=null,this.pluginCallbacks=[],this.register((function(e){return new s(e)}))}function t(){var e={};return{get:function(t){return e[t]},add:function(t,i){e[t]=i},remove:function(t){delete e[t]},removeAll:function(){e={}}}}e.prototype=Object.assign(Object.create(r.Loader.prototype),{constructor:e,load:function(e,t,i,n){var a,o=this;a=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:r.LoaderUtils.extractUrlBase(e),o.manager.itemStart(e);var s=function(t){n?n(t):console.error(t),o.manager.itemError(e),o.manager.itemEnd(e)},l=new r.FileLoader(o.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),"use-credentials"===o.crossOrigin&&l.setWithCredentials(!0),l.load(e,(function(i){try{o.parse(i,a,(function(i){t(i),o.manager.itemEnd(e)}),s)}catch(e){s(e)}}),i,s)},setDRACOLoader:function(e){return this.dracoLoader=e,this},setDDSLoader:function(e){return this.ddsLoader=e,this},register:function(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this},unregister:function(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this},parse:function(e,t,s,d){var m,g={},y={};if("string"==typeof e)m=e;else if(r.LoaderUtils.decodeText(new Uint8Array(e,0,4))===l){try{g[i.KHR_BINARY_GLTF]=new c(e)}catch(e){return void(d&&d(e))}m=g[i.KHR_BINARY_GLTF].content}else m=r.LoaderUtils.decodeText(new Uint8Array(e));var v=JSON.parse(m);if(void 0===v.asset||v.asset.version[0]<2)d&&d(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var _=new L(v,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager});_.fileLoader.setRequestHeader(this.requestHeader);for(var x=0;x<this.pluginCallbacks.length;x++){var b=this.pluginCallbacks[x](_);y[b.name]=b,g[b.name]=!0}if(v.extensionsUsed)for(x=0;x<v.extensionsUsed.length;++x){var w=v.extensionsUsed[x],M=v.extensionsRequired||[];switch(w){case i.KHR_LIGHTS_PUNCTUAL:g[w]=new a(v);break;case i.KHR_MATERIALS_UNLIT:g[w]=new o;break;case i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:g[w]=new p;break;case i.KHR_DRACO_MESH_COMPRESSION:g[w]=new h(v,this.dracoLoader);break;case i.MSFT_TEXTURE_DDS:g[w]=new n(this.ddsLoader);break;case i.KHR_TEXTURE_TRANSFORM:g[w]=new u;break;case i.KHR_MESH_QUANTIZATION:g[w]=new f;break;default:M.indexOf(w)>=0&&void 0===y[w]&&console.warn('THREE.GLTFLoader: Unknown extension "'+w+'".')}}_.setExtensions(g),_.setPlugins(y),_.parse(s,d)}}});var i={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function n(e){if(!e)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing THREE.DDSLoader");this.name=i.MSFT_TEXTURE_DDS,this.ddsLoader=e}function a(e){this.name=i.KHR_LIGHTS_PUNCTUAL;var t=e.extensions&&e.extensions[i.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=t.lights||[]}function o(){this.name=i.KHR_MATERIALS_UNLIT}function s(e){this.parser=e,this.name=i.KHR_MATERIALS_CLEARCOAT}a.prototype.loadLight=function(e){var t,i=this.lightDefs[e],n=new r.Color(16777215);void 0!==i.color&&n.fromArray(i.color);var a=void 0!==i.range?i.range:0;switch(i.type){case"directional":(t=new r.DirectionalLight(n)).target.position.set(0,0,-1),t.add(t.target);break;case"point":(t=new r.PointLight(n)).distance=a;break;case"spot":(t=new r.SpotLight(n)).distance=a,i.spot=i.spot||{},i.spot.innerConeAngle=void 0!==i.spot.innerConeAngle?i.spot.innerConeAngle:0,i.spot.outerConeAngle=void 0!==i.spot.outerConeAngle?i.spot.outerConeAngle:Math.PI/4,t.angle=i.spot.outerConeAngle,t.penumbra=1-i.spot.innerConeAngle/i.spot.outerConeAngle,t.target.position.set(0,0,-1),t.add(t.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+i.type+'".')}return t.position.set(0,0,0),t.decay=2,void 0!==i.intensity&&(t.intensity=i.intensity),t.name=i.name||"light_"+e,Promise.resolve(t)},o.prototype.getMaterialType=function(){return r.MeshBasicMaterial},o.prototype.extendParams=function(e,t,i){var n=[];e.color=new r.Color(1,1,1),e.opacity=1;var a=t.pbrMetallicRoughness;if(a){if(Array.isArray(a.baseColorFactor)){var o=a.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}void 0!==a.baseColorTexture&&n.push(i.assignTexture(e,"map",a.baseColorTexture))}return Promise.all(n)},s.prototype.getMaterialType=function(){return r.MeshPhysicalMaterial},s.prototype.extendMaterialParams=function(e,t){var i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();var a=[],o=n.extensions[this.name];if(void 0!==o.clearcoatFactor&&(t.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&a.push(i.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&a.push(i.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(a.push(i.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){var s=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new r.Vector2(s,s)}return Promise.all(a)};var l="glTF";function c(e){this.name=i.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,12);if(this.header={magic:r.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==l)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var n=new DataView(e,12),a=0;a<n.byteLength;){var o=n.getUint32(a,!0);a+=4;var s=n.getUint32(a,!0);if(a+=4,1313821514===s){var c=new Uint8Array(e,12+a,o);this.content=r.LoaderUtils.decodeText(c)}else if(5130562===s){var h=12+a;this.body=e.slice(h,h+o)}a+=o}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function h(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=i.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}function u(){this.name=i.KHR_TEXTURE_TRANSFORM}function d(e){r.MeshStandardMaterial.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),i=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),n=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),a=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),s={specular:{value:(new r.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=s,this.onBeforeCompile=function(e){for(var r in s)e.uniforms[r]=s[r];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;"),e.fragmentShader=e.fragmentShader.replace("uniform float metalness;","uniform float glossiness;"),e.fragmentShader=e.fragmentShader.replace("#include <roughnessmap_pars_fragment>",t),e.fragmentShader=e.fragmentShader.replace("#include <metalnessmap_pars_fragment>",i),e.fragmentShader=e.fragmentShader.replace("#include <roughnessmap_fragment>",n),e.fragmentShader=e.fragmentShader.replace("#include <metalnessmap_fragment>",a),e.fragmentShader=e.fragmentShader.replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return s.specular.value},set:function(e){s.specular.value=e}},specularMap:{get:function(){return s.specularMap.value},set:function(e){s.specularMap.value=e}},glossiness:{get:function(){return s.glossiness.value},set:function(e){s.glossiness.value=e}},glossinessMap:{get:function(){return s.glossinessMap.value},set:function(e){s.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_ROUGHNESSMAP=""):(delete this.defines.USE_ROUGHNESSMAP,delete this.defines.USE_GLOSSINESSMAP)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}function p(){return{name:i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return d},extendParams:function(e,t,i){var n=t.extensions[this.name];e.color=new r.Color(1,1,1),e.opacity=1;var a=[];if(Array.isArray(n.diffuseFactor)){var o=n.diffuseFactor;e.color.fromArray(o),e.opacity=o[3]}if(void 0!==n.diffuseTexture&&a.push(i.assignTexture(e,"map",n.diffuseTexture)),e.emissive=new r.Color(0,0,0),e.glossiness=void 0!==n.glossinessFactor?n.glossinessFactor:1,e.specular=new r.Color(1,1,1),Array.isArray(n.specularFactor)&&e.specular.fromArray(n.specularFactor),void 0!==n.specularGlossinessTexture){var s=n.specularGlossinessTexture;a.push(i.assignTexture(e,"glossinessMap",s)),a.push(i.assignTexture(e,"specularMap",s))}return Promise.all(a)},createMaterial:function(e){var t=new d(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=r.TangentSpaceNormalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}}function f(){this.name=i.KHR_MESH_QUANTIZATION}function m(e,t,i,n){r.Interpolant.call(this,e,t,i,n)}h.prototype.decodePrimitive=function(e,t){var i=this.json,r=this.dracoLoader,n=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,o={},s={},l={};for(var c in a){var h=x[c]||c.toLowerCase();o[h]=a[c]}for(c in e.attributes)if(h=x[c]||c.toLowerCase(),void 0!==a[c]){var u=i.accessors[e.attributes[c]],d=g[u.componentType];l[h]=d,s[h]=!0===u.normalized}return t.getDependency("bufferView",n).then((function(e){return new Promise((function(t){r.decodeDracoFile(e,(function(e){for(var i in e.attributes){var r=e.attributes[i],n=s[i];void 0!==n&&(r.normalized=n)}t(e)}),o,l)}))}))},u.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},d.prototype=Object.create(r.MeshStandardMaterial.prototype),d.prototype.constructor=d,d.prototype.copy=function(e){return r.MeshStandardMaterial.prototype.copy.call(this,e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},m.prototype=Object.create(r.Interpolant.prototype),m.prototype.constructor=m,m.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,n=e*r*3+r,a=0;a!==r;a++)t[a]=i[n+a];return t},m.prototype.beforeStart_=m.prototype.copySampleValue_,m.prototype.afterEnd_=m.prototype.copySampleValue_,m.prototype.interpolate_=function(e,t,i,r){for(var n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=2*o,l=3*o,c=r-t,h=(i-t)/c,u=h*h,d=u*h,p=e*l,f=p-l,m=-2*d+3*u,g=d-u,y=1-m,v=g-u+h,_=0;_!==o;_++){var x=a[f+_+o],b=a[f+_+s]*c,w=a[p+_+o],M=a[p+_]*c;n[_]=y*x+v*b+m*w+g*M}return n};var g={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},y={9728:r.NearestFilter,9729:r.LinearFilter,9984:r.NearestMipmapNearestFilter,9985:r.LinearMipmapNearestFilter,9986:r.NearestMipmapLinearFilter,9987:r.LinearMipmapLinearFilter},v={33071:r.ClampToEdgeWrapping,33648:r.MirroredRepeatWrapping,10497:r.RepeatWrapping},_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},x={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},b={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},w={CUBICSPLINE:void 0,LINEAR:r.InterpolateLinear,STEP:r.InterpolateDiscrete},M={"image/png":r.RGBAFormat,"image/jpeg":r.RGBFormat};function T(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}function S(e,t,i){for(var r in i.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=i.extensions[r])}function E(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function A(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var i=0,r=t.weights.length;i<r;i++)e.morphTargetInfluences[i]=t.weights[i];if(t.extras&&Array.isArray(t.extras.targetNames)){var n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length)for(e.morphTargetDictionary={},i=0,r=n.length;i<r;i++)e.morphTargetDictionary[n[i]]=i;else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function C(e){for(var t="",i=Object.keys(e).sort(),r=0,n=i.length;r<n;r++)t+=i[r]+":"+e[i[r]]+";";return t}function L(e,i){this.json=e||{},this.extensions={},this.plugins={},this.options=i||{},this.cache=new t,this.associations=new Map,this.primitiveCache={},this.useImageBitmap="undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent),this.useImageBitmap?this.textureLoader=new r.ImageBitmapLoader(this.options.manager):this.textureLoader=new r.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new r.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function P(e,t,i){var n=t.attributes,a=[];function o(t,r){return i.getDependency("accessor",t).then((function(t){e.setAttribute(r,t)}))}for(var s in n){var l=x[s]||s.toLowerCase();l in e.attributes||a.push(o(n[s],l))}if(void 0!==t.indices&&!e.index){var c=i.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));a.push(c)}return E(e,t),function(e,t,i){var n=t.attributes,a=new r.Box3;if(void 0!==n.POSITION){var o=(p=i.json.accessors[n.POSITION]).min,s=p.max;if(void 0!==o&&void 0!==s){a.set(new r.Vector3(o[0],o[1],o[2]),new r.Vector3(s[0],s[1],s[2]));var l=t.targets;if(void 0!==l){for(var c=new r.Vector3,h=new r.Vector3,u=0,d=l.length;u<d;u++){var p,f=l[u];void 0!==f.POSITION&&(o=(p=i.json.accessors[f.POSITION]).min,s=p.max,void 0!==o&&void 0!==s?(h.setX(Math.max(Math.abs(o[0]),Math.abs(s[0]))),h.setY(Math.max(Math.abs(o[1]),Math.abs(s[1]))),h.setZ(Math.max(Math.abs(o[2]),Math.abs(s[2]))),c.max(h)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION."))}a.expandByVector(c)}e.boundingBox=a;var m=new r.Sphere;a.getCenter(m.center),m.radius=a.min.distanceTo(a.max)/2,e.boundingSphere=m}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(e,t,i),Promise.all(a).then((function(){return void 0!==t.targets?function(e,t,i){for(var r=!1,n=!1,a=0,o=t.length;a<o&&(void 0!==(c=t[a]).POSITION&&(r=!0),void 0!==c.NORMAL&&(n=!0),!r||!n);a++);if(!r&&!n)return Promise.resolve(e);var s=[],l=[];for(a=0,o=t.length;a<o;a++){var c=t[a];if(r){var h=void 0!==c.POSITION?i.getDependency("accessor",c.POSITION):e.attributes.position;s.push(h)}n&&(h=void 0!==c.NORMAL?i.getDependency("accessor",c.NORMAL):e.attributes.normal,l.push(h))}return Promise.all([Promise.all(s),Promise.all(l)]).then((function(t){var i=t[0],a=t[1];return r&&(e.morphAttributes.position=i),n&&(e.morphAttributes.normal=a),e.morphTargetsRelative=!0,e}))}(e,t.targets,i):e}))}function I(e,t){var i=e.getIndex();if(null===i){var n=[],a=e.getAttribute("position");if(void 0===a)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var o=0;o<a.count;o++)n.push(o);e.setIndex(n),i=e.getIndex()}var s=i.count-2,l=[];if(t===r.TriangleFanDrawMode)for(o=1;o<=s;o++)l.push(i.getX(0)),l.push(i.getX(o)),l.push(i.getX(o+1));else for(o=0;o<s;o++)o%2==0?(l.push(i.getX(o)),l.push(i.getX(o+1)),l.push(i.getX(o+2))):(l.push(i.getX(o+2)),l.push(i.getX(o+1)),l.push(i.getX(o)));l.length/3!==s&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var c=e.clone();return c.setIndex(l),c}return L.prototype.setExtensions=function(e){this.extensions=e},L.prototype.setPlugins=function(e){this.plugins=e},L.prototype.parse=function(e,t){var i=this,r=this.json,n=this.extensions;this.cache.removeAll(),this.markDefs(),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then((function(t){var a={scene:t[0][r.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:r.asset,parser:i,userData:{}};S(n,a,r),E(a,r),e(a)})).catch(t)},L.prototype.markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[],r={},n={},a=0,o=t.length;a<o;a++)for(var s=t[a].joints,l=0,c=s.length;l<c;l++)e[s[l]].isBone=!0;for(var h=0,u=e.length;h<u;h++){var d=e[h];void 0!==d.mesh&&(void 0===r[d.mesh]&&(r[d.mesh]=n[d.mesh]=0),r[d.mesh]++,void 0!==d.skin&&(i[d.mesh].isSkinnedMesh=!0))}this.json.meshReferences=r,this.json.meshUses=n},L.prototype._invokeOne=function(e){var t=Object.values(this.plugins);t.push(this);for(var i=0;i<t.length;i++){var r=e(t[i]);if(r)return r}},L.prototype._invokeAll=function(e){var t=Object.values(this.plugins);t.unshift(this);for(var i=[],r=0;r<t.length;r++)i.push(e(t[r]));return Promise.all(i)},L.prototype.getDependency=function(e,t){var r=e+":"+t,n=this.cache.get(r);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this.loadNode(t);break;case"mesh":n=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":n=this.loadTexture(t);break;case"skin":n=this.loadSkin(t);break;case"animation":n=this.loadAnimation(t);break;case"camera":n=this.loadCamera(t);break;case"light":n=this.extensions[i.KHR_LIGHTS_PUNCTUAL].loadLight(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(r,n)}return n},L.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var i=this,r=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(r.map((function(t,r){return i.getDependency(e,r)}))),this.cache.add(e,t)}return t},L.prototype.loadBuffer=function(e){var t=this.json.buffers[e],r=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[i.KHR_BINARY_GLTF].body);var n=this.options;return new Promise((function(e,i){r.load(T(t.uri,n.path),e,void 0,(function(){i(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))},L.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){var i=t.byteLength||0,r=t.byteOffset||0;return e.slice(r,r+i)}))},L.prototype.loadAccessor=function(e){var t=this,i=this.json,n=this.json.accessors[e];if(void 0===n.bufferView&&void 0===n.sparse)return Promise.resolve(null);var a=[];return void 0!==n.bufferView?a.push(this.getDependency("bufferView",n.bufferView)):a.push(null),void 0!==n.sparse&&(a.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),a.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(a).then((function(e){var a,o,s=e[0],l=_[n.type],c=g[n.componentType],h=c.BYTES_PER_ELEMENT,u=h*l,d=n.byteOffset||0,p=void 0!==n.bufferView?i.bufferViews[n.bufferView].byteStride:void 0,f=!0===n.normalized;if(p&&p!==u){var m=Math.floor(d/p),y="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+m+":"+n.count,v=t.cache.get(y);v||(a=new c(s,m*p,n.count*p/h),v=new r.InterleavedBuffer(a,p/h),t.cache.add(y,v)),o=new r.InterleavedBufferAttribute(v,l,d%p/h,f)}else a=null===s?new c(n.count*l):new c(s,d,n.count*l),o=new r.BufferAttribute(a,l,f);if(void 0!==n.sparse){var x=_.SCALAR,b=g[n.sparse.indices.componentType],w=n.sparse.indices.byteOffset||0,M=n.sparse.values.byteOffset||0,T=new b(e[1],w,n.sparse.count*x),S=new c(e[2],M,n.sparse.count*l);null!==s&&(o=new r.BufferAttribute(o.array.slice(),o.itemSize,o.normalized));for(var E=0,A=T.length;E<A;E++){var C=T[E];if(o.setX(C,S[E*l]),l>=2&&o.setY(C,S[E*l+1]),l>=3&&o.setZ(C,S[E*l+2]),l>=4&&o.setW(C,S[E*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return o}))},L.prototype.loadTexture=function(e){var t,n=this,a=this.json,o=this.options,s=this.useImageBitmap,l=this.textureLoader,c=self.URL||self.webkitURL,h=a.textures[e],u=h.extensions||{},d=(t=u[i.MSFT_TEXTURE_DDS]?a.images[u[i.MSFT_TEXTURE_DDS].source]:a.images[h.source]).uri,p=!1;return void 0!==t.bufferView&&(d=n.getDependency("bufferView",t.bufferView).then((function(e){p=!0;var i=new Blob([e],{type:t.mimeType});return d=c.createObjectURL(i)}))),Promise.resolve(d).then((function(e){var t=o.manager.getHandler(e);return t||(t=u[i.MSFT_TEXTURE_DDS]?n.extensions[i.MSFT_TEXTURE_DDS].ddsLoader:l),new Promise((function(i,n){var a=i;s&&(a=function(e){i(new r.CanvasTexture(e))}),t.load(T(e,o.path),a,void 0,n)}))})).then((function(i){!0===p&&c.revokeObjectURL(d),i.flipY=!1,h.name&&(i.name=h.name),t.mimeType in M&&(i.format=M[t.mimeType]);var o=(a.samplers||{})[h.sampler]||{};return i.magFilter=y[o.magFilter]||r.LinearFilter,i.minFilter=y[o.minFilter]||r.LinearMipmapLinearFilter,i.wrapS=v[o.wrapS]||r.RepeatWrapping,i.wrapT=v[o.wrapT]||r.RepeatWrapping,n.associations.set(i,{type:"textures",index:e}),i}))},L.prototype.assignTexture=function(e,t,n){var a=this;return this.getDependency("texture",n.index).then((function(o){if(!o.isCompressedTexture)switch(t){case"aoMap":case"emissiveMap":case"metalnessMap":case"normalMap":case"roughnessMap":o.format=r.RGBFormat}if(void 0===n.texCoord||0==n.texCoord||"aoMap"===t&&1==n.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),a.extensions[i.KHR_TEXTURE_TRANSFORM]){var s=void 0!==n.extensions?n.extensions[i.KHR_TEXTURE_TRANSFORM]:void 0;if(s){var l=a.associations.get(o);o=a.extensions[i.KHR_TEXTURE_TRANSFORM].extendTexture(o,s),a.associations.set(o,l)}}e[t]=o}))},L.prototype.assignFinalMaterial=function(e){var t=e.geometry,i=e.material,n=void 0!==t.attributes.tangent,a=void 0!==t.attributes.color,o=void 0===t.attributes.normal,s=!0===e.isSkinnedMesh,l=Object.keys(t.morphAttributes).length>0,c=l&&void 0!==t.morphAttributes.normal;if(e.isPoints){var h="PointsMaterial:"+i.uuid,u=this.cache.get(h);u||(u=new r.PointsMaterial,r.Material.prototype.copy.call(u,i),u.color.copy(i.color),u.map=i.map,u.sizeAttenuation=!1,this.cache.add(h,u)),i=u}else if(e.isLine){h="LineBasicMaterial:"+i.uuid;var d=this.cache.get(h);d||(d=new r.LineBasicMaterial,r.Material.prototype.copy.call(d,i),d.color.copy(i.color),this.cache.add(h,d)),i=d}if(n||a||o||s||l){h="ClonedMaterial:"+i.uuid+":",i.isGLTFSpecularGlossinessMaterial&&(h+="specular-glossiness:"),s&&(h+="skinning:"),n&&(h+="vertex-tangents:"),a&&(h+="vertex-colors:"),o&&(h+="flat-shading:"),l&&(h+="morph-targets:"),c&&(h+="morph-normals:");var p=this.cache.get(h);p||(p=i.clone(),s&&(p.skinning=!0),n&&(p.vertexTangents=!0),a&&(p.vertexColors=!0),o&&(p.flatShading=!0),l&&(p.morphTargets=!0),c&&(p.morphNormals=!0),this.cache.add(h,p),this.associations.set(p,this.associations.get(i))),i=p}i.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),i.normalScale&&!n&&(i.normalScale.y=-i.normalScale.y),i.clearcoatNormalScale&&!n&&(i.clearcoatNormalScale.y=-i.clearcoatNormalScale.y),e.material=i},L.prototype.getMaterialType=function(){return r.MeshStandardMaterial},L.prototype.loadMaterial=function(e){var t,n=this,a=this.json,o=this.extensions,s=a.materials[e],l={},c=s.extensions||{},h=[];if(c[i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var u=o[i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=u.getMaterialType(),h.push(u.extendParams(l,s,n))}else if(c[i.KHR_MATERIALS_UNLIT]){var p=o[i.KHR_MATERIALS_UNLIT];t=p.getMaterialType(),h.push(p.extendParams(l,s,n))}else{var f=s.pbrMetallicRoughness||{};if(l.color=new r.Color(1,1,1),l.opacity=1,Array.isArray(f.baseColorFactor)){var m=f.baseColorFactor;l.color.fromArray(m),l.opacity=m[3]}void 0!==f.baseColorTexture&&h.push(n.assignTexture(l,"map",f.baseColorTexture)),l.metalness=void 0!==f.metallicFactor?f.metallicFactor:1,l.roughness=void 0!==f.roughnessFactor?f.roughnessFactor:1,void 0!==f.metallicRoughnessTexture&&(h.push(n.assignTexture(l,"metalnessMap",f.metallicRoughnessTexture)),h.push(n.assignTexture(l,"roughnessMap",f.metallicRoughnessTexture))),t=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),h.push(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,l)})))}!0===s.doubleSided&&(l.side=r.DoubleSide);var g=s.alphaMode||"OPAQUE";return"BLEND"===g?(l.transparent=!0,l.depthWrite=!1):(l.transparent=!1,"MASK"===g&&(l.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&t!==r.MeshBasicMaterial&&(h.push(n.assignTexture(l,"normalMap",s.normalTexture)),l.normalScale=new r.Vector2(1,1),void 0!==s.normalTexture.scale&&l.normalScale.set(s.normalTexture.scale,s.normalTexture.scale)),void 0!==s.occlusionTexture&&t!==r.MeshBasicMaterial&&(h.push(n.assignTexture(l,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(l.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&t!==r.MeshBasicMaterial&&(l.emissive=(new r.Color).fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&t!==r.MeshBasicMaterial&&h.push(n.assignTexture(l,"emissiveMap",s.emissiveTexture)),Promise.all(h).then((function(){var a;return a=t===d?o[i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(l):new t(l),s.name&&(a.name=s.name),a.map&&(a.map.encoding=r.sRGBEncoding),a.emissiveMap&&(a.emissiveMap.encoding=r.sRGBEncoding),E(a,s),n.associations.set(a,{type:"materials",index:e}),s.extensions&&S(o,a,s),a}))},L.prototype.loadGeometries=function(e){var t=this,n=this.extensions,a=this.primitiveCache;function o(e){return n[i.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(i){return P(i,e,t)}))}for(var s,l,c=[],h=0,u=e.length;h<u;h++){var d,p=e[h],f=(void 0,(l=(s=p).extensions&&s.extensions[i.KHR_DRACO_MESH_COMPRESSION])?"draco:"+l.bufferView+":"+l.indices+":"+C(l.attributes):s.indices+":"+C(s.attributes)+":"+s.mode),m=a[f];m?c.push(m.promise):(d=p.extensions&&p.extensions[i.KHR_DRACO_MESH_COMPRESSION]?o(p):P(new r.BufferGeometry,p,t),a[f]={primitive:p,promise:d},c.push(d))}return Promise.all(c)},L.prototype.loadMesh=function(e){for(var t,i=this,n=this.json.meshes[e],a=n.primitives,o=[],s=0,l=a.length;s<l;s++){var c=void 0===a[s].material?(void 0===(t=this.cache).DefaultMaterial&&(t.DefaultMaterial=new r.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:r.FrontSide})),t.DefaultMaterial):this.getDependency("material",a[s].material);o.push(c)}return o.push(i.loadGeometries(a)),Promise.all(o).then((function(t){for(var o=t.slice(0,t.length-1),s=t[t.length-1],l=[],c=0,h=s.length;c<h;c++){var u,d=s[c],p=a[c],f=o[c];if(4===p.mode||5===p.mode||6===p.mode||void 0===p.mode)!0!==(u=!0===n.isSkinnedMesh?new r.SkinnedMesh(d,f):new r.Mesh(d,f)).isSkinnedMesh||u.geometry.attributes.skinWeight.normalized||u.normalizeSkinWeights(),5===p.mode?u.geometry=I(u.geometry,r.TriangleStripDrawMode):6===p.mode&&(u.geometry=I(u.geometry,r.TriangleFanDrawMode));else if(1===p.mode)u=new r.LineSegments(d,f);else if(3===p.mode)u=new r.Line(d,f);else if(2===p.mode)u=new r.LineLoop(d,f);else{if(0!==p.mode)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+p.mode);u=new r.Points(d,f)}Object.keys(u.geometry.morphAttributes).length>0&&A(u,n),u.name=n.name||"mesh_"+e,s.length>1&&(u.name+="_"+c),E(u,n),i.assignFinalMaterial(u),l.push(u)}if(1===l.length)return l[0];var m=new r.Group;for(c=0,h=l.length;c<h;c++)m.add(l[c]);return m}))},L.prototype.loadCamera=function(e){var t,i=this.json.cameras[e],n=i[i.type];if(n)return"perspective"===i.type?t=new r.PerspectiveCamera(r.MathUtils.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===i.type&&(t=new r.OrthographicCamera(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),i.name&&(t.name=i.name),E(t,i),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")},L.prototype.loadSkin=function(e){var t=this.json.skins[e],i={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(i):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return i.inverseBindMatrices=e,i}))},L.prototype.loadAnimation=function(e){for(var t=this.json.animations[e],i=[],n=[],a=[],o=[],s=[],l=0,c=t.channels.length;l<c;l++){var h=t.channels[l],u=t.samplers[h.sampler],d=h.target,p=void 0!==d.node?d.node:d.id,f=void 0!==t.parameters?t.parameters[u.input]:u.input,g=void 0!==t.parameters?t.parameters[u.output]:u.output;i.push(this.getDependency("node",p)),n.push(this.getDependency("accessor",f)),a.push(this.getDependency("accessor",g)),o.push(u),s.push(d)}return Promise.all([Promise.all(i),Promise.all(n),Promise.all(a),Promise.all(o),Promise.all(s)]).then((function(i){for(var n=i[0],a=i[1],o=i[2],s=i[3],l=i[4],c=[],h=0,u=n.length;h<u;h++){var d=n[h],p=a[h],f=o[h],g=s[h],y=l[h];if(void 0!==d){var v;switch(d.updateMatrix(),d.matrixAutoUpdate=!0,b[y.path]){case b.weights:v=r.NumberKeyframeTrack;break;case b.rotation:v=r.QuaternionKeyframeTrack;break;case b.position:case b.scale:default:v=r.VectorKeyframeTrack}var _=d.name?d.name:d.uuid,x=void 0!==g.interpolation?w[g.interpolation]:r.InterpolateLinear,M=[];b[y.path]===b.weights?d.traverse((function(e){!0===e.isMesh&&e.morphTargetInfluences&&M.push(e.name?e.name:e.uuid)})):M.push(_);var T=f.array;if(f.normalized){var S;if(T.constructor===Int8Array)S=1/127;else if(T.constructor===Uint8Array)S=1/255;else if(T.constructor==Int16Array)S=1/32767;else{if(T.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");S=1/65535}for(var E=new Float32Array(T.length),A=0,C=T.length;A<C;A++)E[A]=T[A]*S;T=E}for(A=0,C=M.length;A<C;A++){var L=new v(M[A]+"."+b[y.path],p.array,T,x);"CUBICSPLINE"===g.interpolation&&(L.createInterpolant=function(e){return new m(this.times,this.values,this.getValueSize()/3,e)},L.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),c.push(L)}}}var P=t.name?t.name:"animation_"+e;return new r.AnimationClip(P,void 0,c)}))},L.prototype.loadNode=function(e){var t,n=this.json,a=this.extensions,o=this,s=n.meshReferences,l=n.meshUses,c=n.nodes[e];return(t=[],void 0!==c.mesh&&t.push(o.getDependency("mesh",c.mesh).then((function(e){var t;if(s[c.mesh]>1){var i=l[c.mesh]++;(t=e.clone()).name+="_instance_"+i}else t=e;return void 0!==c.weights&&t.traverse((function(e){if(e.isMesh)for(var t=0,i=c.weights.length;t<i;t++)e.morphTargetInfluences[t]=c.weights[t]})),t}))),void 0!==c.camera&&t.push(o.getDependency("camera",c.camera)),c.extensions&&c.extensions[i.KHR_LIGHTS_PUNCTUAL]&&void 0!==c.extensions[i.KHR_LIGHTS_PUNCTUAL].light&&t.push(o.getDependency("light",c.extensions[i.KHR_LIGHTS_PUNCTUAL].light)),Promise.all(t)).then((function(t){var i;if((i=!0===c.isBone?new r.Bone:t.length>1?new r.Group:1===t.length?t[0]:new r.Object3D)!==t[0])for(var n=0,s=t.length;n<s;n++)i.add(t[n]);if(c.name&&(i.userData.name=c.name,i.name=r.PropertyBinding.sanitizeNodeName(c.name)),E(i,c),c.extensions&&S(a,i,c),void 0!==c.matrix){var l=new r.Matrix4;l.fromArray(c.matrix),i.applyMatrix4(l)}else void 0!==c.translation&&i.position.fromArray(c.translation),void 0!==c.rotation&&i.quaternion.fromArray(c.rotation),void 0!==c.scale&&i.scale.fromArray(c.scale);return o.associations.set(i,{type:"nodes",index:e}),i}))},L.prototype.loadScene=function(){function e(t,i,n,a){var o=n.nodes[t];return a.getDependency("node",t).then((function(e){return void 0===o.skin?e:a.getDependency("skin",o.skin).then((function(e){for(var i=[],r=0,n=(t=e).joints.length;r<n;r++)i.push(a.getDependency("node",t.joints[r]));return Promise.all(i)})).then((function(i){return e.traverse((function(e){if(e.isMesh){for(var n=[],a=[],o=0,s=i.length;o<s;o++){var l=i[o];if(l){n.push(l);var c=new r.Matrix4;void 0!==t.inverseBindMatrices&&c.fromArray(t.inverseBindMatrices.array,16*o),a.push(c)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[o])}e.bind(new r.Skeleton(n,a),e.matrixWorld)}})),e}));var t})).then((function(t){i.add(t);var r=[];if(o.children)for(var s=o.children,l=0,c=s.length;l<c;l++){var h=s[l];r.push(e(h,t,n,a))}return Promise.all(r)}))}return function(t){var i=this.json,n=this.extensions,a=this.json.scenes[t],o=new r.Group;a.name&&(o.name=a.name),E(o,a),a.extensions&&S(n,o,a);for(var s=a.nodes||[],l=[],c=0,h=s.length;c<h;c++)l.push(e(s[c],o,i,this));return Promise.all(l).then((function(){return o}))}}(),e}(),t.exports=r.GLTFLoader},{"../../three.js":23}],17:[function(e,t,i){const r=e("../../three.js");r.MTLLoader=function(e){r.Loader.call(this,e)},r.MTLLoader.prototype=Object.assign(Object.create(r.Loader.prototype),{constructor:r.MTLLoader,load:function(e,t,i,n){var a=this,o=""===this.path?r.LoaderUtils.extractUrlBase(e||""):this.path,s=new r.FileLoader(this.manager);s.setPath(this.path),s.load(e,(function(i){try{t(a.parse(i,o))}catch(t){n?n(t):console.error(t),a.manager.itemError(e)}}),i,n)},setMaterialOptions:function(e){return this.materialOptions=e,this},parse:function(e,t){for(var i=e.split("\n"),n={},a=/\s+/,o={},s=0;s<i.length;s++){var l=i[s];if(0!==(l=l.trim()).length&&"#"!==l.charAt(0)){var c=l.indexOf(" "),h=c>=0?l.substring(0,c):l;h=h.toLowerCase();var u=c>=0?l.substring(c+1):"";if(u=u.trim(),"newmtl"===h)n={name:u},o[u]=n;else if("ka"===h||"kd"===h||"ks"===h||"ke"===h){var d=u.split(a,3);n[h]=[parseFloat(d[0]),parseFloat(d[1]),parseFloat(d[2])]}else n[h]=u}}var p=new r.MTLLoader.MaterialCreator(this.resourcePath||t,this.materialOptions);return p.setCrossOrigin(this.crossOrigin),p.setManager(this.manager),p.setMaterials(o),p}}),r.MTLLoader.MaterialCreator=function(e,t){this.baseUrl=e||"",this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:r.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:r.RepeatWrapping},r.MTLLoader.MaterialCreator.prototype={constructor:r.MTLLoader.MaterialCreator,crossOrigin:"anonymous",setCrossOrigin:function(e){return this.crossOrigin=e,this},setManager:function(e){this.manager=e},setMaterials:function(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(e){if(!this.options)return e;var t={};for(var i in e){var r=e[i],n={};for(var a in t[i]=n,r){var o=!0,s=r[a],l=a.toLowerCase();switch(l){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(s=[s[0]/255,s[1]/255,s[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===s[0]&&0===s[1]&&0===s[2]&&(o=!1)}o&&(n[l]=s)}}return t},preload:function(){for(var e in this.materialsInfo)this.create(e)},getIndex:function(e){return this.nameLookup[e]},getAsArray:function(){var e=0;for(var t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray},create:function(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]},createMaterial_:function(e){var t=this,i=this.materialsInfo[e],n={name:e,side:this.side};function a(e,i){if(!n[e]){var r,a,o=t.getTextureParams(i,n),s=t.loadTexture((r=t.baseUrl,"string"!=typeof(a=o.url)||""===a?"":/^https?:\/\//i.test(a)?a:r+a));s.repeat.copy(o.scale),s.offset.copy(o.offset),s.wrapS=t.wrap,s.wrapT=t.wrap,n[e]=s}}for(var o in i){var s,l=i[o];if(""!==l)switch(o.toLowerCase()){case"kd":n.color=(new r.Color).fromArray(l);break;case"ks":n.specular=(new r.Color).fromArray(l);break;case"ke":n.emissive=(new r.Color).fromArray(l);break;case"map_kd":a("map",l);break;case"map_ks":a("specularMap",l);break;case"map_ke":a("emissiveMap",l);break;case"norm":a("normalMap",l);break;case"map_bump":case"bump":a("bumpMap",l);break;case"map_d":a("alphaMap",l),n.transparent=!0;break;case"ns":n.shininess=parseFloat(l);break;case"d":(s=parseFloat(l))<1&&(n.opacity=s,n.transparent=!0);break;case"tr":s=parseFloat(l),this.options&&this.options.invertTrProperty&&(s=1-s),s>0&&(n.opacity=1-s,n.transparent=!0)}}return this.materials[e]=new r.MeshPhongMaterial(n),this.materials[e]},getTextureParams:function(e,t){var i,n={scale:new r.Vector2(1,1),offset:new r.Vector2(0,0)},a=e.split(/\s+/);return(i=a.indexOf("-bm"))>=0&&(t.bumpScale=parseFloat(a[i+1]),a.splice(i,2)),(i=a.indexOf("-s"))>=0&&(n.scale.set(parseFloat(a[i+1]),parseFloat(a[i+2])),a.splice(i,4)),(i=a.indexOf("-o"))>=0&&(n.offset.set(parseFloat(a[i+1]),parseFloat(a[i+2])),a.splice(i,4)),n.url=a.join(" ").trim(),n},loadTexture:function(e,t,i,n,a){var o,s=void 0!==this.manager?this.manager:r.DefaultLoadingManager,l=s.getHandler(e);return null===l&&(l=new r.TextureLoader(s)),l.setCrossOrigin&&l.setCrossOrigin(this.crossOrigin),o=l.load(e,i,n,a),void 0!==t&&(o.mapping=t),o}},t.exports=r.MTLLoader},{"../../three.js":23}],18:[function(e,t,i){const r=e("../../three.js");r.OBJLoader=function(){var e=/^[og]\s*(.+)?/,t=/^mtllib /,i=/^usemtl /,n=/^usemap /,a=new r.Vector3,o=new r.Vector3,s=new r.Vector3,l=new r.Vector3,c=new r.Vector3;function h(){var e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var i=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasNormalIndices:!1,hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(e,t){var i=this._finalize(!1);i&&(i.inherited||i.groupCount<=0)&&this.materials.splice(i.index,1);var r={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==i?i.smooth:this.smooth,groupStart:void 0!==i?i.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(r),r},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var i=this.materials.length-1;i>=0;i--)this.materials[i].groupCount<=0&&this.materials.splice(i,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},i&&i.name&&"function"==typeof i.clone){var r=i.clone(0);r.inherited=!0,this.object.materials.push(r)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var i=parseInt(e,10);return 3*(i>=0?i-1:i+t/3)},parseNormalIndex:function(e,t){var i=parseInt(e,10);return 3*(i>=0?i-1:i+t/3)},parseUVIndex:function(e,t){var i=parseInt(e,10);return 2*(i>=0?i-1:i+t/2)},addVertex:function(e,t,i){var r=this.vertices,n=this.object.geometry.vertices;n.push(r[e+0],r[e+1],r[e+2]),n.push(r[t+0],r[t+1],r[t+2]),n.push(r[i+0],r[i+1],r[i+2])},addVertexPoint:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,i){var r=this.normals,n=this.object.geometry.normals;n.push(r[e+0],r[e+1],r[e+2]),n.push(r[t+0],r[t+1],r[t+2]),n.push(r[i+0],r[i+1],r[i+2])},addFaceNormal:function(e,t,i){var r=this.vertices,n=this.object.geometry.normals;a.fromArray(r,e),o.fromArray(r,t),s.fromArray(r,i),c.subVectors(s,o),l.subVectors(a,o),c.cross(l),c.normalize(),n.push(c.x,c.y,c.z),n.push(c.x,c.y,c.z),n.push(c.x,c.y,c.z)},addColor:function(e,t,i){var r=this.colors,n=this.object.geometry.colors;void 0!==r[e]&&n.push(r[e+0],r[e+1],r[e+2]),void 0!==r[t]&&n.push(r[t+0],r[t+1],r[t+2]),void 0!==r[i]&&n.push(r[i+0],r[i+1],r[i+2])},addUV:function(e,t,i){var r=this.uvs,n=this.object.geometry.uvs;n.push(r[e+0],r[e+1]),n.push(r[t+0],r[t+1]),n.push(r[i+0],r[i+1])},addDefaultUV:function(){var e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){var t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,i,r,n,a,o,s,l){var c=this.vertices.length,h=this.parseVertexIndex(e,c),u=this.parseVertexIndex(t,c),d=this.parseVertexIndex(i,c);if(this.addVertex(h,u,d),this.addColor(h,u,d),void 0!==o&&""!==o){var p=this.normals.length;h=this.parseNormalIndex(o,p),u=this.parseNormalIndex(s,p),d=this.parseNormalIndex(l,p),this.addNormal(h,u,d),this.object.geometry.hasNormalIndices=!0}else this.addFaceNormal(h,u,d);if(void 0!==r&&""!==r){var f=this.uvs.length;h=this.parseUVIndex(r,f),u=this.parseUVIndex(n,f),d=this.parseUVIndex(a,f),this.addUV(h,u,d),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";for(var t=this.vertices.length,i=0,r=e.length;i<r;i++)this.addVertexPoint(this.parseVertexIndex(e[i],t))},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var i=this.vertices.length,r=this.uvs.length,n=0,a=e.length;n<a;n++)this.addVertexLine(this.parseVertexIndex(e[n],i));var o=0;for(a=t.length;o<a;o++)this.addUVLine(this.parseUVIndex(t[o],r))}};return e.startObject("",!1),e}function u(e){r.Loader.call(this,e),this.materials=null}return u.prototype=Object.assign(Object.create(r.Loader.prototype),{constructor:u,load:function(e,t,i,n){var a=this,o=new r.FileLoader(a.manager);o.setPath(this.path),o.load(e,(function(i){try{t(a.parse(i))}catch(t){n?n(t):console.error(t),a.manager.itemError(e)}}),i,n)},setMaterials:function(e){return this.materials=e,this},parse:function(a){var o=new h;-1!==a.indexOf("\r\n")&&(a=a.replace(/\r\n/g,"\n")),-1!==a.indexOf("\\\n")&&(a=a.replace(/\\\n/g,""));for(var s=a.split("\n"),l="",c="",u=[],d="function"==typeof"".trimLeft,p=0,f=s.length;p<f;p++)if(l=s[p],0!==(l=d?l.trimLeft():l.trim()).length&&"#"!==(c=l.charAt(0)))if("v"===c){var m=l.split(/\s+/);switch(m[0]){case"v":o.vertices.push(parseFloat(m[1]),parseFloat(m[2]),parseFloat(m[3])),m.length>=7?o.colors.push(parseFloat(m[4]),parseFloat(m[5]),parseFloat(m[6])):o.colors.push(void 0,void 0,void 0);break;case"vn":o.normals.push(parseFloat(m[1]),parseFloat(m[2]),parseFloat(m[3]));break;case"vt":o.uvs.push(parseFloat(m[1]),parseFloat(m[2]))}}else if("f"===c){for(var g=l.substr(1).trim().split(/\s+/),y=[],v=0,_=g.length;v<_;v++){var x=g[v];if(x.length>0){var b=x.split("/");y.push(b)}}var w=y[0];for(v=1,_=y.length-1;v<_;v++){var M=y[v],T=y[v+1];o.addFace(w[0],M[0],T[0],w[1],M[1],T[1],w[2],M[2],T[2])}}else if("l"===c){var S=l.substring(1).trim().split(" "),E=[],A=[];if(-1===l.indexOf("/"))E=S;else for(var C=0,L=S.length;C<L;C++){var P=S[C].split("/");""!==P[0]&&E.push(P[0]),""!==P[1]&&A.push(P[1])}o.addLineGeometry(E,A)}else if("p"===c){var I=l.substr(1).trim().split(" ");o.addPointGeometry(I)}else if(null!==(u=e.exec(l))){var R=(" "+u[0].substr(1).trim()).substr(1);o.startObject(R)}else if(i.test(l))o.object.startMaterial(l.substring(7).trim(),o.materialLibraries);else if(t.test(l))o.materialLibraries.push(l.substring(7).trim());else if(n.test(l))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===c){if((u=l.split(" ")).length>1){var D=u[1].trim().toLowerCase();o.object.smooth="0"!==D&&"off"!==D}else o.object.smooth=!0;(Z=o.object.currentMaterial())&&(Z.smooth=o.object.smooth)}else{if("\0"===l)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+l+'"')}o.finalize();var k=new r.Group;for(k.materialLibraries=[].concat(o.materialLibraries),p=0,f=o.objects.length;p<f;p++){var z=o.objects[p],O=z.geometry,B=z.materials,F="Line"===O.type,N="Points"===O.type,U=!1;if(0!==O.vertices.length){var j=new r.BufferGeometry;j.setAttribute("position",new r.Float32BufferAttribute(O.vertices,3)),!0===O.hasNormalIndices&&j.setAttribute("normal",new r.Float32BufferAttribute(O.normals,3)),O.colors.length>0&&(U=!0,j.setAttribute("color",new r.Float32BufferAttribute(O.colors,3))),!0===O.hasUVIndices&&j.setAttribute("uv",new r.Float32BufferAttribute(O.uvs,2));for(var V,G=[],H=0,W=B.length;H<W;H++){var q=(Y=B[H]).name+"_"+Y.smooth+"_"+U,Z=o.materials[q];if(null!==this.materials)if(Z=this.materials.create(Y.name),!F||!Z||Z instanceof r.LineBasicMaterial){if(N&&Z&&!(Z instanceof r.PointsMaterial)){var X=new r.PointsMaterial({size:10,sizeAttenuation:!1});r.Material.prototype.copy.call(X,Z),X.color.copy(Z.color),X.map=Z.map,Z=X}}else{var $=new r.LineBasicMaterial;r.Material.prototype.copy.call($,Z),$.color.copy(Z.color),Z=$}void 0===Z&&((Z=F?new r.LineBasicMaterial:N?new r.PointsMaterial({size:1,sizeAttenuation:!1}):new r.MeshPhongMaterial).name=Y.name,Z.flatShading=!Y.smooth,Z.vertexColors=U,o.materials[q]=Z),G.push(Z)}if(G.length>1){for(H=0,W=B.length;H<W;H++){var Y=B[H];j.addGroup(Y.groupStart,Y.groupCount,H)}V=F?new r.LineSegments(j,G):N?new r.Points(j,G):new r.Mesh(j,G)}else V=F?new r.LineSegments(j,G[0]):N?new r.Points(j,G[0]):new r.Mesh(j,G[0]);V.name=z.name,k.add(V)}}return k}}),u}(),t.exports=r.OBJLoader},{"../../three.js":23}],19:[function(e,t,i){const r=e("../utils/utils.js"),n=(e("../utils/material.js"),e("../three.js")),a=e("../animation/AnimationManager.js"),s=e("./CSS2DRenderer.js");function l(){}l.prototype={line:function(e){e=r._validate(e,this._defaults.line);var t=r.lnglatsToWorld(e.geometry),i=r.normalizeVertices(t),a=r.flattenVectors(i.vertices),o=new Float32Array(a),s=new n.BufferGeometry;s.setAttribute("position",new n.BufferAttribute(o,3));var l=new n.LineBasicMaterial({color:16711680,linewidth:21}),c=new n.Line(s,l);return c.options=options||{},c.position.copy(i.position),c},extrusion:function(e){},unenroll:function(e,t){t||this.animationManager.unenroll(e)},_addMethods:function(e,t){var i=this;const a="label",o="tooltip",c="help",h="shadowPlane";if(t);else{function u(e,t,i,n){let a=r.radify(n);e.position.sub(t),e.position.applyAxisAngle(i,a),e.position.add(t),e.rotateOnAxis(i,a),tb.map.repaint=!0}e.coordinates||(e.coordinates=[0,0,0]),Object.defineProperty(e,"model",{get:()=>e.getObjectByName("model")}),Object.defineProperty(e,"animations",{get(){const t=e.model;return t?t.animations:null}}),i.animationManager.enroll(e),e.setCoords=function(t){if("meters"===e.userData.units){var i=r.projectedUnitsPerMeter(t[1]);i||(i=1),"number"==typeof(i=Number(i.toFixed(7)))?e.scale.set(i,i,i):e.scale.set(i.x,i.y,i.z)}return e.userData.topMargin&&e.userData.feature&&(t[2]+=((e.userData.feature.properties.height||0)-(e.userData.feature.properties.base_height||e.userData.feature.properties.min_height||0))*(e.userData.topMargin||0)),e.coordinates=t,e.set({position:t}),e.modelHeight=e.coordinates[2]||0,e.setBoundingBoxShadowFloor(),e.setCastShadowFloor(),e},e.setTranslate=function(t){return e.set({translate:t}),e},e.setRotation=function(t){"number"==typeof t&&(t={z:t});var i={x:r.radify(t.x)||e.rotation.x,y:r.radify(t.y)||e.rotation.y,z:r.radify(t.z)||e.rotation.z};e._setObject({rotation:[i.x,i.y,i.z]})},e.calculateAdjustedPosition=function(t,i,n){let a=t.slice(),o=r.unprojectFromWorld(e.modelSize);return n?(a[0]-=0!=i.x?o[0]/i.x:0,a[1]-=0!=i.y?o[1]/i.y:0,a[2]-=0!=i.z?o[2]/i.z:0):(a[0]+=0!=i.x?o[0]/i.x:0,a[1]+=0!=i.y?o[1]/i.y:0,a[2]+=0!=i.z?o[2]/i.z:0),a},e.setRotationAxis=function(t){"number"==typeof t&&(t={z:t});let i=e.modelBox(),r=new n.Vector3(i.max.x,i.max.y,i.min.z);0!=t.x&&u(e,r,new n.Vector3(0,0,1),t.x),0!=t.y&&u(e,r,new n.Vector3(0,0,1),t.y),0!=t.z&&u(e,r,new n.Vector3(0,0,1),t.z)},Object.defineProperty(e,"scaleGroup",{get:()=>e.getObjectByName("scaleGroup")}),Object.defineProperty(e,"boxGroup",{get:()=>e.getObjectByName("boxGroup")}),Object.defineProperty(e,"boundingBox",{get:()=>e.getObjectByName("boxModel")}),Object.defineProperty(e,"boundingBoxShadow",{get:()=>e.getObjectByName("boxShadow")}),e.drawBoundingBox=function(){let t=e.box3(),i=new n.Group;i.name="boxGroup",i.updateMatrixWorld(!0);let r=new n.Box3Helper(t,l.prototype._defaults.colors.yellow);r.name="boxModel",i.add(r),r.layers.disable(0);let a=t.clone();a.max.z=a.min.z;let o=new n.Box3Helper(a,l.prototype._defaults.colors.black);o.name="boxShadow",i.add(o),o.layers.disable(0),i.visible=!1,e.scaleGroup.add(i),e.setBoundingBoxShadowFloor()},e.setBoundingBoxShadowFloor=function(){e.boxGroup&&e.boundingBox&&(e.boundingBoxShadow.box.max.z=-e.modelHeight,e.boundingBoxShadow.box.min.z=-e.modelHeight)},e.setAnchor=function(t){const i=e.box3(),r=(i.getSize(new n.Vector3),i.getCenter(new n.Vector3));switch(e.none={x:0,y:0,z:0},e.center={x:r.x,y:r.y,z:i.min.z},e.bottom={x:r.x,y:i.max.y,z:i.min.z},e.bottomLeft={x:i.max.x,y:i.max.y,z:i.min.z},e.bottomRight={x:i.min.x,y:i.max.y,z:i.min.z},e.top={x:r.x,y:i.min.y,z:i.min.z},e.topLeft={x:i.max.x,y:i.min.y,z:i.min.z},e.topRight={x:i.min.x,y:i.min.y,z:i.min.z},e.left={x:i.max.x,y:r.y,z:i.min.z},e.right={x:i.min.x,y:r.y,z:i.min.z},t){case"center":e.anchor=e.center;break;case"top":e.anchor=e.top;break;case"top-left":e.anchor=e.topLeft;break;case"top-right":e.anchor=e.topRight;break;case"left":e.anchor=e.left;break;case"right":e.anchor=e.right;break;case"bottom":e.anchor=e.bottom;break;case"bottom-left":default:e.anchor=e.bottomLeft;break;case"bottom-right":e.anchor=e.bottomRight;break;case"auto":case"none":e.anchor=e.none}e.model.position.set(-e.anchor.x,-e.anchor.y,-e.anchor.z)},e.setCenter=function(t){if(t&&(0!=t.x||0!=t.y||0!=t.z)){let i=e.getSize();e.anchor={x:e.anchor.x-i.x*t.x,y:e.anchor.y-i.y*t.y,z:e.anchor.z-i.z*t.z},e.model.position.set(-e.anchor.x,-e.anchor.y,-e.anchor.z)}},Object.defineProperty(e,"label",{get:()=>e.getObjectByName(a)}),Object.defineProperty(e,"tooltip",{get:()=>e.getObjectByName(o)}),Object.defineProperty(e,"help",{get:()=>e.getObjectByName(c)}),Object.defineProperty(e,"visibility",{get:()=>e.visible,set(t){let i=t;if("visible"==t||1==t)i=!0,e.label&&(e.label.visible=i);else{if("none"!=t&&0!=t)return;i=!1,e.label&&e.label.alwaysVisible&&(e.label.visible=i),e.tooltip&&(e.tooltip.visible=i)}e.visible!=i&&(e.visible=i,e.model&&e.model.traverse((function(t){"Mesh"!=t.type&&"SkinnedMesh"!=t.type||(i&&e.raycasted?t.layers.enable(0):t.layers.disable(0)),"LineSegments"==t.type&&t.layers.disableAll()})))}}),e.addLabel=function(t,i,r,n){t&&e.drawLabelHTML(t,i,r,n)},e.removeLabel=function(){e.removeCSS2D(a)},e.drawLabelHTML=function(t,r=!1,n=e.anchor,o=.5){let s=i.drawLabelHTML(t,l.prototype._defaults.label.cssClass),c=e.addCSS2D(s,a,n,o);return c.alwaysVisible=r,c.visible=r,c},e.addTooltip=function(t,i,r,n=!0,a=1){let s=e.addHelp(t,o,i,r,a);s.visible=!1,s.custom=n},e.removeTooltip=function(){e.removeCSS2D(o)},e.addHelp=function(t,r="help",n=!1,a=e.anchor,o=0){let s=i.drawTooltip(t,n),l=e.addCSS2D(s,r,a,o);return l.visible=!0,l},e.removeHelp=function(){e.removeCSS2D(c)},e.addCSS2D=function(t,i,r=e.anchor,a=1){if(t){const o=e.box3(),l=o.getSize(new n.Vector3);let c={x:o.max.x,y:o.max.y,z:o.min.z};e.removeCSS2D(i);let h=new s.CSS2DObject(t);return h.name=i,h.position.set(.5*-l.x-e.model.position.x-r.x+c.x,.5*-l.y-e.model.position.y-r.y+c.y,l.z*a),h.visible=!1,e.scaleGroup.add(h),h}},e.removeCSS2D=function(t){let i=e.getObjectByName(t);if(i){i.dispose();let t=e.scaleGroup.children;t.splice(t.indexOf(i),1)}},Object.defineProperty(e,"shadowPlane",{get:()=>e.getObjectByName(h)});let t=!1;Object.defineProperty(e,"castShadow",{get:()=>t,set(i){if(e.model&&t!==i){if(e.model.traverse((function(e){e.isMesh&&(e.castShadow=!0)})),i){const t=e.modelSize,r=[t.x,t.y,t.z],a=10*Math.max(...r),o=new n.PlaneBufferGeometry(a,a),s=new n.ShadowMaterial;s.opacity=.5;let l=new n.Mesh(o,s);l.name=h,l.layers.enable(1),l.layers.disable(0),l.receiveShadow=i,e.add(l)}else e.traverse((function(t){t.isMesh&&t.material instanceof n.ShadowMaterial&&e.remove(t)}));t=i}}}),e.setCastShadowFloor=function(){e.castShadow&&(e.shadowPlane.position.z=-e.modelHeight)};let d=!1;Object.defineProperty(e,"receiveShadow",{get:()=>d,set(t){e.model&&d!==t&&(e.model.traverse((function(e){e.isMesh&&(e.receiveShadow=!0)})),d=t)}});let p=!1;Object.defineProperty(e,"wireframe",{get:()=>p,set(t){e.model&&p!==t&&(e.model.traverse((function(e){if("Mesh"==e.type||"SkinnedMesh"==e.type){let i=[];if(Array.isArray(e.material)?i=e.material:i.push(e.material),t)e.userData.materials=i,e.material=l.prototype._defaults.materials.wireframeMaterial,e.material.opacity=t?.5:1,e.material.wireframe=t,e.material.transparent=t;else{let t=e.userData.materials;e.material=t.length>1?t:t[0],e.userData.materials=null}t?(e.layers.disable(0),e.layers.enable(1)):(e.layers.disable(1),e.layers.enable(0))}"LineSegments"==e.type&&e.layers.disableAll()})),p=t,e.dispatchEvent(new CustomEvent("Wireframed",{detail:e,bubbles:!0,cancelable:!0})))}});let f=!1;Object.defineProperty(e,"selected",{get:()=>f,set(t){t?(e.boxGroup&&(e.boundingBox.material=l.prototype._defaults.materials.boxSelectedMaterial,e.boundingBox.parent.visible=!0,e.boundingBox.layers.enable(1),e.boundingBoxShadow.layers.enable(1)),e.label&&!e.label.alwaysVisible&&(e.label.visible=!0)):(e.boxGroup&&(e.boundingBox.parent.visible=!1,e.boundingBox.layers.disable(1),e.boundingBoxShadow.layers.disable(1),e.boundingBox.material=l.prototype._defaults.materials.boxNormalMaterial,e.remove(e.boxGroup)),e.label&&!e.label.alwaysVisible&&(e.label.visible=!1),e.removeHelp()),e.tooltip&&(e.tooltip.visible=t),f!=t&&(f=t,e.dispatchEvent(new CustomEvent("SelectedChange",{detail:e,bubbles:!0,cancelable:!0})))}});let m=!0;Object.defineProperty(e,"raycasted",{get:()=>m,set(t){e.model&&m!==t&&(e.model.traverse((function(e){"Mesh"!=e.type&&"SkinnedMesh"!=e.type||(t?(e.layers.disable(1),e.layers.enable(0)):(e.layers.disable(0),e.layers.enable(1)))})),m=t)}});let g=!1;Object.defineProperty(e,"over",{get:()=>g,set(t){t?(e.selected||(e.userData.bbox&&!e.boundingBox&&e.drawBoundingBox(),e.userData.tooltip&&!e.tooltip&&e.addTooltip(e.uuid,!0,e.anchor,!1),e.boxGroup&&(e.boundingBox.material=l.prototype._defaults.materials.boxOverMaterial,e.boundingBox.parent.visible=!0,e.boundingBox.layers.enable(1),e.boundingBoxShadow.layers.enable(1))),e.label&&!e.label.alwaysVisible&&(e.label.visible=!0),e.dispatchEvent(new CustomEvent("ObjectMouseOver",{detail:e,bubbles:!0,cancelable:!0}))):(e.selected||(e.boundingBox&&(e.boundingBox.parent.visible=!1,e.boundingBox.layers.disable(1),e.boundingBoxShadow.layers.disable(1),e.boundingBox.material=l.prototype._defaults.materials.boxNormalMaterial,e.remove(e.boxGroup),e.tooltip&&!e.tooltip.custom&&e.removeTooltip()),e.label&&!e.label.alwaysVisible&&(e.label.visible=!1)),e.dispatchEvent(new CustomEvent("ObjectMouseOut",{detail:e,bubbles:!0,cancelable:!0}))),e.tooltip&&(e.tooltip.visible=t||e.selected),g=t}}),e.box3=function(){let t;if(e.updateMatrix(),e.updateMatrixWorld(!0,!0),e.model){let i=e.clone(!0),r=e.model.clone();if(t=(new n.Box3).setFromObject(r),e.parent){let a=new n.Matrix4,o=new n.Matrix4;e.matrix.extractRotation(a),a.getInverse(o),i.setRotationFromMatrix(o),t=(new n.Box3).setFromObject(r)}}return t},e.modelBox=function(){return e.box3()},e.getSize=function(){return e.box3().getSize(new n.Vector3(0,0,0))};let y=!1;Object.defineProperty(e,"modelSize",{get:()=>(y=e.getSize(),y),set(e){y!=e&&(y=e)}}),e.modelHeight=0}e.add=function(t){return e.scaleGroup.add(t),t.position.z=e.coordinates[2]?-e.coordinates[2]:0,t},e.remove=function(t){t&&(t.traverse((e=>{if(e.geometry&&e.geometry.dispose(),e.material)if(e.material.isMaterial)d(e.material);else for(const t of e.material)d(t);e.dispose&&e.dispose()})),e.scaleGroup.remove(t),tb.map.repaint=!0)},e.duplicate=function(t){let n=e.clone(!0);if(n.getObjectByName("model").animations=e.animations,n.userData.feature&&(t&&t.feature&&(n.userData.feature=t.feature),n.userData.feature.properties.uuid=n.uuid),i._addMethods(n),!t||r.equal(t.scale,e.userData.scale))return n.copyAnchor(e),n;{n.userData=t,n.userData.isGeoGroup=!0,n.remove(n.boxGroup);const e=r.types.rotation(t.rotation,[0,0,0]),i=r.types.scale(t.scale,[1,1,1]);return n.model.position.set(0,0,0),n.model.rotation.set(e[0],e[1],e[2]),n.model.scale.set(i[0],i[1],i[2]),n.setAnchor(t.anchor),n.setCenter(t.adjustment),n}},e.copyAnchor=function(t){e.anchor=t.anchor,e.none={x:0,y:0,z:0},e.center=t.center,e.bottom=t.bottom,e.bottomLeft=t.bottomLeft,e.bottomRight=t.bottomRight,e.top=t.top,e.topLeft=t.topLeft,e.topRight=t.topRight,e.left=t.left,e.right=t.right},e.dispose=function(){l.prototype.unenroll(e),e.traverse((e=>{if((!e.parent||"world"!=e.parent.name)&&"threeboxObject"!==e.name){if(e.geometry&&e.geometry.dispose(),e.material)if(e.material.isMaterial)d(e.material);else for(const t of e.material)d(t);e.dispose&&e.dispose()}})),e.children=[]};const d=e=>{e.dispose();for(const t of Object.keys(e)){const i=e[t];i&&"object"==typeof i&&"minFilter"in i&&i.dispose()}let t=e;(t.map||t.alphaMap||t.aoMap||t.bumpMap||t.displacementMap||t.emissiveMap||t.envMap||t.lightMap||t.metalnessMap||t.normalMap||t.roughnessMap)&&(t.map&&t.map.dispose(),t.alphaMap&&t.alphaMap.dispose(),t.aoMap&&t.aoMap.dispose(),t.bumpMap&&t.bumpMap.dispose(),t.displacementMap&&t.displacementMap.dispose(),t.emissiveMap&&t.emissiveMap.dispose(),t.envMap&&t.envMap.dispose(),t.lightMap&&t.lightMap.dispose(),t.metalnessMap&&t.metalnessMap.dispose(),t.normalMap&&t.normalMap.dispose(),t.roughnessMap&&t.roughnessMap.dispose())};return e},_makeGroup:function(e,t){let i=new n.Group;i.name="scaleGroup",i.add(e);var r=new n.Group;if(r.userData=t||{},r.userData.isGeoGroup=!0,r.userData.feature&&(r.userData.feature.properties.uuid=r.uuid),i.length)for(o of i)r.add(o);else r.add(i);return r.name="threeboxObject",r},animationManager:new a,drawTooltip:function(e,t=!1){if(e){let i;if(t){let t=document.createElement("div");t.className="mapboxgl-popup-content";let r=document.createElement("strong");r.innerHTML=e,t.appendChild(r);let n=document.createElement("div");n.className="mapboxgl-popup-tip";let a=document.createElement("div");a.className="marker mapboxgl-popup-anchor-bottom",a.appendChild(n),a.appendChild(t),i=document.createElement("div"),i.className+="label3D",i.appendChild(a)}else i=document.createElement("span"),i.className=this._defaults.tooltip.cssClass,i.innerHTML=e;return i}},drawLabelHTML:function(e,t){let i=document.createElement("div");return i.className+=t,i.innerHTML="string"==typeof e?e:e.outerHTML,i},_defaults:{colors:{red:new n.Color(16711680),yellow:new n.Color(16776960),green:new n.Color(65280),black:new n.Color(0)},materials:{wireframeMaterial:new n.LineBasicMaterial({color:new n.Color(16777215)}),boxNormalMaterial:new n.LineBasicMaterial({color:new n.Color(16711680)}),boxOverMaterial:new n.LineBasicMaterial({color:new n.Color(16776960)}),boxSelectedMaterial:new n.LineBasicMaterial({color:new n.Color(65280)})},line:{geometry:null,color:"black",width:1,opacity:1},sphere:{position:[0,0,0],radius:1,sides:20,units:"scene",material:"MeshBasicMaterial",anchor:"bottom-left",bbox:!1,tooltip:!1,raycasted:!0},label:{htmlElement:null,cssClass:" label3D",alwaysVisible:!1,topMargin:-.5},tooltip:{text:"",cssClass:"toolTip text-xs",mapboxStyle:!1,topMargin:0,feature:null},tube:{geometry:null,radius:1,sides:6,units:"scene",material:"MeshBasicMaterial",anchor:"center",bbox:!1,tooltip:!1,raycasted:!0},loadObj:{type:null,obj:null,units:"scene",scale:1,rotation:0,defaultAnimation:0,anchor:"bottom-left",bbox:!1,tooltip:!1,raycasted:!0},Object3D:{obj:null,units:"scene",anchor:"bottom-left",bbox:!1,tooltip:!1,raycasted:!0},extrusion:{coordinates:[[[]]],geometryOptions:{},height:100,materials:null,scale:1,rotation:0,units:"scene",anchor:"center",bbox:!1,tooltip:!1,raycasted:!0}},geometries:{line:["LineString"],tube:["LineString"],sphere:["Point"]}},t.exports=l},{"../animation/AnimationManager.js":3,"../three.js":23,"../utils/material.js":25,"../utils/utils.js":27,"./CSS2DRenderer.js":5}],20:[function(e,t,i){const r=e("../utils/utils.js"),n=e("../utils/material.js"),a=e("./objects.js"),o=e("./Object3D.js");t.exports=function(e){e=r._validate(e,a.prototype._defaults.sphere);let t=new THREE.SphereBufferGeometry(e.radius,e.sides,e.sides),i=n(e),s=new THREE.Mesh(t,i);return new o({obj:s,units:e.units,anchor:e.anchor,adjustment:e.adjustment,bbox:e.bbox,tooltip:e.tooltip,raycasted:e.raycasted})}},{"../utils/material.js":25,"../utils/utils.js":27,"./Object3D.js":7,"./objects.js":19}],21:[function(e,t,i){const r=e("../utils/utils.js"),n=e("./objects.js"),a=e("./CSS2DRenderer.js");e("../three.js"),t.exports=function(e){if((e=r._validate(e,n.prototype._defaults.tooltip)).text){let i=n.prototype.drawTooltip(e.text,e.mapboxStyle),r=new a.CSS2DObject(i);r.visible=!1,r.name="tooltip";var t=n.prototype._makeGroup(r,e);return n.prototype._addMethods(t),t}}},{"../three.js":23,"../utils/utils.js":27,"./CSS2DRenderer.js":5,"./objects.js":19}],22:[function(e,t,r){const n=e("../utils/utils.js"),a=e("../utils/material.js"),o=e("./objects.js"),s=e("../three.js"),l=e("./Object3D.js");function c(e,t){e=n._validate(e,o.prototype._defaults.tube);let i=n.lnglatsToWorld(e.geometry),r=n.normalizeVertices(i),h=c.prototype.defineCrossSection(e),u=c.prototype.buildVertices(h,r.vertices,t),d=c.prototype.buildFaces(u,r.vertices,e),p=a(e),f=new s.Mesh(d,p);return new l({obj:f,units:e.units,anchor:e.anchor,adjustment:e.adjustment,bbox:e.bbox,tooltip:e.tooltip,raycasted:e.raycasted})}c.prototype={buildVertices:function(e,t,r){var n=new s.PlaneBufferGeometry(99999999999,9999999999),a=new s.MeshBasicMaterial({color:16777215,side:s.DoubleSide});a.opacity=0;var o=new s.Mesh(n,a),l=new s.Geometry,c=!1,h=[t[0].clone().normalize()];for(i in t){var u;i=parseFloat(i),t[i+1]&&(u=(new s.Vector3).subVectors(t[i+1],t[i]).normalize()),h.push(u)}for(i in h.push(new s.Vector3),t){i=parseFloat(i);var d=t[i],p=h[i],f=h[i+1],m=p.clone().add(f).normalize();if(0===i?m=f:i===t.length-1&&(m=p),c){let e=[];o.position.copy(d),o.lookAt(m.clone().add(d)),o.updateMatrixWorld(),c.forEach((function(t){let r=new s.Raycaster(t,p).intersectObject(o)[0];r?(l.vertices.push(r.point),e.push(r.point)):console.error("Tube geometry failed at vertex "+i+". Consider reducing tube radius, or smoothening out the sharp angle at this vertex")})),c=e}else{let t=e.clone();t.lookAt(m),t.vertices.forEach((function(e){l.vertices.push(e.add(d))})),c=t.vertices}}return r.remove(o),l},defineCrossSection:function(e){let t=new s.Geometry,i=e.sides;for(let r=0;r<i;r++){let n=e.radius,a=(r+.5)/i*Math.PI;t.vertices.push(new s.Vector3(-Math.sin(2*a),Math.cos(2*a),0).multiplyScalar(n))}return t},buildFaces:function(e,t,i){for(let r in t)if(r=parseFloat(r),t[r],r<t.length-1)for(let t=0;t<i.sides;t++){let n=r*i.sides+t,a=r*i.sides+(t+1)%i.sides,o=n+i.sides,l=a+i.sides,c=new s.Face3(o,n,a),h=new s.Face3(o,a,l);e.faces.push(c,h)}let r=e.vertices.length;for(let t=0;t+2<i.sides;t++){let i=new s.Face3(0,t+2,t+1),n=new s.Face3(r-1,r-1-(t+2),r-1-(t+1));e.faces.push(i,n)}return e.computeFaceNormals(),(new s.BufferGeometry).fromGeometry(e),e}},t.exports=c},{"../three.js":23,"../utils/material.js":25,"../utils/utils.js":27,"./Object3D.js":7,"./objects.js":19}],23:[function(e,t,i){var o;o=function(e){function t(){}function i(e,t){this.x=e||0,this.y=t||0}function r(){this.elements=[1,0,0,0,1,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}function n(e,t,a,o,s,l,c,h,u,d){Object.defineProperty(this,"id",{value:ka++}),this.uuid=Ia.generateUUID(),this.name="",this.image=void 0!==e?e:n.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:n.DEFAULT_MAPPING,this.wrapS=void 0!==a?a:1001,this.wrapT=void 0!==o?o:1001,this.magFilter=void 0!==s?s:1006,this.minFilter=void 0!==l?l:1008,this.anisotropy=void 0!==u?u:1,this.format=void 0!==c?c:1023,this.internalFormat=null,this.type=void 0!==h?h:1009,this.offset=new i(0,0),this.repeat=new i(1,1),this.center=new i(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new r,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==d?d:3e3,this.version=0,this.onUpdate=null}function a(e,t,i,r){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==r?r:1}function o(e,t,i){this.width=e,this.height=t,this.scissor=new a(0,0,e,t),this.scissorTest=!1,this.viewport=new a(0,0,e,t),i=i||{},this.texture=new n(void 0,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:1006,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0===i.stencilBuffer||i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}function s(e,t,i){o.call(this,e,t,i),this.samples=4}function l(e,t,i,r){this._x=e||0,this._y=t||0,this._z=i||0,this._w=void 0!==r?r:1}function c(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0}function h(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function u(e,t,i,r){this._x=e||0,this._y=t||0,this._z=i||0,this._order=r||u.DefaultOrder}function d(){this.mask=1}function p(){Object.defineProperty(this,"id",{value:qa++}),this.uuid=Ia.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=p.DefaultUp.clone();var e=new c,t=new u,i=new l,n=new c(1,1,1);t._onChange((function(){i.setFromEuler(t,!1)})),i._onChange((function(){t.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new h},normalMatrix:{value:new r}}),this.matrix=new h,this.matrixWorld=new h,this.matrixAutoUpdate=p.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new d,this.visible=!0,this.receiveShadow=this.castShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function f(){p.call(this),this.type="Scene",this.overrideMaterial=this.fog=this.environment=this.background=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function m(e,t){this.min=void 0!==e?e:new c(1/0,1/0,1/0),this.max=void 0!==t?t:new c(-1/0,-1/0,-1/0)}function g(e,t,i,r,n){var a,o=0;for(a=e.length-3;o<=a;o+=3){vo.fromArray(e,o);var s=n.x*Math.abs(vo.x)+n.y*Math.abs(vo.y)+n.z*Math.abs(vo.z),l=t.dot(vo),c=i.dot(vo),h=r.dot(vo);if(Math.max(-Math.max(l,c,h),Math.min(l,c,h))>s)return!1}return!0}function y(e,t){this.center=void 0!==e?e:new c,this.radius=void 0!==t?t:-1}function v(e,t){this.origin=void 0!==e?e:new c,this.direction=void 0!==t?t:new c(0,0,-1)}function _(e,t){this.normal=void 0!==e?e:new c(1,0,0),this.constant=void 0!==t?t:0}function x(e,t,i){this.a=void 0!==e?e:new c,this.b=void 0!==t?t:new c,this.c=void 0!==i?i:new c}function b(e,t,i){return void 0===t&&void 0===i?this.set(e):this.setRGB(e,t,i)}function w(e,t,i){return 0>i&&(i+=1),1<i&&--i,i<1/6?e+6*(t-e)*i:.5>i?t:i<2/3?e+6*(t-e)*(2/3-i):e}function M(e){return.04045>e?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function T(e){return.0031308>e?12.92*e:1.055*Math.pow(e,.41666)-.055}function S(e,t,i,r,n,a){this.a=e,this.b=t,this.c=i,this.normal=r&&r.isVector3?r:new c,this.vertexNormals=Array.isArray(r)?r:[],this.color=n&&n.isColor?n:new b,this.vertexColors=Array.isArray(n)?n:[],this.materialIndex=void 0!==a?a:0}function E(){Object.defineProperty(this,"id",{value:Go++}),this.uuid=Ia.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.vertexColors=this.flatShading=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendEquationAlpha=this.blendDstAlpha=this.blendSrcAlpha=null,this.depthFunc=3,this.depthWrite=this.depthTest=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilZPass=this.stencilZFail=this.stencilFail=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipShadows=this.clipIntersection=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetUnits=this.polygonOffsetFactor=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.toneMapped=this.visible=!0,this.userData={},this.version=0}function A(e){E.call(this),this.type="MeshBasicMaterial",this.color=new b(16777215),this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.envMap=this.alphaMap=this.specularMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.morphTargets=this.skinning=!1,this.setValues(e)}function C(e,t,i){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===i,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}function L(e,t,i){C.call(this,new Int8Array(e),t,i)}function P(e,t,i){C.call(this,new Uint8Array(e),t,i)}function I(e,t,i){C.call(this,new Uint8ClampedArray(e),t,i)}function R(e,t,i){C.call(this,new Int16Array(e),t,i)}function D(e,t,i){C.call(this,new Uint16Array(e),t,i)}function k(e,t,i){C.call(this,new Int32Array(e),t,i)}function z(e,t,i){C.call(this,new Uint32Array(e),t,i)}function O(e,t,i){C.call(this,new Float32Array(e),t,i)}function B(e,t,i){C.call(this,new Float64Array(e),t,i)}function F(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingSphere=this.boundingBox=null,this.groupsNeedUpdate=this.uvsNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.verticesNeedUpdate=!1}function N(e){if(0===e.length)return-1/0;for(var t=e[0],i=1,r=e.length;i<r;++i)e[i]>t&&(t=e[i]);return t}function U(){Object.defineProperty(this,"id",{value:Wo+=2}),this.uuid=Ia.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingSphere=this.boundingBox=null,this.drawRange={start:0,count:1/0},this.userData={}}function j(e,t){p.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new U,this.material=void 0!==t?t:new A,this.updateMorphTargets()}function V(e,t,i,r,n,a,o,s){return null===(1===t.side?r.intersectTriangle(o,a,n,!0,s):r.intersectTriangle(n,a,o,2!==t.side,s))?null:(fs.copy(s),fs.applyMatrix4(e.matrixWorld),(t=i.ray.origin.distanceTo(fs))<i.near||t>i.far?null:{distance:t,point:fs.clone(),object:e})}function G(e,t,r,n,a,o,s,l,c,h,u,d){if(ts.fromBufferAttribute(a,h),is.fromBufferAttribute(a,u),rs.fromBufferAttribute(a,d),a=e.morphTargetInfluences,t.morphTargets&&o&&a){ss.set(0,0,0),ls.set(0,0,0),cs.set(0,0,0);for(var p=0,f=o.length;p<f;p++){var m=a[p],g=o[p];0!==m&&(ns.fromBufferAttribute(g,h),as.fromBufferAttribute(g,u),os.fromBufferAttribute(g,d),s?(ss.addScaledVector(ns,m),ls.addScaledVector(as,m),cs.addScaledVector(os,m)):(ss.addScaledVector(ns.sub(ts),m),ls.addScaledVector(as.sub(is),m),cs.addScaledVector(os.sub(rs),m)))}ts.add(ss),is.add(ls),rs.add(cs)}return e.isSkinnedMesh&&(e.boneTransform(h,ts),e.boneTransform(u,is),e.boneTransform(d,rs)),(e=V(e,t,r,n,ts,is,rs,ps))&&(l&&(hs.fromBufferAttribute(l,h),us.fromBufferAttribute(l,u),ds.fromBufferAttribute(l,d),e.uv=x.getUV(ps,ts,is,rs,hs,us,ds,new i)),c&&(hs.fromBufferAttribute(c,h),us.fromBufferAttribute(c,u),ds.fromBufferAttribute(c,d),e.uv2=x.getUV(ps,ts,is,rs,hs,us,ds,new i)),l=new S(h,u,d),x.getNormal(ts,is,rs,l.normal),e.face=l),e}function H(){Object.defineProperty(this,"id",{value:ms+=2}),this.uuid=Ia.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingSphere=this.boundingBox=null,this.groupsNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.verticesNeedUpdate=this.elementsNeedUpdate=!1}function W(e){var t,i={};for(t in e)for(var r in i[t]={},e[t]){var n=e[t][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture)?i[t][r]=n.clone():Array.isArray(n)?i[t][r]=n.slice():i[t][r]=n}return i}function q(e){for(var t={},i=0;i<e.length;i++){var r,n=W(e[i]);for(r in n)t[r]=n[r]}return t}function Z(e){E.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.morphNormals=this.morphTargets=this.skinning=this.clipping=this.lights=this.fog=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function X(){p.call(this),this.type="Camera",this.matrixWorldInverse=new h,this.projectionMatrix=new h,this.projectionMatrixInverse=new h}function $(e,t,i,r){X.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==i?i:.1,this.far=void 0!==r?r:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function Y(e,t,i){if(p.call(this),this.type="CubeCamera",!0!==i.isWebGLCubeRenderTarget)console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");else{this.renderTarget=i;var r=new $(90,1,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new c(1,0,0)),this.add(r);var n=new $(90,1,e,t);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new c(-1,0,0)),this.add(n);var a=new $(90,1,e,t);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(new c(0,1,0)),this.add(a);var o=new $(90,1,e,t);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new c(0,-1,0)),this.add(o);var s=new $(90,1,e,t);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new c(0,0,1)),this.add(s);var l=new $(90,1,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new c(0,0,-1)),this.add(l),this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var c=e.xr.enabled,h=e.getRenderTarget();e.xr.enabled=!1;var u=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,r),e.setRenderTarget(i,1),e.render(t,n),e.setRenderTarget(i,2),e.render(t,a),e.setRenderTarget(i,3),e.render(t,o),e.setRenderTarget(i,4),e.render(t,s),i.texture.generateMipmaps=u,e.setRenderTarget(i,5),e.render(t,l),e.setRenderTarget(h),e.xr.enabled=c},this.clear=function(e,t,r,n){for(var a=e.getRenderTarget(),o=0;6>o;o++)e.setRenderTarget(i,o),e.clear(t,r,n);e.setRenderTarget(a)}}}function J(e,t,i){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=i),o.call(this,e,e,t)}function K(e,t,i,r,a,o,s,l,c,h,u,d){n.call(this,null,o,s,l,c,h,r,a,u,d),this.image={data:e||null,width:t||1,height:i||1},this.magFilter=void 0!==c?c:1003,this.minFilter=void 0!==h?h:1003,this.flipY=this.generateMipmaps=!1,this.unpackAlignment=1,this.needsUpdate=!0}function Q(e,t,i,r,n,a){this.planes=[void 0!==e?e:new _,void 0!==t?t:new _,void 0!==i?i:new _,void 0!==r?r:new _,void 0!==n?n:new _,void 0!==a?a:new _]}function ee(){function e(n,a){!1!==i&&(r(n,a),t.requestAnimationFrame(e))}var t=null,i=!1,r=null;return{start:function(){!0!==i&&null!==r&&(t.requestAnimationFrame(e),i=!0)},stop:function(){i=!1},setAnimationLoop:function(e){r=e},setContext:function(e){t=e}}}function te(e,t){var i=t.isWebGL2,r=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),r.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);var i=r.get(t);i&&(e.deleteBuffer(i.buffer),r.delete(t))},update:function(t,n){t.isInterleavedBufferAttribute&&(t=t.data);var a=r.get(t);if(void 0===a)r.set(t,function(t,i){var r=t.array,n=t.usage,a=e.createBuffer();return e.bindBuffer(i,a),e.bufferData(i,r,n),t.onUploadCallback(),i=5126,r instanceof Float32Array?i=5126:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?i=5123:r instanceof Int16Array?i=5122:r instanceof Uint32Array?i=5125:r instanceof Int32Array?i=5124:r instanceof Int8Array?i=5120:r instanceof Uint8Array&&(i=5121),{buffer:a,type:i,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}(t,n));else if(a.version<t.version){var o=t.array,s=t.updateRange;e.bindBuffer(n,a.buffer),-1===s.count?e.bufferSubData(n,0,o):(i?e.bufferSubData(n,s.offset*o.BYTES_PER_ELEMENT,o,s.offset,s.count):e.bufferSubData(n,s.offset*o.BYTES_PER_ELEMENT,o.subarray(s.offset,s.offset+s.count)),s.count=-1),a.version=t.version}}}}function ie(e,t,i,r){H.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r},this.fromBufferGeometry(new re(e,t,i,r)),this.mergeVertices()}function re(e,t,i,r){U.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};var n=(e=e||1)/2,a=(t=t||1)/2,o=(i=Math.floor(i)||1)+1,s=(r=Math.floor(r)||1)+1,l=e/i,c=t/r,h=[],u=[],d=[],p=[];for(e=0;e<s;e++){var f=e*c-a;for(t=0;t<o;t++)u.push(t*l-n,-f,0),d.push(0,0,1),p.push(t/i),p.push(1-e/r)}for(e=0;e<r;e++)for(t=0;t<i;t++)n=t+o*(e+1),a=t+1+o*(e+1),s=t+1+o*e,h.push(t+o*e,n,s),h.push(n,a,s);this.setIndex(h),this.setAttribute("position",new O(u,3)),this.setAttribute("normal",new O(d,3)),this.setAttribute("uv",new O(p,2))}function ne(e,t,i,r){function n(e,i){t.buffers.color.setClear(e.r,e.g,e.b,i,r)}var a,o,s=new b(0),l=0,c=null,h=0,u=null;return{getClearColor:function(){return s},setClearColor:function(e,t){s.set(e),n(s,l=void 0!==t?t:1)},getClearAlpha:function(){return l},setClearAlpha:function(e){n(s,l=e)},render:function(t,r,d,p){r=r.background,(d=(d=e.xr).getSession&&d.getSession())&&"additive"===d.environmentBlendMode&&(r=null),null===r?n(s,l):r&&r.isColor&&(n(r,1),p=!0),(e.autoClear||p)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),r&&(r.isCubeTexture||r.isWebGLCubeRenderTarget||306===r.mapping)?(void 0===o&&((o=new j(new xs(1,1,1),new Z({type:"BackgroundCubeMaterial",uniforms:W(Es.cube.uniforms),vertexShader:Es.cube.vertexShader,fragmentShader:Es.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),o.geometry.deleteAttribute("uv"),o.onBeforeRender=function(e,t,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(o.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(o)),p=r.isWebGLCubeRenderTarget?r.texture:r,o.material.uniforms.envMap.value=p,o.material.uniforms.flipEnvMap.value=p.isCubeTexture?-1:1,c===r&&h===p.version&&u===e.toneMapping||(o.material.needsUpdate=!0,c=r,h=p.version,u=e.toneMapping),t.unshift(o,o.geometry,o.material,0,0,null)):r&&r.isTexture&&(void 0===a&&((a=new j(new re(2,2),new Z({type:"BackgroundMaterial",uniforms:W(Es.background.uniforms),vertexShader:Es.background.vertexShader,fragmentShader:Es.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(a)),a.material.uniforms.t2D.value=r,!0===r.matrixAutoUpdate&&r.updateMatrix(),a.material.uniforms.uvTransform.value.copy(r.matrix),c===r&&h===r.version&&u===e.toneMapping||(a.material.needsUpdate=!0,c=r,h=r.version,u=e.toneMapping),t.unshift(a,a.geometry,a.material,0,0,null))}}}function ae(e,t,i,r){var n,a=r.isWebGL2;this.setMode=function(e){n=e},this.render=function(t,r){e.drawArrays(n,t,r),i.update(r,n)},this.renderInstances=function(r,o,s,l){if(0!==l){if(a){r=e;var c="drawArraysInstanced"}else if(c="drawArraysInstancedANGLE",null===(r=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");r[c](n,o,s,l),i.update(s,n,l)}}}function oe(e,t,i){function r(t){if("highp"===t){if(0<e.getShaderPrecisionFormat(35633,36338).precision&&0<e.getShaderPrecisionFormat(35632,36338).precision)return"highp";t="mediump"}return"mediump"===t&&0<e.getShaderPrecisionFormat(35633,36337).precision&&0<e.getShaderPrecisionFormat(35632,36337).precision?"mediump":"lowp"}var n,a="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext,o=void 0!==i.precision?i.precision:"highp",s=r(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s),i=!0===i.logarithmicDepthBuffer,s=e.getParameter(34930);var l=e.getParameter(35660),c=e.getParameter(3379),h=e.getParameter(34076),u=e.getParameter(34921),d=e.getParameter(36347),p=e.getParameter(36348),f=e.getParameter(36349),m=0<l,g=a||!!t.get("OES_texture_float");return{isWebGL2:a,getMaxAnisotropy:function(){if(void 0!==n)return n;var i=t.get("EXT_texture_filter_anisotropic");return n=null!==i?e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:r,precision:o,logarithmicDepthBuffer:i,maxTextures:s,maxVertexTextures:l,maxTextureSize:c,maxCubemapSize:h,maxAttributes:u,maxVertexUniforms:d,maxVaryings:p,maxFragmentUniforms:f,vertexTextures:m,floatFragmentTextures:g,floatVertexTextures:m&&g,maxSamples:a?e.getParameter(36183):0}}function se(){function e(){h.value!==n&&(h.value=n,h.needsUpdate=0<a),i.numPlanes=a,i.numIntersection=0}function t(e,t,r,n){var a=null!==e?e.length:0,o=null;if(0!==a){if(o=h.value,!0!==n||null===o)for(n=r+4*a,t=t.matrixWorldInverse,c.getNormalMatrix(t),(null===o||o.length<n)&&(o=new Float32Array(n)),n=0;n!==a;++n,r+=4)l.copy(e[n]).applyMatrix4(t,c),l.normal.toArray(o,r),o[r+3]=l.constant;h.value=o,h.needsUpdate=!0}return i.numPlanes=a,i.numIntersection=0,o}var i=this,n=null,a=0,o=!1,s=!1,l=new _,c=new r,h={value:null,needsUpdate:!1};this.uniform=h,this.numIntersection=this.numPlanes=0,this.init=function(e,i,r){var s=0!==e.length||i||0!==a||o;return o=i,n=t(e,r,0),a=e.length,s},this.beginShadows=function(){s=!0,t(null)},this.endShadows=function(){s=!1,e()},this.setState=function(i,r,l,c,u,d){if(!o||null===i||0===i.length||s&&!l)s?t(null):e();else{var p=4*(l=s?0:a),f=u.clippingState||null;for(h.value=f,f=t(i,c,p,d),i=0;i!==p;++i)f[i]=n[i];u.clippingState=f,this.numIntersection=r?this.numPlanes:0,this.numPlanes+=l}}}function le(e){var t={};return{get:function(i){if(void 0!==t[i])return t[i];switch(i){case"WEBGL_depth_texture":var r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(i)}return null===r&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),t[i]=r}}}function ce(e,t,i){function r(e){var n=e.target;for(var s in null!==(e=a.get(n)).index&&t.remove(e.index),e.attributes)t.remove(e.attributes[s]);n.removeEventListener("dispose",r),a.delete(n),(s=o.get(e))&&(t.remove(s),o.delete(e)),i.memory.geometries--}function n(e){var i=[],r=e.index,n=e.attributes.position;if(null!==r){var a=r.array;r=r.version,n=0;for(var s=a.length;n<s;n+=3){var l=a[n+0],c=a[n+1],h=a[n+2];i.push(l,c,c,h,h,l)}}else for(a=n.array,r=n.version,n=0,s=a.length/3-1;n<s;n+=3)l=n+0,c=n+1,h=n+2,i.push(l,c,c,h,h,l);(i=new(65535<N(i)?z:D)(i,1)).version=r,t.update(i,34963),(a=o.get(e))&&t.remove(a),o.set(e,i)}var a=new WeakMap,o=new WeakMap;return{get:function(e,t){var n=a.get(t);return n||(t.addEventListener("dispose",r),t.isBufferGeometry?n=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new U).setFromObject(e)),n=t._bufferGeometry),a.set(t,n),i.memory.geometries++,n)},update:function(e){var i=e.index,r=e.attributes;for(var n in null!==i&&t.update(i,34963),r)t.update(r[n],34962);for(n in e=e.morphAttributes){r=0;for(var a=(i=e[n]).length;r<a;r++)t.update(i[r],34962)}},getWireframeAttribute:function(e){var t=o.get(e);if(t){var i=e.index;null!==i&&t.version<i.version&&n(e)}else n(e);return o.get(e)}}}function he(e,t,i,r){var n,a,o,s=r.isWebGL2;this.setMode=function(e){n=e},this.setIndex=function(e){a=e.type,o=e.bytesPerElement},this.render=function(t,r){e.drawElements(n,r,a,t*o),i.update(r,n)},this.renderInstances=function(r,l,c,h){if(0!==h){if(s){r=e;var u="drawElementsInstanced"}else if(u="drawElementsInstancedANGLE",null===(r=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");r[u](n,c,a,l*o,h),i.update(c,n,h)}}}function ue(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,i,r){switch(r=r||1,t.calls++,i){case 4:t.triangles+=e/3*r;break;case 1:t.lines+=e/2*r;break;case 3:t.lines+=r*(e-1);break;case 2:t.lines+=r*e;break;case 0:t.points+=r*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function de(e,t){return Math.abs(t[1])-Math.abs(e[1])}function pe(e){var t={},i=new Float32Array(8);return{update:function(r,n,a,o){var s=r.morphTargetInfluences,l=void 0===s?0:s.length;if(void 0===(r=t[n.id])){r=[];for(var c=0;c<l;c++)r[c]=[c,0];t[n.id]=r}var h=a.morphTargets&&n.morphAttributes.position;for(a=a.morphNormals&&n.morphAttributes.normal,c=0;c<l;c++){var u=r[c];0!==u[1]&&(h&&n.deleteAttribute("morphTarget"+c),a&&n.deleteAttribute("morphNormal"+c))}for(c=0;c<l;c++)(u=r[c])[0]=c,u[1]=s[c];for(r.sort(de),c=s=0;8>c;c++)(u=r[c])&&(l=u[0],u=u[1])?(h&&n.setAttribute("morphTarget"+c,h[l]),a&&n.setAttribute("morphNormal"+c,a[l]),i[c]=u,s+=u):i[c]=0;n=n.morphTargetsRelative?1:1-s,o.getUniforms().setValue(e,"morphTargetBaseInfluence",n),o.getUniforms().setValue(e,"morphTargetInfluences",i)}}}function fe(e,t,i,r){var n=new WeakMap;return{update:function(e){var a=r.render.frame,o=e.geometry,s=t.get(e,o);return n.get(s)!==a&&(o.isGeometry&&s.updateFromObject(e),t.update(s),n.set(s,a)),e.isInstancedMesh&&i.update(e.instanceMatrix,34962),s},dispose:function(){n=new WeakMap}}}function me(e,t,i,r,a,o,s,l,c,h){e=void 0!==e?e:[],n.call(this,e,void 0!==t?t:301,i,r,a,o,void 0!==s?s:1022,l,c,h),this.flipY=!1}function ge(e,t,i,r){n.call(this,null),this.image={data:e||null,width:t||1,height:i||1,depth:r||1},this.minFilter=this.magFilter=1003,this.wrapR=1001,this.flipY=this.generateMipmaps=!1,this.needsUpdate=!0}function ye(e,t,i,r){n.call(this,null),this.image={data:e||null,width:t||1,height:i||1,depth:r||1},this.minFilter=this.magFilter=1003,this.wrapR=1001,this.flipY=this.generateMipmaps=!1,this.needsUpdate=!0}function ve(e,t,i){var r=e[0];if(0>=r||0<r)return e;var n=t*i,a=Is[n];if(void 0===a&&(a=new Float32Array(n),Is[n]=a),0!==t)for(r.toArray(a,0),r=1,n=0;r!==t;++r)n+=i,e[r].toArray(a,n);return a}function _e(e,t){if(e.length!==t.length)return!1;for(var i=0,r=e.length;i<r;i++)if(e[i]!==t[i])return!1;return!0}function xe(e,t){for(var i=0,r=t.length;i<r;i++)e[i]=t[i]}function be(e,t){var i=Rs[t];void 0===i&&(i=new Int32Array(t),Rs[t]=i);for(var r=0;r!==t;++r)i[r]=e.allocateTextureUnit();return i}function we(e,t){var i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function Me(e,t){var i=this.cache;void 0!==t.x?i[0]===t.x&&i[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y):_e(i,t)||(e.uniform2fv(this.addr,t),xe(i,t))}function Te(e,t){var i=this.cache;void 0!==t.x?i[0]===t.x&&i[1]===t.y&&i[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z):void 0!==t.r?i[0]===t.r&&i[1]===t.g&&i[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b):_e(i,t)||(e.uniform3fv(this.addr,t),xe(i,t))}function Se(e,t){var i=this.cache;void 0!==t.x?i[0]===t.x&&i[1]===t.y&&i[2]===t.z&&i[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w):_e(i,t)||(e.uniform4fv(this.addr,t),xe(i,t))}function Ee(e,t){var i=this.cache,r=t.elements;void 0===r?_e(i,t)||(e.uniformMatrix2fv(this.addr,!1,t),xe(i,t)):_e(i,r)||(zs.set(r),e.uniformMatrix2fv(this.addr,!1,zs),xe(i,r))}function Ae(e,t){var i=this.cache,r=t.elements;void 0===r?_e(i,t)||(e.uniformMatrix3fv(this.addr,!1,t),xe(i,t)):_e(i,r)||(ks.set(r),e.uniformMatrix3fv(this.addr,!1,ks),xe(i,r))}function Ce(e,t){var i=this.cache,r=t.elements;void 0===r?_e(i,t)||(e.uniformMatrix4fv(this.addr,!1,t),xe(i,t)):_e(i,r)||(Ds.set(r),e.uniformMatrix4fv(this.addr,!1,Ds),xe(i,r))}function Le(e,t,i){var r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.safeSetTexture2D(t||As,n)}function Pe(e,t,i){var r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture2DArray(t||Cs,n)}function Ie(e,t,i){var r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture3D(t||Ls,n)}function Re(e,t,i){var r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.safeSetTextureCube(t||Ps,n)}function De(e,t){var i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function ke(e,t){var i=this.cache;_e(i,t)||(e.uniform2iv(this.addr,t),xe(i,t))}function ze(e,t){var i=this.cache;_e(i,t)||(e.uniform3iv(this.addr,t),xe(i,t))}function Oe(e,t){var i=this.cache;_e(i,t)||(e.uniform4iv(this.addr,t),xe(i,t))}function Be(e,t){var i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function Fe(e,t){e.uniform1fv(this.addr,t)}function Ne(e,t){e.uniform1iv(this.addr,t)}function Ue(e,t){e.uniform2iv(this.addr,t)}function je(e,t){e.uniform3iv(this.addr,t)}function Ve(e,t){e.uniform4iv(this.addr,t)}function Ge(e,t){t=ve(t,this.size,2),e.uniform2fv(this.addr,t)}function He(e,t){t=ve(t,this.size,3),e.uniform3fv(this.addr,t)}function We(e,t){t=ve(t,this.size,4),e.uniform4fv(this.addr,t)}function qe(e,t){t=ve(t,this.size,4),e.uniformMatrix2fv(this.addr,!1,t)}function Ze(e,t){t=ve(t,this.size,9),e.uniformMatrix3fv(this.addr,!1,t)}function Xe(e,t){t=ve(t,this.size,16),e.uniformMatrix4fv(this.addr,!1,t)}function $e(e,t,i){var r=t.length,n=be(i,r);for(e.uniform1iv(this.addr,n),e=0;e!==r;++e)i.safeSetTexture2D(t[e]||As,n[e])}function Ye(e,t,i){var r=t.length,n=be(i,r);for(e.uniform1iv(this.addr,n),e=0;e!==r;++e)i.safeSetTextureCube(t[e]||Ps,n[e])}function Je(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=function(e){switch(e){case 5126:return we;case 35664:return Me;case 35665:return Te;case 35666:return Se;case 35674:return Ee;case 35675:return Ae;case 35676:return Ce;case 5124:case 35670:return De;case 35667:case 35671:return ke;case 35668:case 35672:return ze;case 35669:case 35673:return Oe;case 5125:return Be;case 35678:case 36198:case 36298:case 36306:case 35682:return Le;case 35679:case 36299:case 36307:return Ie;case 35680:case 36300:case 36308:case 36293:return Re;case 36289:case 36303:case 36311:case 36292:return Pe}}(t.type)}function Ke(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return Fe;case 35664:return Ge;case 35665:return He;case 35666:return We;case 35674:return qe;case 35675:return Ze;case 35676:return Xe;case 5124:case 35670:return Ne;case 35667:case 35671:return Ue;case 35668:case 35672:return je;case 35669:case 35673:return Ve;case 35678:case 36198:case 36298:case 36306:case 35682:return $e;case 35680:case 36300:case 36308:case 36293:return Ye}}(t.type)}function Qe(e){this.id=e,this.seq=[],this.map={}}function et(e,t){this.seq=[],this.map={};for(var i=e.getProgramParameter(t,35718),r=0;r<i;++r){var n=e.getActiveUniform(t,r),a=e.getUniformLocation(t,n.name),o=this,s=n.name,l=s.length;for(Os.lastIndex=0;;){var c=Os.exec(s),h=Os.lastIndex,u=c[1],d=c[3];if("]"===c[2]&&(u|=0),void 0===d||"["===d&&h+2===l){s=o,n=void 0===d?new Je(u,n,a):new Ke(u,n,a),s.seq.push(n),s.map[n.id]=n;break}void 0===(d=o.map[u])&&(d=new Qe(u),u=o,o=d,u.seq.push(o),u.map[o.id]=o),o=d}}}function tt(e,t,i){return t=e.createShader(t),e.shaderSource(t,i),e.compileShader(t),t}function it(e){switch(e){case 3e3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:throw Error("unsupported encoding: "+e)}}function rt(e,t,i){var r=e.getShaderParameter(t,35713),n=e.getShaderInfoLog(t).trim();if(r&&""===n)return"";for(e=e.getShaderSource(t).split("\n"),t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return"THREE.WebGLShader: gl.getShaderInfoLog() "+i+"\n"+n+e.join("\n")}function nt(e,t){return"vec4 "+e+"( vec4 value ) { return "+(t=it(t))[0]+"ToLinear"+t[1]+"; }"}function at(e,t){return"vec4 "+e+"( vec4 value ) { return LinearTo"+(t=it(t))[0]+t[1]+"; }"}function ot(e,t){switch(t){case 1:t="Linear";break;case 2:t="Reinhard";break;case 3:t="Uncharted2";break;case 4:t="OptimizedCineon";break;case 5:t="ACESFilmic";break;default:throw Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function st(e){return""!==e}function lt(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function ct(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}function ht(e,t){if(void 0===(e=Ss[t]))throw Error("Can not resolve #include <"+t+">");return e.replace(Fs,ht)}function ut(e,t,i,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),dt(e,t,i,r)}function dt(e,t,i,r){for(e="",t=parseInt(t);t<parseInt(i);t++)e+=r.replace(/\[ i \]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return e}function pt(e){var t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function ft(e,t,i){var r,n,a=e.getContext(),o=i.defines,s=i.vertexShader,l=i.fragmentShader,c=function(e){var t="SHADOWMAP_TYPE_BASIC";return 1===e.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===e.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(i),h=function(e){var t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case 301:case 302:t="ENVMAP_TYPE_CUBE";break;case 306:case 307:t="ENVMAP_TYPE_CUBE_UV";break;case 303:case 304:t="ENVMAP_TYPE_EQUIREC";break;case 305:t="ENVMAP_TYPE_SPHERE"}return t}(i),u=function(e){var t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case 302:case 304:t="ENVMAP_MODE_REFRACTION"}return t}(i),d=function(e){var t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(i),p=0<e.gammaFactor?e.gammaFactor:1,f=i.isWebGL2?"":[i.extensionDerivatives||i.envMapCubeUV||i.bumpMap||i.tangentSpaceNormalMap||i.clearcoatNormalMap||i.flatShading||"physical"===i.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(i.extensionFragDepth||i.logarithmicDepthBuffer)&&i.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",i.extensionDrawBuffers&&i.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(i.extensionShaderTextureLOD||i.envMap)&&i.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(st).join("\n"),m=function(e){var t,i=[];for(t in e){var r=e[t];!1!==r&&i.push("#define "+t+" "+r)}return i.join("\n")}(o),g=a.createProgram();return i.isRawShaderMaterial?(0<(o=[m].filter(st).join("\n")).length&&(o+="\n"),0<(c=[f,m].filter(st).join("\n")).length&&(c+="\n")):(o=[pt(i),"#define SHADER_NAME "+i.shaderName,m,i.instancing?"#define USE_INSTANCING":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+p,"#define MAX_BONES "+i.maxBones,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+u:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+c:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(st).join("\n"),c=[f,pt(i),"#define SHADER_NAME "+i.shaderName,m,i.alphaTest?"#define ALPHATEST "+i.alphaTest+(i.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+p,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+h:"",i.envMap?"#define "+u:"",i.envMap?"#define "+d:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.sheen?"#define USE_SHEEN":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+c:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(i.extensionShaderTextureLOD||i.envMap)&&i.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==i.toneMapping?"#define TONE_MAPPING":"",0!==i.toneMapping?Ss.tonemapping_pars_fragment:"",0!==i.toneMapping?ot("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.outputEncoding||i.mapEncoding||i.matcapEncoding||i.envMapEncoding||i.emissiveMapEncoding||i.lightMapEncoding?Ss.encodings_pars_fragment:"",i.mapEncoding?nt("mapTexelToLinear",i.mapEncoding):"",i.matcapEncoding?nt("matcapTexelToLinear",i.matcapEncoding):"",i.envMapEncoding?nt("envMapTexelToLinear",i.envMapEncoding):"",i.emissiveMapEncoding?nt("emissiveMapTexelToLinear",i.emissiveMapEncoding):"",i.lightMapEncoding?nt("lightMapTexelToLinear",i.lightMapEncoding):"",i.outputEncoding?at("linearToOutputTexel",i.outputEncoding):"",i.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(st).join("\n")),s=ct(s=lt(s=s.replace(Fs,ht),i),i),l=ct(l=lt(l=l.replace(Fs,ht),i),i),s=s.replace(Us,dt).replace(Ns,ut),l=l.replace(Us,dt).replace(Ns,ut),i.isWebGL2&&!i.isRawShaderMaterial&&(h=!1,u=/^\s*#version\s+300\s+es\s*\n/,i.isShaderMaterial&&null!==s.match(u)&&null!==l.match(u)&&(h=!0,s=s.replace(u,""),l=l.replace(u,"")),o="#version 300 es\n\n#define attribute in\n#define varying out\n#define texture2D texture\n"+o,c=["#version 300 es\n\n#define varying in",h?"":"out highp vec4 pc_fragColor;",h?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth\n#define texture2D texture\n#define textureCube texture\n#define texture2DProj textureProj\n#define texture2DLodEXT textureLod\n#define texture2DProjLodEXT textureProjLod\n#define textureCubeLodEXT textureLod\n#define texture2DGradEXT textureGrad\n#define texture2DProjGradEXT textureProjGrad\n#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+c),l=c+l,s=tt(a,35633,o+s),l=tt(a,35632,l),a.attachShader(g,s),a.attachShader(g,l),void 0!==i.index0AttributeName?a.bindAttribLocation(g,0,i.index0AttributeName):!0===i.morphTargets&&a.bindAttribLocation(g,0,"position"),a.linkProgram(g),e.debug.checkShaderErrors&&(e=a.getProgramInfoLog(g).trim(),h=a.getShaderInfoLog(s).trim(),u=a.getShaderInfoLog(l).trim(),p=d=!0,!1===a.getProgramParameter(g,35714)?(d=!1,f=rt(a,s,"vertex"),m=rt(a,l,"fragment"),console.error("THREE.WebGLProgram: shader error: ",a.getError(),"35715",a.getProgramParameter(g,35715),"gl.getProgramInfoLog",e,f,m)):""!==e?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",e):""!==h&&""!==u||(p=!1),p&&(this.diagnostics={runnable:d,programLog:e,vertexShader:{log:h,prefix:o},fragmentShader:{log:u,prefix:c}})),a.deleteShader(s),a.deleteShader(l),this.getUniforms=function(){return void 0===r&&(r=new et(a,g)),r},this.getAttributes=function(){if(void 0===n){for(var e={},t=a.getProgramParameter(g,35721),i=0;i<t;i++){var r=a.getActiveAttrib(g,i).name;e[r]=a.getAttribLocation(g,r)}n=e}return n},this.destroy=function(){a.deleteProgram(g),this.program=void 0},this.name=i.shaderName,this.id=Bs++,this.cacheKey=t,this.usedTimes=1,this.program=g,this.vertexShader=s,this.fragmentShader=l,this}function mt(e,t,i){function r(e){if(e)e.isTexture?t=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=e.texture.encoding);else var t=3e3;return t}var n=[],a=i.isWebGL2,o=i.logarithmicDepthBuffer,s=i.floatVertexTextures,l=i.precision,c=i.maxVertexUniforms,h=i.vertexTextures,u={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},d="precision isWebGL2 supportsVertexTextures outputEncoding instancing map mapEncoding matcap matcapEncoding envMap envMapMode envMapEncoding envMapCubeUV lightMap lightMapEncoding aoMap emissiveMap emissiveMapEncoding bumpMap normalMap objectSpaceNormalMap tangentSpaceNormalMap clearcoatMap clearcoatRoughnessMap clearcoatNormalMap displacementMap specularMap roughnessMap metalnessMap gradientMap alphaMap combine vertexColors vertexTangents vertexUvs uvsVertexOnly fog useFog fogExp2 flatShading sizeAttenuation logarithmicDepthBuffer skinning maxBones useVertexTexture morphTargets morphNormals maxMorphTargets maxMorphNormals premultipliedAlpha numDirLights numPointLights numSpotLights numHemiLights numRectAreaLights numDirLightShadows numPointLightShadows numSpotLightShadows shadowMapEnabled shadowMapType toneMapping physicallyCorrectLights alphaTest doubleSided flipSided numClippingPlanes numClipIntersection depthPacking dithering sheen".split(" ");this.getParameters=function(n,d,p,f,m,g,y){var v=f.fog;f=n.isMeshStandardMaterial?f.environment:null,f=n.envMap||f;var _=u[n.type];if(y.isSkinnedMesh){var x=y.skeleton.bones;if(s)x=1024;else{var b=Math.min(Math.floor((c-20)/4),x.length);b<x.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+x.length+" bones. This GPU supports "+b+"."),x=0):x=b}}else x=0;null!==n.precision&&(l=i.getMaxPrecision(n.precision))!==n.precision&&console.warn("THREE.WebGLProgram.getParameters:",n.precision,"not supported, using",l,"instead."),_?(b=Es[_],b={name:n.type,uniforms:bs.clone(b.uniforms),vertexShader:b.vertexShader,fragmentShader:b.fragmentShader}):b={name:n.type,uniforms:n.uniforms,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader},n.onBeforeCompile(b,e);var w=e.getRenderTarget();return{isWebGL2:a,shaderID:_,shaderName:b.name,uniforms:b.uniforms,vertexShader:b.vertexShader,fragmentShader:b.fragmentShader,defines:n.defines,isRawShaderMaterial:n.isRawShaderMaterial,isShaderMaterial:n.isShaderMaterial,precision:l,instancing:!0===y.isInstancedMesh,supportsVertexTextures:h,outputEncoding:null!==w?r(w.texture):e.outputEncoding,map:!!n.map,mapEncoding:r(n.map),matcap:!!n.matcap,matcapEncoding:r(n.matcap),envMap:!!f,envMapMode:f&&f.mapping,envMapEncoding:r(f),envMapCubeUV:!!f&&(306===f.mapping||307===f.mapping),lightMap:!!n.lightMap,lightMapEncoding:r(n.lightMap),aoMap:!!n.aoMap,emissiveMap:!!n.emissiveMap,emissiveMapEncoding:r(n.emissiveMap),bumpMap:!!n.bumpMap,normalMap:!!n.normalMap,objectSpaceNormalMap:1===n.normalMapType,tangentSpaceNormalMap:0===n.normalMapType,clearcoatMap:!!n.clearcoatMap,clearcoatRoughnessMap:!!n.clearcoatRoughnessMap,clearcoatNormalMap:!!n.clearcoatNormalMap,displacementMap:!!n.displacementMap,roughnessMap:!!n.roughnessMap,metalnessMap:!!n.metalnessMap,specularMap:!!n.specularMap,alphaMap:!!n.alphaMap,gradientMap:!!n.gradientMap,sheen:!!n.sheen,combine:n.combine,vertexTangents:n.normalMap&&n.vertexTangents,vertexColors:n.vertexColors,vertexUvs:!!(n.map||n.bumpMap||n.normalMap||n.specularMap||n.alphaMap||n.emissiveMap||n.roughnessMap||n.metalnessMap||n.clearcoatMap||n.clearcoatRoughnessMap||n.clearcoatNormalMap||n.displacementMap),uvsVertexOnly:!(n.map||n.bumpMap||n.normalMap||n.specularMap||n.alphaMap||n.emissiveMap||n.roughnessMap||n.metalnessMap||n.clearcoatNormalMap||!n.displacementMap),fog:!!v,useFog:n.fog,fogExp2:v&&v.isFogExp2,flatShading:n.flatShading,sizeAttenuation:n.sizeAttenuation,logarithmicDepthBuffer:o,skinning:n.skinning&&0<x,maxBones:x,useVertexTexture:s,morphTargets:n.morphTargets,morphNormals:n.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:d.directional.length,numPointLights:d.point.length,numSpotLights:d.spot.length,numRectAreaLights:d.rectArea.length,numHemiLights:d.hemi.length,numDirLightShadows:d.directionalShadowMap.length,numPointLightShadows:d.pointShadowMap.length,numSpotLightShadows:d.spotShadowMap.length,numClippingPlanes:m,numClipIntersection:g,dithering:n.dithering,shadowMapEnabled:e.shadowMap.enabled&&0<p.length,shadowMapType:e.shadowMap.type,toneMapping:n.toneMapped?e.toneMapping:0,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:n.premultipliedAlpha,alphaTest:n.alphaTest,doubleSided:2===n.side,flipSided:1===n.side,depthPacking:void 0!==n.depthPacking&&n.depthPacking,index0AttributeName:n.index0AttributeName,extensionDerivatives:n.extensions&&n.extensions.derivatives,extensionFragDepth:n.extensions&&n.extensions.fragDepth,extensionDrawBuffers:n.extensions&&n.extensions.drawBuffers,extensionShaderTextureLOD:n.extensions&&n.extensions.shaderTextureLOD,rendererExtensionFragDepth:a||null!==t.get("EXT_frag_depth"),rendererExtensionDrawBuffers:a||null!==t.get("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:a||null!==t.get("EXT_shader_texture_lod"),onBeforeCompile:n.onBeforeCompile}},this.getProgramCacheKey=function(t){var i=[];if(t.shaderID?i.push(t.shaderID):(i.push(t.fragmentShader),i.push(t.vertexShader)),void 0!==t.defines)for(var r in t.defines)i.push(r),i.push(t.defines[r]);if(void 0===t.isRawShaderMaterial){for(r=0;r<d.length;r++)i.push(t[d[r]]);i.push(e.outputEncoding),i.push(e.gammaFactor)}return i.push(t.onBeforeCompile.toString()),i.join()},this.acquireProgram=function(t,i){for(var r,a=0,o=n.length;a<o;a++){var s=n[a];if(s.cacheKey===i){++(r=s).usedTimes;break}}return void 0===r&&(r=new ft(e,i,t),n.push(r)),r},this.releaseProgram=function(e){if(0==--e.usedTimes){var t=n.indexOf(e);n[t]=n[n.length-1],n.pop(),e.destroy()}},this.programs=n}function gt(){var e=new WeakMap;return{get:function(t){var i=e.get(t);return void 0===i&&(i={},e.set(t,i)),i},remove:function(t){e.delete(t)},update:function(t,i,r){e.get(t)[i]=r},dispose:function(){e=new WeakMap}}}function yt(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function vt(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function _t(){function e(e,r,n,o,s,l){var c=t[i];return void 0===c?(c={id:e.id,object:e,geometry:r,material:n,program:n.program||a,groupOrder:o,renderOrder:e.renderOrder,z:s,group:l},t[i]=c):(c.id=e.id,c.object=e,c.geometry=r,c.material=n,c.program=n.program||a,c.groupOrder=o,c.renderOrder=e.renderOrder,c.z=s,c.group=l),i++,c}var t=[],i=0,r=[],n=[],a={id:-1};return{opaque:r,transparent:n,init:function(){i=0,r.length=0,n.length=0},push:function(t,i,a,o,s,l){t=e(t,i,a,o,s,l),(!0===a.transparent?n:r).push(t)},unshift:function(t,i,a,o,s,l){t=e(t,i,a,o,s,l),(!0===a.transparent?n:r).unshift(t)},finish:function(){for(var e=i,r=t.length;e<r;e++){var n=t[e];if(null===n.id)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.program=null,n.group=null}},sort:function(e,t){1<r.length&&r.sort(e||yt),1<n.length&&n.sort(t||vt)}}}function xt(){function e(i){(i=i.target).removeEventListener("dispose",e),t.delete(i)}var t=new WeakMap;return{get:function(i,r){var n=t.get(i);if(void 0===n){var a=new _t;t.set(i,new WeakMap),t.get(i).set(r,a),i.addEventListener("dispose",e)}else void 0===(a=n.get(r))&&(a=new _t,n.set(r,a));return a},dispose:function(){t=new WeakMap}}}function bt(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];switch(t.type){case"DirectionalLight":var i={direction:new c,color:new b};break;case"SpotLight":i={position:new c,direction:new c,color:new b,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new c,color:new b,distance:0,decay:0};break;case"HemisphereLight":i={direction:new c,skyColor:new b,groundColor:new b};break;case"RectAreaLight":i={color:new b,position:new c,halfWidth:new c,halfHeight:new c}}return e[t.id]=i}}}function wt(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function Mt(){for(var e=new bt,t=function(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];switch(t.type){case"DirectionalLight":var r={shadowBias:0,shadowRadius:1,shadowMapSize:new i};break;case"SpotLight":r={shadowBias:0,shadowRadius:1,shadowMapSize:new i};break;case"PointLight":r={shadowBias:0,shadowRadius:1,shadowMapSize:new i,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=r}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},n=0;9>n;n++)r.probe.push(new c);var a=new c,o=new h,s=new h;return{setup:function(i,n,l){for(var c=0,h=0,u=0,d=0;9>d;d++)r.probe[d].set(0,0,0);var p=n=0,f=0,m=0,g=0,y=0,v=0,_=0;l=l.matrixWorldInverse,i.sort(wt),d=0;for(var x=i.length;d<x;d++){var b=i[d],w=b.color,M=b.intensity,T=b.distance,S=b.shadow&&b.shadow.map?b.shadow.map.texture:null;if(b.isAmbientLight)c+=w.r*M,h+=w.g*M,u+=w.b*M;else if(b.isLightProbe)for(S=0;9>S;S++)r.probe[S].addScaledVector(b.sh.coefficients[S],M);else if(b.isDirectionalLight){var E=e.get(b);E.color.copy(b.color).multiplyScalar(b.intensity),E.direction.setFromMatrixPosition(b.matrixWorld),a.setFromMatrixPosition(b.target.matrixWorld),E.direction.sub(a),E.direction.transformDirection(l),b.castShadow&&(M=b.shadow,(w=t.get(b)).shadowBias=M.bias,w.shadowRadius=M.radius,w.shadowMapSize=M.mapSize,r.directionalShadow[n]=w,r.directionalShadowMap[n]=S,r.directionalShadowMatrix[n]=b.shadow.matrix,y++),r.directional[n]=E,n++}else b.isSpotLight?((E=e.get(b)).position.setFromMatrixPosition(b.matrixWorld),E.position.applyMatrix4(l),E.color.copy(w).multiplyScalar(M),E.distance=T,E.direction.setFromMatrixPosition(b.matrixWorld),a.setFromMatrixPosition(b.target.matrixWorld),E.direction.sub(a),E.direction.transformDirection(l),E.coneCos=Math.cos(b.angle),E.penumbraCos=Math.cos(b.angle*(1-b.penumbra)),E.decay=b.decay,b.castShadow&&(M=b.shadow,(w=t.get(b)).shadowBias=M.bias,w.shadowRadius=M.radius,w.shadowMapSize=M.mapSize,r.spotShadow[f]=w,r.spotShadowMap[f]=S,r.spotShadowMatrix[f]=b.shadow.matrix,_++),r.spot[f]=E,f++):b.isRectAreaLight?((E=e.get(b)).color.copy(w).multiplyScalar(M),E.position.setFromMatrixPosition(b.matrixWorld),E.position.applyMatrix4(l),s.identity(),o.copy(b.matrixWorld),o.premultiply(l),s.extractRotation(o),E.halfWidth.set(.5*b.width,0,0),E.halfHeight.set(0,.5*b.height,0),E.halfWidth.applyMatrix4(s),E.halfHeight.applyMatrix4(s),r.rectArea[m]=E,m++):b.isPointLight?((E=e.get(b)).position.setFromMatrixPosition(b.matrixWorld),E.position.applyMatrix4(l),E.color.copy(b.color).multiplyScalar(b.intensity),E.distance=b.distance,E.decay=b.decay,b.castShadow&&(M=b.shadow,(w=t.get(b)).shadowBias=M.bias,w.shadowRadius=M.radius,w.shadowMapSize=M.mapSize,w.shadowCameraNear=M.camera.near,w.shadowCameraFar=M.camera.far,r.pointShadow[p]=w,r.pointShadowMap[p]=S,r.pointShadowMatrix[p]=b.shadow.matrix,v++),r.point[p]=E,p++):b.isHemisphereLight&&((E=e.get(b)).direction.setFromMatrixPosition(b.matrixWorld),E.direction.transformDirection(l),E.direction.normalize(),E.skyColor.copy(b.color).multiplyScalar(M),E.groundColor.copy(b.groundColor).multiplyScalar(M),r.hemi[g]=E,g++)}r.ambient[0]=c,r.ambient[1]=h,r.ambient[2]=u,(i=r.hash).directionalLength===n&&i.pointLength===p&&i.spotLength===f&&i.rectAreaLength===m&&i.hemiLength===g&&i.numDirectionalShadows===y&&i.numPointShadows===v&&i.numSpotShadows===_||(r.directional.length=n,r.spot.length=f,r.rectArea.length=m,r.point.length=p,r.hemi.length=g,r.directionalShadow.length=y,r.directionalShadowMap.length=y,r.pointShadow.length=v,r.pointShadowMap.length=v,r.spotShadow.length=_,r.spotShadowMap.length=_,r.directionalShadowMatrix.length=y,r.pointShadowMatrix.length=v,r.spotShadowMatrix.length=_,i.directionalLength=n,i.pointLength=p,i.spotLength=f,i.rectAreaLength=m,i.hemiLength=g,i.numDirectionalShadows=y,i.numPointShadows=v,i.numSpotShadows=_,r.version=js++)},state:r}}function Tt(){var e=new Mt,t=[],i=[];return{init:function(){t.length=0,i.length=0},state:{lightsArray:t,shadowsArray:i,lights:e},setupLights:function(r){e.setup(t,i,r)},pushLight:function(e){t.push(e)},pushShadow:function(e){i.push(e)}}}function St(){function e(i){(i=i.target).removeEventListener("dispose",e),t.delete(i)}var t=new WeakMap;return{get:function(i,r){if(!1===t.has(i)){var n=new Tt;t.set(i,new WeakMap),t.get(i).set(r,n),i.addEventListener("dispose",e)}else!1===t.get(i).has(r)?(n=new Tt,t.get(i).set(r,n)):n=t.get(i).get(r);return n},dispose:function(){t=new WeakMap}}}function Et(e){E.call(this),this.type="MeshDepthMaterial",this.depthPacking=3200,this.morphTargets=this.skinning=!1,this.displacementMap=this.alphaMap=this.map=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}function At(e){E.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new c,this.nearDistance=1,this.farDistance=1e3,this.morphTargets=this.skinning=!1,this.displacementMap=this.alphaMap=this.map=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}function Ct(e,t,r){function n(e,t,i){var r=f[i=e<<0|t<<1|i<<2];return void 0===r&&(r=new Et({depthPacking:3201,morphTargets:e,skinning:t}),f[i]=r),r}function s(e,t,i){var r=m[i=e<<0|t<<1|i<<2];return void 0===r&&(r=new At({morphTargets:e,skinning:t}),m[i]=r),r}function l(t,i,r,a,o,l,c){var h=n,u=t.customDepthMaterial;return!0===a.isPointLight&&(h=s,u=t.customDistanceMaterial),void 0===u?(u=!1,!0===r.morphTargets&&(u=i.morphAttributes&&i.morphAttributes.position&&0<i.morphAttributes.position.length),i=!1,!0===t.isSkinnedMesh&&(!0===r.skinning?i=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t)),t=h(u,i,!0===t.isInstancedMesh)):t=u,e.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length&&(u=t.uuid,h=r.uuid,void 0===(i=g[u])&&(i={},g[u]=i),void 0===(u=i[h])&&(u=t.clone(),i[h]=u),t=u),t.visible=r.visible,t.wireframe=r.wireframe,t.side=3===c?null!==r.shadowSide?r.shadowSide:r.side:null!==r.shadowSide?r.shadowSide:y[r.side],t.clipShadows=r.clipShadows,t.clippingPlanes=r.clippingPlanes,t.clipIntersection=r.clipIntersection,t.wireframeLinewidth=r.wireframeLinewidth,t.linewidth=r.linewidth,!0===a.isPointLight&&!0===t.isMeshDistanceMaterial&&(t.referencePosition.setFromMatrixPosition(a.matrixWorld),t.nearDistance=o,t.farDistance=l),t}function c(i,r,n,a,o){if(!1!==i.visible){if(i.layers.test(r.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&3===o)&&(!i.frustumCulled||h.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,i.matrixWorld);var s=t.update(i),u=i.material;if(Array.isArray(u))for(var d=s.groups,p=0,f=d.length;p<f;p++){var m=d[p],g=u[m.materialIndex];g&&g.visible&&(g=l(i,s,g,a,n.near,n.far,o),e.renderBufferDirect(n,null,s,g,i,m))}else u.visible&&(g=l(i,s,u,a,n.near,n.far,o),e.renderBufferDirect(n,null,s,g,i,null))}for(s=0,u=(i=i.children).length;s<u;s++)c(i[s],r,n,a,o)}}var h=new Q,u=new i,d=new i,p=new a,f=[],m=[],g={},y={0:1,1:0,2:2},v=new Z({defines:{SAMPLE_RATE:.25,HALF_SAMPLE_RATE:.125},uniforms:{shadow_pass:{value:null},resolution:{value:new i},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n  float mean = 0.0;\n  float squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );\n  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n    #ifdef HORIZONAL_PASS\n      vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n      mean += distribution.x;\n      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n    #else\n      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );\n      mean += depth;\n      squared_mean += depth * depth;\n    #endif\n  }\n  mean = mean * HALF_SAMPLE_RATE;\n  squared_mean = squared_mean * HALF_SAMPLE_RATE;\n  float std_dev = sqrt( squared_mean - mean * mean );\n  gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),_=v.clone();_.defines.HORIZONAL_PASS=1;var x=new U;x.setAttribute("position",new C(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var b=new j(x,v),w=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(i,n,a){if(!1!==w.enabled&&(!1!==w.autoUpdate||!1!==w.needsUpdate)&&0!==i.length){var s=e.getRenderTarget(),l=e.getActiveCubeFace(),f=e.getActiveMipmapLevel(),m=e.state;m.setBlending(0),m.buffers.color.setClear(1,1,1,1),m.buffers.depth.setTest(!0),m.setScissorTest(!1);for(var g=0,y=i.length;g<y;g++){var x=i[g],M=x.shadow;if(void 0===M)console.warn("THREE.WebGLShadowMap:",x,"has no shadow.");else{u.copy(M.mapSize);var T=M.getFrameExtents();u.multiply(T),d.copy(M.mapSize),(u.x>r||u.y>r)&&(u.x>r&&(d.x=Math.floor(r/T.x),u.x=d.x*T.x,M.mapSize.x=d.x),u.y>r&&(d.y=Math.floor(r/T.y),u.y=d.y*T.y,M.mapSize.y=d.y)),null!==M.map||M.isPointLightShadow||3!==this.type||(T={minFilter:1006,magFilter:1006,format:1023},M.map=new o(u.x,u.y,T),M.map.texture.name=x.name+".shadowMap",M.mapPass=new o(u.x,u.y,T),M.camera.updateProjectionMatrix()),null===M.map&&(T={minFilter:1003,magFilter:1003,format:1023},M.map=new o(u.x,u.y,T),M.map.texture.name=x.name+".shadowMap",M.camera.updateProjectionMatrix()),e.setRenderTarget(M.map),e.clear(),T=M.getViewportCount();for(var S=0;S<T;S++){var E=M.getViewport(S);p.set(d.x*E.x,d.y*E.y,d.x*E.z,d.y*E.w),m.viewport(p),M.updateMatrices(x,S),h=M.getFrustum(),c(n,a,M.camera,x,this.type)}M.isPointLightShadow||3!==this.type||(x=M,M=a,T=t.update(b),v.uniforms.shadow_pass.value=x.map.texture,v.uniforms.resolution.value=x.mapSize,v.uniforms.radius.value=x.radius,e.setRenderTarget(x.mapPass),e.clear(),e.renderBufferDirect(M,null,T,v,b,null),_.uniforms.shadow_pass.value=x.mapPass.texture,_.uniforms.resolution.value=x.mapSize,_.uniforms.radius.value=x.radius,e.setRenderTarget(x.map),e.clear(),e.renderBufferDirect(M,null,T,_,b,null))}}w.needsUpdate=!1,e.setRenderTarget(s,l,f)}}}function Lt(e,t,i){function r(t,i,r){var n=new Uint8Array(4),a=e.createTexture();for(e.bindTexture(t,a),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728),t=0;t<r;t++)e.texImage2D(i+t,0,6408,1,1,0,6408,5121,n);return a}function n(i,r){y[i]=1,0===v[i]&&(e.enableVertexAttribArray(i),v[i]=1),_[i]!==r&&((p?e:t.get("ANGLE_instanced_arrays"))[p?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,r),_[i]=r)}function o(t){!0!==x[t]&&(e.enable(t),x[t]=!0)}function s(t){!1!==x[t]&&(e.disable(t),x[t]=!1)}function l(t,i,r,n,a,l,c,h){if(0===t)w&&(s(3042),w=!1);else if(w||(o(3042),w=!0),5!==t){if(t!==M||h!==P){if(100===T&&100===A||(e.blendEquation(32774),A=T=100),h)switch(t){case 1:e.blendFuncSeparate(1,771,1,771);break;case 2:e.blendFunc(1,1);break;case 3:e.blendFuncSeparate(0,0,769,771);break;case 4:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(770,771,1,771);break;case 2:e.blendFunc(770,1);break;case 3:e.blendFunc(0,769);break;case 4:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}L=C=E=S=null,M=t,P=h}}else a=a||i,l=l||r,c=c||n,i===T&&a===A||(e.blendEquationSeparate(G[i],G[a]),T=i,A=a),r===S&&n===E&&l===C&&c===L||(e.blendFuncSeparate(H[r],H[n],H[l],H[c]),S=r,E=n,C=l,L=c),M=t,P=null}function c(t){I!==t&&(t?e.frontFace(2304):e.frontFace(2305),I=t)}function h(t){0!==t?(o(2884),t!==R&&(1===t?e.cullFace(1029):2===t?e.cullFace(1028):e.cullFace(1032))):s(2884),R=t}function u(t,i,r){t?(o(32823),(k!==i||z!==r)&&(e.polygonOffset(i,r),k=i,z=r)):s(32823)}function d(t){void 0===t&&(t=33984+O-1),F!==t&&(e.activeTexture(t),F=t)}var p=i.isWebGL2,f=new function(){var t=!1,i=new a,r=null,n=new a(0,0,0,0);return{setMask:function(i){r===i||t||(e.colorMask(i,i,i,i),r=i)},setLocked:function(e){t=e},setClear:function(t,r,a,o,s){!0===s&&(t*=o,r*=o,a*=o),i.set(t,r,a,o),!1===n.equals(i)&&(e.clearColor(t,r,a,o),n.copy(i))},reset:function(){t=!1,r=null,n.set(-1,0,0,0)}}},m=new function(){var t=!1,i=null,r=null,n=null;return{setTest:function(e){e?o(2929):s(2929)},setMask:function(r){i===r||t||(e.depthMask(r),i=r)},setFunc:function(t){if(r!==t){if(t)switch(t){case 0:e.depthFunc(512);break;case 1:e.depthFunc(519);break;case 2:e.depthFunc(513);break;case 3:e.depthFunc(515);break;case 4:e.depthFunc(514);break;case 5:e.depthFunc(518);break;case 6:e.depthFunc(516);break;case 7:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);r=t}},setLocked:function(e){t=e},setClear:function(t){n!==t&&(e.clearDepth(t),n=t)},reset:function(){t=!1,n=r=i=null}}},g=new function(){var t=!1,i=null,r=null,n=null,a=null,l=null,c=null,h=null,u=null;return{setTest:function(e){t||(e?o(2960):s(2960))},setMask:function(r){i===r||t||(e.stencilMask(r),i=r)},setFunc:function(t,i,o){r===t&&n===i&&a===o||(e.stencilFunc(t,i,o),r=t,n=i,a=o)},setOp:function(t,i,r){l===t&&c===i&&h===r||(e.stencilOp(t,i,r),l=t,c=i,h=r)},setLocked:function(e){t=e},setClear:function(t){u!==t&&(e.clearStencil(t),u=t)},reset:function(){t=!1,u=h=c=l=a=n=r=i=null}}};i=e.getParameter(34921);var y=new Uint8Array(i),v=new Uint8Array(i),_=new Uint8Array(i),x={},b=null,w=null,M=null,T=null,S=null,E=null,A=null,C=null,L=null,P=!1,I=null,R=null,D=null,k=null,z=null,O=e.getParameter(35661),B=!1;i=0,-1!==(i=e.getParameter(7938)).indexOf("WebGL")?(i=parseFloat(/^WebGL ([0-9])/.exec(i)[1]),B=1<=i):-1!==i.indexOf("OpenGL ES")&&(i=parseFloat(/^OpenGL ES ([0-9])/.exec(i)[1]),B=2<=i);var F=null,N={},U=new a,j=new a,V={};V[3553]=r(3553,3553,1),V[34067]=r(34067,34069,6),f.setClear(0,0,0,1),m.setClear(1),g.setClear(0),o(2929),m.setFunc(3),c(!1),h(1),o(2884),l(0);var G={100:32774,101:32778,102:32779};p?(G[103]=32775,G[104]=32776):null!==(i=t.get("EXT_blend_minmax"))&&(G[103]=i.MIN_EXT,G[104]=i.MAX_EXT);var H={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};return{buffers:{color:f,depth:m,stencil:g},initAttributes:function(){for(var e=0,t=y.length;e<t;e++)y[e]=0},enableAttribute:function(e){n(e,0)},enableAttributeAndDivisor:n,disableUnusedAttributes:function(){for(var t=0,i=v.length;t!==i;++t)v[t]!==y[t]&&(e.disableVertexAttribArray(t),v[t]=0)},vertexAttribPointer:function(t,i,r,n,a,o){!0!==p||5124!==r&&5125!==r?e.vertexAttribPointer(t,i,r,n,a,o):e.vertexAttribIPointer(t,i,r,n,a,o)},enable:o,disable:s,useProgram:function(t){return b!==t&&(e.useProgram(t),b=t,!0)},setBlending:l,setMaterial:function(e,t){2===e.side?s(2884):o(2884);var i=1===e.side;t&&(i=!i),c(i),1===e.blending&&!1===e.transparent?l(0):l(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),m.setFunc(e.depthFunc),m.setTest(e.depthTest),m.setMask(e.depthWrite),f.setMask(e.colorWrite),t=e.stencilWrite,g.setTest(t),t&&(g.setMask(e.stencilWriteMask),g.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),g.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),u(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:c,setCullFace:h,setLineWidth:function(t){t!==D&&(B&&e.lineWidth(t),D=t)},setPolygonOffset:u,setScissorTest:function(e){e?o(3089):s(3089)},activeTexture:d,bindTexture:function(t,i){null===F&&d();var r=N[F];void 0===r&&(r={type:void 0,texture:void 0},N[F]=r),r.type===t&&r.texture===i||(e.bindTexture(t,i||V[t]),r.type=t,r.texture=i)},unbindTexture:function(){var t=N[F];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===U.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),U.copy(t))},viewport:function(t){!1===j.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),j.copy(t))},reset:function(){for(var t=0;t<v.length;t++)1===v[t]&&(e.disableVertexAttribArray(t),v[t]=0);x={},F=null,N={},R=I=M=b=null,f.reset(),m.reset(),g.reset()}}}function Pt(e,t,i,r,n,a,o){function s(e,t){return R?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function l(e,t,i,r){var n=1;if((e.width>r||e.height>r)&&(n=r/Math.max(e.width,e.height)),1>n||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap)return t=(r=t?Ia.floorPowerOfTwo:Math.floor)(n*e.width),n=r(n*e.height),void 0===S&&(S=s(t,n)),(i=i?s(t,n):S).width=t,i.height=n,i.getContext("2d").drawImage(e,0,0,t,n),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+t+"x"+n+")."),i;"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+").")}return e}function c(e){return Ia.isPowerOfTwo(e.width)&&Ia.isPowerOfTwo(e.height)}function h(e,t){return e.generateMipmaps&&t&&1003!==e.minFilter&&1006!==e.minFilter}function u(t,i,n,a){e.generateMipmap(t),r.get(i).__maxMipLevel=Math.log(Math.max(n,a))*Math.LOG2E}function d(i,r,n){if(!1===E)return r;if(null!==i){if(void 0!==e[i])return e[i];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+i+"'")}return i=r,6403===r&&(5126===n&&(i=33326),5131===n&&(i=33325),5121===n&&(i=33321)),6407===r&&(5126===n&&(i=34837),5131===n&&(i=34843),5121===n&&(i=32849)),6408===r&&(5126===n&&(i=34836),5131===n&&(i=34842),5121===n&&(i=32856)),33325!==i&&33326!==i&&34842!==i&&34836!==i||t.get("EXT_color_buffer_float"),i}function p(e){return 1003===e||1004===e||1005===e?9728:9729}function f(t){(t=t.target).removeEventListener("dispose",f);var i=r.get(t);void 0!==i.__webglInit&&(e.deleteTexture(i.__webglTexture),r.remove(t)),t.isVideoTexture&&I.delete(t),o.memory.textures--}function m(t){(t=t.target).removeEventListener("dispose",m);var i=r.get(t),n=r.get(t.texture);if(t){if(void 0!==n.__webglTexture&&e.deleteTexture(n.__webglTexture),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(n=0;6>n;n++)e.deleteFramebuffer(i.__webglFramebuffer[n]),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer[n]);else e.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer),i.__webglMultisampledFramebuffer&&e.deleteFramebuffer(i.__webglMultisampledFramebuffer),i.__webglColorRenderbuffer&&e.deleteRenderbuffer(i.__webglColorRenderbuffer),i.__webglDepthRenderbuffer&&e.deleteRenderbuffer(i.__webglDepthRenderbuffer);r.remove(t.texture),r.remove(t)}o.memory.textures--}function g(e,t){var n=r.get(e);if(e.isVideoTexture){var a=o.render.frame;I.get(e)!==a&&(I.set(e,a),e.update())}if(0<e.version&&n.__version!==e.version)if(void 0===(a=e.image))console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==a.complete)return void b(n,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}i.activeTexture(33984+t),i.bindTexture(3553,n.__webglTexture)}function y(t,n){if(6===t.image.length){var o=r.get(t);if(0<t.version&&o.__version!==t.version){x(o,t),i.activeTexture(33984+n),i.bindTexture(34067,o.__webglTexture),e.pixelStorei(37440,t.flipY);var s=t&&(t.isCompressedTexture||t.image[0].isCompressedTexture);n=t.image[0]&&t.image[0].isDataTexture;for(var p=[],f=0;6>f;f++)p[f]=s||n?n?t.image[f].image:t.image[f]:l(t.image[f],!1,!0,C);var m=p[0],g=c(m)||E,y=a.convert(t.format),v=a.convert(t.type),b=d(t.internalFormat,y,v);if(_(34067,t,g),s){for(f=0;6>f;f++){var w=p[f].mipmaps;for(s=0;s<w.length;s++){var M=w[s];1023!==t.format&&1022!==t.format?null!==y?i.compressedTexImage2D(34069+f,s,b,M.width,M.height,0,M.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):i.texImage2D(34069+f,s,b,M.width,M.height,0,y,v,M.data)}}o.__maxMipLevel=w.length-1}else{for(w=t.mipmaps,f=0;6>f;f++)if(n)for(i.texImage2D(34069+f,0,b,p[f].width,p[f].height,0,y,v,p[f].data),s=0;s<w.length;s++)M=(M=w[s]).image[f].image,i.texImage2D(34069+f,s+1,b,M.width,M.height,0,y,v,M.data);else for(i.texImage2D(34069+f,0,b,y,v,p[f]),s=0;s<w.length;s++)M=w[s],i.texImage2D(34069+f,s+1,b,y,v,M.image[f]);o.__maxMipLevel=w.length}h(t,g)&&u(34067,t,m.width,m.height),o.__version=t.version,t.onUpdate&&t.onUpdate(t)}else i.activeTexture(33984+n),i.bindTexture(34067,o.__webglTexture)}}function v(e,t){i.activeTexture(33984+t),i.bindTexture(34067,r.get(e).__webglTexture)}function _(i,a,o){o?(e.texParameteri(i,10242,k[a.wrapS]),e.texParameteri(i,10243,k[a.wrapT]),32879!==i&&35866!==i||e.texParameteri(i,32882,k[a.wrapR]),e.texParameteri(i,10240,z[a.magFilter]),e.texParameteri(i,10241,z[a.minFilter])):(e.texParameteri(i,10242,33071),e.texParameteri(i,10243,33071),32879!==i&&35866!==i||e.texParameteri(i,32882,33071),1001===a.wrapS&&1001===a.wrapT||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(i,10240,p(a.magFilter)),e.texParameteri(i,10241,p(a.minFilter)),1003!==a.minFilter&&1006!==a.minFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!(o=t.get("EXT_texture_filter_anisotropic"))||1015===a.type&&null===t.get("OES_texture_float_linear")||1016===a.type&&null===(E||t.get("OES_texture_half_float_linear"))||!(1<a.anisotropy||r.get(a).__currentAnisotropy)||(e.texParameterf(i,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,n.getMaxAnisotropy())),r.get(a).__currentAnisotropy=a.anisotropy)}function x(t,i){void 0===t.__webglInit&&(t.__webglInit=!0,i.addEventListener("dispose",f),t.__webglTexture=e.createTexture(),o.memory.textures++)}function b(t,r,n){var o=3553;r.isDataTexture2DArray&&(o=35866),r.isDataTexture3D&&(o=32879),x(t,r),i.activeTexture(33984+n),i.bindTexture(o,t.__webglTexture),e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment),n=(n=!E&&(1001!==r.wrapS||1001!==r.wrapT||1003!==r.minFilter&&1006!==r.minFilter))&&!1===c(r.image);var s=c(n=l(r.image,n,!1,L))||E,p=a.convert(r.format),f=a.convert(r.type),m=d(r.internalFormat,p,f);_(o,r,s);var g=r.mipmaps;if(r.isDepthTexture)m=6402,E?m=1015===r.type?36012:1014===r.type?33190:1020===r.type?35056:33189:1015===r.type&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),1026===r.format&&6402===m&&1012!==r.type&&1014!==r.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=1012,f=a.convert(r.type)),1027===r.format&&6402===m&&(m=34041,1020!==r.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=1020,f=a.convert(r.type))),i.texImage2D(3553,0,m,n.width,n.height,0,p,f,null);else if(r.isDataTexture)if(0<g.length&&s){for(var y=0,v=g.length;y<v;y++){var b=g[y];i.texImage2D(3553,y,m,b.width,b.height,0,p,f,b.data)}r.generateMipmaps=!1,t.__maxMipLevel=g.length-1}else i.texImage2D(3553,0,m,n.width,n.height,0,p,f,n.data),t.__maxMipLevel=0;else if(r.isCompressedTexture){for(y=0,v=g.length;y<v;y++)b=g[y],1023!==r.format&&1022!==r.format?null!==p?i.compressedTexImage2D(3553,y,m,b.width,b.height,0,b.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):i.texImage2D(3553,y,m,b.width,b.height,0,p,f,b.data);t.__maxMipLevel=g.length-1}else if(r.isDataTexture2DArray)i.texImage3D(35866,0,m,n.width,n.height,n.depth,0,p,f,n.data),t.__maxMipLevel=0;else if(r.isDataTexture3D)i.texImage3D(32879,0,m,n.width,n.height,n.depth,0,p,f,n.data),t.__maxMipLevel=0;else if(0<g.length&&s){for(y=0,v=g.length;y<v;y++)b=g[y],i.texImage2D(3553,y,m,p,f,b);r.generateMipmaps=!1,t.__maxMipLevel=g.length-1}else i.texImage2D(3553,0,m,p,f,n),t.__maxMipLevel=0;h(r,s)&&u(o,r,n.width,n.height),t.__version=r.version,r.onUpdate&&r.onUpdate(r)}function w(t,n,o,s){var l=a.convert(n.texture.format),c=a.convert(n.texture.type),h=d(n.texture.internalFormat,l,c);i.texImage2D(s,0,h,n.width,n.height,0,l,c,null),e.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,o,s,r.get(n.texture).__webglTexture,0),e.bindFramebuffer(36160,null)}function M(t,i,r){if(e.bindRenderbuffer(36161,t),i.depthBuffer&&!i.stencilBuffer){var n=33189;r?((r=i.depthTexture)&&r.isDepthTexture&&(1015===r.type?n=36012:1014===r.type&&(n=33190)),r=T(i),e.renderbufferStorageMultisample(36161,r,n,i.width,i.height)):e.renderbufferStorage(36161,n,i.width,i.height),e.framebufferRenderbuffer(36160,36096,36161,t)}else i.depthBuffer&&i.stencilBuffer?(r?(r=T(i),e.renderbufferStorageMultisample(36161,r,35056,i.width,i.height)):e.renderbufferStorage(36161,34041,i.width,i.height),e.framebufferRenderbuffer(36160,33306,36161,t)):(t=a.convert(i.texture.format),n=a.convert(i.texture.type),n=d(i.texture.internalFormat,t,n),r?(r=T(i),e.renderbufferStorageMultisample(36161,r,n,i.width,i.height)):e.renderbufferStorage(36161,n,i.width,i.height));e.bindRenderbuffer(36161,null)}function T(e){return E&&e.isWebGLMultisampleRenderTarget?Math.min(P,e.samples):0}var S,E=n.isWebGL2,A=n.maxTextures,C=n.maxCubemapSize,L=n.maxTextureSize,P=n.maxSamples,I=new WeakMap,R=!1;try{R="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}var D=0,k={1e3:10497,1001:33071,1002:33648},z={1003:9728,1004:9984,1005:9986,1006:9729,1007:9985,1008:9987},O=!1,B=!1;this.allocateTextureUnit=function(){var e=D;return e>=A&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+A),D+=1,e},this.resetTextureUnits=function(){D=0},this.setTexture2D=g,this.setTexture2DArray=function(e,t){var n=r.get(e);0<e.version&&n.__version!==e.version?b(n,e,t):(i.activeTexture(33984+t),i.bindTexture(35866,n.__webglTexture))},this.setTexture3D=function(e,t){var n=r.get(e);0<e.version&&n.__version!==e.version?b(n,e,t):(i.activeTexture(33984+t),i.bindTexture(32879,n.__webglTexture))},this.setTextureCube=y,this.setTextureCubeDynamic=v,this.setupRenderTarget=function(t){var n=r.get(t),s=r.get(t.texture);t.addEventListener("dispose",m),s.__webglTexture=e.createTexture(),o.memory.textures++;var l=!0===t.isWebGLCubeRenderTarget,p=!0===t.isWebGLMultisampleRenderTarget,f=c(t)||E;if(!E||1022!==t.texture.format||1015!==t.texture.type&&1016!==t.texture.type||(t.texture.format=1023,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),l)for(n.__webglFramebuffer=[],p=0;6>p;p++)n.__webglFramebuffer[p]=e.createFramebuffer();else if(n.__webglFramebuffer=e.createFramebuffer(),p)if(E){n.__webglMultisampledFramebuffer=e.createFramebuffer(),n.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,n.__webglColorRenderbuffer),p=a.convert(t.texture.format);var y=a.convert(t.texture.type);p=d(t.texture.internalFormat,p,y),y=T(t),e.renderbufferStorageMultisample(36161,y,p,t.width,t.height),e.bindFramebuffer(36160,n.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,n.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(n.__webglDepthRenderbuffer=e.createRenderbuffer(),M(n.__webglDepthRenderbuffer,t,!0)),e.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(l){for(i.bindTexture(34067,s.__webglTexture),_(34067,t.texture,f),p=0;6>p;p++)w(n.__webglFramebuffer[p],t,36064,34069+p);h(t.texture,f)&&u(34067,t.texture,t.width,t.height),i.bindTexture(34067,null)}else i.bindTexture(3553,s.__webglTexture),_(3553,t.texture,f),w(n.__webglFramebuffer,t,36064,3553),h(t.texture,f)&&u(3553,t.texture,t.width,t.height),i.bindTexture(3553,null);if(t.depthBuffer){if(n=r.get(t),s=!0===t.isWebGLCubeRenderTarget,t.depthTexture){if(s)throw Error("target.depthTexture not supported in Cube render targets");if(t&&t.isWebGLCubeRenderTarget)throw Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,n.__webglFramebuffer),!t.depthTexture||!t.depthTexture.isDepthTexture)throw Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");if(r.get(t.depthTexture).__webglTexture&&t.depthTexture.image.width===t.width&&t.depthTexture.image.height===t.height||(t.depthTexture.image.width=t.width,t.depthTexture.image.height=t.height,t.depthTexture.needsUpdate=!0),g(t.depthTexture,0),n=r.get(t.depthTexture).__webglTexture,1026===t.depthTexture.format)e.framebufferTexture2D(36160,36096,3553,n,0);else{if(1027!==t.depthTexture.format)throw Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,n,0)}}else if(s)for(n.__webglDepthbuffer=[],s=0;6>s;s++)e.bindFramebuffer(36160,n.__webglFramebuffer[s]),n.__webglDepthbuffer[s]=e.createRenderbuffer(),M(n.__webglDepthbuffer[s],t,!1);else e.bindFramebuffer(36160,n.__webglFramebuffer),n.__webglDepthbuffer=e.createRenderbuffer(),M(n.__webglDepthbuffer,t,!1);e.bindFramebuffer(36160,null)}},this.updateRenderTargetMipmap=function(e){var t=e.texture,n=c(e)||E;if(h(t,n)){n=e.isWebGLCubeRenderTarget?34067:3553;var a=r.get(t).__webglTexture;i.bindTexture(n,a),u(n,t,e.width,e.height),i.bindTexture(n,null)}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(E){var i=r.get(t);e.bindFramebuffer(36008,i.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,i.__webglFramebuffer);var n=t.width,a=t.height,o=16384;t.depthBuffer&&(o|=256),t.stencilBuffer&&(o|=1024),e.blitFramebuffer(0,0,n,a,0,0,n,a,o,9728),e.bindFramebuffer(36160,i.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===O&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),O=!0),e=e.texture),g(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===B&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),B=!0),e=e.texture),e&&e.isCubeTexture||Array.isArray(e.image)&&6===e.image.length?y(e,t):v(e,t)}}function It(e,t,i){var r=i.isWebGL2;return{convert:function(e){if(1009===e)return 5121;if(1017===e)return 32819;if(1018===e)return 32820;if(1019===e)return 33635;if(1010===e)return 5120;if(1011===e)return 5122;if(1012===e)return 5123;if(1013===e)return 5124;if(1014===e)return 5125;if(1015===e)return 5126;if(1016===e){if(r)return 5131;var i=t.get("OES_texture_half_float");return null!==i?i.HALF_FLOAT_OES:null}if(1021===e)return 6406;if(1022===e)return 6407;if(1023===e)return 6408;if(1024===e)return 6409;if(1025===e)return 6410;if(1026===e)return 6402;if(1027===e)return 34041;if(1028===e)return 6403;if(1029===e)return 36244;if(1030===e)return 33319;if(1031===e)return 33320;if(1032===e)return 36248;if(1033===e)return 36249;if(33776===e||33777===e||33778===e||33779===e){if(null===(i=t.get("WEBGL_compressed_texture_s3tc")))return null;if(33776===e)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===e)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===e)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===e)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===e||35841===e||35842===e||35843===e){if(null===(i=t.get("WEBGL_compressed_texture_pvrtc")))return null;if(35840===e)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===e)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===e)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===e)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===e)return null!==(i=t.get("WEBGL_compressed_texture_etc1"))?i.COMPRESSED_RGB_ETC1_WEBGL:null;if((37492===e||37496===e)&&null!==(i=t.get("WEBGL_compressed_texture_etc"))){if(37492===e)return i.COMPRESSED_RGB8_ETC2;if(37496===e)return i.COMPRESSED_RGBA8_ETC2_EAC}return 37808===e||37809===e||37810===e||37811===e||37812===e||37813===e||37814===e||37815===e||37816===e||37817===e||37818===e||37819===e||37820===e||37821===e||37840===e||37841===e||37842===e||37843===e||37844===e||37845===e||37846===e||37847===e||37848===e||37849===e||37850===e||37851===e||37852===e||37853===e?null!==(i=t.get("WEBGL_compressed_texture_astc"))?e:null:36492===e?null!==(i=t.get("EXT_texture_compression_bptc"))?e:null:1020===e?r?34042:null!==(i=t.get("WEBGL_depth_texture"))?i.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}function Rt(e){$.call(this),this.cameras=e||[]}function Dt(){p.call(this),this.type="Group"}function kt(){this._grip=this._targetRay=null}function zt(e,t){function i(e){var t=g.get(e.inputSource);t&&t.dispatchEvent({type:e.type})}function r(){g.forEach((function(e,t){e.disconnect(t)})),g.clear(),e.setFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),E.stop(),l.isPresenting=!1,l.dispatchEvent({type:"sessionend"})}function n(e){d=e,E.setContext(h),E.start(),l.isPresenting=!0,l.dispatchEvent({type:"sessionstart"})}function o(e){for(var t=h.inputSources,i=0;i<m.length;i++)g.set(t[i],m[i]);for(i=0;i<e.removed.length;i++){t=e.removed[i];var r=g.get(t);r&&(r.dispatchEvent({type:"disconnected",data:t}),g.delete(t))}for(i=0;i<e.added.length;i++)t=e.added[i],(r=g.get(t))&&r.dispatchEvent({type:"connected",data:t})}function s(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.getInverse(e.matrixWorld)}var l=this,h=null,u=1,d=null,p="local-floor",f=null,m=[],g=new Map,y=new $;y.layers.enable(1),y.viewport=new a;var v=new $;v.layers.enable(2),v.viewport=new a;var _=[y,v],x=new Rt;x.layers.enable(1),x.layers.enable(2);var b=null,w=null;this.isPresenting=this.enabled=!1,this.getController=function(e){var t=m[e];return void 0===t&&(t=new kt,m[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){var t=m[e];return void 0===t&&(t=new kt,m[e]=t),t.getGripSpace()},this.setFramebufferScaleFactor=function(e){u=e,!0===l.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){p=e,!0===l.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return d},this.getSession=function(){return h},this.setSession=function(e){null!==(h=e)&&(h.addEventListener("select",i),h.addEventListener("selectstart",i),h.addEventListener("selectend",i),h.addEventListener("squeeze",i),h.addEventListener("squeezestart",i),h.addEventListener("squeezeend",i),h.addEventListener("end",r),!0!==(e=t.getContextAttributes()).xrCompatible&&t.makeXRCompatible(),e=new XRWebGLLayer(h,t,{antialias:e.antialias,alpha:e.alpha,depth:e.depth,stencil:e.stencil,framebufferScaleFactor:u}),h.updateRenderState({baseLayer:e}),h.requestReferenceSpace(p).then(n),h.addEventListener("inputsourceschange",o))};var M=new c,T=new c;this.getCamera=function(e){x.near=v.near=y.near=e.near,x.far=v.far=y.far=e.far,b===x.near&&w===x.far||(h.updateRenderState({depthNear:x.near,depthFar:x.far}),b=x.near,w=x.far);var t=e.parent,i=x.cameras;s(x,t);for(var r=0;r<i.length;r++)s(i[r],t);for(e.matrixWorld.copy(x.matrixWorld),r=0,t=(e=e.children).length;r<t;r++)e[r].updateMatrixWorld(!0);if(2===i.length){M.setFromMatrixPosition(y.matrixWorld),T.setFromMatrixPosition(v.matrixWorld),i=M.distanceTo(T);var n=y.projectionMatrix.elements,a=v.projectionMatrix.elements,o=n[14]/(n[10]-1);r=n[14]/(n[10]+1),e=(n[9]+1)/n[5],t=(n[9]-1)/n[5];var l=(n[8]-1)/n[0],c=(a[8]+1)/a[0];a=o*l,n=o*c,l=(c=i/(-l+c))*-l,y.matrixWorld.decompose(x.position,x.quaternion,x.scale),x.translateX(l),x.translateZ(c),x.matrixWorld.compose(x.position,x.quaternion,x.scale),x.matrixWorldInverse.getInverse(x.matrixWorld),o+=c,c=r+c,x.projectionMatrix.makePerspective(a-l,n+(i-l),e*r/c*o,t*r/c*o,o,c)}else x.projectionMatrix.copy(y.projectionMatrix);return x};var S=null,E=new ee;E.setAnimationLoop((function(t,i){if(null!==(f=i.getViewerPose(d))){var r=f.views,n=h.renderState.baseLayer;e.setFramebuffer(n.framebuffer);var a=!1;r.length!==x.cameras.length&&(x.cameras.length=0,a=!0);for(var o=0;o<r.length;o++){var s=r[o],l=n.getViewport(s),c=_[o];c.matrix.fromArray(s.transform.matrix),c.projectionMatrix.fromArray(s.projectionMatrix),c.viewport.set(l.x,l.y,l.width,l.height),0===o&&x.matrix.copy(c.matrix),!0===a&&x.cameras.push(c)}}for(r=h.inputSources,o=0;o<m.length;o++)m[o].update(r[o],i,d);S&&S(t,i)})),this.setAnimationLoop=function(e){S=e},this.dispose=function(){}}function Ot(e){function t(t,i,r){if(t.opacity.value=i.opacity,i.color&&t.diffuse.value.copy(i.color),i.emissive&&t.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(t.map.value=i.map),i.alphaMap&&(t.alphaMap.value=i.alphaMap),i.specularMap&&(t.specularMap.value=i.specularMap),(r=i.envMap||r)&&(t.envMap.value=r,t.flipEnvMap.value=r.isCubeTexture?-1:1,t.reflectivity.value=i.reflectivity,t.refractionRatio.value=i.refractionRatio,t.maxMipLevel.value=e.get(r).__maxMipLevel),i.lightMap&&(t.lightMap.value=i.lightMap,t.lightMapIntensity.value=i.lightMapIntensity),i.aoMap&&(t.aoMap.value=i.aoMap,t.aoMapIntensity.value=i.aoMapIntensity),i.map)var n=i.map;else i.specularMap?n=i.specularMap:i.displacementMap?n=i.displacementMap:i.normalMap?n=i.normalMap:i.bumpMap?n=i.bumpMap:i.roughnessMap?n=i.roughnessMap:i.metalnessMap?n=i.metalnessMap:i.alphaMap?n=i.alphaMap:i.emissiveMap&&(n=i.emissiveMap);if(void 0!==n&&(n.isWebGLRenderTarget&&(n=n.texture),!0===n.matrixAutoUpdate&&n.updateMatrix(),t.uvTransform.value.copy(n.matrix)),i.aoMap)var a=i.aoMap;else i.lightMap&&(a=i.lightMap);void 0!==a&&(a.isWebGLRenderTarget&&(a=a.texture),!0===a.matrixAutoUpdate&&a.updateMatrix(),t.uv2Transform.value.copy(a.matrix))}function i(e,t,i){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),(t.envMap||i)&&(e.envMapIntensity.value=t.envMapIntensity)}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,r,n,a,o){if(r.isMeshBasicMaterial)t(e,r);else if(r.isMeshLambertMaterial)t(e,r),r.emissiveMap&&(e.emissiveMap.value=r.emissiveMap);else if(r.isMeshToonMaterial)t(e,r),e.specular.value.copy(r.specular),e.shininess.value=Math.max(r.shininess,1e-4),r.gradientMap&&(e.gradientMap.value=r.gradientMap),r.emissiveMap&&(e.emissiveMap.value=r.emissiveMap),r.bumpMap&&(e.bumpMap.value=r.bumpMap,e.bumpScale.value=r.bumpScale,1===r.side&&(e.bumpScale.value*=-1)),r.normalMap&&(e.normalMap.value=r.normalMap,e.normalScale.value.copy(r.normalScale),1===r.side&&e.normalScale.value.negate()),r.displacementMap&&(e.displacementMap.value=r.displacementMap,e.displacementScale.value=r.displacementScale,e.displacementBias.value=r.displacementBias);else if(r.isMeshPhongMaterial)t(e,r),e.specular.value.copy(r.specular),e.shininess.value=Math.max(r.shininess,1e-4),r.emissiveMap&&(e.emissiveMap.value=r.emissiveMap),r.bumpMap&&(e.bumpMap.value=r.bumpMap,e.bumpScale.value=r.bumpScale,1===r.side&&(e.bumpScale.value*=-1)),r.normalMap&&(e.normalMap.value=r.normalMap,e.normalScale.value.copy(r.normalScale),1===r.side&&e.normalScale.value.negate()),r.displacementMap&&(e.displacementMap.value=r.displacementMap,e.displacementScale.value=r.displacementScale,e.displacementBias.value=r.displacementBias);else if(r.isMeshStandardMaterial)t(e,r,n),r.isMeshPhysicalMaterial?(i(e,r,n),e.reflectivity.value=r.reflectivity,e.clearcoat.value=r.clearcoat,e.clearcoatRoughness.value=r.clearcoatRoughness,r.sheen&&e.sheen.value.copy(r.sheen),r.clearcoatMap&&(e.clearcoatMap.value=r.clearcoatMap),r.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=r.clearcoatRoughnessMap),r.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(r.clearcoatNormalScale),e.clearcoatNormalMap.value=r.clearcoatNormalMap,1===r.side&&e.clearcoatNormalScale.value.negate()),e.transparency.value=r.transparency):i(e,r,n);else if(r.isMeshMatcapMaterial)t(e,r),r.matcap&&(e.matcap.value=r.matcap),r.bumpMap&&(e.bumpMap.value=r.bumpMap,e.bumpScale.value=r.bumpScale,1===r.side&&(e.bumpScale.value*=-1)),r.normalMap&&(e.normalMap.value=r.normalMap,e.normalScale.value.copy(r.normalScale),1===r.side&&e.normalScale.value.negate()),r.displacementMap&&(e.displacementMap.value=r.displacementMap,e.displacementScale.value=r.displacementScale,e.displacementBias.value=r.displacementBias);else if(r.isMeshDepthMaterial)t(e,r),r.displacementMap&&(e.displacementMap.value=r.displacementMap,e.displacementScale.value=r.displacementScale,e.displacementBias.value=r.displacementBias);else if(r.isMeshDistanceMaterial)t(e,r),r.displacementMap&&(e.displacementMap.value=r.displacementMap,e.displacementScale.value=r.displacementScale,e.displacementBias.value=r.displacementBias),e.referencePosition.value.copy(r.referencePosition),e.nearDistance.value=r.nearDistance,e.farDistance.value=r.farDistance;else if(r.isMeshNormalMaterial)t(e,r),r.bumpMap&&(e.bumpMap.value=r.bumpMap,e.bumpScale.value=r.bumpScale,1===r.side&&(e.bumpScale.value*=-1)),r.normalMap&&(e.normalMap.value=r.normalMap,e.normalScale.value.copy(r.normalScale),1===r.side&&e.normalScale.value.negate()),r.displacementMap&&(e.displacementMap.value=r.displacementMap,e.displacementScale.value=r.displacementScale,e.displacementBias.value=r.displacementBias);else if(r.isLineBasicMaterial)e.diffuse.value.copy(r.color),e.opacity.value=r.opacity,r.isLineDashedMaterial&&(e.dashSize.value=r.dashSize,e.totalSize.value=r.dashSize+r.gapSize,e.scale.value=r.scale);else if(r.isPointsMaterial){if(e.diffuse.value.copy(r.color),e.opacity.value=r.opacity,e.size.value=r.size*a,e.scale.value=.5*o,r.map&&(e.map.value=r.map),r.alphaMap&&(e.alphaMap.value=r.alphaMap),r.map)var s=r.map;else r.alphaMap&&(s=r.alphaMap);void 0!==s&&(!0===s.matrixAutoUpdate&&s.updateMatrix(),e.uvTransform.value.copy(s.matrix))}else if(r.isSpriteMaterial){if(e.diffuse.value.copy(r.color),e.opacity.value=r.opacity,e.rotation.value=r.rotation,r.map&&(e.map.value=r.map),r.alphaMap&&(e.alphaMap.value=r.alphaMap),r.map)var l=r.map;else r.alphaMap&&(l=r.alphaMap);void 0!==l&&(!0===l.matrixAutoUpdate&&l.updateMatrix(),e.uvTransform.value.copy(l.matrix))}else r.isShadowMaterial?(e.color.value.copy(r.color),e.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function Bt(e){var t;function r(){L=new le(Oe),!1===(P=new oe(Oe,L,e)).isWebGL2&&(L.get("WEBGL_depth_texture"),L.get("OES_texture_float"),L.get("OES_texture_half_float"),L.get("OES_texture_half_float_linear"),L.get("OES_standard_derivatives"),L.get("OES_element_index_uint"),L.get("ANGLE_instanced_arrays")),L.get("OES_texture_float_linear"),q=new It(Oe,L,P),(I=new Lt(Oe,L,P)).scissor(xe.copy(Ce).multiplyScalar(Te).floor()),I.viewport(_e.copy(Ae).multiplyScalar(Te).floor()),R=new ue(Oe),D=new gt,k=new Pt(Oe,L,I,D,P,q,R),z=new te(Oe,P),O=new ce(Oe,z,R),B=new fe(Oe,O,z,R),G=new pe(Oe),F=new mt(Z,L,P),N=new Ot(D),U=new xt,j=new St,V=new ne(Z,I,B,M),H=new ae(Oe,L,R,P),W=new he(Oe,L,R,P),R.programs=F.programs,Z.capabilities=P,Z.extensions=L,Z.properties=D,Z.renderLists=U,Z.state=I,Z.info=R}function n(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),X=!0}function o(){console.log("THREE.WebGLRenderer: Context Restored."),X=!1,r()}function s(e){(e=e.target).removeEventListener("dispose",s),l(e),D.remove(e)}function l(e){var t=D.get(e).program;e.program=void 0,void 0!==t&&F.releaseProgram(t)}function u(e,t,i,r){if(!1!==e.visible){if(e.layers.test(t.layers))if(e.isGroup)i=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)C.pushLight(e),e.castShadow&&C.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||Pe.intersectsSprite(e)){r&&ze.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ke);var n=B.update(e),a=e.material;a.visible&&A.push(e,n,a,i,ze.z,null)}}else if(e.isImmediateRenderObject)r&&ze.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ke),A.push(e,null,e.material,i,ze.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==R.render.frame&&(e.skeleton.update(),e.skeleton.frame=R.render.frame),!e.frustumCulled||Pe.intersectsObject(e)))if(r&&ze.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ke),n=B.update(e),a=e.material,Array.isArray(a))for(var o=n.groups,s=0,l=o.length;s<l;s++){var c=o[s],h=a[c.materialIndex];h&&h.visible&&A.push(e,n,h,i,ze.z,c)}else a.visible&&A.push(e,n,a,i,ze.z,null);for(s=0,l=(e=e.children).length;s<l;s++)u(e[s],t,i,r)}}function d(e,t,i,r){for(var n=0,a=e.length;n<a;n++){var o=e[n],s=o.object,l=o.geometry,c=void 0===r?o.material:r;if(o=o.group,i.isArrayCamera){ve=i;for(var h=i.cameras,u=0,d=h.length;u<d;u++){var f=h[u];s.layers.test(f.layers)&&(I.viewport(_e.copy(f.viewport)),C.setupLights(f),p(s,t,f,l,c,o))}}else ve=null,p(s,t,i,l,c,o)}}function p(e,i,r,n,a,o){if(e.onBeforeRender(Z,i,r,n,a,o),C=j.get(i,ve||r),e.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){var s=g(r,i,a,e);I.setMaterial(a),me=t=null,ge=!1,function(e,t){e.render((function(e){Z.renderBufferImmediate(e,t)}))}(e,s)}else Z.renderBufferDirect(r,i,n,a,e,o);e.onAfterRender(Z,i,r,n,a,o),C=j.get(i,ve||r)}function m(e,t,i){var r=D.get(e),n=C.state.lights,a=n.state.version;i=F.getParameters(e,n.state,C.state.shadowsArray,t,Ie.numPlanes,Ie.numIntersection,i);var o=F.getProgramCacheKey(i),c=r.program,h=!0;if(void 0===c)e.addEventListener("dispose",s);else if(c.cacheKey!==o)l(e);else{if(r.lightsStateVersion!==a)r.lightsStateVersion=a;else if(void 0!==i.shaderID)return;h=!1}if(h&&(c=F.acquireProgram(i,o),r.program=c,r.uniforms=i.uniforms,r.outputEncoding=i.outputEncoding,e.program=c),i=c.getAttributes(),e.morphTargets)for(o=e.numSupportedMorphTargets=0;o<Z.maxMorphTargets;o++)0<=i["morphTarget"+o]&&e.numSupportedMorphTargets++;if(e.morphNormals)for(o=e.numSupportedMorphNormals=0;o<Z.maxMorphNormals;o++)0<=i["morphNormal"+o]&&e.numSupportedMorphNormals++;i=r.uniforms,(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(r.numClippingPlanes=Ie.numPlanes,r.numIntersection=Ie.numIntersection,i.clippingPlanes=Ie.uniform),r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.needsLights=e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights,r.lightsStateVersion=a,r.needsLights&&(i.ambientLightColor.value=n.state.ambient,i.lightProbe.value=n.state.probe,i.directionalLights.value=n.state.directional,i.directionalLightShadows.value=n.state.directionalShadow,i.spotLights.value=n.state.spot,i.spotLightShadows.value=n.state.spotShadow,i.rectAreaLights.value=n.state.rectArea,i.pointLights.value=n.state.point,i.pointLightShadows.value=n.state.pointShadow,i.hemisphereLights.value=n.state.hemi,i.directionalShadowMap.value=n.state.directionalShadowMap,i.directionalShadowMatrix.value=n.state.directionalShadowMatrix,i.spotShadowMap.value=n.state.spotShadowMap,i.spotShadowMatrix.value=n.state.spotShadowMatrix,i.pointShadowMap.value=n.state.pointShadowMap,i.pointShadowMatrix.value=n.state.pointShadowMatrix),e=r.program.getUniforms(),e=et.seqWithValue(e.seq,i),r.uniformsList=e}function g(e,t,i,r){k.resetTextureUnits();var n=t.fog,a=i.isMeshStandardMaterial?t.environment:null,o=null===ie?Z.outputEncoding:ie.texture.encoding,s=D.get(i),l=C.state.lights;Re&&(De||e!==ye)&&Ie.setState(i.clippingPlanes,i.clipIntersection,i.clipShadows,e,s,e===ye&&i.id===de),i.version===s.__version?void 0===s.program||i.fog&&s.fog!==n||s.environment!==a||s.needsLights&&s.lightsStateVersion!==l.state.version?m(i,t,r):void 0===s.numClippingPlanes||s.numClippingPlanes===Ie.numPlanes&&s.numIntersection===Ie.numIntersection?s.outputEncoding!==o&&m(i,t,r):m(i,t,r):(m(i,t,r),s.__version=i.version);var c=!1,h=!1,u=!1;if(o=(t=s.program).getUniforms(),l=s.uniforms,I.useProgram(t.program)&&(u=h=c=!0),i.id!==de&&(de=i.id,h=!0),(c||ye!==e)&&(o.setValue(Oe,"projectionMatrix",e.projectionMatrix),P.logarithmicDepthBuffer&&o.setValue(Oe,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),ye!==e&&(ye=e,u=h=!0),(i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap)&&void 0!==(c=o.map.cameraPosition)&&c.setValue(Oe,ze.setFromMatrixPosition(e.matrixWorld)),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&o.setValue(Oe,"isOrthographic",!0===e.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.skinning)&&o.setValue(Oe,"viewMatrix",e.matrixWorldInverse)),i.skinning&&(o.setOptional(Oe,r,"bindMatrix"),o.setOptional(Oe,r,"bindMatrixInverse"),e=r.skeleton))if(c=e.bones,P.floatVertexTextures){if(void 0===e.boneTexture){c=Math.sqrt(4*c.length),c=Ia.ceilPowerOfTwo(c),c=Math.max(c,4);var d=new Float32Array(c*c*4);d.set(e.boneMatrices);var p=new K(d,c,c,1023,1015);e.boneMatrices=d,e.boneTexture=p,e.boneTextureSize=c}o.setValue(Oe,"boneTexture",e.boneTexture,k),o.setValue(Oe,"boneTextureSize",e.boneTextureSize)}else o.setOptional(Oe,e,"boneMatrices");return(h||s.receiveShadow!==r.receiveShadow)&&(s.receiveShadow=r.receiveShadow,o.setValue(Oe,"receiveShadow",r.receiveShadow)),h&&(o.setValue(Oe,"toneMappingExposure",Z.toneMappingExposure),o.setValue(Oe,"toneMappingWhitePoint",Z.toneMappingWhitePoint),s.needsLights&&(h=u,l.ambientLightColor.needsUpdate=h,l.lightProbe.needsUpdate=h,l.directionalLights.needsUpdate=h,l.directionalLightShadows.needsUpdate=h,l.pointLights.needsUpdate=h,l.pointLightShadows.needsUpdate=h,l.spotLights.needsUpdate=h,l.spotLightShadows.needsUpdate=h,l.rectAreaLights.needsUpdate=h,l.hemisphereLights.needsUpdate=h),n&&i.fog&&N.refreshFogUniforms(l,n),N.refreshMaterialUniforms(l,i,a,Te,Me),void 0!==l.ltc_1&&(l.ltc_1.value=Ts.LTC_1),void 0!==l.ltc_2&&(l.ltc_2.value=Ts.LTC_2),et.upload(Oe,s.uniformsList,l,k)),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(et.upload(Oe,s.uniformsList,l,k),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&o.setValue(Oe,"center",r.center),o.setValue(Oe,"modelViewMatrix",r.modelViewMatrix),o.setValue(Oe,"normalMatrix",r.normalMatrix),o.setValue(Oe,"modelMatrix",r.matrixWorld),t}var y=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),v=void 0!==e.context?e.context:null,_=void 0!==e.alpha&&e.alpha,x=void 0===e.depth||e.depth,b=void 0===e.stencil||e.stencil,w=void 0!==e.antialias&&e.antialias,M=void 0===e.premultipliedAlpha||e.premultipliedAlpha,T=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,S=void 0!==e.powerPreference?e.powerPreference:"default",E=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat,A=null,C=null;this.domElement=y,this.debug={checkShaderErrors:!0},this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=3e3,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingWhitePoint=this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var L,P,I,R,D,k,z,O,B,F,N,U,j,V,G,H,W,q,Z=this,X=!1,$=null,Y=0,J=0,ie=null,re=null,de=-1,me=t=null,ge=!1,ye=null,ve=null,_e=new a,xe=new a,be=null,we=y.width,Me=y.height,Te=1,Se=null,Ee=null,Ae=new a(0,0,we,Me),Ce=new a(0,0,we,Me),Le=!1,Pe=new Q,Ie=new se,Re=!1,De=!1,ke=new h,ze=new c;try{_={alpha:_,depth:x,stencil:b,antialias:w,premultipliedAlpha:M,preserveDrawingBuffer:T,powerPreference:S,failIfMajorPerformanceCaveat:E},y.addEventListener("webglcontextlost",n,!1),y.addEventListener("webglcontextrestored",o,!1);var Oe=v||y.getContext("webgl",_)||y.getContext("experimental-webgl",_);if(null===Oe){if(null!==y.getContext("webgl"))throw Error("Error creating WebGL context with your selected attributes.");throw Error("Error creating WebGL context.")}void 0===Oe.getShaderPrecisionFormat&&(Oe.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}r();var Be=new zt(Z,Oe);this.xr=Be;var Fe=new Ct(Z,B,P.maxTextureSize);this.shadowMap=Fe,this.getContext=function(){return Oe},this.getContextAttributes=function(){return Oe.getContextAttributes()},this.forceContextLoss=function(){var e=L.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=L.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return Te},this.setPixelRatio=function(e){void 0!==e&&(Te=e,this.setSize(we,Me,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new i),e.set(we,Me)},this.setSize=function(e,t,i){Be.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(we=e,Me=t,y.width=Math.floor(e*Te),y.height=Math.floor(t*Te),!1!==i&&(y.style.width=e+"px",y.style.height=t+"px"),this.setViewport(0,0,e,t))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new i),e.set(we*Te,Me*Te).floor()},this.setDrawingBufferSize=function(e,t,i){we=e,Me=t,Te=i,y.width=Math.floor(e*i),y.height=Math.floor(t*i),this.setViewport(0,0,e,t)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new a),e.copy(_e)},this.getViewport=function(e){return e.copy(Ae)},this.setViewport=function(e,t,i,r){e.isVector4?Ae.set(e.x,e.y,e.z,e.w):Ae.set(e,t,i,r),I.viewport(_e.copy(Ae).multiplyScalar(Te).floor())},this.getScissor=function(e){return e.copy(Ce)},this.setScissor=function(e,t,i,r){e.isVector4?Ce.set(e.x,e.y,e.z,e.w):Ce.set(e,t,i,r),I.scissor(xe.copy(Ce).multiplyScalar(Te).floor())},this.getScissorTest=function(){return Le},this.setScissorTest=function(e){I.setScissorTest(Le=e)},this.setOpaqueSort=function(e){Se=e},this.setTransparentSort=function(e){Ee=e},this.getClearColor=function(){return V.getClearColor()},this.setClearColor=function(){V.setClearColor.apply(V,arguments)},this.getClearAlpha=function(){return V.getClearAlpha()},this.setClearAlpha=function(){V.setClearAlpha.apply(V,arguments)},this.clear=function(e,t,i){var r=0;(void 0===e||e)&&(r|=16384),(void 0===t||t)&&(r|=256),(void 0===i||i)&&(r|=1024),Oe.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){y.removeEventListener("webglcontextlost",n,!1),y.removeEventListener("webglcontextrestored",o,!1),U.dispose(),j.dispose(),D.dispose(),B.dispose(),Be.dispose(),je.stop()},this.renderBufferImmediate=function(e,t){I.initAttributes();var i=D.get(e);e.hasPositions&&!i.position&&(i.position=Oe.createBuffer()),e.hasNormals&&!i.normal&&(i.normal=Oe.createBuffer()),e.hasUvs&&!i.uv&&(i.uv=Oe.createBuffer()),e.hasColors&&!i.color&&(i.color=Oe.createBuffer()),t=t.getAttributes(),e.hasPositions&&(Oe.bindBuffer(34962,i.position),Oe.bufferData(34962,e.positionArray,35048),I.enableAttribute(t.position),Oe.vertexAttribPointer(t.position,3,5126,!1,0,0)),e.hasNormals&&(Oe.bindBuffer(34962,i.normal),Oe.bufferData(34962,e.normalArray,35048),I.enableAttribute(t.normal),Oe.vertexAttribPointer(t.normal,3,5126,!1,0,0)),e.hasUvs&&(Oe.bindBuffer(34962,i.uv),Oe.bufferData(34962,e.uvArray,35048),I.enableAttribute(t.uv),Oe.vertexAttribPointer(t.uv,2,5126,!1,0,0)),e.hasColors&&(Oe.bindBuffer(34962,i.color),Oe.bufferData(34962,e.colorArray,35048),I.enableAttribute(t.color),Oe.vertexAttribPointer(t.color,3,5126,!1,0,0)),I.disableUnusedAttributes(),Oe.drawArrays(4,0,e.count),e.count=0};var Ne=new f;this.renderBufferDirect=function(e,i,r,n,a,o){null===i&&(i=Ne);var s=a.isMesh&&0>a.matrixWorld.determinant(),l=g(e,i,n,a);I.setMaterial(n,s);var c=!1;if(t===r.id&&me===l.id&&ge===(!0===n.wireframe)||(t=r.id,me=l.id,ge=!0===n.wireframe,c=!0),(n.morphTargets||n.morphNormals)&&(G.update(a,r,n,l),c=!0),!0===a.isInstancedMesh&&(c=!0),e=r.index,i=r.attributes.position,null===e){if(void 0===i||0===i.count)return}else if(0===e.count)return;var h=1;if(!0===n.wireframe&&(e=O.getWireframeAttribute(r),h=2),s=H,null!==e){var u=z.get(e);(s=W).setIndex(u)}if(c){if(!1!==P.isWebGL2||!a.isInstancedMesh&&!r.isInstancedBufferGeometry||null!==L.get("ANGLE_instanced_arrays")){I.initAttributes(),c=r.attributes,l=l.getAttributes();var d=n.defaultAttributeValues;for(M in l){var p=l[M];if(0<=p){var f=c[M];if(void 0!==f){var m=f.normalized,y=f.itemSize,v=z.get(f);if(void 0!==v){var _=v.buffer,x=v.type;if(v=v.bytesPerElement,f.isInterleavedBufferAttribute){var b=f.data,w=b.stride;f=f.offset,b&&b.isInstancedInterleavedBuffer?(I.enableAttributeAndDivisor(p,b.meshPerAttribute),void 0===r._maxInstanceCount&&(r._maxInstanceCount=b.meshPerAttribute*b.count)):I.enableAttribute(p),Oe.bindBuffer(34962,_),I.vertexAttribPointer(p,y,x,m,w*v,f*v)}else f.isInstancedBufferAttribute?(I.enableAttributeAndDivisor(p,f.meshPerAttribute),void 0===r._maxInstanceCount&&(r._maxInstanceCount=f.meshPerAttribute*f.count)):I.enableAttribute(p),Oe.bindBuffer(34962,_),I.vertexAttribPointer(p,y,x,m,0,0)}}else if("instanceMatrix"===M)void 0!==(v=z.get(a.instanceMatrix))&&(_=v.buffer,x=v.type,I.enableAttributeAndDivisor(p+0,1),I.enableAttributeAndDivisor(p+1,1),I.enableAttributeAndDivisor(p+2,1),I.enableAttributeAndDivisor(p+3,1),Oe.bindBuffer(34962,_),Oe.vertexAttribPointer(p+0,4,x,!1,64,0),Oe.vertexAttribPointer(p+1,4,x,!1,64,16),Oe.vertexAttribPointer(p+2,4,x,!1,64,32),Oe.vertexAttribPointer(p+3,4,x,!1,64,48));else if(void 0!==d&&void 0!==(m=d[M]))switch(m.length){case 2:Oe.vertexAttrib2fv(p,m);break;case 3:Oe.vertexAttrib3fv(p,m);break;case 4:Oe.vertexAttrib4fv(p,m);break;default:Oe.vertexAttrib1fv(p,m)}}}I.disableUnusedAttributes()}null!==e&&Oe.bindBuffer(34963,u.buffer)}var M=r.drawRange.start*h;c=null!==o?o.start*h:0,u=Math.max(M,c),0!==(o=Math.max(0,Math.min(null!==e?e.count:i.count,M+r.drawRange.count*h,c+(null!==o?o.count*h:1/0))-1-u+1))&&(a.isMesh?!0===n.wireframe?(I.setLineWidth(n.wireframeLinewidth*(null===ie?Te:1)),s.setMode(1)):s.setMode(4):a.isLine?(void 0===(n=n.linewidth)&&(n=1),I.setLineWidth(n*(null===ie?Te:1)),a.isLineSegments?s.setMode(1):a.isLineLoop?s.setMode(2):s.setMode(3)):a.isPoints?s.setMode(0):a.isSprite&&s.setMode(4),a.isInstancedMesh?s.renderInstances(r,u,o,a.count):r.isInstancedBufferGeometry?s.renderInstances(r,u,o,Math.min(r.instanceCount,r._maxInstanceCount)):s.render(u,o))},this.compile=function(e,t){(C=j.get(e,t)).init(),e.traverse((function(e){e.isLight&&(C.pushLight(e),e.castShadow&&C.pushShadow(e))})),C.setupLights(t);var i={};e.traverse((function(t){var r=t.material;if(r)if(Array.isArray(r))for(var n=0;n<r.length;n++){var a=r[n];0==a.uuid in i&&(m(a,e,t),i[a.uuid]=!0)}else 0==r.uuid in i&&(m(r,e,t),i[r.uuid]=!0)}))};var Ue=null,je=new ee;je.setAnimationLoop((function(e){Be.isPresenting||Ue&&Ue(e)})),"undefined"!=typeof window&&je.setContext(window),this.setAnimationLoop=function(e){Ue=e,Be.setAnimationLoop(e),je.start()},this.render=function(e,i,r,n){if(void 0!==r){console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead.");var a=r}if(void 0!==n){console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead.");var o=n}i&&i.isCamera?X||(me=t=null,ge=!1,de=-1,ye=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===i.parent&&i.updateMatrixWorld(),Be.enabled&&Be.isPresenting&&(i=Be.getCamera(i)),e.onBeforeRender(Z,e,i,a||ie),(C=j.get(e,i)).init(),ke.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),Pe.setFromProjectionMatrix(ke),De=this.localClippingEnabled,Re=Ie.init(this.clippingPlanes,De,i),(A=U.get(e,i)).init(),u(e,i,0,Z.sortObjects),A.finish(),!0===Z.sortObjects&&A.sort(Se,Ee),Re&&Ie.beginShadows(),Fe.render(C.state.shadowsArray,e,i),C.setupLights(i),Re&&Ie.endShadows(),this.info.autoReset&&this.info.reset(),void 0!==a&&this.setRenderTarget(a),V.render(A,e,i,o),r=A.opaque,n=A.transparent,e.overrideMaterial?(a=e.overrideMaterial,r.length&&d(r,e,i,a),n.length&&d(n,e,i,a)):(r.length&&d(r,e,i),n.length&&d(n,e,i)),e.onAfterRender(Z,e,i),null!==ie&&(k.updateRenderTargetMipmap(ie),k.updateMultisampleRenderTarget(ie)),I.buffers.depth.setTest(!0),I.buffers.depth.setMask(!0),I.buffers.color.setMask(!0),I.setPolygonOffset(!1),C=A=null):console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFramebuffer=function(e){$!==e&&null===ie&&Oe.bindFramebuffer(36160,e),$=e},this.getActiveCubeFace=function(){return Y},this.getActiveMipmapLevel=function(){return J},this.getRenderTarget=function(){return ie},this.setRenderTarget=function(e,t,i){ie=e,Y=t,J=i,e&&void 0===D.get(e).__webglFramebuffer&&k.setupRenderTarget(e);var r=$,n=!1;e?(r=D.get(e).__webglFramebuffer,e.isWebGLCubeRenderTarget?(r=r[t||0],n=!0):r=e.isWebGLMultisampleRenderTarget?D.get(e).__webglMultisampledFramebuffer:r,_e.copy(e.viewport),xe.copy(e.scissor),be=e.scissorTest):(_e.copy(Ae).multiplyScalar(Te).floor(),xe.copy(Ce).multiplyScalar(Te).floor(),be=Le),re!==r&&(Oe.bindFramebuffer(36160,r),re=r),I.viewport(_e),I.scissor(xe),I.setScissorTest(be),n&&(e=D.get(e.texture),Oe.framebufferTexture2D(36160,36064,34069+(t||0),e.__webglTexture,i||0))},this.readRenderTargetPixels=function(e,t,i,r,n,a,o){if(e&&e.isWebGLRenderTarget){var s=D.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(s=s[o]),s){o=!1,s!==re&&(Oe.bindFramebuffer(36160,s),o=!0);try{var l=e.texture,c=l.format,h=l.type;1023!==c&&q.convert(c)!==Oe.getParameter(35739)?console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format."):1009===h||q.convert(h)===Oe.getParameter(35738)||1015===h&&(P.isWebGL2||L.get("OES_texture_float")||L.get("WEBGL_color_buffer_float"))||1016===h&&(P.isWebGL2?L.get("EXT_color_buffer_float"):L.get("EXT_color_buffer_half_float"))?36053===Oe.checkFramebufferStatus(36160)?0<=t&&t<=e.width-r&&0<=i&&i<=e.height-n&&Oe.readPixels(t,i,r,n,q.convert(c),q.convert(h),a):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."):console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.")}finally{o&&Oe.bindFramebuffer(36160,re)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,i){void 0===i&&(i=0);var r=Math.pow(2,-i),n=Math.floor(t.image.width*r);r=Math.floor(t.image.height*r);var a=q.convert(t.format);k.setTexture2D(t,0),Oe.copyTexImage2D(3553,i,a,e.x,e.y,n,r,0),I.unbindTexture()},this.copyTextureToTexture=function(e,t,i,r){void 0===r&&(r=0);var n=t.image.width,a=t.image.height,o=q.convert(i.format),s=q.convert(i.type);k.setTexture2D(i,0),t.isDataTexture?Oe.texSubImage2D(3553,r,e.x,e.y,n,a,o,s,t.image.data):t.isCompressedTexture?Oe.compressedTexSubImage2D(3553,r,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):Oe.texSubImage2D(3553,r,e.x,e.y,o,s,t.image),0===r&&i.generateMipmaps&&Oe.generateMipmap(3553),I.unbindTexture()},this.initTexture=function(e){k.setTexture2D(e,0),I.unbindTexture()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function Ft(e,t){this.name="",this.color=new b(e),this.density=void 0!==t?t:25e-5}function Nt(e,t,i){this.name="",this.color=new b(e),this.near=void 0!==t?t:1,this.far=void 0!==i?i:1e3}function Ut(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}function jt(e,t,i,r){this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=!0===r}function Vt(e){E.call(this),this.type="SpriteMaterial",this.color=new b(16777215),this.alphaMap=this.map=null,this.rotation=0,this.transparent=this.sizeAttenuation=!0,this.setValues(e)}function Gt(e){if(p.call(this),this.type="Sprite",void 0===Gs){Gs=new U;var t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]);t=new Ut(t,5),Gs.setIndex([0,1,2,0,2,3]),Gs.setAttribute("position",new jt(t,3,0,!1)),Gs.setAttribute("uv",new jt(t,2,3,!1))}this.geometry=Gs,this.material=void 0!==e?e:new Vt,this.center=new i(.5,.5)}function Ht(e,t,i,r,n,a){Zs.subVectors(e,i).addScalar(.5).multiply(r),void 0!==n?(Xs.x=a*Zs.x-n*Zs.y,Xs.y=n*Zs.x+a*Zs.y):Xs.copy(Zs),e.copy(t),e.x+=Xs.x,e.y+=Xs.y,e.applyMatrix4($s)}function Wt(){p.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function qt(e,t){e&&e.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),j.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new h,this.bindMatrixInverse=new h}function Zt(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else for(console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[],e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new h)}function Xt(){p.call(this),this.type="Bone"}function $t(e,t,i){j.call(this,e,t),this.instanceMatrix=new C(new Float32Array(16*i),16),this.count=i,this.frustumCulled=!1}function Yt(e){E.call(this),this.type="LineBasicMaterial",this.color=new b(16777215),this.linewidth=1,this.linejoin=this.linecap="round",this.morphTargets=!1,this.setValues(e)}function Jt(e,t,i){1===i&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),p.call(this),this.type="Line",this.geometry=void 0!==e?e:new U,this.material=void 0!==t?t:new Yt,this.updateMorphTargets()}function Kt(e,t){Jt.call(this,e,t),this.type="LineSegments"}function Qt(e,t){Jt.call(this,e,t),this.type="LineLoop"}function ei(e){E.call(this),this.type="PointsMaterial",this.color=new b(16777215),this.alphaMap=this.map=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}function ti(e,t){p.call(this),this.type="Points",this.geometry=void 0!==e?e:new U,this.material=void 0!==t?t:new ei,this.updateMorphTargets()}function ii(e,t,i,r,n,a,o){var s=Ml.distanceSqToPoint(e);s<i&&(i=new c,Ml.closestPointToPoint(e,i),i.applyMatrix4(r),(e=n.ray.origin.distanceTo(i))<n.near||e>n.far||a.push({distance:e,distanceToRay:Math.sqrt(s),point:i,index:t,face:null,object:o}))}function ri(e,t,i,r,a,o,s,l,c){n.call(this,e,t,i,r,a,o,s,l,c),this.format=void 0!==s?s:1022,this.minFilter=void 0!==o?o:1006,this.magFilter=void 0!==a?a:1006,this.generateMipmaps=!1}function ni(e,t,i,r,a,o,s,l,c,h,u,d){n.call(this,null,o,s,l,c,h,r,a,u,d),this.image={width:t,height:i},this.mipmaps=e,this.generateMipmaps=this.flipY=!1}function ai(e,t,i,r,a,o,s,l,c){n.call(this,e,t,i,r,a,o,s,l,c),this.needsUpdate=!0}function oi(e,t,i,r,a,o,s,l,c,h){if(1026!==(h=void 0!==h?h:1026)&&1027!==h)throw Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&1026===h&&(i=1012),void 0===i&&1027===h&&(i=1020),n.call(this,null,r,a,o,s,l,h,i,c),this.image={width:e,height:t},this.magFilter=void 0!==s?s:1003,this.minFilter=void 0!==l?l:1003,this.generateMipmaps=this.flipY=!1}function si(e){U.call(this),this.type="WireframeGeometry";var t,i,r,n=[],a=[0,0],o={},s=["a","b","c"];if(e&&e.isGeometry){var l=e.faces,h=0;for(i=l.length;h<i;h++){var u=l[h];for(t=0;3>t;t++){var d=u[s[t]],p=u[s[(t+1)%3]];a[0]=Math.min(d,p),a[1]=Math.max(d,p),void 0===o[d=a[0]+","+a[1]]&&(o[d]={index1:a[0],index2:a[1]})}}for(d in o)h=o[d],s=e.vertices[h.index1],n.push(s.x,s.y,s.z),s=e.vertices[h.index2],n.push(s.x,s.y,s.z)}else if(e&&e.isBufferGeometry)if(s=new c,null!==e.index){l=e.attributes.position,u=e.index;var f=e.groups;for(0===f.length&&(f=[{start:0,count:u.count,materialIndex:0}]),e=0,r=f.length;e<r;++e)for(t=(h=f[e]).start,i=h.count,h=t,i=t+i;h<i;h+=3)for(t=0;3>t;t++)d=u.getX(h+t),p=u.getX(h+(t+1)%3),a[0]=Math.min(d,p),a[1]=Math.max(d,p),void 0===o[d=a[0]+","+a[1]]&&(o[d]={index1:a[0],index2:a[1]});for(d in o)h=o[d],s.fromBufferAttribute(l,h.index1),n.push(s.x,s.y,s.z),s.fromBufferAttribute(l,h.index2),n.push(s.x,s.y,s.z)}else for(h=0,i=(l=e.attributes.position).count/3;h<i;h++)for(t=0;3>t;t++)o=3*h+t,s.fromBufferAttribute(l,o),n.push(s.x,s.y,s.z),o=3*h+(t+1)%3,s.fromBufferAttribute(l,o),n.push(s.x,s.y,s.z);this.setAttribute("position",new O(n,3))}function li(e,t,i){H.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:i},this.fromBufferGeometry(new ci(e,t,i)),this.mergeVertices()}function ci(e,t,i){U.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:i};var r,n,a=[],o=[],s=[],l=[],h=new c,u=new c,d=new c,p=new c,f=new c;3>e.length&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var m=t+1;for(r=0;r<=i;r++){var g=r/i;for(n=0;n<=t;n++){var y=n/t;e(y,g,u),o.push(u.x,u.y,u.z),0<=y-1e-5?(e(y-1e-5,g,d),p.subVectors(u,d)):(e(y+1e-5,g,d),p.subVectors(d,u)),0<=g-1e-5?(e(y,g-1e-5,d),f.subVectors(u,d)):(e(y,g+1e-5,d),f.subVectors(d,u)),h.crossVectors(p,f).normalize(),s.push(h.x,h.y,h.z),l.push(y,g)}}for(r=0;r<i;r++)for(n=0;n<t;n++)e=r*m+n+1,h=(r+1)*m+n+1,u=(r+1)*m+n,a.push(r*m+n,e,u),a.push(e,h,u);this.setIndex(a),this.setAttribute("position",new O(o,3)),this.setAttribute("normal",new O(s,3)),this.setAttribute("uv",new O(l,2))}function hi(e,t,i,r){H.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:r},this.fromBufferGeometry(new ui(e,t,i,r)),this.mergeVertices()}function ui(e,t,r,n){function a(e){l.push(e.x,e.y,e.z)}function o(t,i){t*=3,i.x=e[t+0],i.y=e[t+1],i.z=e[t+2]}function s(e,t,i,r){0>r&&1===e.x&&(h[t]=e.x-1),0===i.x&&0===i.z&&(h[t]=r/2/Math.PI+.5)}U.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:n},r=r||1;var l=[],h=[];!function(e){for(var i=new c,r=new c,n=new c,s=0;s<t.length;s+=3){o(t[s+0],i),o(t[s+1],r),o(t[s+2],n);var l,h,u=i,d=r,p=n,f=Math.pow(2,e),m=[];for(h=0;h<=f;h++){m[h]=[];var g=u.clone().lerp(p,h/f),y=d.clone().lerp(p,h/f),v=f-h;for(l=0;l<=v;l++)m[h][l]=0===l&&h===f?g:g.clone().lerp(y,l/v)}for(h=0;h<f;h++)for(l=0;l<2*(f-h)-1;l++)u=Math.floor(l/2),0==l%2?(a(m[h][u+1]),a(m[h+1][u]),a(m[h][u])):(a(m[h][u+1]),a(m[h+1][u+1]),a(m[h+1][u]))}}(n=n||0),function(e){for(var t=new c,i=0;i<l.length;i+=3)t.x=l[i+0],t.y=l[i+1],t.z=l[i+2],t.normalize().multiplyScalar(e),l[i+0]=t.x,l[i+1]=t.y,l[i+2]=t.z}(r),function(){for(var e=new c,t=0;t<l.length;t+=3)e.x=l[t+0],e.y=l[t+1],e.z=l[t+2],h.push(Math.atan2(e.z,-e.x)/2/Math.PI+.5,1-(Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5));e=new c,t=new c;for(var r=new c,n=new c,a=new i,o=new i,u=new i,d=0,p=0;d<l.length;d+=9,p+=6){e.set(l[d+0],l[d+1],l[d+2]),t.set(l[d+3],l[d+4],l[d+5]),r.set(l[d+6],l[d+7],l[d+8]),a.set(h[p+0],h[p+1]),o.set(h[p+2],h[p+3]),u.set(h[p+4],h[p+5]),n.copy(e).add(t).add(r).divideScalar(3);var f=Math.atan2(n.z,-n.x);s(a,p+0,e,f),s(o,p+2,t,f),s(u,p+4,r,f)}for(e=0;e<h.length;e+=6)t=h[e+0],r=h[e+2],n=h[e+4],a=Math.min(t,r,n),.9<Math.max(t,r,n)&&.1>a&&(.2>t&&(h[e+0]+=1),.2>r&&(h[e+2]+=1),.2>n&&(h[e+4]+=1))}(),this.setAttribute("position",new O(l,3)),this.setAttribute("normal",new O(l.slice(),3)),this.setAttribute("uv",new O(h,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}function di(e,t){H.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new pi(e,t)),this.mergeVertices()}function pi(e,t){ui.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}function fi(e,t){H.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new mi(e,t)),this.mergeVertices()}function mi(e,t){ui.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}function gi(e,t){H.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new yi(e,t)),this.mergeVertices()}function yi(e,t){var i=(1+Math.sqrt(5))/2;ui.call(this,[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}function vi(e,t){H.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new _i(e,t)),this.mergeVertices()}function _i(e,t){var i=(1+Math.sqrt(5))/2,r=1/i;ui.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}function xi(e,t,i,r,n,a){H.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:r,closed:n},void 0!==a&&console.warn("THREE.TubeGeometry: taper has been removed."),e=new bi(e,t,i,r,n),this.tangents=e.tangents,this.normals=e.normals,this.binormals=e.binormals,this.fromBufferGeometry(e),this.mergeVertices()}function bi(e,t,r,n,a){function o(i){f=e.getPointAt(i/t,f);var a=s.normals[i];for(i=s.binormals[i],h=0;h<=n;h++){var o=h/n*Math.PI*2,l=Math.sin(o);o=-Math.cos(o),d.x=o*a.x+l*i.x,d.y=o*a.y+l*i.y,d.z=o*a.z+l*i.z,d.normalize(),g.push(d.x,d.y,d.z),u.x=f.x+r*d.x,u.y=f.y+r*d.y,u.z=f.z+r*d.z,m.push(u.x,u.y,u.z)}}U.call(this),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:n,closed:a},t=t||64,r=r||1,n=n||8,a=a||!1;var s=e.computeFrenetFrames(t,a);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;var l,h,u=new c,d=new c,p=new i,f=new c,m=[],g=[],y=[],v=[];for(l=0;l<t;l++)o(l);for(o(!1===a?t:0),l=0;l<=t;l++)for(h=0;h<=n;h++)p.x=l/t,p.y=h/n,y.push(p.x,p.y);!function(){for(h=1;h<=t;h++)for(l=1;l<=n;l++){var e=(n+1)*h+(l-1),i=(n+1)*h+l,r=(n+1)*(h-1)+l;v.push((n+1)*(h-1)+(l-1),e,r),v.push(e,i,r)}}(),this.setIndex(v),this.setAttribute("position",new O(m,3)),this.setAttribute("normal",new O(g,3)),this.setAttribute("uv",new O(y,2))}function wi(e,t,i,r,n,a,o){H.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:r,p:n,q:a},void 0!==o&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new Mi(e,t,i,r,n,a)),this.mergeVertices()}function Mi(e,t,i,r,n,a){function o(e,t,i,r,n){var a=Math.sin(e);t=i/t*e,i=Math.cos(t),n.x=r*(2+i)*.5*Math.cos(e),n.y=r*(2+i)*a*.5,n.z=r*Math.sin(t)*.5}U.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:r,p:n,q:a},e=e||1,t=t||.4,i=Math.floor(i)||64,r=Math.floor(r)||8,n=n||2,a=a||3;var s,l=[],h=[],u=[],d=[],p=new c,f=new c,m=new c,g=new c,y=new c,v=new c,_=new c;for(s=0;s<=i;++s){var x=s/i*n*Math.PI*2;for(o(x,n,a,e,m),o(x+.01,n,a,e,g),v.subVectors(g,m),_.addVectors(g,m),y.crossVectors(v,_),_.crossVectors(y,v),y.normalize(),_.normalize(),x=0;x<=r;++x){var b=x/r*Math.PI*2,w=-t*Math.cos(b);b=t*Math.sin(b),p.x=m.x+(w*_.x+b*y.x),p.y=m.y+(w*_.y+b*y.y),p.z=m.z+(w*_.z+b*y.z),h.push(p.x,p.y,p.z),f.subVectors(p,m).normalize(),u.push(f.x,f.y,f.z),d.push(s/i),d.push(x/r)}}for(x=1;x<=i;x++)for(s=1;s<=r;s++)e=(r+1)*x+(s-1),t=(r+1)*x+s,n=(r+1)*(x-1)+s,l.push((r+1)*(x-1)+(s-1),e,n),l.push(e,t,n);this.setIndex(l),this.setAttribute("position",new O(h,3)),this.setAttribute("normal",new O(u,3)),this.setAttribute("uv",new O(d,2))}function Ti(e,t,i,r,n){H.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:n},this.fromBufferGeometry(new Si(e,t,i,r,n)),this.mergeVertices()}function Si(e,t,i,r,n){U.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:n},e=e||1,t=t||.4,i=Math.floor(i)||8,r=Math.floor(r)||6,n=n||2*Math.PI;var a,o,s=[],l=[],h=[],u=[],d=new c,p=new c,f=new c;for(a=0;a<=i;a++)for(o=0;o<=r;o++){var m=o/r*n,g=a/i*Math.PI*2;p.x=(e+t*Math.cos(g))*Math.cos(m),p.y=(e+t*Math.cos(g))*Math.sin(m),p.z=t*Math.sin(g),l.push(p.x,p.y,p.z),d.x=e*Math.cos(m),d.y=e*Math.sin(m),f.subVectors(p,d).normalize(),h.push(f.x,f.y,f.z),u.push(o/r),u.push(a/i)}for(a=1;a<=i;a++)for(o=1;o<=r;o++)e=(r+1)*(a-1)+o-1,t=(r+1)*(a-1)+o,n=(r+1)*a+o,s.push((r+1)*a+o-1,e,n),s.push(e,t,n);this.setIndex(s),this.setAttribute("position",new O(l,3)),this.setAttribute("normal",new O(h,3)),this.setAttribute("uv",new O(u,2))}function Ei(e,t,i,r,n){for(var a,o=0,s=t,l=i-r;s<i;s+=r)o+=(e[l]-e[s])*(e[s+1]+e[l+1]),l=s;if(n===0<o)for(n=t;n<i;n+=r)a=Vi(n,e[n],e[n+1],a);else for(n=i-r;n>=t;n-=r)a=Vi(n,e[n],e[n+1],a);return a&&Oi(a,a.next)&&(Gi(a),a=a.next),a}function Ai(e,t){if(!e)return e;t||(t=e);do{var i=!1;if(e.steiner||!Oi(e,e.next)&&0!==zi(e.prev,e,e.next))e=e.next;else{if(Gi(e),(e=t=e.prev)===e.next)break;i=!0}}while(i||e!==t);return t}function Ci(e,t,i,r,n,a,o){if(e){if(!o&&a){var s=e,l=s;do{null===l.z&&(l.z=Ri(l.x,l.y,r,n,a)),l.prevZ=l.prev,l=l.nextZ=l.next}while(l!==s);l.prevZ.nextZ=null,l.prevZ=null,s=l;var c,h,u,d,p=1;do{l=s;var f=s=null;for(h=0;l;){h++;var m=l;for(c=u=0;c<p&&(u++,m=m.nextZ);c++);for(d=p;0<u||0<d&&m;)0!==u&&(0===d||!m||l.z<=m.z)?(c=l,l=l.nextZ,u--):(c=m,m=m.nextZ,d--),f?f.nextZ=c:s=c,c.prevZ=f,f=c;l=m}f.nextZ=null,p*=2}while(1<h)}for(s=e;e.prev!==e.next;){if(l=e.prev,m=e.next,a)f=Li(e,r,n,a);else e:if(f=e,h=f.prev,u=f,p=f.next,0<=zi(h,u,p))f=!1;else{for(c=f.next.next;c!==f.prev;){if(ki(h.x,h.y,u.x,u.y,p.x,p.y,c.x,c.y)&&0<=zi(c.prev,c,c.next)){f=!1;break e}c=c.next}f=!0}if(f)t.push(l.i/i),t.push(e.i/i),t.push(m.i/i),Gi(e),s=e=m.next;else if((e=m)===s){if(o){if(1===o){o=t,s=i,l=e=Ai(e);do{!Oi(m=l.prev,f=l.next.next)&&Bi(m,l,l.next,f)&&Ui(m,f)&&Ui(f,m)&&(o.push(m.i/s),o.push(l.i/s),o.push(f.i/s),Gi(l),Gi(l.next),l=e=f),l=l.next}while(l!==e);Ci(e=Ai(l),t,i,r,n,a,2)}else if(2===o)e:{o=e;do{for(s=o.next.next;s!==o.prev;){if(l=o.i!==s.i){if(m=s,f=(l=o).next.i!==m.i&&l.prev.i!==m.i){t:{f=l;do{if(f.i!==l.i&&f.next.i!==l.i&&f.i!==m.i&&f.next.i!==m.i&&Bi(f,f.next,l,m)){f=!0;break t}f=f.next}while(f!==l);f=!1}f=!f}if(f){if(f=Ui(l,m)&&Ui(m,l)){f=l,h=!1,u=(l.x+m.x)/2,p=(l.y+m.y)/2;do{f.y>p!=f.next.y>p&&f.next.y!==f.y&&u<(f.next.x-f.x)*(p-f.y)/(f.next.y-f.y)+f.x&&(h=!h),f=f.next}while(f!==l);f=h}f=f&&(zi(l.prev,l,m.prev)||zi(l,m.prev,m))||Oi(l,m)&&0<zi(l.prev,l,l.next)&&0<zi(m.prev,m,m.next)}l=f}if(l){e=ji(o,s),o=Ai(o,o.next),e=Ai(e,e.next),Ci(o,t,i,r,n,a),Ci(e,t,i,r,n,a);break e}s=s.next}o=o.next}while(o!==e)}}else Ci(Ai(e),t,i,r,n,a,1);break}}}}function Li(e,t,i,r){var n=e.prev,a=e.next;if(0<=zi(n,e,a))return!1;var o=n.x>e.x?n.x>a.x?n.x:a.x:e.x>a.x?e.x:a.x,s=n.y>e.y?n.y>a.y?n.y:a.y:e.y>a.y?e.y:a.y,l=Ri(n.x<e.x?n.x<a.x?n.x:a.x:e.x<a.x?e.x:a.x,n.y<e.y?n.y<a.y?n.y:a.y:e.y<a.y?e.y:a.y,t,i,r);for(t=Ri(o,s,t,i,r),i=e.prevZ,r=e.nextZ;i&&i.z>=l&&r&&r.z<=t;){if(i!==e.prev&&i!==e.next&&ki(n.x,n.y,e.x,e.y,a.x,a.y,i.x,i.y)&&0<=zi(i.prev,i,i.next))return!1;if(i=i.prevZ,r!==e.prev&&r!==e.next&&ki(n.x,n.y,e.x,e.y,a.x,a.y,r.x,r.y)&&0<=zi(r.prev,r,r.next))return!1;r=r.nextZ}for(;i&&i.z>=l;){if(i!==e.prev&&i!==e.next&&ki(n.x,n.y,e.x,e.y,a.x,a.y,i.x,i.y)&&0<=zi(i.prev,i,i.next))return!1;i=i.prevZ}for(;r&&r.z<=t;){if(r!==e.prev&&r!==e.next&&ki(n.x,n.y,e.x,e.y,a.x,a.y,r.x,r.y)&&0<=zi(r.prev,r,r.next))return!1;r=r.nextZ}return!0}function Pi(e,t){return e.x-t.x}function Ii(e,t){var i=t,r=e.x,n=e.y,a=-1/0;do{if(n<=i.y&&n>=i.next.y&&i.next.y!==i.y){var o=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(o<=r&&o>a){if(a=o,o===r){if(n===i.y)return i;if(n===i.next.y)return i.next}var s=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!s)return null;if(r===a)return s;t=s,o=s.x;var l=s.y,c=1/0;i=s;do{if(r>=i.x&&i.x>=o&&r!==i.x&&ki(n<l?r:a,n,o,l,n<l?a:r,n,i.x,i.y)){var h,u=Math.abs(n-i.y)/(r-i.x);if((h=Ui(i,e))&&!(h=u<c)&&(h=u===c)&&!(h=i.x>s.x)&&(h=i.x===s.x)){var d=i;h=0>zi((h=s).prev,h,d.prev)&&0>zi(d.next,h,h.next)}h&&(s=i,c=u)}i=i.next}while(i!==t);return s}function Ri(e,t,i,r,n){return 1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1)|(1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Di(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function ki(e,t,i,r,n,a,o,s){return 0<=(n-o)*(t-s)-(e-o)*(a-s)&&0<=(e-o)*(r-s)-(i-o)*(t-s)&&0<=(i-o)*(a-s)-(n-o)*(r-s)}function zi(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function Oi(e,t){return e.x===t.x&&e.y===t.y}function Bi(e,t,i,r){var n=Ni(zi(e,t,i)),a=Ni(zi(e,t,r)),o=Ni(zi(i,r,e)),s=Ni(zi(i,r,t));return!!(n!==a&&o!==s||0===n&&Fi(e,i,t)||0===a&&Fi(e,r,t)||0===o&&Fi(i,e,r)||0===s&&Fi(i,t,r))}function Fi(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function Ni(e){return 0<e?1:0>e?-1:0}function Ui(e,t){return 0>zi(e.prev,e,e.next)?0<=zi(e,t,e.next)&&0<=zi(e,e.prev,t):0>zi(e,t,e.prev)||0>zi(e,e.next,t)}function ji(e,t){var i=new Hi(e.i,e.x,e.y),r=new Hi(t.i,t.x,t.y),n=e.next,a=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,a.next=r,r.prev=a,r}function Vi(e,t,i,r){return e=new Hi(e,t,i),r?(e.next=r.next,e.prev=r,r.next.prev=e,r.next=e):(e.prev=e,e.next=e),e}function Gi(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Hi(e,t,i){this.i=e,this.x=t,this.y=i,this.nextZ=this.prevZ=this.z=this.next=this.prev=null,this.steiner=!1}function Wi(e){var t=e.length;2<t&&e[t-1].equals(e[0])&&e.pop()}function qi(e,t){for(var i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}function Zi(e,t){H.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new Xi(e,t)),this.mergeVertices()}function Xi(e,t){function r(e){function r(e,t,i){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(i).add(e)}function s(e,t,r){var n=e.x-t.x,a=e.y-t.y,o=r.x-e.x,s=r.y-e.y,l=n*n+a*a;if(Math.abs(n*s-a*o)>Number.EPSILON){var c=Math.sqrt(l),h=Math.sqrt(o*o+s*s);if(l=t.x-a/c,t=t.y+n/c,2>=(a=(o=l+n*(s=((r.x-s/h-l)*s-(r.y+o/h-t)*o)/(n*s-a*o))-e.x)*o+(n=t+a*s-e.y)*n))return new i(o,n);a=Math.sqrt(a/2)}else e=!1,n>Number.EPSILON?o>Number.EPSILON&&(e=!0):n<-Number.EPSILON?o<-Number.EPSILON&&(e=!0):Math.sign(a)===Math.sign(s)&&(e=!0),e?(o=-a,a=Math.sqrt(l)):(o=n,n=a,a=Math.sqrt(l/2));return new i(o/a,n/a)}function l(e,t){for(j=e.length;0<=--j;){var i=j,r=j-1;0>r&&(r=e.length-1);var o,s=g+2*w;for(o=0;o<s;o++){var l=N*o,c=N*(o+1),h=t+r+l,u=t+r+c;c=t+i+c,d(t+i+l),d(h),d(c),d(h),d(u),d(c),l=a.length/3,p((l=T.generateSideWallUV(n,a,l-6,l-3,l-2,l-1))[0]),p(l[1]),p(l[3]),p(l[1]),p(l[2]),p(l[3])}}}function h(e,t,i){f.push(e),f.push(t),f.push(i)}function u(e,t,i){d(e),d(t),d(i),e=a.length/3,p((e=T.generateTopUV(n,a,e-3,e-2,e-1))[0]),p(e[1]),p(e[2])}function d(e){a.push(f[3*e]),a.push(f[3*e+1]),a.push(f[3*e+2])}function p(e){o.push(e.x),o.push(e.y)}var f=[],m=void 0!==t.curveSegments?t.curveSegments:12,g=void 0!==t.steps?t.steps:1,y=void 0!==t.depth?t.depth:100,v=void 0===t.bevelEnabled||t.bevelEnabled,_=void 0!==t.bevelThickness?t.bevelThickness:6,x=void 0!==t.bevelSize?t.bevelSize:_-2,b=void 0!==t.bevelOffset?t.bevelOffset:0,w=void 0!==t.bevelSegments?t.bevelSegments:3,M=t.extrudePath,T=void 0!==t.UVGenerator?t.UVGenerator:Cl;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),y=t.amount);var S,E=!1;if(M){var A=M.getSpacedPoints(g);E=!0,v=!1;var C=M.computeFrenetFrames(g,!1),L=new c,P=new c,I=new c}v||(b=x=_=w=0),m=e.extractPoints(m),e=m.shape;var R=m.holes;if(!Al.isClockWise(e)){e=e.reverse();var D=0;for(S=R.length;D<S;D++){var k=R[D];Al.isClockWise(k)&&(R[D]=k.reverse())}}var z=Al.triangulateShape(e,R),O=e;for(D=0,S=R.length;D<S;D++)k=R[D],e=e.concat(k);var B,F,N=e.length,U=z.length;m=[];var j=0,V=O.length,G=V-1;for(B=j+1;j<V;j++,G++,B++)G===V&&(G=0),B===V&&(B=0),m[j]=s(O[j],O[G],O[B]);M=[];var H=m.concat();for(D=0,S=R.length;D<S;D++){k=R[D];var W=[];for(j=0,G=(V=k.length)-1,B=j+1;j<V;j++,G++,B++)G===V&&(G=0),B===V&&(B=0),W[j]=s(k[j],k[G],k[B]);M.push(W),H=H.concat(W)}for(G=0;G<w;G++){V=G/w;var q=_*Math.cos(V*Math.PI/2);for(B=x*Math.sin(V*Math.PI/2)+b,j=0,V=O.length;j<V;j++){var Z=r(O[j],m[j],B);h(Z.x,Z.y,-q)}for(D=0,S=R.length;D<S;D++)for(k=R[D],W=M[D],j=0,V=k.length;j<V;j++)h((Z=r(k[j],W[j],B)).x,Z.y,-q)}for(B=x+b,j=0;j<N;j++)Z=v?r(e[j],H[j],B):e[j],E?(P.copy(C.normals[0]).multiplyScalar(Z.x),L.copy(C.binormals[0]).multiplyScalar(Z.y),I.copy(A[0]).add(P).add(L),h(I.x,I.y,I.z)):h(Z.x,Z.y,0);for(V=1;V<=g;V++)for(j=0;j<N;j++)Z=v?r(e[j],H[j],B):e[j],E?(P.copy(C.normals[V]).multiplyScalar(Z.x),L.copy(C.binormals[V]).multiplyScalar(Z.y),I.copy(A[V]).add(P).add(L),h(I.x,I.y,I.z)):h(Z.x,Z.y,y/g*V);for(G=w-1;0<=G;G--){for(V=G/w,q=_*Math.cos(V*Math.PI/2),B=x*Math.sin(V*Math.PI/2)+b,j=0,V=O.length;j<V;j++)h((Z=r(O[j],m[j],B)).x,Z.y,y+q);for(D=0,S=R.length;D<S;D++)for(k=R[D],W=M[D],j=0,V=k.length;j<V;j++)Z=r(k[j],W[j],B),E?h(Z.x,Z.y+A[g-1].y,A[g-1].x+q):h(Z.x,Z.y,y+q)}!function(){var e=a.length/3;if(v){var t=0*N;for(j=0;j<U;j++)u((F=z[j])[2]+t,F[1]+t,F[0]+t);for(t=N*(g+2*w),j=0;j<U;j++)u((F=z[j])[0]+t,F[1]+t,F[2]+t)}else{for(j=0;j<U;j++)u((F=z[j])[2],F[1],F[0]);for(j=0;j<U;j++)u((F=z[j])[0]+N*g,F[1]+N*g,F[2]+N*g)}n.addGroup(e,a.length/3-e,0)}(),function(){var e=a.length/3,t=0;for(l(O,t),t+=O.length,D=0,S=R.length;D<S;D++)l(k=R[D],t),t+=k.length;n.addGroup(e,a.length/3-e,1)}()}U.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];for(var n=this,a=[],o=[],s=0,l=e.length;s<l;s++)r(e[s]);this.setAttribute("position",new O(a,3)),this.setAttribute("uv",new O(o,2)),this.computeVertexNormals()}function $i(e,t,i){if(i.shapes=[],Array.isArray(e))for(var r=0,n=e.length;r<n;r++)i.shapes.push(e[r].uuid);else i.shapes.push(e.uuid);return void 0!==t.extrudePath&&(i.options.extrudePath=t.extrudePath.toJSON()),i}function Yi(e,t){H.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new Ji(e,t)),this.mergeVertices()}function Ji(e,t){var i=(t=t||{}).font;if(!i||!i.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new H;e=i.generateShapes(e,t.size),t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),Xi.call(this,e,t),this.type="TextBufferGeometry"}function Ki(e,t,i,r,n,a,o){H.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:n,thetaStart:a,thetaLength:o},this.fromBufferGeometry(new Qi(e,t,i,r,n,a,o)),this.mergeVertices()}function Qi(e,t,i,r,n,a,o){U.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:n,thetaStart:a,thetaLength:o},e=e||1,t=Math.max(3,Math.floor(t)||8),i=Math.max(2,Math.floor(i)||6),r=void 0!==r?r:0,n=void 0!==n?n:2*Math.PI,a=void 0!==a?a:0,o=void 0!==o?o:Math.PI;var s,l,h=Math.min(a+o,Math.PI),u=0,d=[],p=new c,f=new c,m=[],g=[],y=[],v=[];for(l=0;l<=i;l++){var _=[],x=l/i,b=0;for(0==l&&0==a?b=.5/t:l==i&&h==Math.PI&&(b=-.5/t),s=0;s<=t;s++){var w=s/t;p.x=-e*Math.cos(r+w*n)*Math.sin(a+x*o),p.y=e*Math.cos(a+x*o),p.z=e*Math.sin(r+w*n)*Math.sin(a+x*o),g.push(p.x,p.y,p.z),f.copy(p).normalize(),y.push(f.x,f.y,f.z),v.push(w+b,1-x),_.push(u++)}d.push(_)}for(l=0;l<i;l++)for(s=0;s<t;s++)e=d[l][s+1],r=d[l][s],n=d[l+1][s],o=d[l+1][s+1],(0!==l||0<a)&&m.push(e,r,o),(l!==i-1||h<Math.PI)&&m.push(r,n,o);this.setIndex(m),this.setAttribute("position",new O(g,3)),this.setAttribute("normal",new O(y,3)),this.setAttribute("uv",new O(v,2))}function er(e,t,i,r,n,a){H.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:r,thetaStart:n,thetaLength:a},this.fromBufferGeometry(new tr(e,t,i,r,n,a)),this.mergeVertices()}function tr(e,t,r,n,a,o){U.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:n,thetaStart:a,thetaLength:o},e=e||.5,t=t||1,a=void 0!==a?a:0,o=void 0!==o?o:2*Math.PI,r=void 0!==r?Math.max(3,r):8;var s,l,h=[],u=[],d=[],p=[],f=e,m=(t-e)/(n=void 0!==n?Math.max(1,n):1),g=new c,y=new i;for(s=0;s<=n;s++){for(l=0;l<=r;l++)e=a+l/r*o,g.x=f*Math.cos(e),g.y=f*Math.sin(e),u.push(g.x,g.y,g.z),d.push(0,0,1),y.x=(g.x/t+1)/2,y.y=(g.y/t+1)/2,p.push(y.x,y.y);f+=m}for(s=0;s<n;s++)for(t=s*(r+1),l=0;l<r;l++)a=(e=l+t)+r+1,o=e+r+2,f=e+1,h.push(e,a,f),h.push(a,o,f);this.setIndex(h),this.setAttribute("position",new O(u,3)),this.setAttribute("normal",new O(d,3)),this.setAttribute("uv",new O(p,2))}function ir(e,t,i,r){H.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:r},this.fromBufferGeometry(new rr(e,t,i,r)),this.mergeVertices()}function rr(e,t,r,n){U.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:n},t=Math.floor(t)||12,r=r||0,n=n||2*Math.PI,n=Ia.clamp(n,0,2*Math.PI);var a,o=[],s=[],l=[],h=1/t,u=new c,d=new i;for(a=0;a<=t;a++){var p=r+a*h*n,f=Math.sin(p),m=Math.cos(p);for(p=0;p<=e.length-1;p++)u.x=e[p].x*f,u.y=e[p].y,u.z=e[p].x*m,s.push(u.x,u.y,u.z),d.x=a/t,d.y=p/(e.length-1),l.push(d.x,d.y)}for(a=0;a<t;a++)for(p=0;p<e.length-1;p++)h=(r=p+a*e.length)+e.length,u=r+e.length+1,d=r+1,o.push(r,h,d),o.push(h,u,d);if(this.setIndex(o),this.setAttribute("position",new O(s,3)),this.setAttribute("uv",new O(l,2)),this.computeVertexNormals(),n===2*Math.PI)for(n=this.attributes.normal.array,o=new c,s=new c,l=new c,r=t*e.length*3,p=a=0;a<e.length;a++,p+=3)o.x=n[p+0],o.y=n[p+1],o.z=n[p+2],s.x=n[r+p+0],s.y=n[r+p+1],s.z=n[r+p+2],l.addVectors(o,s).normalize(),n[p+0]=n[r+p+0]=l.x,n[p+1]=n[r+p+1]=l.y,n[p+2]=n[r+p+2]=l.z}function nr(e,t){H.call(this),this.type="ShapeGeometry","object"==typeof t&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new ar(e,t)),this.mergeVertices()}function ar(e,t){function i(e){var i,s=n.length/3,c=(e=e.extractPoints(t)).shape,h=e.holes;for(!1===Al.isClockWise(c)&&(c=c.reverse()),e=0,i=h.length;e<i;e++){var u=h[e];!0===Al.isClockWise(u)&&(h[e]=u.reverse())}var d=Al.triangulateShape(c,h);for(e=0,i=h.length;e<i;e++)u=h[e],c=c.concat(u);for(e=0,i=c.length;e<i;e++)u=c[e],n.push(u.x,u.y,0),a.push(0,0,1),o.push(u.x,u.y);for(e=0,i=d.length;e<i;e++)c=d[e],r.push(c[0]+s,c[1]+s,c[2]+s),l+=3}U.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;var r=[],n=[],a=[],o=[],s=0,l=0;if(!1===Array.isArray(e))i(e);else for(var c=0;c<e.length;c++)i(e[c]),this.addGroup(s,l,c),s+=l,l=0;this.setIndex(r),this.setAttribute("position",new O(n,3)),this.setAttribute("normal",new O(a,3)),this.setAttribute("uv",new O(o,2))}function or(e,t){if(t.shapes=[],Array.isArray(e))for(var i=0,r=e.length;i<r;i++)t.shapes.push(e[i].uuid);else t.shapes.push(e.uuid);return t}function sr(e,t){U.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t};var i=[];t=Math.cos(Ia.DEG2RAD*(void 0!==t?t:1));var r=[0,0],n={},a=["a","b","c"];if(e.isBufferGeometry){var o=new H;o.fromBufferGeometry(e)}else o=e.clone();o.mergeVertices(),o.computeFaceNormals(),e=o.vertices;for(var s=0,l=(o=o.faces).length;s<l;s++)for(var c=o[s],h=0;3>h;h++){var u=c[a[h]],d=c[a[(h+1)%3]];r[0]=Math.min(u,d),r[1]=Math.max(u,d),void 0===n[u=r[0]+","+r[1]]?n[u]={index1:r[0],index2:r[1],face1:s,face2:void 0}:n[u].face2=s}for(u in n)(void 0===(r=n[u]).face2||o[r.face1].normal.dot(o[r.face2].normal)<=t)&&(a=e[r.index1],i.push(a.x,a.y,a.z),a=e[r.index2],i.push(a.x,a.y,a.z));this.setAttribute("position",new O(i,3))}function lr(e,t,i,r,n,a,o,s){H.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:n,openEnded:a,thetaStart:o,thetaLength:s},this.fromBufferGeometry(new cr(e,t,i,r,n,a,o,s)),this.mergeVertices()}function cr(e,t,r,n,a,o,s,l){function h(r){var a,o=new i,h=new c,y=0,x=!0===r?e:t,b=!0===r?1:-1,w=g;for(a=1;a<=n;a++)p.push(0,v*b,0),f.push(0,b,0),m.push(.5,.5),g++;var M=g;for(a=0;a<=n;a++){var T=a/n*l+s,S=Math.cos(T);T=Math.sin(T),h.x=x*T,h.y=v*b,h.z=x*S,p.push(h.x,h.y,h.z),f.push(0,b,0),o.x=.5*S+.5,o.y=.5*T*b+.5,m.push(o.x,o.y),g++}for(a=0;a<n;a++)o=w+a,h=M+a,!0===r?d.push(h,h+1,o):d.push(h+1,h,o),y+=3;u.addGroup(_,y,!0===r?1:2),_+=y}U.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:n,heightSegments:a,openEnded:o,thetaStart:s,thetaLength:l};var u=this;e=void 0!==e?e:1,t=void 0!==t?t:1,r=r||1,n=Math.floor(n)||8,a=Math.floor(a)||1,o=void 0!==o&&o,s=void 0!==s?s:0,l=void 0!==l?l:2*Math.PI;var d=[],p=[],f=[],m=[],g=0,y=[],v=r/2,_=0;!function(){var i,o,h=new c,x=new c,b=0,w=(t-e)/r;for(o=0;o<=a;o++){var M=[],T=o/a,S=T*(t-e)+e;for(i=0;i<=n;i++){var E=i/n,A=E*l+s,C=Math.sin(A);A=Math.cos(A),x.x=S*C,x.y=-T*r+v,x.z=S*A,p.push(x.x,x.y,x.z),h.set(C,w,A).normalize(),f.push(h.x,h.y,h.z),m.push(E,1-T),M.push(g++)}y.push(M)}for(i=0;i<n;i++)for(o=0;o<a;o++)h=y[o+1][i],x=y[o+1][i+1],w=y[o][i+1],d.push(y[o][i],h,w),d.push(h,x,w),b+=6;u.addGroup(_,b,0),_+=b}(),!1===o&&(0<e&&h(!0),0<t&&h(!1)),this.setIndex(d),this.setAttribute("position",new O(p,3)),this.setAttribute("normal",new O(f,3)),this.setAttribute("uv",new O(m,2))}function hr(e,t,i,r,n,a,o){lr.call(this,0,e,t,i,r,n,a,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:n,thetaStart:a,thetaLength:o}}function ur(e,t,i,r,n,a,o){cr.call(this,0,e,t,i,r,n,a,o),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:n,thetaStart:a,thetaLength:o}}function dr(e,t,i,r){H.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:r},this.fromBufferGeometry(new pr(e,t,i,r)),this.mergeVertices()}function pr(e,t,r,n){U.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:n},e=e||1,t=void 0!==t?Math.max(3,t):8,r=void 0!==r?r:0,n=void 0!==n?n:2*Math.PI;var a,o=[],s=[],l=[],h=[],u=new c,d=new i;s.push(0,0,0),l.push(0,0,1),h.push(.5,.5);var p=0;for(a=3;p<=t;p++,a+=3){var f=r+p/t*n;u.x=e*Math.cos(f),u.y=e*Math.sin(f),s.push(u.x,u.y,u.z),l.push(0,0,1),d.x=(s[a]/e+1)/2,d.y=(s[a+1]/e+1)/2,h.push(d.x,d.y)}for(a=1;a<=t;a++)o.push(a,a+1,0);this.setIndex(o),this.setAttribute("position",new O(s,3)),this.setAttribute("normal",new O(l,3)),this.setAttribute("uv",new O(h,2))}function fr(e){E.call(this),this.type="ShadowMaterial",this.color=new b(0),this.transparent=!0,this.setValues(e)}function mr(e){Z.call(this,e),this.type="RawShaderMaterial"}function gr(e){E.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new b(16777215),this.roughness=1,this.metalness=0,this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new b(0),this.emissiveIntensity=1,this.bumpMap=this.emissiveMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new i(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.envMap=this.alphaMap=this.metalnessMap=this.roughnessMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexTangents=this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)}function yr(e){gr.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new i(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,this.sheen=null,this.transparency=0,this.setValues(e)}function vr(e){E.call(this),this.type="MeshPhongMaterial",this.color=new b(16777215),this.specular=new b(1118481),this.shininess=30,this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new b(0),this.emissiveIntensity=1,this.bumpMap=this.emissiveMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new i(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.envMap=this.alphaMap=this.specularMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)}function _r(e){E.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new b(16777215),this.specular=new b(1118481),this.shininess=30,this.lightMap=this.gradientMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new b(0),this.emissiveIntensity=1,this.bumpMap=this.emissiveMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new i(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=this.specularMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)}function xr(e){E.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new i(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.morphNormals=this.morphTargets=this.skinning=this.fog=!1,this.setValues(e)}function br(e){E.call(this),this.type="MeshLambertMaterial",this.color=new b(16777215),this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new b(0),this.emissiveIntensity=1,this.envMap=this.alphaMap=this.specularMap=this.emissiveMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)}function wr(e){E.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new b(16777215),this.bumpMap=this.map=this.matcap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new i(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)}function Mr(e){Yt.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}function Tr(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i}function Sr(e,t,i,r){Tr.call(this,e,t,i,r),this._offsetNext=this._weightNext=this._offsetPrev=this._weightPrev=-0}function Er(e,t,i,r){Tr.call(this,e,t,i,r)}function Ar(e,t,i,r){Tr.call(this,e,t,i,r)}function Cr(e,t,i,r){if(void 0===e)throw Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Il.convertArray(t,this.TimeBufferType),this.values=Il.convertArray(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}function Lr(e,t,i){Cr.call(this,e,t,i)}function Pr(e,t,i,r){Cr.call(this,e,t,i,r)}function Ir(e,t,i,r){Cr.call(this,e,t,i,r)}function Rr(e,t,i,r){Tr.call(this,e,t,i,r)}function Dr(e,t,i,r){Cr.call(this,e,t,i,r)}function kr(e,t,i,r){Cr.call(this,e,t,i,r)}function zr(e,t,i,r){Cr.call(this,e,t,i,r)}function Or(e,t,i,r){this.name=e,this.tracks=i,this.duration=void 0!==t?t:-1,this.blendMode=void 0!==r?r:2500,this.uuid=Ia.generateUUID(),0>this.duration&&this.resetDuration()}function Br(e){if(void 0===e.type)throw Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Ir;case"vector":case"vector2":case"vector3":case"vector4":return zr;case"color":return Pr;case"quaternion":return Dr;case"bool":case"boolean":return Lr;case"string":return kr}throw Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){var i=[],r=[];Il.flattenJSON(e.keys,i,r,"value"),e.times=i,e.values=r}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}function Fr(e,t,i){var r=this,n=!1,a=0,o=0,s=void 0,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(e){o++,!1===n&&void 0!==r.onStart&&r.onStart(e,a,o),n=!0},this.itemEnd=function(e){a++,void 0!==r.onProgress&&r.onProgress(e,a,o),a===o&&(n=!1,void 0!==r.onLoad)&&r.onLoad()},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){return-1!==(e=l.indexOf(e))&&l.splice(e,2),this},this.getHandler=function(e){for(var t=0,i=l.length;t<i;t+=2){var r=l[t],n=l[t+1];if(r.global&&(r.lastIndex=0),r.test(e))return n}return null}}function Nr(e){this.manager=void 0!==e?e:Dl,this.crossOrigin="anonymous",this.resourcePath=this.path="",this.requestHeader={}}function Ur(e){Nr.call(this,e)}function jr(e){Nr.call(this,e)}function Vr(e){Nr.call(this,e)}function Gr(e){Nr.call(this,e)}function Hr(e){Nr.call(this,e)}function Wr(e){Nr.call(this,e)}function qr(e){Nr.call(this,e)}function Zr(){this.type="Curve",this.arcLengthDivisions=200}function Xr(e,t,i,r,n,a,o,s){Zr.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=i||1,this.yRadius=r||1,this.aStartAngle=n||0,this.aEndAngle=a||2*Math.PI,this.aClockwise=o||!1,this.aRotation=s||0}function $r(e,t,i,r,n,a){Xr.call(this,e,t,i,i,r,n,a),this.type="ArcCurve"}function Yr(){var e=0,t=0,i=0,r=0;return{initCatmullRom:function(n,a,o,s,l){e=a,t=n=l*(o-n),i=-3*a+3*o-2*n-(s=l*(s-a)),r=2*a-2*o+n+s},initNonuniformCatmullRom:function(n,a,o,s,l,c,h){e=a,t=n=((a-n)/l-(o-n)/(l+c)+(o-a)/c)*c,i=-3*a+3*o-2*n-(s=((o-a)/c-(s-a)/(c+h)+(s-o)/h)*c),r=2*a-2*o+n+s},calc:function(n){var a=n*n;return e+t*n+i*a+r*a*n}}}function Jr(e,t,i,r){Zr.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=i||"centripetal",this.tension=r||.5}function Kr(e,t,i,r,n){var a=e*e;return(2*i-2*r+(t=.5*(r-t))+(n=.5*(n-i)))*e*a+(-3*i+3*r-2*t-n)*a+t*e+i}function Qr(e,t,i,r){var n=1-e;return n*n*t+2*(1-e)*e*i+e*e*r}function en(e,t,i,r,n){var a=1-e,o=1-e;return a*a*a*t+3*o*o*e*i+3*(1-e)*e*e*r+e*e*e*n}function tn(e,t,r,n){Zr.call(this),this.type="CubicBezierCurve",this.v0=e||new i,this.v1=t||new i,this.v2=r||new i,this.v3=n||new i}function rn(e,t,i,r){Zr.call(this),this.type="CubicBezierCurve3",this.v0=e||new c,this.v1=t||new c,this.v2=i||new c,this.v3=r||new c}function nn(e,t){Zr.call(this),this.type="LineCurve",this.v1=e||new i,this.v2=t||new i}function an(e,t){Zr.call(this),this.type="LineCurve3",this.v1=e||new c,this.v2=t||new c}function on(e,t,r){Zr.call(this),this.type="QuadraticBezierCurve",this.v0=e||new i,this.v1=t||new i,this.v2=r||new i}function sn(e,t,i){Zr.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new c,this.v1=t||new c,this.v2=i||new c}function ln(e){Zr.call(this),this.type="SplineCurve",this.points=e||[]}function cn(){Zr.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function hn(e){cn.call(this),this.type="Path",this.currentPoint=new i,e&&this.setFromPoints(e)}function un(e){hn.call(this,e),this.uuid=Ia.generateUUID(),this.type="Shape",this.holes=[]}function dn(e,t){p.call(this),this.type="Light",this.color=new b(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}function pn(e,t,i){dn.call(this,e,i),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(p.DefaultUp),this.updateMatrix(),this.groundColor=new b(t)}function fn(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new i(512,512),this.mapPass=this.map=null,this.matrix=new h,this._frustum=new Q,this._frameExtents=new i(1,1),this._viewportCount=1,this._viewports=[new a(0,0,1,1)]}function mn(){fn.call(this,new $(50,1,.5,500))}function gn(e,t,i,r,n,a){dn.call(this,e,t),this.type="SpotLight",this.position.copy(p.DefaultUp),this.updateMatrix(),this.target=new p,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==i?i:0,this.angle=void 0!==r?r:Math.PI/3,this.penumbra=void 0!==n?n:0,this.decay=void 0!==a?a:1,this.shadow=new mn}function yn(){fn.call(this,new $(90,1,.5,500)),this._frameExtents=new i(4,2),this._viewportCount=6,this._viewports=[new a(2,1,1,1),new a(0,1,1,1),new a(3,1,1,1),new a(1,1,1,1),new a(3,0,1,1),new a(1,0,1,1)],this._cubeDirections=[new c(1,0,0),new c(-1,0,0),new c(0,0,1),new c(0,0,-1),new c(0,1,0),new c(0,-1,0)],this._cubeUps=[new c(0,1,0),new c(0,1,0),new c(0,1,0),new c(0,1,0),new c(0,0,1),new c(0,0,-1)]}function vn(e,t,i,r){dn.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==i?i:0,this.decay=void 0!==r?r:1,this.shadow=new yn}function _n(e,t,i,r,n,a){X.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==e?e:-1,this.right=void 0!==t?t:1,this.top=void 0!==i?i:1,this.bottom=void 0!==r?r:-1,this.near=void 0!==n?n:.1,this.far=void 0!==a?a:2e3,this.updateProjectionMatrix()}function xn(){fn.call(this,new _n(-5,5,5,-5,.5,500))}function bn(e,t){dn.call(this,e,t),this.type="DirectionalLight",this.position.copy(p.DefaultUp),this.updateMatrix(),this.target=new p,this.shadow=new xn}function wn(e,t){dn.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function Mn(e,t,i,r){dn.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==i?i:10,this.height=void 0!==r?r:10}function Tn(){this.coefficients=[];for(var e=0;9>e;e++)this.coefficients.push(new c)}function Sn(e,t){dn.call(this,void 0,t),this.type="LightProbe",this.sh=void 0!==e?e:new Tn}function En(e){Nr.call(this,e),this.textures={}}function An(){U.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}function Cn(e,t,i,r){"number"==typeof i&&(r=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),C.call(this,e,t,i),this.meshPerAttribute=r||1}function Ln(e){Nr.call(this,e)}function Pn(e){Nr.call(this,e)}function In(e){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),Nr.call(this,e),this.options=void 0}function Rn(){this.type="ShapePath",this.color=new b,this.subPaths=[],this.currentPath=null}function Dn(e){this.type="Font",this.data=e}function kn(e){Nr.call(this,e)}function zn(e){Nr.call(this,e)}function On(e,t,i){Sn.call(this,void 0,i),e=(new b).set(e),i=(new b).set(t),t=new c(e.r,e.g,e.b),e=new c(i.r,i.g,i.b);var r=(i=Math.sqrt(Math.PI))*Math.sqrt(.75);this.sh.coefficients[0].copy(t).add(e).multiplyScalar(i),this.sh.coefficients[1].copy(t).sub(e).multiplyScalar(r)}function Bn(e,t){Sn.call(this,void 0,t),e=(new b).set(e),this.sh.coefficients[0].set(e.r,e.g,e.b).multiplyScalar(2*Math.sqrt(Math.PI))}function Fn(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new $,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new $,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}function Nn(e){this.autoStart=void 0===e||e,this.elapsedTime=this.oldTime=this.startTime=0,this.running=!1}function Un(){p.call(this),this.type="AudioListener",this.context=ql.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Nn}function jn(e){p.call(this),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.offset=this.loopEnd=this.loopStart=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this._progress=this._startedAt=0,this.filters=[]}function Vn(e){jn.call(this,e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}function Gn(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}function Hn(e,t,i){switch(this.binding=e,this.valueSize=i,t){case"quaternion":e=this._slerp,t=this._slerpAdditive;var r=this._setAdditiveIdentityQuaternion;this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":t=e=this._select,r=this._setAdditiveIdentityOther,this.buffer=Array(5*i);break;default:e=this._lerp,t=this._lerpAdditive,r=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=e,this._mixBufferRegionAdditive=t,this._setIdentity=r,this._origIndex=3,this._addIndex=4,this.referenceCount=this.useCount=this.cumulativeWeightAdditive=this.cumulativeWeight=0}function Wn(e,t,i){i=i||qn.parseTrackName(t),this._targetGroup=e,this._bindings=e.subscribe_(t,i)}function qn(e,t,i){this.path=t,this.parsedPath=i||qn.parseTrackName(t),this.node=qn.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function Zn(){this.uuid=Ia.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,i=arguments.length;t!==i;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}}function Xn(e,t,i,r){this._mixer=e,this._clip=t,this._localRoot=i||null,this.blendMode=r||t.blendMode,t=(e=t.tracks).length,i=Array(t),r={endingStart:2400,endingEnd:2400};for(var n=0;n!==t;++n){var a=e[n].createInterpolant(null);i[n]=a,a.settings=r}this._interpolantSettings=r,this._interpolants=i,this._propertyBindings=Array(t),this._weightInterpolant=this._timeScaleInterpolant=this._byClipCacheIndex=this._cacheIndex=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this._effectiveWeight=this.weight=this._effectiveTimeScale=this.timeScale=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtEnd=this.zeroSlopeAtStart=!0}function $n(e){this._root=e,this._initMemoryManager(),this.time=this._accuIndex=0,this.timeScale=1}function Yn(e,t){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=t),this.value=e}function Jn(e,t,i){Ut.call(this,e,t),this.meshPerAttribute=i||1}function Kn(e,t,i,r){this.ray=new v(e,t),this.near=i||0,this.far=r||1/0,this.camera=null,this.layers=new d,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function Qn(e,t){return e.distance-t.distance}function ea(e,t,i,r){if(e.layers.test(t.layers)&&e.raycast(t,i),!0===r){r=0;for(var n=(e=e.children).length;r<n;r++)ea(e[r],t,i,!0)}}function ta(e,t,i){return this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==i?i:0,this}function ia(e,t,i){return this.radius=void 0!==e?e:1,this.theta=void 0!==t?t:0,this.y=void 0!==i?i:0,this}function ra(e,t){this.min=void 0!==e?e:new i(1/0,1/0),this.max=void 0!==t?t:new i(-1/0,-1/0)}function na(e,t){this.start=void 0!==e?e:new c,this.end=void 0!==t?t:new c}function aa(e){p.call(this),this.material=e,this.render=function(){},this.hasUvs=this.hasColors=this.hasNormals=this.hasPositions=!1,this.uvArray=this.colorArray=this.normalArray=this.positionArray=null,this.count=0}function oa(e,t){p.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,e=new U,t=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(var i=0,r=1;32>i;i++,r++){var n=i/32*Math.PI*2,a=r/32*Math.PI*2;t.push(Math.cos(n),Math.sin(n),1,Math.cos(a),Math.sin(a),1)}e.setAttribute("position",new O(t,3)),t=new Yt({fog:!1,toneMapped:!1}),this.cone=new Kt(e,t),this.add(this.cone),this.update()}function sa(e){var t=[];e&&e.isBone&&t.push(e);for(var i=0;i<e.children.length;i++)t.push.apply(t,sa(e.children[i]));return t}function la(e){for(var t=sa(e),i=new U,r=[],n=[],a=new b(0,0,1),o=new b(0,1,0),s=0;s<t.length;s++){var l=t[s];l.parent&&l.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),n.push(a.r,a.g,a.b),n.push(o.r,o.g,o.b))}i.setAttribute("position",new O(r,3)),i.setAttribute("color",new O(n,3)),r=new Yt({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0}),Kt.call(this,i,r),this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}function ca(e,t,i){this.light=e,this.light.updateMatrixWorld(),this.color=i,e=new Qi(t,4,2),t=new A({wireframe:!0,fog:!1,toneMapped:!1}),j.call(this,e,t),this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function ha(e,t,i){p.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,(e=new mi(t)).rotateY(.5*Math.PI),this.material=new A({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0),t=e.getAttribute("position"),t=new Float32Array(3*t.count),e.setAttribute("color",new C(t,3)),this.add(new j(e,this.material)),this.update()}function ua(e,t,i,r){e=e||10,t=t||10,i=new b(void 0!==i?i:4473924),r=new b(void 0!==r?r:8947848);var n=t/2,a=e/t,o=e/2;e=[];for(var s=[],l=0,c=0,h=-o;l<=t;l++,h+=a){e.push(-o,0,h,o,0,h),e.push(h,0,-o,h,0,o);var u=l===n?i:r;u.toArray(s,c),c+=3,u.toArray(s,c),c+=3,u.toArray(s,c),c+=3,u.toArray(s,c),c+=3}(t=new U).setAttribute("position",new O(e,3)),t.setAttribute("color",new O(s,3)),i=new Yt({vertexColors:!0,toneMapped:!1}),Kt.call(this,t,i),this.type="GridHelper"}function da(e,t,i,r,n,a){e=e||10,t=t||16,i=i||8,r=r||64,n=new b(void 0!==n?n:4473924),a=new b(void 0!==a?a:8947848);var o,s=[],l=[];for(o=0;o<=t;o++){var c=o/t*2*Math.PI,h=Math.sin(c)*e;c=Math.cos(c)*e,s.push(0,0,0),s.push(h,0,c);var u=1&o?n:a;l.push(u.r,u.g,u.b),l.push(u.r,u.g,u.b)}for(o=0;o<=i;o++){u=1&o?n:a;var d=e-e/i*o;for(t=0;t<r;t++)c=t/r*2*Math.PI,h=Math.sin(c)*d,c=Math.cos(c)*d,s.push(h,0,c),l.push(u.r,u.g,u.b),c=(t+1)/r*2*Math.PI,h=Math.sin(c)*d,c=Math.cos(c)*d,s.push(h,0,c),l.push(u.r,u.g,u.b)}(e=new U).setAttribute("position",new O(s,3)),e.setAttribute("color",new O(l,3)),s=new Yt({vertexColors:!0,toneMapped:!1}),Kt.call(this,e,s),this.type="PolarGridHelper"}function pa(e,t,i){p.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,void 0===t&&(t=1),(e=new U).setAttribute("position",new O([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3)),t=new Yt({fog:!1,toneMapped:!1}),this.lightPlane=new Jt(e,t),this.add(this.lightPlane),(e=new U).setAttribute("position",new O([0,0,0,0,0,1],3)),this.targetLine=new Jt(e,t),this.add(this.targetLine),this.update()}function fa(e){function t(e,t,r){i(e,r),i(t,r)}function i(e,t){a.push(0,0,0),o.push(t.r,t.g,t.b),void 0===s[e]&&(s[e]=[]),s[e].push(a.length/3-1)}var r=new U,n=new Yt({color:16777215,vertexColors:!0,toneMapped:!1}),a=[],o=[],s={},l=new b(16755200),c=new b(16711680),h=new b(43775),u=new b(16777215),d=new b(3355443);t("n1","n2",l),t("n2","n4",l),t("n4","n3",l),t("n3","n1",l),t("f1","f2",l),t("f2","f4",l),t("f4","f3",l),t("f3","f1",l),t("n1","f1",l),t("n2","f2",l),t("n3","f3",l),t("n4","f4",l),t("p","n1",c),t("p","n2",c),t("p","n3",c),t("p","n4",c),t("u1","u2",h),t("u2","u3",h),t("u3","u1",h),t("c","t",u),t("p","c",d),t("cn1","cn2",d),t("cn3","cn4",d),t("cf1","cf2",d),t("cf3","cf4",d),r.setAttribute("position",new O(a,3)),r.setAttribute("color",new O(o,3)),Kt.call(this,r,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}function ma(e,t,i,r,n,a,o){if(Tc.set(n,a,o).unproject(r),void 0!==(e=t[e]))for(i=i.getAttribute("position"),t=0,r=e.length;t<r;t++)i.setXYZ(e[t],Tc.x,Tc.y,Tc.z)}function ga(e,t){this.object=e,void 0===t&&(t=16776960),e=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);var i=new Float32Array(24),r=new U;r.setIndex(new C(e,1)),r.setAttribute("position",new C(i,3)),Kt.call(this,r,new Yt({color:t,toneMapped:!1})),this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}function ya(e,t){this.type="Box3Helper",this.box=e,t=t||16776960,e=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);var i=new U;i.setIndex(new C(e,1)),i.setAttribute("position",new O([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),Kt.call(this,i,new Yt({color:t,toneMapped:!1})),this.type="Box3Helper",this.geometry.computeBoundingSphere()}function va(e,t,i){this.plane=e,this.size=void 0===t?1:t,e=void 0!==i?i:16776960,(t=new U).setAttribute("position",new O([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),t.computeBoundingSphere(),Jt.call(this,t,new Yt({color:e,toneMapped:!1})),this.type="PlaneHelper",(t=new U).setAttribute("position",new O([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),t.computeBoundingSphere(),this.add(new j(t,new A({color:e,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}function _a(e,t,i,r,n,a){p.call(this),this.type="ArrowHelper",void 0===e&&(e=new c(0,0,1)),void 0===t&&(t=new c(0,0,0)),void 0===i&&(i=1),void 0===r&&(r=16776960),void 0===n&&(n=.2*i),void 0===a&&(a=.2*n),void 0===Ac&&((Ac=new U).setAttribute("position",new O([0,0,0,0,1,0],3)),(Cc=new cr(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new Jt(Ac,new Yt({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new j(Cc,new A({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,n,a)}function xa(e){var t=[0,0,0,e=e||1,0,0,0,0,0,0,e,0,0,0,0,0,0,e];(e=new U).setAttribute("position",new O(t,3)),e.setAttribute("color",new O([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),t=new Yt({vertexColors:!0,toneMapped:!1}),Kt.call(this,e,t),this.type="AxesHelper"}function ba(e){this._renderer=e,this._pingPongRenderTarget=null,(e=new mr({defines:{n:20},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:e=new Float32Array(20)},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:new c(0,1,0)},inputEncoding:{value:Dc[3e3]},outputEncoding:{value:Dc[3e3]}},vertexShader:"\nprecision mediump float;\nprecision mediump int;\nattribute vec3 position;\nattribute vec2 uv;\nattribute float faceIndex;\nvarying vec3 vOutputDirection;\n\n// RH coordinate system; PMREM face-indexing convention\nvec3 getDirection(vec2 uv, float face) {\n\tuv = 2.0 * uv - 1.0;\n\tvec3 direction = vec3(uv, 1.0);\n\tif (face == 0.0) {\n\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\t} else if (face == 1.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\t} else if (face == 2.0) {\n\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\t} else if (face == 3.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\t} else if (face == 4.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\t} else if (face == 5.0) {\n\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\t}\n\treturn direction;\n}\n\nvoid main() {\n\tvOutputDirection = getDirection(uv, faceIndex);\n\tgl_Position = vec4( position, 1.0 );\n}\n\t",fragmentShader:"\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform sampler2D envMap;\nuniform int samples;\nuniform float weights[n];\nuniform bool latitudinal;\nuniform float dTheta;\nuniform float mipInt;\nuniform vec3 poleAxis;\n\n\nuniform int inputEncoding;\nuniform int outputEncoding;\n\n#include <encodings_pars_fragment>\n\nvec4 inputTexelToLinear(vec4 value){\n\tif(inputEncoding == 0){\n\t\treturn value;\n\t}else if(inputEncoding == 1){\n\t\treturn sRGBToLinear(value);\n\t}else if(inputEncoding == 2){\n\t\treturn RGBEToLinear(value);\n\t}else if(inputEncoding == 3){\n\t\treturn RGBMToLinear(value, 7.0);\n\t}else if(inputEncoding == 4){\n\t\treturn RGBMToLinear(value, 16.0);\n\t}else if(inputEncoding == 5){\n\t\treturn RGBDToLinear(value, 256.0);\n\t}else{\n\t\treturn GammaToLinear(value, 2.2);\n\t}\n}\n\nvec4 linearToOutputTexel(vec4 value){\n\tif(outputEncoding == 0){\n\t\treturn value;\n\t}else if(outputEncoding == 1){\n\t\treturn LinearTosRGB(value);\n\t}else if(outputEncoding == 2){\n\t\treturn LinearToRGBE(value);\n\t}else if(outputEncoding == 3){\n\t\treturn LinearToRGBM(value, 7.0);\n\t}else if(outputEncoding == 4){\n\t\treturn LinearToRGBM(value, 16.0);\n\t}else if(outputEncoding == 5){\n\t\treturn LinearToRGBD(value, 256.0);\n\t}else{\n\t\treturn LinearToGamma(value, 2.2);\n\t}\n}\n\nvec4 envMapTexelToLinear(vec4 color) {\n\treturn inputTexelToLinear(color);\n}\n\t\n\n#define ENVMAP_TYPE_CUBE_UV\n#include <cube_uv_reflection_fragment>\n\nvec3 getSample(float theta, vec3 axis) {\n\tfloat cosTheta = cos(theta);\n\t// Rodrigues' axis-angle rotation\n\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t+ cross(axis, vOutputDirection) * sin(theta)\n\t\t+ axis * dot(axis, vOutputDirection) * (1.0 - cosTheta);\n\treturn bilinearCubeUV(envMap, sampleDirection, mipInt);\n}\n\nvoid main() {\n\tvec3 axis = latitudinal ? poleAxis : cross(poleAxis, vOutputDirection);\n\tif (all(equal(axis, vec3(0.0))))\n\t\taxis = vec3(vOutputDirection.z, 0.0, - vOutputDirection.x);\n\taxis = normalize(axis);\n\tgl_FragColor = vec4(0.0);\n\tgl_FragColor.rgb += weights[0] * getSample(0.0, axis);\n\tfor (int i = 1; i < n; i++) {\n\t\tif (i >= samples)\n\t\t\tbreak;\n\t\tfloat theta = dTheta * float(i);\n\t\tgl_FragColor.rgb += weights[i] * getSample(-1.0 * theta, axis);\n\t\tgl_FragColor.rgb += weights[i] * getSample(theta, axis);\n\t}\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})).type="SphericalGaussianBlur",this._blurMaterial=e,this._cubemapShader=this._equirectShader=null,this._compileMaterial(this._blurMaterial)}function wa(e){return(e=new o(3*Pc,3*Pc,e)).texture.mapping=306,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function Ma(e,t,i,r,n){e.viewport.set(t,i,r,n),e.scissor.set(t,i,r,n)}function Ta(){var e=new i(1,1);return(e=new mr({uniforms:{envMap:{value:null},texelSize:{value:e},inputEncoding:{value:Dc[3e3]},outputEncoding:{value:Dc[3e3]}},vertexShader:"\nprecision mediump float;\nprecision mediump int;\nattribute vec3 position;\nattribute vec2 uv;\nattribute float faceIndex;\nvarying vec3 vOutputDirection;\n\n// RH coordinate system; PMREM face-indexing convention\nvec3 getDirection(vec2 uv, float face) {\n\tuv = 2.0 * uv - 1.0;\n\tvec3 direction = vec3(uv, 1.0);\n\tif (face == 0.0) {\n\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\t} else if (face == 1.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\t} else if (face == 2.0) {\n\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\t} else if (face == 3.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\t} else if (face == 4.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\t} else if (face == 5.0) {\n\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\t}\n\treturn direction;\n}\n\nvoid main() {\n\tvOutputDirection = getDirection(uv, faceIndex);\n\tgl_Position = vec4( position, 1.0 );\n}\n\t",fragmentShader:"\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform sampler2D envMap;\nuniform vec2 texelSize;\n\n\nuniform int inputEncoding;\nuniform int outputEncoding;\n\n#include <encodings_pars_fragment>\n\nvec4 inputTexelToLinear(vec4 value){\n\tif(inputEncoding == 0){\n\t\treturn value;\n\t}else if(inputEncoding == 1){\n\t\treturn sRGBToLinear(value);\n\t}else if(inputEncoding == 2){\n\t\treturn RGBEToLinear(value);\n\t}else if(inputEncoding == 3){\n\t\treturn RGBMToLinear(value, 7.0);\n\t}else if(inputEncoding == 4){\n\t\treturn RGBMToLinear(value, 16.0);\n\t}else if(inputEncoding == 5){\n\t\treturn RGBDToLinear(value, 256.0);\n\t}else{\n\t\treturn GammaToLinear(value, 2.2);\n\t}\n}\n\nvec4 linearToOutputTexel(vec4 value){\n\tif(outputEncoding == 0){\n\t\treturn value;\n\t}else if(outputEncoding == 1){\n\t\treturn LinearTosRGB(value);\n\t}else if(outputEncoding == 2){\n\t\treturn LinearToRGBE(value);\n\t}else if(outputEncoding == 3){\n\t\treturn LinearToRGBM(value, 7.0);\n\t}else if(outputEncoding == 4){\n\t\treturn LinearToRGBM(value, 16.0);\n\t}else if(outputEncoding == 5){\n\t\treturn LinearToRGBD(value, 256.0);\n\t}else{\n\t\treturn LinearToGamma(value, 2.2);\n\t}\n}\n\nvec4 envMapTexelToLinear(vec4 color) {\n\treturn inputTexelToLinear(color);\n}\n\t\n\n#include <common>\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tvec3 outputDirection = normalize(vOutputDirection);\n\tvec2 uv = equirectUv( outputDirection );\n\tvec2 f = fract(uv / texelSize - 0.5);\n\tuv -= f * texelSize;\n\tvec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.x += texelSize.x;\n\tvec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.y += texelSize.y;\n\tvec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.x -= texelSize.x;\n\tvec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tvec3 tm = mix(tl, tr, f.x);\n\tvec3 bm = mix(bl, br, f.x);\n\tgl_FragColor.rgb = mix(tm, bm, f.y);\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})).type="EquirectangularToCubeUV",e}function Sa(){var e=new mr({uniforms:{envMap:{value:null},inputEncoding:{value:Dc[3e3]},outputEncoding:{value:Dc[3e3]}},vertexShader:"\nprecision mediump float;\nprecision mediump int;\nattribute vec3 position;\nattribute vec2 uv;\nattribute float faceIndex;\nvarying vec3 vOutputDirection;\n\n// RH coordinate system; PMREM face-indexing convention\nvec3 getDirection(vec2 uv, float face) {\n\tuv = 2.0 * uv - 1.0;\n\tvec3 direction = vec3(uv, 1.0);\n\tif (face == 0.0) {\n\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\t} else if (face == 1.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\t} else if (face == 2.0) {\n\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\t} else if (face == 3.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\t} else if (face == 4.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\t} else if (face == 5.0) {\n\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\t}\n\treturn direction;\n}\n\nvoid main() {\n\tvOutputDirection = getDirection(uv, faceIndex);\n\tgl_Position = vec4( position, 1.0 );\n}\n\t",fragmentShader:"\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform samplerCube envMap;\n\n\nuniform int inputEncoding;\nuniform int outputEncoding;\n\n#include <encodings_pars_fragment>\n\nvec4 inputTexelToLinear(vec4 value){\n\tif(inputEncoding == 0){\n\t\treturn value;\n\t}else if(inputEncoding == 1){\n\t\treturn sRGBToLinear(value);\n\t}else if(inputEncoding == 2){\n\t\treturn RGBEToLinear(value);\n\t}else if(inputEncoding == 3){\n\t\treturn RGBMToLinear(value, 7.0);\n\t}else if(inputEncoding == 4){\n\t\treturn RGBMToLinear(value, 16.0);\n\t}else if(inputEncoding == 5){\n\t\treturn RGBDToLinear(value, 256.0);\n\t}else{\n\t\treturn GammaToLinear(value, 2.2);\n\t}\n}\n\nvec4 linearToOutputTexel(vec4 value){\n\tif(outputEncoding == 0){\n\t\treturn value;\n\t}else if(outputEncoding == 1){\n\t\treturn LinearTosRGB(value);\n\t}else if(outputEncoding == 2){\n\t\treturn LinearToRGBE(value);\n\t}else if(outputEncoding == 3){\n\t\treturn LinearToRGBM(value, 7.0);\n\t}else if(outputEncoding == 4){\n\t\treturn LinearToRGBM(value, 16.0);\n\t}else if(outputEncoding == 5){\n\t\treturn LinearToRGBD(value, 256.0);\n\t}else{\n\t\treturn LinearToGamma(value, 2.2);\n\t}\n}\n\nvec4 envMapTexelToLinear(vec4 color) {\n\treturn inputTexelToLinear(color);\n}\n\t\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tgl_FragColor.rgb = envMapTexelToLinear(textureCube(envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ))).rgb;\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t",blending:0,depthTest:!1,depthWrite:!1});return e.type="CubemapToCubeUV",e}function Ea(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Jr.call(this,e),this.type="catmullrom",this.closed=!0}function Aa(e){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Jr.call(this,e),this.type="catmullrom"}function Ca(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),Jr.call(this,e),this.type="catmullrom"}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return 0>e?-1:0<e?1:+e}),0=="name"in Function.prototype&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),i=1;i<arguments.length;i++){var r=arguments[i];if(null!=r)for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t}),Object.assign(t.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)},removeEventListener:function(e,t){void 0!==this._listeners&&void 0!==(e=this._listeners[e])&&-1!==(t=e.indexOf(t))&&e.splice(t,1)},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var i=0,r=(t=t.slice(0)).length;i<r;i++)t[i].call(this,e)}}}});for(var La=[],Pa=0;256>Pa;Pa++)La[Pa]=(16>Pa?"0":"")+Pa.toString(16);var Ia={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(La[255&e]+La[e>>8&255]+La[e>>16&255]+La[e>>24&255]+"-"+La[255&t]+La[t>>8&255]+"-"+La[t>>16&15|64]+La[t>>24&255]+"-"+La[63&i|128]+La[i>>8&255]+"-"+La[i>>16&255]+La[i>>24&255]+La[255&r]+La[r>>8&255]+La[r>>16&255]+La[r>>24&255]).toUpperCase()},clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)},lerp:function(e,t,i){return(1-i)*e+i*t},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*Ia.DEG2RAD},radToDeg:function(e){return e*Ia.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,i,r,n){var a=Math.cos,o=Math.sin,s=a(i/2);i=o(i/2);var l=a((t+r)/2),c=o((t+r)/2),h=a((t-r)/2),u=o((t-r)/2);switch(a=a((r-t)/2),t=o((r-t)/2),n){case"XYX":e.set(s*c,i*h,i*u,s*l);break;case"YZY":e.set(i*u,s*c,i*h,s*l);break;case"ZXZ":e.set(i*h,i*u,s*c,s*l);break;case"XZX":e.set(s*c,i*t,i*a,s*l);break;case"YXY":e.set(i*a,s*c,i*t,s*l);break;case"ZYZ":e.set(i*t,i*a,s*c,s*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}};Object.defineProperties(i.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(i.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.y=this.x=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,i=this.y;return e=e.elements,this.x=e[0]*t+e[3]*i+e[6],this.y=e[1]*t+e[4]*i+e[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this},clampLength:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){return Math.atan2(-this.y,-this.x)+Math.PI},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x;return t*t+(e=this.y-e.y)*e},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var i=Math.cos(t);t=Math.sin(t);var r=this.x-e.x,n=this.y-e.y;return this.x=r*i-n*t+e.x,this.y=r*t+n*i+e.y,this},random:function(){return this.x=Math.random(),this.y=Math.random(),this}}),Object.assign(r.prototype,{isMatrix3:!0,set:function(e,t,i,r,n,a,o,s,l){var c=this.elements;return c[0]=e,c[1]=r,c[2]=o,c[3]=t,c[4]=n,c[5]=s,c[6]=i,c[7]=a,c[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=this.elements;return e=e.elements,t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],this},extractBasis:function(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this},setFromMatrix4:function(e){return e=e.elements,this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var i=e.elements,r=t.elements;t=this.elements,e=i[0];var n=i[3],a=i[6],o=i[1],s=i[4],l=i[7],c=i[2],h=i[5];i=i[8];var u=r[0],d=r[3],p=r[6],f=r[1],m=r[4],g=r[7],y=r[2],v=r[5];return r=r[8],t[0]=e*u+n*f+a*y,t[3]=e*d+n*m+a*v,t[6]=e*p+n*g+a*r,t[1]=o*u+s*f+l*y,t[4]=o*d+s*m+l*v,t[7]=o*p+s*g+l*r,t[2]=c*u+h*f+i*y,t[5]=c*d+h*m+i*v,t[8]=c*p+h*g+i*r,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],a=e[4],o=e[5],s=e[6],l=e[7];return t*a*(e=e[8])-t*o*l-i*n*e+i*o*s+r*n*l-r*a*s},getInverse:function(e,t){void 0!==t&&console.warn("THREE.Matrix3: .getInverse() can no longer be configured to throw on degenerate.");var i=e.elements;e=this.elements,t=i[0];var r=i[1],n=i[2],a=i[3],o=i[4],s=i[5],l=i[6],c=i[7],h=(i=i[8])*o-s*c,u=s*l-i*a,d=c*a-o*l,p=t*h+r*u+n*d;return 0===p?this.set(0,0,0,0,0,0,0,0,0):(p=1/p,e[0]=h*p,e[1]=(n*c-i*r)*p,e[2]=(s*r-n*o)*p,e[3]=u*p,e[4]=(i*t-n*l)*p,e[5]=(n*a-s*t)*p,e[6]=d*p,e[7]=(r*l-c*t)*p,e[8]=(o*t-r*a)*p,this)},transpose:function(){var e=this.elements,t=e[1];return e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,i,r,n,a,o){var s=Math.cos(n);n=Math.sin(n),this.set(i*s,i*n,-i*(s*a+n*o)+a+e,-r*n,r*s,-r*(-n*a+s*o)+o+t,0,0,1)},scale:function(e,t){var i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=t,i[4]*=t,i[7]*=t,this},rotate:function(e){var t=Math.cos(e);e=Math.sin(e);var i=this.elements,r=i[0],n=i[3],a=i[6],o=i[1],s=i[4],l=i[7];return i[0]=t*r+e*o,i[3]=t*n+e*s,i[6]=t*a+e*l,i[1]=-e*r+t*o,i[4]=-e*n+t*s,i[7]=-e*a+t*l,this},translate:function(e,t){var i=this.elements;return i[0]+=e*i[2],i[3]+=e*i[5],i[6]+=e*i[8],i[1]+=t*i[2],i[4]+=t*i[5],i[7]+=t*i[8],this},equals:function(e){var t=this.elements;e=e.elements;for(var i=0;9>i;i++)if(t[i]!==e[i])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var i=0;9>i;i++)this.elements[i]=e[i+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}});var Ra,Da={getDataURL:function(e){if("undefined"==typeof HTMLCanvasElement)return e.src;if(!(e instanceof HTMLCanvasElement)){void 0===Ra&&(Ra=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Ra.width=e.width,Ra.height=e.height;var t=Ra.getContext("2d");e instanceof ImageData?t.putImageData(e,0,0):t.drawImage(e,0,0,e.width,e.height),e=Ra}return 2048<e.width||2048<e.height?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}},ka=0;n.DEFAULT_IMAGE=void 0,n.DEFAULT_MAPPING=300,n.prototype=Object.assign(Object.create(t.prototype),{constructor:n,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var r=this.image;if(void 0===r.uuid&&(r.uuid=Ia.generateUUID()),!t&&void 0===e.images[r.uuid]){if(Array.isArray(r))for(var n=[],a=0,o=r.length;a<o;a++)n.push(Da.getDataURL(r[a]));else n=Da.getDataURL(r);e.images[r.uuid]={uuid:r.uuid,url:n}}i.image=r.uuid}return t||(e.textures[this.uuid]=i),i},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),0>e.x||1<e.x)switch(this.wrapS){case 1e3:e.x-=Math.floor(e.x);break;case 1001:e.x=0>e.x?0:1;break;case 1002:e.x=1===Math.abs(Math.floor(e.x)%2)?Math.ceil(e.x)-e.x:e.x-Math.floor(e.x)}if(0>e.y||1<e.y)switch(this.wrapT){case 1e3:e.y-=Math.floor(e.y);break;case 1001:e.y=0>e.y?0:1;break;case 1002:e.y=1===Math.abs(Math.floor(e.y)%2)?Math.ceil(e.y)-e.y:e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(n.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.defineProperties(a.prototype,{width:{get:function(){return this.z},set:function(e){this.z=e}},height:{get:function(){return this.w},set:function(e){this.w=e}}}),Object.assign(a.prototype,{isVector4:!0,set:function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this},setScalar:function(e){return this.w=this.z=this.y=this.x=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,i=this.y,r=this.z,n=this.w;return e=e.elements,this.x=e[0]*t+e[4]*i+e[8]*r+e[12]*n,this.y=e[1]*t+e[5]*i+e[9]*r+e[13]*n,this.z=e[2]*t+e[6]*i+e[10]*r+e[14]*n,this.w=e[3]*t+e[7]*i+e[11]*r+e[15]*n,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return 1e-4>t?(this.x=1,this.z=this.y=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t=(e=e.elements)[0],i=e[4],r=e[8],n=e[1],a=e[5],o=e[9],s=e[2],l=e[6],c=e[10];return.01>Math.abs(i-n)&&.01>Math.abs(r-s)&&.01>Math.abs(o-l)?.1>Math.abs(i+n)&&.1>Math.abs(r+s)&&.1>Math.abs(o+l)&&.1>Math.abs(t+a+c-3)?(this.set(1,0,0,0),this):(e=Math.PI,c=(c+1)/2,i=(i+n)/4,r=(r+s)/4,o=(o+l)/4,(t=(t+1)/2)>(a=(a+1)/2)&&t>c?.01>t?(l=0,i=s=.707106781):(s=i/(l=Math.sqrt(t)),i=r/l):a>c?.01>a?(l=.707106781,s=0,i=.707106781):(l=i/(s=Math.sqrt(a)),i=o/s):.01>c?(s=l=.707106781,i=0):(l=r/(i=Math.sqrt(c)),s=o/i),this.set(l,s,i,e),this):(e=Math.sqrt((l-o)*(l-o)+(r-s)*(r-s)+(n-i)*(n-i)),.001>Math.abs(e)&&(e=1),this.x=(l-o)/e,this.y=(r-s)/e,this.z=(n-i)/e,this.w=Math.acos((t+a+c-1)/2),this)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this},clampLength:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z),this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this},random:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}),o.prototype=Object.assign(Object.create(t.prototype),{constructor:o,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.texture.image.width=e,this.texture.image.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),s.prototype=Object.assign(Object.create(o.prototype),{constructor:s,isWebGLMultisampleRenderTarget:!0,copy:function(e){return o.prototype.copy.call(this,e),this.samples=e.samples,this}}),Object.assign(l,{slerp:function(e,t,i,r){return i.copy(e).slerp(t,r)},slerpFlat:function(e,t,i,r,n,a,o){var s=i[r+0],l=i[r+1],c=i[r+2];i=i[r+3],r=n[a+0];var h=n[a+1],u=n[a+2];if(i!==(n=n[a+3])||s!==r||l!==h||c!==u){a=1-o;var d=s*r+l*h+c*u+i*n,p=0<=d?1:-1,f=1-d*d;f>Number.EPSILON&&(f=Math.sqrt(f),d=Math.atan2(f,d*p),a=Math.sin(a*d)/f,o=Math.sin(o*d)/f),s=s*a+r*(p*=o),l=l*a+h*p,c=c*a+u*p,i=i*a+n*p,a===1-o&&(s*=o=1/Math.sqrt(s*s+l*l+c*c+i*i),l*=o,c*=o,i*=o)}e[t]=s,e[t+1]=l,e[t+2]=c,e[t+3]=i},multiplyQuaternionsFlat:function(e,t,i,r,n,a){var o=i[r],s=i[r+1],l=i[r+2];i=i[r+3],r=n[a];var c=n[a+1],h=n[a+2];return n=n[a+3],e[t]=o*n+i*r+s*h-l*c,e[t+1]=s*n+i*c+l*r-o*h,e[t+2]=l*n+i*h+o*c-s*r,e[t+3]=i*n-o*r-s*c-l*h,e}}),Object.defineProperties(l.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}}}),Object.assign(l.prototype,{isQuaternion:!0,set:function(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var i=e._x,r=e._y,n=e._z;e=e.order;var a=Math.cos,o=Math.sin,s=a(i/2),l=a(r/2);switch(a=a(n/2),i=o(i/2),r=o(r/2),n=o(n/2),e){case"XYZ":this._x=i*l*a+s*r*n,this._y=s*r*a-i*l*n,this._z=s*l*n+i*r*a,this._w=s*l*a-i*r*n;break;case"YXZ":this._x=i*l*a+s*r*n,this._y=s*r*a-i*l*n,this._z=s*l*n-i*r*a,this._w=s*l*a+i*r*n;break;case"ZXY":this._x=i*l*a-s*r*n,this._y=s*r*a+i*l*n,this._z=s*l*n+i*r*a,this._w=s*l*a-i*r*n;break;case"ZYX":this._x=i*l*a-s*r*n,this._y=s*r*a+i*l*n,this._z=s*l*n-i*r*a,this._w=s*l*a+i*r*n;break;case"YZX":this._x=i*l*a+s*r*n,this._y=s*r*a+i*l*n,this._z=s*l*n-i*r*a,this._w=s*l*a-i*r*n;break;case"XZY":this._x=i*l*a-s*r*n,this._y=s*r*a-i*l*n,this._z=s*l*n+i*r*a,this._w=s*l*a+i*r*n;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+e)}return!1!==t&&this._onChangeCallback(),this},setFromAxisAngle:function(e,t){t/=2;var i=Math.sin(t);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(t),this._onChangeCallback(),this},setFromRotationMatrix:function(e){var t=e.elements,i=t[0];e=t[4];var r=t[8],n=t[1],a=t[5],o=t[9],s=t[2],l=t[6],c=i+a+(t=t[10]);return 0<c?(i=.5/Math.sqrt(c+1),this._w=.25/i,this._x=(l-o)*i,this._y=(r-s)*i,this._z=(n-e)*i):i>a&&i>t?(i=2*Math.sqrt(1+i-a-t),this._w=(l-o)/i,this._x=.25*i,this._y=(e+n)/i,this._z=(r+s)/i):a>t?(i=2*Math.sqrt(1+a-i-t),this._w=(r-s)/i,this._x=(e+n)/i,this._y=.25*i,this._z=(o+l)/i):(i=2*Math.sqrt(1+t-i-a),this._w=(n-e)/i,this._x=(r+s)/i,this._y=(o+l)/i,this._z=.25*i),this._onChangeCallback(),this},setFromUnitVectors:function(e,t){var i=e.dot(t)+1;return 1e-6>i?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0):(this._x=0,this._y=-e.z,this._z=e.y)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x),this._w=i,this.normalize()},angleTo:function(e){return 2*Math.acos(Math.abs(Ia.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){var i=this.angleTo(e);return 0===i||this.slerp(e,Math.min(1,t/i)),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._z=this._y=this._x=0,this._w=1):(e=1/e,this._x*=e,this._y*=e,this._z*=e,this._w*=e),this._onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var i=e._x,r=e._y,n=e._z;e=e._w;var a=t._x,o=t._y,s=t._z;return t=t._w,this._x=i*t+e*a+r*s-n*o,this._y=r*t+e*o+n*a-i*s,this._z=n*t+e*s+i*o-r*a,this._w=e*t-i*a-r*o-n*s,this._onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var i=this._x,r=this._y,n=this._z,a=this._w,o=a*e._w+i*e._x+r*e._y+n*e._z;if(0>o?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),1<=o)return this._w=a,this._x=i,this._y=r,this._z=n,this;if((e=1-o*o)<=Number.EPSILON)return o=1-t,this._w=o*a+t*this._w,this._x=o*i+t*this._x,this._y=o*r+t*this._y,this._z=o*n+t*this._z,this.normalize(),this._onChangeCallback(),this;e=Math.sqrt(e);var s=Math.atan2(e,o);return o=Math.sin((1-t)*s)/e,t=Math.sin(t*s)/e,this._w=a*o+this._w*t,this._x=i*o+this._x*t,this._y=r*o+this._y*t,this._z=n*o+this._z*t,this._onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},fromBufferAttribute:function(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}});var za=new c,Oa=new l;Object.assign(c.prototype,{isVector3:!0,set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},setScalar:function(e){return this.z=this.y=this.x=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Oa.setFromEuler(e))},applyAxisAngle:function(e,t){return this.applyQuaternion(Oa.setFromAxisAngle(e,t))},applyMatrix3:function(e){var t=this.x,i=this.y,r=this.z;return e=e.elements,this.x=e[0]*t+e[3]*i+e[6]*r,this.y=e[1]*t+e[4]*i+e[7]*r,this.z=e[2]*t+e[5]*i+e[8]*r,this},applyNormalMatrix:function(e){return this.applyMatrix3(e).normalize()},applyMatrix4:function(e){var t=this.x,i=this.y,r=this.z,n=1/((e=e.elements)[3]*t+e[7]*i+e[11]*r+e[15]);return this.x=(e[0]*t+e[4]*i+e[8]*r+e[12])*n,this.y=(e[1]*t+e[5]*i+e[9]*r+e[13])*n,this.z=(e[2]*t+e[6]*i+e[10]*r+e[14])*n,this},applyQuaternion:function(e){var t=this.x,i=this.y,r=this.z,n=e.x,a=e.y,o=e.z,s=(e=e.w)*t+a*r-o*i,l=e*i+o*t-n*r,c=e*r+n*i-a*t;return t=-n*t-a*i-o*r,this.x=s*e+t*-n+l*-o-c*-a,this.y=l*e+t*-a+c*-n-s*-o,this.z=c*e+t*-o+s*-a-l*-n,this},project:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},unproject:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)},transformDirection:function(e){var t=this.x,i=this.y,r=this.z;return e=e.elements,this.x=e[0]*t+e[4]*i+e[8]*r,this.y=e[1]*t+e[5]*i+e[9]*r,this.z=e[2]*t+e[6]*i+e[10]*r,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this},clampLength:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this},cross:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var i=e.x,r=e.y;e=e.z;var n=t.x,a=t.y;return t=t.z,this.x=r*t-e*a,this.y=e*n-i*t,this.z=i*a-r*n,this},projectOnVector:function(e){var t=e.lengthSq();return 0===t?this.set(0,0,0):(t=e.dot(this)/t,this.copy(e).multiplyScalar(t))},projectOnPlane:function(e){return za.copy(this).projectOnVector(e),this.sub(za)},reflect:function(e){return this.sub(za.copy(e).multiplyScalar(2*this.dot(e)))},angleTo:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());return 0===t?Math.PI/2:(e=this.dot(e)/t,Math.acos(Ia.clamp(e,-1,1)))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i+(e=this.z-e.z)*e},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},setFromSphericalCoords:function(e,t,i){var r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this},setFromCylindrical:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},setFromCylindricalCoords:function(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this},setFromMatrixPosition:function(e){return e=e.elements,this.x=e[12],this.y=e[13],this.z=e[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length();return e=this.setFromMatrixColumn(e,2).length(),this.x=t,this.y=i,this.z=e,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},setFromMatrix3Column:function(e,t){return this.fromArray(e.elements,3*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this},random:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}});var Ba=new c,Fa=new h,Na=new c(0,0,0),Ua=new c(1,1,1),ja=new c,Va=new c,Ga=new c;Object.assign(h.prototype,{isMatrix4:!0,set:function(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=r,g[1]=n,g[5]=a,g[9]=o,g[13]=s,g[2]=l,g[6]=c,g[10]=h,g[14]=u,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new h).fromArray(this.elements)},copy:function(e){var t=this.elements;return e=e.elements,t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],this},copyPosition:function(e){var t=this.elements;return e=e.elements,t[12]=e[12],t[13]=e[13],t[14]=e[14],this},extractBasis:function(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this},extractRotation:function(e){var t=this.elements,i=e.elements,r=1/Ba.setFromMatrixColumn(e,0).length(),n=1/Ba.setFromMatrixColumn(e,1).length();return e=1/Ba.setFromMatrixColumn(e,2).length(),t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*n,t[5]=i[5]*n,t[6]=i[6]*n,t[7]=0,t[8]=i[8]*e,t[9]=i[9]*e,t[10]=i[10]*e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,i=e.x,r=e.y,n=e.z,a=Math.cos(i);i=Math.sin(i);var o=Math.cos(r);r=Math.sin(r);var s=Math.cos(n);if(n=Math.sin(n),"XYZ"===e.order){e=a*s;var l=a*n,c=i*s,h=i*n;t[0]=o*s,t[4]=-o*n,t[8]=r,t[1]=l+c*r,t[5]=e-h*r,t[9]=-i*o,t[2]=h-e*r,t[6]=c+l*r,t[10]=a*o}else"YXZ"===e.order?(e=o*s,l=o*n,c=r*s,h=r*n,t[0]=e+h*i,t[4]=c*i-l,t[8]=a*r,t[1]=a*n,t[5]=a*s,t[9]=-i,t[2]=l*i-c,t[6]=h+e*i,t[10]=a*o):"ZXY"===e.order?(e=o*s,l=o*n,c=r*s,h=r*n,t[0]=e-h*i,t[4]=-a*n,t[8]=c+l*i,t[1]=l+c*i,t[5]=a*s,t[9]=h-e*i,t[2]=-a*r,t[6]=i,t[10]=a*o):"ZYX"===e.order?(e=a*s,l=a*n,c=i*s,h=i*n,t[0]=o*s,t[4]=c*r-l,t[8]=e*r+h,t[1]=o*n,t[5]=h*r+e,t[9]=l*r-c,t[2]=-r,t[6]=i*o,t[10]=a*o):"YZX"===e.order?(e=a*o,l=a*r,c=i*o,h=i*r,t[0]=o*s,t[4]=h-e*n,t[8]=c*n+l,t[1]=n,t[5]=a*s,t[9]=-i*s,t[2]=-r*s,t[6]=l*n+c,t[10]=e-h*n):"XZY"===e.order&&(e=a*o,l=a*r,c=i*o,h=i*r,t[0]=o*s,t[4]=-n,t[8]=r*s,t[1]=e*n+h,t[5]=a*s,t[9]=l*n-c,t[2]=c*n-l,t[6]=i*s,t[10]=h*n+e);return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(e){return this.compose(Na,e,Ua)},lookAt:function(e,t,i){var r=this.elements;return Ga.subVectors(e,t),0===Ga.lengthSq()&&(Ga.z=1),Ga.normalize(),ja.crossVectors(i,Ga),0===ja.lengthSq()&&(1===Math.abs(i.z)?Ga.x+=1e-4:Ga.z+=1e-4,Ga.normalize(),ja.crossVectors(i,Ga)),ja.normalize(),Va.crossVectors(Ga,ja),r[0]=ja.x,r[4]=Va.x,r[8]=Ga.x,r[1]=ja.y,r[5]=Va.y,r[9]=Ga.y,r[2]=ja.z,r[6]=Va.z,r[10]=Ga.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var i=e.elements,r=t.elements;t=this.elements,e=i[0];var n=i[4],a=i[8],o=i[12],s=i[1],l=i[5],c=i[9],h=i[13],u=i[2],d=i[6],p=i[10],f=i[14],m=i[3],g=i[7],y=i[11];i=i[15];var v=r[0],_=r[4],x=r[8],b=r[12],w=r[1],M=r[5],T=r[9],S=r[13],E=r[2],A=r[6],C=r[10],L=r[14],P=r[3],I=r[7],R=r[11];return r=r[15],t[0]=e*v+n*w+a*E+o*P,t[4]=e*_+n*M+a*A+o*I,t[8]=e*x+n*T+a*C+o*R,t[12]=e*b+n*S+a*L+o*r,t[1]=s*v+l*w+c*E+h*P,t[5]=s*_+l*M+c*A+h*I,t[9]=s*x+l*T+c*C+h*R,t[13]=s*b+l*S+c*L+h*r,t[2]=u*v+d*w+p*E+f*P,t[6]=u*_+d*M+p*A+f*I,t[10]=u*x+d*T+p*C+f*R,t[14]=u*b+d*S+p*L+f*r,t[3]=m*v+g*w+y*E+i*P,t[7]=m*_+g*M+y*A+i*I,t[11]=m*x+g*T+y*C+i*R,t[15]=m*b+g*S+y*L+i*r,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},determinant:function(){var e=this.elements,t=e[0],i=e[4],r=e[8],n=e[12],a=e[1],o=e[5],s=e[9],l=e[13],c=e[2],h=e[6],u=e[10],d=e[14];return e[3]*(+n*s*h-r*l*h-n*o*u+i*l*u+r*o*d-i*s*d)+e[7]*(+t*s*d-t*l*u+n*a*u-r*a*d+r*l*c-n*s*c)+e[11]*(+t*l*h-t*o*d-n*a*h+i*a*d+n*o*c-i*l*c)+e[15]*(-r*o*c-t*s*h+t*o*u+r*a*h-i*a*u+i*s*c)},transpose:function(){var e=this.elements,t=e[1];return e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(e,t,i){var r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this},getInverse:function(e,t){void 0!==t&&console.warn("THREE.Matrix4: .getInverse() can no longer be configured to throw on degenerate."),t=this.elements;var i=e.elements;e=i[0];var r=i[1],n=i[2],a=i[3],o=i[4],s=i[5],l=i[6],c=i[7],h=i[8],u=i[9],d=i[10],p=i[11],f=i[12],m=i[13],g=i[14],y=u*g*c-m*d*c+m*l*p-s*g*p-u*l*(i=i[15])+s*d*i,v=f*d*c-h*g*c-f*l*p+o*g*p+h*l*i-o*d*i,_=h*m*c-f*u*c+f*s*p-o*m*p-h*s*i+o*u*i,x=f*u*l-h*m*l-f*s*d+o*m*d+h*s*g-o*u*g,b=e*y+r*v+n*_+a*x;return 0===b?this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0):(b=1/b,t[0]=y*b,t[1]=(m*d*a-u*g*a-m*n*p+r*g*p+u*n*i-r*d*i)*b,t[2]=(s*g*a-m*l*a+m*n*c-r*g*c-s*n*i+r*l*i)*b,t[3]=(u*l*a-s*d*a-u*n*c+r*d*c+s*n*p-r*l*p)*b,t[4]=v*b,t[5]=(h*g*a-f*d*a+f*n*p-e*g*p-h*n*i+e*d*i)*b,t[6]=(f*l*a-o*g*a-f*n*c+e*g*c+o*n*i-e*l*i)*b,t[7]=(o*d*a-h*l*a+h*n*c-e*d*c-o*n*p+e*l*p)*b,t[8]=_*b,t[9]=(f*u*a-h*m*a-f*r*p+e*m*p+h*r*i-e*u*i)*b,t[10]=(o*m*a-f*s*a+f*r*c-e*m*c-o*r*i+e*s*i)*b,t[11]=(h*s*a-o*u*a-h*r*c+e*u*c+o*r*p-e*s*p)*b,t[12]=x*b,t[13]=(h*m*n-f*u*n+f*r*d-e*m*d-h*r*g+e*u*g)*b,t[14]=(f*s*n-o*m*n-f*r*l+e*m*l+o*r*g-e*s*g)*b,t[15]=(o*u*n-h*s*n+h*r*l-e*u*l-o*r*d+e*s*d)*b,this)},scale:function(e){var t=this.elements,i=e.x,r=e.y;return e=e.z,t[0]*=i,t[4]*=r,t[8]*=e,t[1]*=i,t[5]*=r,t[9]*=e,t[2]*=i,t[6]*=r,t[10]*=e,t[3]*=i,t[7]*=r,t[11]*=e,this},getMaxScaleOnAxis:function(){var e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e);return e=Math.sin(e),this.set(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e);return e=Math.sin(e),this.set(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e);return e=Math.sin(e),this.set(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t);t=Math.sin(t);var r=1-i,n=e.x,a=e.y;e=e.z;var o=r*n,s=r*a;return this.set(o*n+i,o*a-t*e,o*e+t*a,0,o*a+t*e,s*a+i,s*e-t*n,0,o*e-t*a,s*e+t*n,r*e*e+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},makeShear:function(e,t,i){return this.set(1,t,i,0,e,1,i,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,i){var r=this.elements,n=t._x,a=t._y,o=t._z,s=t._w,l=n+n,c=a+a,h=o+o;t=n*l;var u=n*c;n*=h;var d=a*c;a*=h,o*=h,l*=s,c*=s,s*=h,h=i.x;var p=i.y;return i=i.z,r[0]=(1-(d+o))*h,r[1]=(u+s)*h,r[2]=(n-c)*h,r[3]=0,r[4]=(u-s)*p,r[5]=(1-(t+o))*p,r[6]=(a+l)*p,r[7]=0,r[8]=(n+c)*i,r[9]=(a-l)*i,r[10]=(1-(t+d))*i,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this},decompose:function(e,t,i){var r=this.elements,n=Ba.set(r[0],r[1],r[2]).length(),a=Ba.set(r[4],r[5],r[6]).length(),o=Ba.set(r[8],r[9],r[10]).length();0>this.determinant()&&(n=-n),e.x=r[12],e.y=r[13],e.z=r[14],Fa.copy(this),e=1/n,r=1/a;var s=1/o;return Fa.elements[0]*=e,Fa.elements[1]*=e,Fa.elements[2]*=e,Fa.elements[4]*=r,Fa.elements[5]*=r,Fa.elements[6]*=r,Fa.elements[8]*=s,Fa.elements[9]*=s,Fa.elements[10]*=s,t.setFromRotationMatrix(Fa),i.x=n,i.y=a,i.z=o,this},makePerspective:function(e,t,i,r,n,a){void 0===a&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements;return o[0]=2*n/(t-e),o[4]=0,o[8]=(t+e)/(t-e),o[12]=0,o[1]=0,o[5]=2*n/(i-r),o[9]=(i+r)/(i-r),o[13]=0,o[2]=0,o[6]=0,o[10]=-(a+n)/(a-n),o[14]=-2*a*n/(a-n),o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makeOrthographic:function(e,t,i,r,n,a){var o=this.elements,s=1/(t-e),l=1/(i-r),c=1/(a-n);return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-(t+e)*s,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-(i+r)*l,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-(a+n)*c,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(e){var t=this.elements;e=e.elements;for(var i=0;16>i;i++)if(t[i]!==e[i])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var i=0;16>i;i++)this.elements[i]=e[i+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}});var Ha=new h,Wa=new l;u.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" "),u.DefaultOrder="XYZ",Object.defineProperties(u.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}}}),Object.assign(u.prototype,{isEuler:!0,set:function(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._order=r||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this},setFromRotationMatrix:function(e,t,i){var r=Ia.clamp,n=e.elements;e=n[0];var a=n[4],o=n[8],s=n[1],l=n[5],c=n[9],h=n[2],u=n[6];switch(n=n[10],t=t||this._order){case"XYZ":this._y=Math.asin(r(o,-1,1)),.9999999>Math.abs(o)?(this._x=Math.atan2(-c,n),this._z=Math.atan2(-a,e)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-r(c,-1,1)),.9999999>Math.abs(c)?(this._y=Math.atan2(o,n),this._z=Math.atan2(s,l)):(this._y=Math.atan2(-h,e),this._z=0);break;case"ZXY":this._x=Math.asin(r(u,-1,1)),.9999999>Math.abs(u)?(this._y=Math.atan2(-h,n),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(s,e));break;case"ZYX":this._y=Math.asin(-r(h,-1,1)),.9999999>Math.abs(h)?(this._x=Math.atan2(u,n),this._z=Math.atan2(s,e)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(r(s,-1,1)),.9999999>Math.abs(s)?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,e)):(this._x=0,this._y=Math.atan2(o,n));break;case"XZY":this._z=Math.asin(-r(a,-1,1)),.9999999>Math.abs(a)?(this._x=Math.atan2(u,l),this._y=Math.atan2(o,e)):(this._x=Math.atan2(-c,n),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!1!==i&&this._onChangeCallback(),this},setFromQuaternion:function(e,t,i){return Ha.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Ha,t,i)},setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(e){return Wa.setFromEuler(this),this.setFromQuaternion(Wa,e)},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new c(this._x,this._y,this._z)},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}}),Object.assign(d.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask=this.mask|1<<e|0},enableAll:function(){this.mask=-1},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},disableAll:function(){this.mask=0},test:function(e){return 0!=(this.mask&e.mask)}});var qa=0,Za=new c,Xa=new l,$a=new h,Ya=new c,Ja=new c,Ka=new c,Qa=new l,eo=new c(1,0,0),to=new c(0,1,0),io=new c(0,0,1),ro={type:"added"},no={type:"removed"};p.DefaultUp=new c(0,1,0),p.DefaultMatrixAutoUpdate=!0,p.prototype=Object.assign(Object.create(t.prototype),{constructor:p,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(e,t){return Xa.setFromAxisAngle(e,t),this.quaternion.multiply(Xa),this},rotateOnWorldAxis:function(e,t){return Xa.setFromAxisAngle(e,t),this.quaternion.premultiply(Xa),this},rotateX:function(e){return this.rotateOnAxis(eo,e)},rotateY:function(e){return this.rotateOnAxis(to,e)},rotateZ:function(e){return this.rotateOnAxis(io,e)},translateOnAxis:function(e,t){return Za.copy(e).applyQuaternion(this.quaternion),this.position.add(Za.multiplyScalar(t)),this},translateX:function(e){return this.translateOnAxis(eo,e)},translateY:function(e){return this.translateOnAxis(to,e)},translateZ:function(e){return this.translateOnAxis(io,e)},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4($a.getInverse(this.matrixWorld))},lookAt:function(e,t,i){e.isVector3?Ya.copy(e):Ya.set(e,t,i),e=this.parent,this.updateWorldMatrix(!0,!1),Ja.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?$a.lookAt(Ja,Ya,this.up):$a.lookAt(Ya,Ja,this.up),this.quaternion.setFromRotationMatrix($a),e&&($a.extractRotation(e.matrixWorld),Xa.setFromRotationMatrix($a),this.quaternion.premultiply(Xa.inverse()))},add:function(e){if(1<arguments.length){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(ro)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(1<arguments.length){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}return-1!==(t=this.children.indexOf(e))&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(no)),this},attach:function(e){return this.updateWorldMatrix(!0,!1),$a.getInverse(this.matrixWorld),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),$a.multiply(e.parent.matrixWorld)),e.applyMatrix4($a),e.updateWorldMatrix(!1,!1),this.add(e),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var i=0,r=this.children.length;i<r;i++){var n=this.children[i].getObjectByProperty(e,t);if(void 0!==n)return n}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new c),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new l),this.updateMatrixWorld(!0),this.matrixWorld.decompose(Ja,e,Ka),e},getWorldScale:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new c),this.updateMatrixWorld(!0),this.matrixWorld.decompose(Ja,Qa,e),e},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new c),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,i=0,r=t.length;i<r;i++)t[i].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,i=0,r=t.length;i<r;i++)t[i].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){var i=this.parent;if(!0===e&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(t=0,i=(e=this.children).length;t<i;t++)e[t].updateWorldMatrix(!1,!0)},toJSON:function(e){function t(t,i){return void 0===t[i.uuid]&&(t[i.uuid]=i.toJSON(e)),i.uuid}function i(e){var t,i=[];for(t in e){var r=e[t];delete r.metadata,i.push(r)}return i}var r=void 0===e||"string"==typeof e,n={};r&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var a={};if(a.uuid=this.uuid,a.type=this.type,""!==this.name&&(a.name=this.name),!0===this.castShadow&&(a.castShadow=!0),!0===this.receiveShadow&&(a.receiveShadow=!0),!1===this.visible&&(a.visible=!1),!1===this.frustumCulled&&(a.frustumCulled=!1),0!==this.renderOrder&&(a.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(a.userData=this.userData),a.layers=this.layers.mask,a.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(a.matrixAutoUpdate=!1),this.isInstancedMesh&&(a.type="InstancedMesh",a.count=this.count,a.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){a.geometry=t(e.geometries,this.geometry);var o=this.geometry.parameters;if(void 0!==o&&void 0!==o.shapes)if(o=o.shapes,Array.isArray(o))for(var s=0,l=o.length;s<l;s++)t(e.shapes,o[s]);else t(e.shapes,o)}if(void 0!==this.material)if(Array.isArray(this.material)){for(o=[],s=0,l=this.material.length;s<l;s++)o.push(t(e.materials,this.material[s]));a.material=o}else a.material=t(e.materials,this.material);if(0<this.children.length)for(a.children=[],s=0;s<this.children.length;s++)a.children.push(this.children[s].toJSON(e).object);if(r){r=i(e.geometries),s=i(e.materials),l=i(e.textures);var c=i(e.images);o=i(e.shapes),0<r.length&&(n.geometries=r),0<s.length&&(n.materials=s),0<l.length&&(n.textures=l),0<c.length&&(n.images=c),0<o.length&&(n.shapes=o)}return n.object=a,n},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(t=0;t<e.children.length;t++)this.add(e.children[t].clone());return this}}),f.prototype=Object.assign(Object.create(p.prototype),{constructor:f,isScene:!0,copy:function(e,t){return p.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=p.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.environment&&(t.object.environment=this.environment.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t},dispose:function(){this.dispatchEvent({type:"dispose"})}});var ao=[new c,new c,new c,new c,new c,new c,new c,new c],oo=new c,so=new m,lo=new c,co=new c,ho=new c,uo=new c,po=new c,fo=new c,mo=new c,go=new c,yo=new c,vo=new c;Object.assign(m.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,i=1/0,r=1/0,n=-1/0,a=-1/0,o=-1/0,s=0,l=e.length;s<l;s+=3){var c=e[s],h=e[s+1],u=e[s+2];c<t&&(t=c),h<i&&(i=h),u<r&&(r=u),c>n&&(n=c),h>a&&(a=h),u>o&&(o=u)}return this.min.set(t,i,r),this.max.set(n,a,o),this},setFromBufferAttribute:function(e){for(var t=1/0,i=1/0,r=1/0,n=-1/0,a=-1/0,o=-1/0,s=0,l=e.count;s<l;s++){var c=e.getX(s),h=e.getY(s),u=e.getZ(s);c<t&&(t=c),h<i&&(i=h),u<r&&(r=u),c>n&&(n=c),h>a&&(a=h),u>o&&(o=u)}return this.min.set(t,i,r),this.max.set(n,a,o),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){return t=oo.copy(t).multiplyScalar(.5),this.min.copy(e).sub(t),this.max.copy(e).add(t),this},setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new c),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new c),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(e){e.updateWorldMatrix(!1,!1);var t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),so.copy(t.boundingBox),so.applyMatrix4(e.matrixWorld),this.union(so)),t=0;for(var i=(e=e.children).length;t<i;t++)this.expandByObject(e[t]);return this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new c),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(e){return this.clampPoint(e.center,oo),oo.distanceToSquared(e.center)<=e.radius*e.radius},intersectsPlane:function(e){if(0<e.normal.x)var t=e.normal.x*this.min.x,i=e.normal.x*this.max.x;else t=e.normal.x*this.max.x,i=e.normal.x*this.min.x;return 0<e.normal.y?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),0<e.normal.z?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant},intersectsTriangle:function(e){return!this.isEmpty()&&(this.getCenter(mo),go.subVectors(this.max,mo),lo.subVectors(e.a,mo),co.subVectors(e.b,mo),ho.subVectors(e.c,mo),uo.subVectors(co,lo),po.subVectors(ho,co),fo.subVectors(lo,ho),!!g(e=[0,-uo.z,uo.y,0,-po.z,po.y,0,-fo.z,fo.y,uo.z,0,-uo.x,po.z,0,-po.x,fo.z,0,-fo.x,-uo.y,uo.x,0,-po.y,po.x,0,-fo.y,fo.x,0],lo,co,ho,go)&&!!g(e=[1,0,0,0,1,0,0,0,1],lo,co,ho,go)&&(yo.crossVectors(uo,po),g(e=[yo.x,yo.y,yo.z],lo,co,ho,go)))},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new c),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return oo.copy(e).clamp(this.min,this.max).sub(e).length()},getBoundingSphere:function(e){return void 0===e&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize(oo).length(),e},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(e){return this.isEmpty()||(ao[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),ao[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),ao[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),ao[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),ao[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),ao[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),ao[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),ao[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(ao)),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var _o=new m;Object.assign(y.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(e,t){var i=this.center;void 0!==t?i.copy(t):_o.setFromPoints(e).getCenter(i);for(var r=t=0,n=e.length;r<n;r++)t=Math.max(t,i.distanceToSquared(e[r]));return this.radius=Math.sqrt(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},isEmpty:function(){return 0>this.radius},makeEmpty:function(){return this.center.set(0,0,0),this.radius=-1,this},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var i=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new c),t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new m),this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius*=e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}});var xo=new c,bo=new c,wo=new c,Mo=new c,To=new c,So=new c,Eo=new c;Object.assign(v.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new c),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(e){return this.origin.copy(this.at(e,xo)),this},closestPointToPoint:function(e,t){return void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new c),t.subVectors(e,this.origin),0>(e=t.dot(this.direction))?t.copy(this.origin):t.copy(this.direction).multiplyScalar(e).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(e){var t=xo.subVectors(e,this.origin).dot(this.direction);return 0>t?this.origin.distanceToSquared(e):(xo.copy(this.direction).multiplyScalar(t).add(this.origin),xo.distanceToSquared(e))},distanceSqToSegment:function(e,t,i,r){bo.copy(e).add(t).multiplyScalar(.5),wo.copy(t).sub(e).normalize(),Mo.copy(this.origin).sub(bo);var n=.5*e.distanceTo(t),a=-this.direction.dot(wo),o=Mo.dot(this.direction),s=-Mo.dot(wo),l=Mo.lengthSq(),c=Math.abs(1-a*a);if(0<c){t=a*o-s;var h=n*c;0<=(e=a*s-o)?t>=-h?t<=h?a=(e*=n=1/c)*(e+a*(t*=n)+2*o)+t*(a*e+t+2*s)+l:(t=n,a=-(e=Math.max(0,-(a*t+o)))*e+t*(t+2*s)+l):(t=-n,a=-(e=Math.max(0,-(a*t+o)))*e+t*(t+2*s)+l):t<=-h?a=-(e=Math.max(0,-(-a*n+o)))*e+(t=0<e?-n:Math.min(Math.max(-n,-s),n))*(t+2*s)+l:t<=h?(e=0,a=(t=Math.min(Math.max(-n,-s),n))*(t+2*s)+l):a=-(e=Math.max(0,-(a*n+o)))*e+(t=0<e?n:Math.min(Math.max(-n,-s),n))*(t+2*s)+l}else t=0<a?-n:n,a=-(e=Math.max(0,-(a*t+o)))*e+t*(t+2*s)+l;return i&&i.copy(this.direction).multiplyScalar(e).add(this.origin),r&&r.copy(wo).multiplyScalar(t).add(bo),a},intersectSphere:function(e,t){xo.subVectors(e.center,this.origin);var i=xo.dot(this.direction),r=xo.dot(xo)-i*i;return r>(e=e.radius*e.radius)?null:(r=i-(e=Math.sqrt(e-r)),i+=e,0>r&&0>i?null:0>r?this.at(i,t):this.at(r,t))},intersectsSphere:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);return 0===t?0===e.distanceToPoint(this.origin)?0:null:0<=(e=-(this.origin.dot(e.normal)+e.constant)/t)?e:null},intersectPlane:function(e,t){return null===(e=this.distanceToPlane(e))?null:this.at(e,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||0>e.normal.dot(this.direction)*t},intersectBox:function(e,t){var i=1/this.direction.x,r=1/this.direction.y,n=1/this.direction.z,a=this.origin;if(0<=i){var o=(e.min.x-a.x)*i;i*=e.max.x-a.x}else o=(e.max.x-a.x)*i,i*=e.min.x-a.x;if(0<=r){var s=(e.min.y-a.y)*r;r*=e.max.y-a.y}else s=(e.max.y-a.y)*r,r*=e.min.y-a.y;return o>r||s>i?null:((s>o||o!=o)&&(o=s),(r<i||i!=i)&&(i=r),0<=n?(s=(e.min.z-a.z)*n,e=(e.max.z-a.z)*n):(s=(e.max.z-a.z)*n,e=(e.min.z-a.z)*n),o>e||s>i?null:((s>o||o!=o)&&(o=s),(e<i||i!=i)&&(i=e),0>i?null:this.at(0<=o?o:i,t)))},intersectsBox:function(e){return null!==this.intersectBox(e,xo)},intersectTriangle:function(e,t,i,r,n){if(To.subVectors(t,e),So.subVectors(i,e),Eo.crossVectors(To,So),0<(t=this.direction.dot(Eo))){if(r)return null;r=1}else{if(!(0>t))return null;r=-1,t=-t}return Mo.subVectors(this.origin,e),0>(e=r*this.direction.dot(So.crossVectors(Mo,So)))||0>(i=r*this.direction.dot(To.cross(Mo)))||e+i>t||0>(e=-r*Mo.dot(Eo))?null:this.at(e/t,n)},applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}});var Ao=new c,Co=new c,Lo=new r;Object.assign(_.prototype,{isPlane:!0,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(e,t,i){return t=Ao.subVectors(i,t).cross(Co.subVectors(e,t)).normalize(),this.setFromNormalAndCoplanarPoint(t,e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new c),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(e,t){void 0===t&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new c);var i=e.delta(Ao),r=this.normal.dot(i);if(0===r){if(0===this.distanceToPoint(e.start))return t.copy(e.start)}else if(!(0>(r=-(e.start.dot(this.normal)+this.constant)/r)||1<r))return t.copy(i).multiplyScalar(r).add(e.start)},intersectsLine:function(e){var t=this.distanceToPoint(e.start);return e=this.distanceToPoint(e.end),0>t&&0<e||0>e&&0<t},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new c),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(e,t){return t=t||Lo.getNormalMatrix(e),e=this.coplanarPoint(Ao).applyMatrix4(e),t=this.normal.applyMatrix3(t).normalize(),this.constant=-e.dot(t),this},translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}});var Po=new c,Io=new c,Ro=new c,Do=new c,ko=new c,zo=new c,Oo=new c,Bo=new c,Fo=new c,No=new c;Object.assign(x,{getNormal:function(e,t,i,r){return void 0===r&&(console.warn("THREE.Triangle: .getNormal() target is now required"),r=new c),r.subVectors(i,t),Po.subVectors(e,t),r.cross(Po),0<(e=r.lengthSq())?r.multiplyScalar(1/Math.sqrt(e)):r.set(0,0,0)},getBarycoord:function(e,t,i,r,n){Po.subVectors(r,t),Io.subVectors(i,t),Ro.subVectors(e,t),e=Po.dot(Po),t=Po.dot(Io),i=Po.dot(Ro);var a=Io.dot(Io);r=Io.dot(Ro);var o=e*a-t*t;return void 0===n&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),n=new c),0===o?n.set(-2,-1,-1):(a=(a*i-t*r)*(o=1/o),e=(e*r-t*i)*o,n.set(1-a-e,e,a))},containsPoint:function(e,t,i,r){return x.getBarycoord(e,t,i,r,Do),0<=Do.x&&0<=Do.y&&1>=Do.x+Do.y},getUV:function(e,t,i,r,n,a,o,s){return this.getBarycoord(e,t,i,r,Do),s.set(0,0),s.addScaledVector(n,Do.x),s.addScaledVector(a,Do.y),s.addScaledVector(o,Do.z),s},isFrontFacing:function(e,t,i,r){return Po.subVectors(i,t),Io.subVectors(e,t),0>Po.cross(Io).dot(r)}}),Object.assign(x.prototype,{set:function(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this},setFromPointsAndIndices:function(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){return Po.subVectors(this.c,this.b),Io.subVectors(this.a,this.b),.5*Po.cross(Io).length()},getMidpoint:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new c),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return x.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new _),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return x.getBarycoord(e,this.a,this.b,this.c,t)},getUV:function(e,t,i,r,n){return x.getUV(e,this.a,this.b,this.c,t,i,r,n)},containsPoint:function(e){return x.containsPoint(e,this.a,this.b,this.c)},isFrontFacing:function(e){return x.isFrontFacing(this.a,this.b,this.c,e)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new c);var i=this.a,r=this.b,n=this.c;ko.subVectors(r,i),zo.subVectors(n,i),Bo.subVectors(e,i);var a=ko.dot(Bo),o=zo.dot(Bo);if(0>=a&&0>=o)return t.copy(i);Fo.subVectors(e,r);var s=ko.dot(Fo),l=zo.dot(Fo);if(0<=s&&l<=s)return t.copy(r);var h=a*l-s*o;if(0>=h&&0<=a&&0>=s)return r=a/(a-s),t.copy(i).addScaledVector(ko,r);No.subVectors(e,n),e=ko.dot(No);var u=zo.dot(No);return 0<=u&&e<=u?t.copy(n):0>=(a=e*o-a*u)&&0<=o&&0>=u?(h=o/(o-u),t.copy(i).addScaledVector(zo,h)):0>=(o=s*u-e*l)&&0<=l-s&&0<=e-u?(Oo.subVectors(n,r),h=(l-s)/(l-s+(e-u)),t.copy(r).addScaledVector(Oo,h)):(r=a*(n=1/(o+a+h)),h*=n,t.copy(i).addScaledVector(ko,r).addScaledVector(zo,h))},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}});var Uo={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},jo={h:0,s:0,l:0},Vo={h:0,s:0,l:0};Object.assign(b.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){return this.b=this.g=this.r=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,i){return this.r=e,this.g=t,this.b=i,this},setHSL:function(e,t,i){return e=Ia.euclideanModulo(e,1),t=Ia.clamp(t,0,1),i=Ia.clamp(i,0,1),0===t?this.r=this.g=this.b=i:(i=2*i-(t=.5>=i?i*(1+t):i+t-i*t),this.r=w(i,t,e+1/3),this.g=w(i,t,e),this.b=w(i,t,e-1/3)),this},setStyle:function(e){function t(t){void 0!==t&&1>parseFloat(t)&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var i;if(i=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var r=i[2];switch(i[1]){case"rgb":case"rgba":if(i=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,t(i[5]),this;if(i=/^(\d+)%\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,t(i[5]),this;break;case"hsl":case"hsla":if(i=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r)){r=parseFloat(i[1])/360;var n=parseInt(i[2],10)/100,a=parseInt(i[3],10)/100;return t(i[5]),this.setHSL(r,n,a)}}}else if(i=/^#([A-Fa-f0-9]+)$/.exec(e)){if(3===(r=(i=i[1]).length))return this.r=parseInt(i.charAt(0)+i.charAt(0),16)/255,this.g=parseInt(i.charAt(1)+i.charAt(1),16)/255,this.b=parseInt(i.charAt(2)+i.charAt(2),16)/255,this;if(6===r)return this.r=parseInt(i.charAt(0)+i.charAt(1),16)/255,this.g=parseInt(i.charAt(2)+i.charAt(3),16)/255,this.b=parseInt(i.charAt(4)+i.charAt(5),16)/255,this}return e&&0<e.length?this.setColorName(e):this},setColorName:function(e){var t=Uo[e];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){return void 0===t&&(t=2),t=0<t?1/t:1,this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},convertGammaToLinear:function(e){return this.copyGammaToLinear(this,e),this},convertLinearToGamma:function(e){return this.copyLinearToGamma(this,e),this},copySRGBToLinear:function(e){return this.r=M(e.r),this.g=M(e.g),this.b=M(e.b),this},copyLinearToSRGB:function(e){return this.r=T(e.r),this.g=T(e.g),this.b=T(e.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,i=this.r,r=this.g,n=this.b,a=Math.max(i,r,n),o=Math.min(i,r,n),s=(o+a)/2;if(o===a)o=t=0;else{var l=a-o;switch(o=.5>=s?l/(a+o):l/(2-a-o),a){case i:t=(r-n)/l+(r<n?6:0);break;case r:t=(n-i)/l+2;break;case n:t=(i-r)/l+4}t/=6}return e.h=t,e.s=o,e.l=s,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,i){return this.getHSL(jo),jo.h+=e,jo.s+=t,jo.l+=i,this.setHSL(jo.h,jo.s,jo.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},lerpHSL:function(e,t){this.getHSL(jo),e.getHSL(Vo),e=Ia.lerp(jo.h,Vo.h,t);var i=Ia.lerp(jo.s,Vo.s,t);return t=Ia.lerp(jo.l,Vo.l,t),this.setHSL(e,i,t),this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}}),b.NAMES=Uo,Object.assign(S.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(t=0,i=e.vertexColors.length;t<i;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}});var Go=0;E.prototype=Object.assign(Object.create(t.prototype),{constructor:E,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var i=e[t];if(void 0===i)console.warn("THREE.Material: '"+t+"' parameter is undefined.");else if("shading"===t)console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===i;else{var r=this[t];void 0===r?console.warn("THREE."+this.type+": '"+t+"' is not a property of this material."):r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i}}},toJSON:function(e){function t(e){var t,i=[];for(t in e){var r=e[t];delete r.metadata,i.push(r)}return i}var i=void 0===e||"string"==typeof e;i&&(e={textures:{},images:{}});var r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};return r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(r.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearcoat&&(r.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,r.reflectivity=this.reflectivity,r.refractionRatio=this.refractionRatio,void 0!==this.combine&&(r.combine=this.combine),void 0!==this.envMapIntensity&&(r.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(r.size=this.size),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(r.blending=this.blending),!0===this.flatShading&&(r.flatShading=this.flatShading),0!==this.side&&(r.side=this.side),this.vertexColors&&(r.vertexColors=!0),1>this.opacity&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,r.stencilWrite=this.stencilWrite,r.stencilWriteMask=this.stencilWriteMask,r.stencilFunc=this.stencilFunc,r.stencilRef=this.stencilRef,r.stencilFuncMask=this.stencilFuncMask,r.stencilFail=this.stencilFail,r.stencilZFail=this.stencilZFail,r.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(r.rotation=this.rotation),!0===this.polygonOffset&&(r.polygonOffset=!0),0!==this.polygonOffsetFactor&&(r.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),0<this.alphaTest&&(r.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(r.wireframe=this.wireframe),1<this.wireframeLinewidth&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(r.morphTargets=!0),!0===this.morphNormals&&(r.morphNormals=!0),!0===this.skinning&&(r.skinning=!0),!1===this.visible&&(r.visible=!1),!1===this.toneMapped&&(r.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),i&&(i=t(e.textures),e=t(e.images),0<i.length&&(r.textures=i),0<e.length&&(r.images=e)),r},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes,i=null;if(null!==t){var r=t.length;i=Array(r);for(var n=0;n!==r;++n)i[n]=t[n].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(E.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),A.prototype=Object.create(E.prototype),A.prototype.constructor=A,A.prototype.isMeshBasicMaterial=!0,A.prototype.copy=function(e){return E.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this};var Ho=new c;Object.defineProperty(C.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(C.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this},copyAt:function(e,t,i){e*=this.itemSize,i*=t.itemSize;for(var r=0,n=this.itemSize;r<n;r++)this.array[e+r]=t.array[i+r];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,i=0,r=0,n=e.length;r<n;r++){var a=e[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),a=new b),t[i++]=a.r,t[i++]=a.g,t[i++]=a.b}return this},copyVector2sArray:function(e){for(var t=this.array,r=0,n=0,a=e.length;n<a;n++){var o=e[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),o=new i),t[r++]=o.x,t[r++]=o.y}return this},copyVector3sArray:function(e){for(var t=this.array,i=0,r=0,n=e.length;r<n;r++){var a=e[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),a=new c),t[i++]=a.x,t[i++]=a.y,t[i++]=a.z}return this},copyVector4sArray:function(e){for(var t=this.array,i=0,r=0,n=e.length;r<n;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),o=new a),t[i++]=o.x,t[i++]=o.y,t[i++]=o.z,t[i++]=o.w}return this},applyMatrix3:function(e){for(var t=0,i=this.count;t<i;t++)Ho.x=this.getX(t),Ho.y=this.getY(t),Ho.z=this.getZ(t),Ho.applyMatrix3(e),this.setXYZ(t,Ho.x,Ho.y,Ho.z);return this},applyMatrix4:function(e){for(var t=0,i=this.count;t<i;t++)Ho.x=this.getX(t),Ho.y=this.getY(t),Ho.z=this.getZ(t),Ho.applyMatrix4(e),this.setXYZ(t,Ho.x,Ho.y,Ho.z);return this},applyNormalMatrix:function(e){for(var t=0,i=this.count;t<i;t++)Ho.x=this.getX(t),Ho.y=this.getY(t),Ho.z=this.getZ(t),Ho.applyNormalMatrix(e),this.setXYZ(t,Ho.x,Ho.y,Ho.z);return this},transformDirection:function(e){for(var t=0,i=this.count;t<i;t++)Ho.x=this.getX(t),Ho.y=this.getY(t),Ho.z=this.getZ(t),Ho.transformDirection(e),this.setXYZ(t,Ho.x,Ho.y,Ho.z);return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this},setXYZ:function(e,t,i,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this},setXYZW:function(e,t,i,r,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=n,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),L.prototype=Object.create(C.prototype),L.prototype.constructor=L,P.prototype=Object.create(C.prototype),P.prototype.constructor=P,I.prototype=Object.create(C.prototype),I.prototype.constructor=I,R.prototype=Object.create(C.prototype),R.prototype.constructor=R,D.prototype=Object.create(C.prototype),D.prototype.constructor=D,k.prototype=Object.create(C.prototype),k.prototype.constructor=k,z.prototype=Object.create(C.prototype),z.prototype.constructor=z,O.prototype=Object.create(C.prototype),O.prototype.constructor=O,B.prototype=Object.create(C.prototype),B.prototype.constructor=B,Object.assign(F.prototype,{computeGroups:function(e){var t=[],i=void 0;e=e.faces;for(var r=0;r<e.length;r++){var n=e[r];if(n.materialIndex!==i){i=n.materialIndex,void 0!==a&&(a.count=3*r-a.start,t.push(a));var a={start:3*r,materialIndex:i}}}void 0!==a&&(a.count=3*r-a.start,t.push(a)),this.groups=t},fromGeometry:function(e){var t=e.faces,r=e.vertices,n=e.faceVertexUvs,a=n[0]&&0<n[0].length,o=n[1]&&0<n[1].length,s=e.morphTargets,l=s.length;if(0<l){for(var c=[],h=0;h<l;h++)c[h]={name:s[h].name,data:[]};this.morphTargets.position=c}var u=e.morphNormals,d=u.length;if(0<d){var p=[];for(h=0;h<d;h++)p[h]={name:u[h].name,data:[]};this.morphTargets.normal=p}var f=e.skinIndices,m=e.skinWeights,g=f.length===r.length,y=m.length===r.length;for(0<r.length&&0===t.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported."),h=0;h<t.length;h++){var v=t[h];this.vertices.push(r[v.a],r[v.b],r[v.c]);var _=v.vertexNormals;for(3===_.length?this.normals.push(_[0],_[1],_[2]):(_=v.normal,this.normals.push(_,_,_)),3===(_=v.vertexColors).length?this.colors.push(_[0],_[1],_[2]):(_=v.color,this.colors.push(_,_,_)),!0===a&&(void 0!==(_=n[0][h])?this.uvs.push(_[0],_[1],_[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",h),this.uvs.push(new i,new i,new i))),!0===o&&(void 0!==(_=n[1][h])?this.uvs2.push(_[0],_[1],_[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",h),this.uvs2.push(new i,new i,new i))),_=0;_<l;_++){var x=s[_].vertices;c[_].data.push(x[v.a],x[v.b],x[v.c])}for(_=0;_<d;_++)x=u[_].vertexNormals[h],p[_].data.push(x.a,x.b,x.c);g&&this.skinIndices.push(f[v.a],f[v.b],f[v.c]),y&&this.skinWeights.push(m[v.a],m[v.b],m[v.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}});var Wo=1,qo=new h,Zo=new p,Xo=new c,$o=new m,Yo=new m,Jo=new c;U.prototype=Object.assign(Object.create(t.prototype),{constructor:U,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(65535<N(e)?z:D)(e,1):this.index=e},getAttribute:function(e){return this.attributes[e]},setAttribute:function(e,t){return this.attributes[e]=t,this},deleteAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,i){this.groups.push({start:e,count:t,materialIndex:void 0!==i?i:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix4:function(e){var t=this.attributes.position;if(void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0),void 0!==(t=this.attributes.normal)){var i=(new r).getNormalMatrix(e);t.applyNormalMatrix(i),t.needsUpdate=!0}return void 0!==(t=this.attributes.tangent)&&(t.transformDirection(e),t.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(e){return qo.makeRotationX(e),this.applyMatrix4(qo),this},rotateY:function(e){return qo.makeRotationY(e),this.applyMatrix4(qo),this},rotateZ:function(e){return qo.makeRotationZ(e),this.applyMatrix4(qo),this},translate:function(e,t,i){return qo.makeTranslation(e,t,i),this.applyMatrix4(qo),this},scale:function(e,t,i){return qo.makeScale(e,t,i),this.applyMatrix4(qo),this},lookAt:function(e){return Zo.lookAt(e),Zo.updateMatrix(),this.applyMatrix4(Zo.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Xo).negate(),this.translate(Xo.x,Xo.y,Xo.z),this},setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){e=new O(3*t.vertices.length,3);var i=new O(3*t.colors.length,3);this.setAttribute("position",e.copyVector3sArray(t.vertices)),this.setAttribute("color",i.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length&&(e=new O(t.lineDistances.length,1),this.setAttribute("lineDistance",e.copyArray(t.lineDistances))),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],i=0,r=e.length;i<r;i++){var n=e[i];t.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new O(t,3)),this},updateFromObject:function(e){var t=e.geometry;if(e.isMesh){var i=t.__directGeometry;if(!0===t.elementsNeedUpdate&&(i=void 0,t.elementsNeedUpdate=!1),void 0===i)return this.fromGeometry(t);i.verticesNeedUpdate=t.verticesNeedUpdate,i.normalsNeedUpdate=t.normalsNeedUpdate,i.colorsNeedUpdate=t.colorsNeedUpdate,i.uvsNeedUpdate=t.uvsNeedUpdate,i.groupsNeedUpdate=t.groupsNeedUpdate,t.verticesNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.groupsNeedUpdate=!1,t=i}return!0===t.verticesNeedUpdate&&(void 0!==(i=this.attributes.position)&&(i.copyVector3sArray(t.vertices),i.needsUpdate=!0),t.verticesNeedUpdate=!1),!0===t.normalsNeedUpdate&&(void 0!==(i=this.attributes.normal)&&(i.copyVector3sArray(t.normals),i.needsUpdate=!0),t.normalsNeedUpdate=!1),!0===t.colorsNeedUpdate&&(void 0!==(i=this.attributes.color)&&(i.copyColorsArray(t.colors),i.needsUpdate=!0),t.colorsNeedUpdate=!1),t.uvsNeedUpdate&&(void 0!==(i=this.attributes.uv)&&(i.copyVector2sArray(t.uvs),i.needsUpdate=!0),t.uvsNeedUpdate=!1),t.lineDistancesNeedUpdate&&(void 0!==(i=this.attributes.lineDistance)&&(i.copyArray(t.lineDistances),i.needsUpdate=!0),t.lineDistancesNeedUpdate=!1),t.groupsNeedUpdate&&(t.computeGroups(e.geometry),this.groups=t.groups,t.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new F).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);for(var i in this.setAttribute("position",new C(t,3).copyVector3sArray(e.vertices)),0<e.normals.length&&(t=new Float32Array(3*e.normals.length),this.setAttribute("normal",new C(t,3).copyVector3sArray(e.normals))),0<e.colors.length&&(t=new Float32Array(3*e.colors.length),this.setAttribute("color",new C(t,3).copyColorsArray(e.colors))),0<e.uvs.length&&(t=new Float32Array(2*e.uvs.length),this.setAttribute("uv",new C(t,2).copyVector2sArray(e.uvs))),0<e.uvs2.length&&(t=new Float32Array(2*e.uvs2.length),this.setAttribute("uv2",new C(t,2).copyVector2sArray(e.uvs2))),this.groups=e.groups,e.morphTargets){t=[];for(var r=e.morphTargets[i],n=0,a=r.length;n<a;n++){var o=r[n],s=new O(3*o.data.length,3);s.name=o.name,t.push(s.copyVector3sArray(o.data))}this.morphAttributes[i]=t}return 0<e.skinIndices.length&&(i=new O(4*e.skinIndices.length,4),this.setAttribute("skinIndex",i.copyVector4sArray(e.skinIndices))),0<e.skinWeights.length&&(i=new O(4*e.skinWeights.length,4),this.setAttribute("skinWeight",i.copyVector4sArray(e.skinWeights))),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new m);var e=this.attributes.position,t=this.morphAttributes.position;if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t){e=0;for(var i=t.length;e<i;e++)$o.setFromBufferAttribute(t[e]),this.morphTargetsRelative?(Jo.addVectors(this.boundingBox.min,$o.min),this.boundingBox.expandByPoint(Jo),Jo.addVectors(this.boundingBox.max,$o.max),this.boundingBox.expandByPoint(Jo)):(this.boundingBox.expandByPoint($o.min),this.boundingBox.expandByPoint($o.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new y);var e=this.attributes.position,t=this.morphAttributes.position;if(e){var i=this.boundingSphere.center;if($o.setFromBufferAttribute(e),t)for(var r=0,n=t.length;r<n;r++){var a=t[r];Yo.setFromBufferAttribute(a),this.morphTargetsRelative?(Jo.addVectors($o.min,Yo.min),$o.expandByPoint(Jo),Jo.addVectors($o.max,Yo.max),$o.expandByPoint(Jo)):($o.expandByPoint(Yo.min),$o.expandByPoint(Yo.max))}$o.getCenter(i);var o=0;for(r=0,n=e.count;r<n;r++)Jo.fromBufferAttribute(e,r),o=Math.max(o,i.distanceToSquared(Jo));if(t)for(r=0,n=t.length;r<n;r++){a=t[r];for(var s=this.morphTargetsRelative,l=0,c=a.count;l<c;l++)Jo.fromBufferAttribute(a,l),s&&(Xo.fromBufferAttribute(e,l),Jo.add(Xo)),o=Math.max(o,i.distanceToSquared(Jo))}this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes;if(t.position){var i=t.position.array;if(void 0===t.normal)this.setAttribute("normal",new C(new Float32Array(i.length),3));else for(var r=t.normal.array,n=0,a=r.length;n<a;n++)r[n]=0;r=t.normal.array;var o=new c,s=new c,l=new c,h=new c,u=new c;if(e){var d=e.array;for(n=0,a=e.count;n<a;n+=3){e=3*d[n+0];var p=3*d[n+1],f=3*d[n+2];o.fromArray(i,e),s.fromArray(i,p),l.fromArray(i,f),h.subVectors(l,s),u.subVectors(o,s),h.cross(u),r[e]+=h.x,r[e+1]+=h.y,r[e+2]+=h.z,r[p]+=h.x,r[p+1]+=h.y,r[p+2]+=h.z,r[f]+=h.x,r[f+1]+=h.y,r[f+2]+=h.z}}else for(n=0,a=i.length;n<a;n+=9)o.fromArray(i,n),s.fromArray(i,n+3),l.fromArray(i,n+6),h.subVectors(l,s),u.subVectors(o,s),h.cross(u),r[n]=h.x,r[n+1]=h.y,r[n+2]=h.z,r[n+3]=h.x,r[n+4]=h.y,r[n+5]=h.z,r[n+6]=h.x,r[n+7]=h.y,r[n+8]=h.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var i,r=this.attributes;for(i in r)if(void 0!==e.attributes[i]){var n=r[i].array,a=e.attributes[i],o=a.array,s=a.itemSize*t;a=Math.min(o.length,n.length-s);for(var l=0;l<a;l++,s++)n[s]=o[l]}return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){for(var e=this.attributes.normal,t=0,i=e.count;t<i;t++)Jo.x=e.getX(t),Jo.y=e.getY(t),Jo.z=e.getZ(t),Jo.normalize(),e.setXYZ(t,Jo.x,Jo.y,Jo.z)},toNonIndexed:function(){function e(e,t){var i=e.array,r=e.itemSize;e=e.normalized;for(var n,a=new i.constructor(t.length*r),o=0,s=0,l=t.length;s<l;s++){n=t[s]*r;for(var c=0;c<r;c++)a[o++]=i[n++]}return new C(a,r,e)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t,i=new U,r=this.index.array,n=this.attributes;for(t in n){var a=n[t];a=e(a,r),i.setAttribute(t,a)}var o=this.morphAttributes;for(t in o){var s=[],l=o[t];n=0;for(var c=l.length;n<c;n++)a=e(a=l[n],r),s.push(a);i.morphAttributes[t]=s}for(i.morphTargetsRelative=this.morphTargetsRelative,n=0,t=(r=this.groups).length;n<t;n++)a=r[n],i.addGroup(a.start,a.count,a.materialIndex);return i},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),0<Object.keys(this.userData).length&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(c in t)void 0!==t[c]&&(e[c]=t[c]);return e}e.data={attributes:{}},null!==(t=this.index)&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});var i=this.attributes;for(c in i){var r=(t=i[c]).toJSON();""!==t.name&&(r.name=t.name),e.data.attributes[c]=r}i={};var n=!1;for(c in this.morphAttributes){for(var a=this.morphAttributes[c],o=[],s=0,l=a.length;s<l;s++)r=(t=a[s]).toJSON(),""!==t.name&&(r.name=t.name),o.push(r);0<o.length&&(i[c]=o,n=!0)}n&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);var c=this.groups;return 0<c.length&&(e.data.groups=JSON.parse(JSON.stringify(c))),null!==(c=this.boundingSphere)&&(e.data.boundingSphere={center:c.center.toArray(),radius:c.radius}),e},clone:function(){return(new U).copy(this)},copy:function(e){var t;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingSphere=this.boundingBox=null,this.name=e.name;var i=e.index;for(o in null!==i&&this.setIndex(i.clone()),i=e.attributes)this.setAttribute(o,i[o].clone());var r=e.morphAttributes;for(o in r){var n=[],a=r[o];for(i=0,t=a.length;i<t;i++)n.push(a[i].clone());this.morphAttributes[o]=n}this.morphTargetsRelative=e.morphTargetsRelative;var o=e.groups;for(i=0,t=o.length;i<t;i++)r=o[i],this.addGroup(r.start,r.count,r.materialIndex);return null!==(o=e.boundingBox)&&(this.boundingBox=o.clone()),null!==(o=e.boundingSphere)&&(this.boundingSphere=o.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Ko=new h,Qo=new v,es=new y,ts=new c,is=new c,rs=new c,ns=new c,as=new c,os=new c,ss=new c,ls=new c,cs=new c,hs=new i,us=new i,ds=new i,ps=new c,fs=new c;j.prototype=Object.assign(Object.create(p.prototype),{constructor:j,isMesh:!0,copy:function(e){return p.prototype.copy.call(this,e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e=this.geometry;if(e.isBufferGeometry){e=e.morphAttributes;var t=Object.keys(e);if(0<t.length){var i=e[t[0]];if(void 0!==i)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=i.length;e<t;e++){var r=i[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e}}}else void 0!==(e=e.morphTargets)&&0<e.length&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")},raycast:function(e,t){var r=this.geometry,n=this.material,a=this.matrixWorld;if(void 0!==n&&(null===r.boundingSphere&&r.computeBoundingSphere(),es.copy(r.boundingSphere),es.applyMatrix4(a),!1!==e.ray.intersectsSphere(es)&&(Ko.getInverse(a),Qo.copy(e.ray).applyMatrix4(Ko),null===r.boundingBox||!1!==Qo.intersectsBox(r.boundingBox))))if(r.isBufferGeometry){var o=r.index;a=r.attributes.position;var s,l,c=r.morphAttributes.position,h=r.morphTargetsRelative,u=r.attributes.uv,d=r.attributes.uv2,p=r.groups,f=r.drawRange;if(null!==o)if(Array.isArray(n)){var m=0;for(s=p.length;m<s;m++){var g=p[m],y=n[g.materialIndex],v=Math.max(g.start,f.start);for(l=r=Math.min(g.start+g.count,f.start+f.count);v<l;v+=3){r=o.getX(v);var _=o.getX(v+1),b=o.getX(v+2);(r=G(this,y,e,Qo,a,c,h,u,d,r,_,b))&&(r.faceIndex=Math.floor(v/3),r.face.materialIndex=g.materialIndex,t.push(r))}}}else for(m=v=Math.max(0,f.start),s=r=Math.min(o.count,f.start+f.count);m<s;m+=3)r=o.getX(m),_=o.getX(m+1),b=o.getX(m+2),(r=G(this,n,e,Qo,a,c,h,u,d,r,_,b))&&(r.faceIndex=Math.floor(m/3),t.push(r));else if(void 0!==a)if(Array.isArray(n))for(m=0,s=p.length;m<s;m++)for(y=n[(g=p[m]).materialIndex],v=Math.max(g.start,f.start),l=r=Math.min(g.start+g.count,f.start+f.count);v<l;v+=3)(r=G(this,y,e,Qo,a,c,h,u,d,r=v,_=v+1,b=v+2))&&(r.faceIndex=Math.floor(v/3),r.face.materialIndex=g.materialIndex,t.push(r));else for(m=v=Math.max(0,f.start),s=r=Math.min(a.count,f.start+f.count);m<s;m+=3)(r=G(this,n,e,Qo,a,c,h,u,d,r=m,_=m+1,b=m+2))&&(r.faceIndex=Math.floor(m/3),t.push(r))}else if(r.isGeometry)for(a=Array.isArray(n),c=r.vertices,h=r.faces,0<(r=r.faceVertexUvs[0]).length&&(o=r),f=0,m=h.length;f<m;f++)s=h[f],void 0!==(r=a?n[s.materialIndex]:n)&&(u=c[s.a],d=c[s.b],p=c[s.c],r=V(this,r,e,Qo,u,d,p,ps))&&(o&&o[f]&&(g=o[f],hs.copy(g[0]),us.copy(g[1]),ds.copy(g[2]),r.uv=x.getUV(ps,u,d,p,hs,us,ds,new i)),r.face=s,r.faceIndex=f,t.push(r))},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var ms=0,gs=new h,ys=new p,vs=new c;H.prototype=Object.assign(Object.create(t.prototype),{constructor:H,isGeometry:!0,applyMatrix4:function(e){for(var t=(new r).getNormalMatrix(e),i=0,n=this.vertices.length;i<n;i++)this.vertices[i].applyMatrix4(e);for(i=0,n=this.faces.length;i<n;i++){(e=this.faces[i]).normal.applyMatrix3(t).normalize();for(var a=0,o=e.vertexNormals.length;a<o;a++)e.vertexNormals[a].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.normalsNeedUpdate=this.verticesNeedUpdate=!0,this},rotateX:function(e){return gs.makeRotationX(e),this.applyMatrix4(gs),this},rotateY:function(e){return gs.makeRotationY(e),this.applyMatrix4(gs),this},rotateZ:function(e){return gs.makeRotationZ(e),this.applyMatrix4(gs),this},translate:function(e,t,i){return gs.makeTranslation(e,t,i),this.applyMatrix4(gs),this},scale:function(e,t,i){return gs.makeScale(e,t,i),this.applyMatrix4(gs),this},lookAt:function(e){return ys.lookAt(e),ys.updateMatrix(),this.applyMatrix4(ys.matrix),this},fromBufferGeometry:function(e){function t(e,t,n,a){var o=void 0===l?[]:[r.colors[e].clone(),r.colors[t].clone(),r.colors[n].clone()];a=new S(e,t,n,void 0===s?[]:[(new c).fromArray(s,3*e),(new c).fromArray(s,3*t),(new c).fromArray(s,3*n)],o,a),r.faces.push(a),void 0!==h&&r.faceVertexUvs[0].push([(new i).fromArray(h,2*e),(new i).fromArray(h,2*t),(new i).fromArray(h,2*n)]),void 0!==u&&r.faceVertexUvs[1].push([(new i).fromArray(u,2*e),(new i).fromArray(u,2*t),(new i).fromArray(u,2*n)])}var r=this,n=null!==e.index?e.index.array:void 0,a=e.attributes;if(void 0===a.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;var o=a.position.array,s=void 0!==a.normal?a.normal.array:void 0,l=void 0!==a.color?a.color.array:void 0,h=void 0!==a.uv?a.uv.array:void 0,u=void 0!==a.uv2?a.uv2.array:void 0;for(void 0!==u&&(this.faceVertexUvs[1]=[]),a=0;a<o.length;a+=3)r.vertices.push((new c).fromArray(o,a)),void 0!==l&&r.colors.push((new b).fromArray(l,a));var d=e.groups;if(0<d.length)for(a=0;a<d.length;a++){var p=(o=d[a]).start,f=p;for(p+=o.count;f<p;f+=3)void 0!==n?t(n[f],n[f+1],n[f+2],o.materialIndex):t(f,f+1,f+2,o.materialIndex)}else if(void 0!==n)for(a=0;a<n.length;a+=3)t(n[a],n[a+1],n[a+2]);else for(a=0;a<o.length/3;a+=3)t(a,a+1,a+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(vs).negate(),this.translate(vs.x,vs.y,vs.z),this},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius;t=0===t?1:1/t;var i=new h;return i.set(t,0,0,-t*e.x,0,t,0,-t*e.y,0,0,t,-t*e.z,0,0,0,1),this.applyMatrix4(i),this},computeFaceNormals:function(){for(var e=new c,t=new c,i=0,r=this.faces.length;i<r;i++){var n=this.faces[i],a=this.vertices[n.a],o=this.vertices[n.b];e.subVectors(this.vertices[n.c],o),t.subVectors(a,o),e.cross(t),e.normalize(),n.normal.copy(e)}},computeVertexNormals:function(e){var t;void 0===e&&(e=!0);var i=Array(this.vertices.length),r=0;for(t=this.vertices.length;r<t;r++)i[r]=new c;if(e){var n=new c,a=new c;for(e=0,r=this.faces.length;e<r;e++){t=this.faces[e];var o=this.vertices[t.a],s=this.vertices[t.b],l=this.vertices[t.c];n.subVectors(l,s),a.subVectors(o,s),n.cross(a),i[t.a].add(n),i[t.b].add(n),i[t.c].add(n)}}else for(this.computeFaceNormals(),e=0,r=this.faces.length;e<r;e++)i[(t=this.faces[e]).a].add(t.normal),i[t.b].add(t.normal),i[t.c].add(t.normal);for(r=0,t=this.vertices.length;r<t;r++)i[r].normalize();for(e=0,r=this.faces.length;e<r;e++)3===(o=(t=this.faces[e]).vertexNormals).length?(o[0].copy(i[t.a]),o[1].copy(i[t.b]),o[2].copy(i[t.c])):(o[0]=i[t.a].clone(),o[1]=i[t.b].clone(),o[2]=i[t.c].clone());0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e;this.computeFaceNormals();var t=0;for(e=this.faces.length;t<e;t++){var i=this.faces[t],r=i.vertexNormals;3===r.length?(r[0].copy(i.normal),r[1].copy(i.normal),r[2].copy(i.normal)):(r[0]=i.normal.clone(),r[1]=i.normal.clone(),r[2]=i.normal.clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,i=0;for(t=this.faces.length;i<t;i++){var r=this.faces[i];r.__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]);var n=0;for(e=r.vertexNormals.length;n<e;n++)r.__originalVertexNormals[n]?r.__originalVertexNormals[n].copy(r.vertexNormals[n]):r.__originalVertexNormals[n]=r.vertexNormals[n].clone()}var a=new H;for(a.faces=this.faces,n=0,e=this.morphTargets.length;n<e;n++){if(!this.morphNormals[n]){this.morphNormals[n]={},this.morphNormals[n].faceNormals=[],this.morphNormals[n].vertexNormals=[],r=this.morphNormals[n].faceNormals;var o=this.morphNormals[n].vertexNormals;for(i=0,t=this.faces.length;i<t;i++){var s=new c,l={a:new c,b:new c,c:new c};r.push(s),o.push(l)}}for(o=this.morphNormals[n],a.vertices=this.morphTargets[n].vertices,a.computeFaceNormals(),a.computeVertexNormals(),i=0,t=this.faces.length;i<t;i++)r=this.faces[i],s=o.faceNormals[i],l=o.vertexNormals[i],s.copy(r.normal),l.a.copy(r.vertexNormals[0]),l.b.copy(r.vertexNormals[1]),l.c.copy(r.vertexNormals[2])}for(i=0,t=this.faces.length;i<t;i++)(r=this.faces[i]).normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new m),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new y),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,i){if(e&&e.isGeometry){var n,a=this.vertices.length,o=this.vertices,s=e.vertices,l=this.faces,c=e.faces,h=this.colors,u=e.colors;void 0===i&&(i=0),void 0!==t&&(n=(new r).getNormalMatrix(t));for(var d=0,p=s.length;d<p;d++){var f=s[d].clone();void 0!==t&&f.applyMatrix4(t),o.push(f)}for(d=0,p=u.length;d<p;d++)h.push(u[d].clone());for(d=0,p=c.length;d<p;d++){var m=(s=c[d]).vertexNormals;for(u=s.vertexColors,(h=new S(s.a+a,s.b+a,s.c+a)).normal.copy(s.normal),void 0!==n&&h.normal.applyMatrix3(n).normalize(),t=0,o=m.length;t<o;t++)f=m[t].clone(),void 0!==n&&f.applyMatrix3(n).normalize(),h.vertexNormals.push(f);for(h.color.copy(s.color),t=0,o=u.length;t<o;t++)f=u[t],h.vertexColors.push(f.clone());h.materialIndex=s.materialIndex+i,l.push(h)}for(d=0,p=e.faceVertexUvs.length;d<p;d++)for(i=e.faceVertexUvs[d],void 0===this.faceVertexUvs[d]&&(this.faceVertexUvs[d]=[]),t=0,o=i.length;t<o;t++){for(a=[],l=0,c=(n=i[t]).length;l<c;l++)a.push(n[l].clone());this.faceVertexUvs[d].push(a)}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var e,t={},i=[],r=[],n=Math.pow(10,4),a=0;for(e=this.vertices.length;a<e;a++){var o=this.vertices[a];void 0===t[o=Math.round(o.x*n)+"_"+Math.round(o.y*n)+"_"+Math.round(o.z*n)]?(t[o]=a,i.push(this.vertices[a]),r[a]=i.length-1):r[a]=r[t[o]]}for(t=[],a=0,e=this.faces.length;a<e;a++)for((n=this.faces[a]).a=r[n.a],n.b=r[n.b],n.c=r[n.c],n=[n.a,n.b,n.c],o=0;3>o;o++)if(n[o]===n[(o+1)%3]){t.push(a);break}for(a=t.length-1;0<=a;a--)for(n=t[a],this.faces.splice(n,1),r=0,e=this.faceVertexUvs.length;r<e;r++)this.faceVertexUvs[r].splice(n,1);return a=this.vertices.length-i.length,this.vertices=i,a},setFromPoints:function(e){this.vertices=[];for(var t=0,i=e.length;t<i;t++){var r=e[t];this.vertices.push(new c(r.x,r.y,r.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,i=0;i<t;i++)e[i]._id=i;e.sort((function(e,t){return e.materialIndex-t.materialIndex}));var r,n,a=this.faceVertexUvs[0],o=this.faceVertexUvs[1];for(a&&a.length===t&&(r=[]),o&&o.length===t&&(n=[]),i=0;i<t;i++){var s=e[i]._id;r&&r.push(a[s]),n&&n.push(o[s])}r&&(this.faceVertexUvs[0]=r),n&&(this.faceVertexUvs[1]=n)},toJSON:function(){function e(e,t,i){return i?e|1<<t:e&~(1<<t)}function t(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==c[t]||(c[t]=l.length/3,l.push(e.x,e.y,e.z)),c[t]}function i(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==u[t]||(u[t]=h.length,h.push(e.getHex())),u[t]}function r(e){var t=e.x.toString()+e.y.toString();return void 0!==p[t]||(p[t]=d.length/2,d.push(e.x,e.y)),p[t]}var n={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),void 0!==this.parameters){var a,o=this.parameters;for(a in o)void 0!==o[a]&&(n[a]=o[a]);return n}for(o=[],a=0;a<this.vertices.length;a++){var s=this.vertices[a];o.push(s.x,s.y,s.z)}s=[];var l=[],c={},h=[],u={},d=[],p={};for(a=0;a<this.faces.length;a++){var f=this.faces[a],m=void 0!==this.faceVertexUvs[0][a],g=0<f.normal.length(),y=0<f.vertexNormals.length,v=1!==f.color.r||1!==f.color.g||1!==f.color.b,_=0<f.vertexColors.length,x=0;x=e(x,0,0),x=e(x,1,!0),x=e(x,2,!1),x=e(x,3,m),x=e(x,4,g),x=e(x,5,y),x=e(x,6,v),x=e(x,7,_),s.push(x),s.push(f.a,f.b,f.c),s.push(f.materialIndex),m&&(m=this.faceVertexUvs[0][a],s.push(r(m[0]),r(m[1]),r(m[2]))),g&&s.push(t(f.normal)),y&&(g=f.vertexNormals,s.push(t(g[0]),t(g[1]),t(g[2]))),v&&s.push(i(f.color)),_&&(f=f.vertexColors,s.push(i(f[0]),i(f[1]),i(f[2])))}return n.data={},n.data.vertices=o,n.data.normals=l,0<h.length&&(n.data.colors=h),0<d.length&&(n.data.uvs=[d]),n.data.faces=s,n},clone:function(){return(new H).copy(this)},copy:function(e){var t,i,r;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingSphere=this.boundingBox=null,this.name=e.name;var n=e.vertices,a=0;for(t=n.length;a<t;a++)this.vertices.push(n[a].clone());for(a=0,t=(n=e.colors).length;a<t;a++)this.colors.push(n[a].clone());for(a=0,t=(n=e.faces).length;a<t;a++)this.faces.push(n[a].clone());for(a=0,t=e.faceVertexUvs.length;a<t;a++){var o=e.faceVertexUvs[a];for(void 0===this.faceVertexUvs[a]&&(this.faceVertexUvs[a]=[]),n=0,i=o.length;n<i;n++){var s=o[n],l=[],c=0;for(r=s.length;c<r;c++)l.push(s[c].clone());this.faceVertexUvs[a].push(l)}}for(a=0,t=(c=e.morphTargets).length;a<t;a++){if((r={}).name=c[a].name,void 0!==c[a].vertices)for(r.vertices=[],n=0,i=c[a].vertices.length;n<i;n++)r.vertices.push(c[a].vertices[n].clone());if(void 0!==c[a].normals)for(r.normals=[],n=0,i=c[a].normals.length;n<i;n++)r.normals.push(c[a].normals[n].clone());this.morphTargets.push(r)}for(a=0,t=(c=e.morphNormals).length;a<t;a++){if(r={},void 0!==c[a].vertexNormals)for(r.vertexNormals=[],n=0,i=c[a].vertexNormals.length;n<i;n++)o=c[a].vertexNormals[n],(s={}).a=o.a.clone(),s.b=o.b.clone(),s.c=o.c.clone(),r.vertexNormals.push(s);if(void 0!==c[a].faceNormals)for(r.faceNormals=[],n=0,i=c[a].faceNormals.length;n<i;n++)r.faceNormals.push(c[a].faceNormals[n].clone());this.morphNormals.push(r)}for(a=0,t=(n=e.skinWeights).length;a<t;a++)this.skinWeights.push(n[a].clone());for(a=0,t=(n=e.skinIndices).length;a<t;a++)this.skinIndices.push(n[a].clone());for(a=0,t=(n=e.lineDistances).length;a<t;a++)this.lineDistances.push(n[a]);return null!==(a=e.boundingBox)&&(this.boundingBox=a.clone()),null!==(a=e.boundingSphere)&&(this.boundingSphere=a.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var _s=function(e){function t(t,i,r,n,a,o){e.call(this),this.type="BoxGeometry",this.parameters={width:t,height:i,depth:r,widthSegments:n,heightSegments:a,depthSegments:o},this.fromBufferGeometry(new xs(t,i,r,n,a,o)),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t}(H),xs=function(e){function t(t,i,r,n,a,o){function s(e,t,i,r,n,a,o,s,g,y,v){var _=a/g,x=o/y,b=a/2,w=o/2,M=s/2;o=g+1;for(var T=y+1,S=a=0,E=new c,A=0;A<T;A++)for(var C=A*x-w,L=0;L<o;L++)E[e]=(L*_-b)*r,E[t]=C*n,E[i]=M,u.push(E.x,E.y,E.z),E[e]=0,E[t]=0,E[i]=0<s?1:-1,d.push(E.x,E.y,E.z),p.push(L/g),p.push(1-A/y),a+=1;for(e=0;e<y;e++)for(t=0;t<g;t++)i=f+t+o*(e+1),r=f+(t+1)+o*(e+1),n=f+(t+1)+o*e,h.push(f+t+o*e,i,n),h.push(i,r,n),S+=6;l.addGroup(m,S,v),m+=S,f+=a}e.call(this),this.type="BoxBufferGeometry",this.parameters={width:t,height:i,depth:r,widthSegments:n,heightSegments:a,depthSegments:o};var l=this;t=t||1,i=i||1,r=r||1,n=Math.floor(n)||1,a=Math.floor(a)||1,o=Math.floor(o)||1;var h=[],u=[],d=[],p=[],f=0,m=0;s("z","y","x",-1,-1,r,i,t,o,a,0),s("z","y","x",1,-1,r,i,-t,o,a,1),s("x","z","y",1,1,t,r,i,n,o,2),s("x","z","y",1,-1,t,r,-i,n,o,3),s("x","y","z",1,-1,t,i,r,n,a,4),s("x","y","z",-1,-1,t,i,-r,n,a,5),this.setIndex(h),this.setAttribute("position",new O(u,3)),this.setAttribute("normal",new O(d,3)),this.setAttribute("uv",new O(p,2))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t}(U),bs={clone:W,merge:q};Z.prototype=Object.create(E.prototype),Z.prototype.constructor=Z,Z.prototype.isShaderMaterial=!0,Z.prototype.copy=function(e){return E.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=W(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=Object.assign({},e.extensions),this},Z.prototype.toJSON=function(e){var t=E.prototype.toJSON.call(this,e);for(var i in t.uniforms={},this.uniforms){var r=this.uniforms[i].value;t.uniforms[i]=r&&r.isTexture?{type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?{type:"c",value:r.getHex()}:r&&r.isVector2?{type:"v2",value:r.toArray()}:r&&r.isVector3?{type:"v3",value:r.toArray()}:r&&r.isVector4?{type:"v4",value:r.toArray()}:r&&r.isMatrix3?{type:"m3",value:r.toArray()}:r&&r.isMatrix4?{type:"m4",value:r.toArray()}:{value:r}}for(var n in 0<Object.keys(this.defines).length&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,e={},this.extensions)!0===this.extensions[n]&&(e[n]=!0);return 0<Object.keys(e).length&&(t.extensions=e),t},X.prototype=Object.assign(Object.create(p.prototype),{constructor:X,isCamera:!0,copy:function(e,t){return p.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new c),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){p.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},updateWorldMatrix:function(e,t){p.prototype.updateWorldMatrix.call(this,e,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),$.prototype=Object.assign(Object.create(X.prototype),{constructor:$,isPerspectiveCamera:!0,copy:function(e,t){return X.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){e=.5*this.getFilmHeight()/e,this.fov=2*Ia.RAD2DEG*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*Ia.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*Ia.RAD2DEG*Math.atan(Math.tan(.5*Ia.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,i,r,n,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*Ia.DEG2RAD*this.fov)/this.zoom,i=2*t,r=this.aspect*i,n=-.5*r,a=this.view;if(null!==this.view&&this.view.enabled){var o=a.fullWidth,s=a.fullHeight;n+=a.offsetX*r/o,t-=a.offsetY*i/s,r*=a.width/o,i*=a.height/s}0!==(a=this.filmOffset)&&(n+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+r,t,t-i,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){return(e=p.prototype.toJSON.call(this,e)).object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}),Y.prototype=Object.create(p.prototype),Y.prototype.constructor=Y,J.prototype=Object.create(o.prototype),J.prototype.constructor=J,J.prototype.isWebGLCubeRenderTarget=!0,J.prototype.fromEquirectangularTexture=function(e,t){this.texture.type=t.type,this.texture.format=t.format,this.texture.encoding=t.encoding;var i=new f,r=new Z({type:"CubemapFromEquirect",uniforms:W({tEquirect:{value:null}}),vertexShader:"varying vec3 vWorldDirection;\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",fragmentShader:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}",side:1,blending:0});return r.uniforms.tEquirect.value=t,t=new j(new xs(5,5,5),r),i.add(t),new Y(1,10,this).update(e,i),t.geometry.dispose(),t.material.dispose(),this},K.prototype=Object.create(n.prototype),K.prototype.constructor=K,K.prototype.isDataTexture=!0;var ws=new y,Ms=new c;Object.assign(Q.prototype,{set:function(e,t,i,r,n,a){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(i),o[3].copy(r),o[4].copy(n),o[5].copy(a),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,i=0;6>i;i++)t[i].copy(e.planes[i]);return this},setFromProjectionMatrix:function(e){var t=this.planes,i=e.elements;e=i[0];var r=i[1],n=i[2],a=i[3],o=i[4],s=i[5],l=i[6],c=i[7],h=i[8],u=i[9],d=i[10],p=i[11],f=i[12],m=i[13],g=i[14];return i=i[15],t[0].setComponents(a-e,c-o,p-h,i-f).normalize(),t[1].setComponents(a+e,c+o,p+h,i+f).normalize(),t[2].setComponents(a+r,c+s,p+u,i+m).normalize(),t[3].setComponents(a-r,c-s,p-u,i-m).normalize(),t[4].setComponents(a-n,c-l,p-d,i-g).normalize(),t[5].setComponents(a+n,c+l,p+d,i+g).normalize(),this},intersectsObject:function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),ws.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(ws)},intersectsSprite:function(e){return ws.center.set(0,0,0),ws.radius=.7071067811865476,ws.applyMatrix4(e.matrixWorld),this.intersectsSphere(ws)},intersectsSphere:function(e){var t=this.planes,i=e.center;e=-e.radius;for(var r=0;6>r;r++)if(t[r].distanceToPoint(i)<e)return!1;return!0},intersectsBox:function(e){for(var t=this.planes,i=0;6>i;i++){var r=t[i];if(Ms.x=0<r.normal.x?e.max.x:e.min.x,Ms.y=0<r.normal.y?e.max.y:e.min.y,Ms.z=0<r.normal.z?e.max.z:e.min.z,0>r.distanceToPoint(Ms))return!1}return!0},containsPoint:function(e){for(var t=this.planes,i=0;6>i;i++)if(0>t[i].distanceToPoint(e))return!1;return!0}});var Ts={common:{diffuse:{value:new b(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new r},uv2Transform:{value:new r},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new i(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new b(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new b(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new r}},sprite:{diffuse:{value:new b(15658734)},opacity:{value:1},center:{value:new i(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new r}}};ie.prototype=Object.create(H.prototype),ie.prototype.constructor=ie,re.prototype=Object.create(U.prototype),re.prototype.constructor=re;var Ss={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha  = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n  return m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_maxMipLevel 8.0\n#define cubeUV_minMipLevel 4.0\n#define cubeUV_maxTileSize 256.0\n#define cubeUV_minTileSize 16.0\nfloat getFace(vec3 direction) {\n    vec3 absDirection = abs(direction);\n    float face = -1.0;\n    if (absDirection.x > absDirection.z) {\n      if (absDirection.x > absDirection.y)\n        face = direction.x > 0.0 ? 0.0 : 3.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    } else {\n      if (absDirection.z > absDirection.y)\n        face = direction.z > 0.0 ? 2.0 : 5.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    }\n    return face;\n}\nvec2 getUV(vec3 direction, float face) {\n    vec2 uv;\n    if (face == 0.0) {\n      uv = vec2(direction.z, direction.y) / abs(direction.x);    } else if (face == 1.0) {\n      uv = vec2(-direction.x, -direction.z) / abs(direction.y);    } else if (face == 2.0) {\n      uv = vec2(-direction.x, direction.y) / abs(direction.z);    } else if (face == 3.0) {\n      uv = vec2(-direction.z, direction.y) / abs(direction.x);    } else if (face == 4.0) {\n      uv = vec2(-direction.x, direction.z) / abs(direction.y);    } else {\n      uv = vec2(direction.x, direction.y) / abs(direction.z);    }\n    return 0.5 * (uv + 1.0);\n}\nvec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n  float face = getFace(direction);\n  float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n  mipInt = max(mipInt, cubeUV_minMipLevel);\n  float faceSize = exp2(mipInt);\n  float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n  vec2 uv = getUV(direction, face) * (faceSize - 1.0);\n  vec2 f = fract(uv);\n  uv += 0.5 - f;\n  if (face > 2.0) {\n    uv.y += faceSize;\n    face -= 3.0;\n  }\n  uv.x += face * faceSize;\n  if(mipInt < cubeUV_maxMipLevel){\n    uv.y += 2.0 * cubeUV_maxTileSize;\n  }\n  uv.y += filterInt * 2.0 * cubeUV_minTileSize;\n  uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n  uv *= texelSize;\n  vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x += texelSize;\n  vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.y += texelSize;\n  vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x -= texelSize;\n  vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  vec3 tm = mix(tl, tr, f.x);\n  vec3 bm = mix(bl, br, f.x);\n  return mix(tm, bm, f.y);\n}\n#define r0 1.0\n#define v0 0.339\n#define m0 -2.0\n#define r1 0.8\n#define v1 0.276\n#define m1 -1.0\n#define r4 0.4\n#define v4 0.046\n#define m4 2.0\n#define r5 0.305\n#define v5 0.016\n#define m5 3.0\n#define r6 0.21\n#define v6 0.0038\n#define m6 4.0\nfloat roughnessToMip(float roughness) {\n  float mip = 0.0;\n  if (roughness >= r1) {\n    mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n  } else if (roughness >= r4) {\n    mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n  } else if (roughness >= r5) {\n    mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n  } else if (roughness >= r6) {\n    mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n  } else {\n    mip = -2.0 * log2(1.16 * roughness);  }\n  return mip;\n}\nvec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {\n  float mip = clamp(roughnessToMip(roughness), m0, cubeUV_maxMipLevel);\n  float mipF = fract(mip);\n  float mipInt = floor(mip);\n  vec3 color0 = bilinearCubeUV(envMap, sampleDir, mipInt);\n  if (mipF == 0.0) {\n    return vec4(color0, 1.0);\n  } else {\n    vec3 color1 = bilinearCubeUV(envMap, sampleDir, mipInt + 1.0);\n    return vec4(mix(color0, color1, mipF), 1.0);\n  }\n}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\t\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t}  else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec2 sampleUV = equirectUv( reflectVec );\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t  vec3 reflectVec = reflect( -viewDir, normal );\n\t\t  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV = equirectUv( reflectVec );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) { \n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\n}",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSPARENCY\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSPARENCY\n\tuniform float transparency;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSPARENCY\n\t\tdiffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},Es={basic:{uniforms:q([Ts.common,Ts.specularmap,Ts.envmap,Ts.aomap,Ts.lightmap,Ts.fog]),vertexShader:Ss.meshbasic_vert,fragmentShader:Ss.meshbasic_frag},lambert:{uniforms:q([Ts.common,Ts.specularmap,Ts.envmap,Ts.aomap,Ts.lightmap,Ts.emissivemap,Ts.fog,Ts.lights,{emissive:{value:new b(0)}}]),vertexShader:Ss.meshlambert_vert,fragmentShader:Ss.meshlambert_frag},phong:{uniforms:q([Ts.common,Ts.specularmap,Ts.envmap,Ts.aomap,Ts.lightmap,Ts.emissivemap,Ts.bumpmap,Ts.normalmap,Ts.displacementmap,Ts.fog,Ts.lights,{emissive:{value:new b(0)},specular:{value:new b(1118481)},shininess:{value:30}}]),vertexShader:Ss.meshphong_vert,fragmentShader:Ss.meshphong_frag},standard:{uniforms:q([Ts.common,Ts.envmap,Ts.aomap,Ts.lightmap,Ts.emissivemap,Ts.bumpmap,Ts.normalmap,Ts.displacementmap,Ts.roughnessmap,Ts.metalnessmap,Ts.fog,Ts.lights,{emissive:{value:new b(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ss.meshphysical_vert,fragmentShader:Ss.meshphysical_frag},toon:{uniforms:q([Ts.common,Ts.specularmap,Ts.aomap,Ts.lightmap,Ts.emissivemap,Ts.bumpmap,Ts.normalmap,Ts.displacementmap,Ts.gradientmap,Ts.fog,Ts.lights,{emissive:{value:new b(0)},specular:{value:new b(1118481)},shininess:{value:30}}]),vertexShader:Ss.meshtoon_vert,fragmentShader:Ss.meshtoon_frag},matcap:{uniforms:q([Ts.common,Ts.bumpmap,Ts.normalmap,Ts.displacementmap,Ts.fog,{matcap:{value:null}}]),vertexShader:Ss.meshmatcap_vert,fragmentShader:Ss.meshmatcap_frag},points:{uniforms:q([Ts.points,Ts.fog]),vertexShader:Ss.points_vert,fragmentShader:Ss.points_frag},dashed:{uniforms:q([Ts.common,Ts.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ss.linedashed_vert,fragmentShader:Ss.linedashed_frag},depth:{uniforms:q([Ts.common,Ts.displacementmap]),vertexShader:Ss.depth_vert,fragmentShader:Ss.depth_frag},normal:{uniforms:q([Ts.common,Ts.bumpmap,Ts.normalmap,Ts.displacementmap,{opacity:{value:1}}]),vertexShader:Ss.normal_vert,fragmentShader:Ss.normal_frag},sprite:{uniforms:q([Ts.sprite,Ts.fog]),vertexShader:Ss.sprite_vert,fragmentShader:Ss.sprite_frag},background:{uniforms:{uvTransform:{value:new r},t2D:{value:null}},vertexShader:Ss.background_vert,fragmentShader:Ss.background_frag},cube:{uniforms:q([Ts.envmap,{opacity:{value:1}}]),vertexShader:Ss.cube_vert,fragmentShader:Ss.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ss.equirect_vert,fragmentShader:Ss.equirect_frag},distanceRGBA:{uniforms:q([Ts.common,Ts.displacementmap,{referencePosition:{value:new c},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ss.distanceRGBA_vert,fragmentShader:Ss.distanceRGBA_frag},shadow:{uniforms:q([Ts.lights,Ts.fog,{color:{value:new b(0)},opacity:{value:1}}]),vertexShader:Ss.shadow_vert,fragmentShader:Ss.shadow_frag}};Es.physical={uniforms:q([Es.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new i(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new b(0)},transparency:{value:0}}]),vertexShader:Ss.meshphysical_vert,fragmentShader:Ss.meshphysical_frag},me.prototype=Object.create(n.prototype),me.prototype.constructor=me,me.prototype.isCubeTexture=!0,Object.defineProperty(me.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),ge.prototype=Object.create(n.prototype),ge.prototype.constructor=ge,ge.prototype.isDataTexture2DArray=!0,ye.prototype=Object.create(n.prototype),ye.prototype.constructor=ye,ye.prototype.isDataTexture3D=!0;var As=new n,Cs=new ge,Ls=new ye,Ps=new me,Is=[],Rs=[],Ds=new Float32Array(16),ks=new Float32Array(9),zs=new Float32Array(4);Ke.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),xe(t,e)},Qe.prototype.setValue=function(e,t,i){for(var r=this.seq,n=0,a=r.length;n!==a;++n){var o=r[n];o.setValue(e,t[o.id],i)}};var Os=/([\w\d_]+)(\])?(\[|\.)?/g;et.prototype.setValue=function(e,t,i,r){void 0!==(t=this.map[t])&&t.setValue(e,i,r)},et.prototype.setOptional=function(e,t,i){void 0!==(t=t[i])&&this.setValue(e,i,t)},et.upload=function(e,t,i,r){for(var n=0,a=t.length;n!==a;++n){var o=t[n],s=i[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,r)}},et.seqWithValue=function(e,t){for(var i=[],r=0,n=e.length;r!==n;++r){var a=e[r];a.id in t&&i.push(a)}return i};var Bs=0,Fs=/^[ \t]*#include +<([\w\d./]+)>/gm,Ns=/#pragma unroll_loop[\s]+?for \( int i = (\d+); i < (\d+); i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Us=/#pragma unroll_loop_start[\s]+?for \( int i = (\d+); i < (\d+); i \+\+ \) \{([\s\S]+?)(?=\})\}[\s]+?#pragma unroll_loop_end/g,js=0;Et.prototype=Object.create(E.prototype),Et.prototype.constructor=Et,Et.prototype.isMeshDepthMaterial=!0,Et.prototype.copy=function(e){return E.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},At.prototype=Object.create(E.prototype),At.prototype.constructor=At,At.prototype.isMeshDistanceMaterial=!0,At.prototype.copy=function(e){return E.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this},Rt.prototype=Object.assign(Object.create($.prototype),{constructor:Rt,isArrayCamera:!0}),Dt.prototype=Object.assign(Object.create(p.prototype),{constructor:Dt,isGroup:!0}),Object.assign(kt.prototype,{constructor:kt,getTargetRaySpace:function(){return null===this._targetRay&&(this._targetRay=new Dt,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return null===this._grip&&(this._grip=new Dt,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),this},disconnect:function(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),this},update:function(e,t,i){var r=null,n=null,a=this._targetRay,o=this._grip;return e&&(null!==a&&null!==(r=t.getPose(e.targetRaySpace,i))&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale)),null!==o&&e.gripSpace&&null!==(n=t.getPose(e.gripSpace,i))&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale))),null!==a&&(a.visible=null!==r),null!==o&&(o.visible=null!==n),this}}),Object.assign(zt.prototype,t.prototype),Object.assign(Ft.prototype,{isFogExp2:!0,clone:function(){return new Ft(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}),Object.assign(Nt.prototype,{isFog:!0,clone:function(){return new Nt(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),Object.defineProperty(Ut.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Ut.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this},copyAt:function(e,t,i){e*=this.stride,i*=t.stride;for(var r=0,n=this.stride;r<n;r++)this.array[e+r]=t.array[i+r];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}});var Vs=new c;Object.defineProperties(jt.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(jt.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(e){for(var t=0,i=this.data.count;t<i;t++)Vs.x=this.getX(t),Vs.y=this.getY(t),Vs.z=this.getZ(t),Vs.applyMatrix4(e),this.setXYZ(t,Vs.x,Vs.y,Vs.z);return this},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this},setXYZ:function(e,t,i,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this},setXYZW:function(e,t,i,r,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=n,this},clone:function(){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");for(var e=[],t=0;t<this.count;t++)for(var i=t*this.data.stride+this.offset,r=0;r<this.itemSize;r++)e.push(this.data.array[i+r]);return new C(new this.array.constructor(e),this.itemSize,this.normalized)},toJSON:function(){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");for(var e=[],t=0;t<this.count;t++)for(var i=t*this.data.stride+this.offset,r=0;r<this.itemSize;r++)e.push(this.data.array[i+r]);return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}}),Vt.prototype=Object.create(E.prototype),Vt.prototype.constructor=Vt,Vt.prototype.isSpriteMaterial=!0,Vt.prototype.copy=function(e){return E.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this};var Gs,Hs=new c,Ws=new c,qs=new c,Zs=new i,Xs=new i,$s=new h,Ys=new c,Js=new c,Ks=new c,Qs=new i,el=new i,tl=new i;Gt.prototype=Object.assign(Object.create(p.prototype),{constructor:Gt,isSprite:!0,raycast:function(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Ws.setFromMatrixScale(this.matrixWorld),$s.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),qs.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Ws.multiplyScalar(-qs.z);var r=this.material.rotation;if(0!==r)var n=Math.cos(r),a=Math.sin(r);r=this.center,Ht(Ys.set(-.5,-.5,0),qs,r,Ws,a,n),Ht(Js.set(.5,-.5,0),qs,r,Ws,a,n),Ht(Ks.set(.5,.5,0),qs,r,Ws,a,n),Qs.set(0,0),el.set(1,0),tl.set(1,1);var o=e.ray.intersectTriangle(Ys,Js,Ks,!1,Hs);null===o&&(Ht(Js.set(-.5,.5,0),qs,r,Ws,a,n),el.set(0,1),null===(o=e.ray.intersectTriangle(Ys,Ks,Js,!1,Hs)))||(a=e.ray.origin.distanceTo(Hs))<e.near||a>e.far||t.push({distance:a,point:Hs.clone(),uv:x.getUV(Hs,Ys,Js,Ks,Qs,el,tl,new i),face:null,object:this})},clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){return p.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this}});var il,rl,nl,al,ol,sl=new c,ll=new c;Wt.prototype=Object.assign(Object.create(p.prototype),{constructor:Wt,isLOD:!0,copy:function(e){p.prototype.copy.call(this,e,!1);for(var t=e.levels,i=0,r=t.length;i<r;i++){var n=t[i];this.addLevel(n.object.clone(),n.distance)}return this.autoUpdate=e.autoUpdate,this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var i=this.levels,r=0;r<i.length&&!(t<i[r].distance);r++);return i.splice(r,0,{distance:t,object:e}),this.add(e),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(e){var t=this.levels;if(0<t.length){for(var i=1,r=t.length;i<r&&!(e<t[i].distance);i++);return t[i-1].object}return null},raycast:function(e,t){if(0<this.levels.length){sl.setFromMatrixPosition(this.matrixWorld);var i=e.ray.origin.distanceTo(sl);this.getObjectForDistance(i).raycast(e,t)}},update:function(e){var t=this.levels;if(1<t.length){sl.setFromMatrixPosition(e.matrixWorld),ll.setFromMatrixPosition(this.matrixWorld),e=sl.distanceTo(ll)/e.zoom,t[0].object.visible=!0;for(var i=1,r=t.length;i<r&&e>=t[i].distance;i++)t[i-1].object.visible=!1,t[i].object.visible=!0;for(this._currentLevel=i-1;i<r;i++)t[i].object.visible=!1}},toJSON:function(e){e=p.prototype.toJSON.call(this,e),!1===this.autoUpdate&&(e.object.autoUpdate=!1),e.object.levels=[];for(var t=this.levels,i=0,r=t.length;i<r;i++){var n=t[i];e.object.levels.push({object:n.object.uuid,distance:n.distance})}return e}}),qt.prototype=Object.assign(Object.create(j.prototype),{constructor:qt,isSkinnedMesh:!0,bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var e=new a,t=this.geometry.attributes.skinWeight,i=0,r=t.count;i<r;i++){e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.w=t.getW(i);var n=1/e.manhattanLength();1/0!==n?e.multiplyScalar(n):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){j.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)},boneTransform:(il=new c,rl=new a,nl=new a,al=new c,ol=new h,function(e,t){var i=this.skeleton,r=this.geometry;for(rl.fromBufferAttribute(r.attributes.skinIndex,e),nl.fromBufferAttribute(r.attributes.skinWeight,e),il.fromBufferAttribute(r.attributes.position,e).applyMatrix4(this.bindMatrix),t.set(0,0,0),e=0;4>e;e++)if(0!==(r=nl.getComponent(e))){var n=rl.getComponent(e);ol.multiplyMatrices(i.bones[n].matrixWorld,i.boneInverses[n]),t.addScaledVector(al.copy(il).applyMatrix4(ol),r)}return t.applyMatrix4(this.bindMatrixInverse)})});var cl=new h,hl=new h;Object.assign(Zt.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var i=new h;this.bones[e]&&i.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(i)}},pose:function(){var e,t,i=0;for(t=this.bones.length;i<t;i++)(e=this.bones[i])&&e.matrixWorld.getInverse(this.boneInverses[i]);for(i=0,t=this.bones.length;i<t;i++)(e=this.bones[i])&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:function(){for(var e=this.bones,t=this.boneInverses,i=this.boneMatrices,r=this.boneTexture,n=0,a=e.length;n<a;n++)cl.multiplyMatrices(e[n]?e[n].matrixWorld:hl,t[n]),cl.toArray(i,16*n);void 0!==r&&(r.needsUpdate=!0)},clone:function(){return new Zt(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,i=this.bones.length;t<i;t++){var r=this.bones[t];if(r.name===e)return r}},dispose:function(){this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=void 0)}}),Xt.prototype=Object.assign(Object.create(p.prototype),{constructor:Xt,isBone:!0});var ul=new h,dl=new h,pl=[],fl=new j;$t.prototype=Object.assign(Object.create(j.prototype),{constructor:$t,isInstancedMesh:!0,getMatrixAt:function(e,t){t.fromArray(this.instanceMatrix.array,16*e)},raycast:function(e,t){var i=this.matrixWorld,r=this.count;if(fl.geometry=this.geometry,fl.material=this.material,void 0!==fl.material)for(var n=0;n<r;n++){this.getMatrixAt(n,ul),dl.multiplyMatrices(i,ul),fl.matrixWorld=dl,fl.raycast(e,pl);for(var a=0,o=pl.length;a<o;a++){var s=pl[a];s.instanceId=n,s.object=this,t.push(s)}pl.length=0}},setMatrixAt:function(e,t){t.toArray(this.instanceMatrix.array,16*e)},updateMorphTargets:function(){}}),Yt.prototype=Object.create(E.prototype),Yt.prototype.constructor=Yt,Yt.prototype.isLineBasicMaterial=!0,Yt.prototype.copy=function(e){return E.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.morphTargets=e.morphTargets,this};var ml=new c,gl=new c,yl=new h,vl=new v,_l=new y;Jt.prototype=Object.assign(Object.create(p.prototype),{constructor:Jt,isLine:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,i=[0],r=1,n=t.count;r<n;r++)ml.fromBufferAttribute(t,r-1),gl.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=ml.distanceTo(gl);e.setAttribute("lineDistance",new O(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry)for(t=e.vertices,(i=e.lineDistances)[0]=0,r=1,n=t.length;r<n;r++)i[r]=i[r-1],i[r]+=t[r-1].distanceTo(t[r]);return this},raycast:function(e,t){var i=this.geometry,r=this.matrixWorld,n=e.params.Line.threshold;if(null===i.boundingSphere&&i.computeBoundingSphere(),_l.copy(i.boundingSphere),_l.applyMatrix4(r),_l.radius+=n,!1!==e.ray.intersectsSphere(_l)){yl.getInverse(r),vl.copy(e.ray).applyMatrix4(yl),r=n/((this.scale.x+this.scale.y+this.scale.z)/3),r*=r;var a=new c,o=new c;n=new c;var s=new c,l=this&&this.isLineSegments?2:1;if(i.isBufferGeometry){var h=i.index,u=i.attributes.position.array;if(null!==h){i=0;for(var d=(h=h.array).length-1;i<d;i+=l){var p=h[i+1];a.fromArray(u,3*h[i]),o.fromArray(u,3*p),(p=vl.distanceSqToSegment(a,o,s,n))>r||(s.applyMatrix4(this.matrixWorld),(p=e.ray.origin.distanceTo(s))<e.near||p>e.far||t.push({distance:p,point:n.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this}))}}else for(i=0,d=u.length/3-1;i<d;i+=l)a.fromArray(u,3*i),o.fromArray(u,3*i+3),(p=vl.distanceSqToSegment(a,o,s,n))>r||(s.applyMatrix4(this.matrixWorld),(p=e.ray.origin.distanceTo(s))<e.near||p>e.far||t.push({distance:p,point:n.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this}))}else if(i.isGeometry)for(o=(a=i.vertices).length,i=0;i<o-1;i+=l)(p=vl.distanceSqToSegment(a[i],a[i+1],s,n))>r||(s.applyMatrix4(this.matrixWorld),(p=e.ray.origin.distanceTo(s))<e.near||p>e.far||t.push({distance:p,point:n.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this}))}},updateMorphTargets:function(){var e=this.geometry;if(e.isBufferGeometry){e=e.morphAttributes;var t=Object.keys(e);if(0<t.length){var i=e[t[0]];if(void 0!==i)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=i.length;e<t;e++){var r=i[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e}}}else void 0!==(e=e.morphTargets)&&0<e.length&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var xl=new c,bl=new c;Kt.prototype=Object.assign(Object.create(Jt.prototype),{constructor:Kt,isLineSegments:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,i=[],r=0,n=t.count;r<n;r+=2)xl.fromBufferAttribute(t,r),bl.fromBufferAttribute(t,r+1),i[r]=0===r?0:i[r-1],i[r+1]=i[r]+xl.distanceTo(bl);e.setAttribute("lineDistance",new O(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry)for(t=e.vertices,i=e.lineDistances,r=0,n=t.length;r<n;r+=2)xl.copy(t[r]),bl.copy(t[r+1]),i[r]=0===r?0:i[r-1],i[r+1]=i[r]+xl.distanceTo(bl);return this}}),Qt.prototype=Object.assign(Object.create(Jt.prototype),{constructor:Qt,isLineLoop:!0}),ei.prototype=Object.create(E.prototype),ei.prototype.constructor=ei,ei.prototype.isPointsMaterial=!0,ei.prototype.copy=function(e){return E.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this};var wl=new h,Ml=new v,Tl=new y,Sl=new c;ti.prototype=Object.assign(Object.create(p.prototype),{constructor:ti,isPoints:!0,raycast:function(e,t){var i=this.geometry,r=this.matrixWorld,n=e.params.Points.threshold;if(null===i.boundingSphere&&i.computeBoundingSphere(),Tl.copy(i.boundingSphere),Tl.applyMatrix4(r),Tl.radius+=n,!1!==e.ray.intersectsSphere(Tl))if(wl.getInverse(r),Ml.copy(e.ray).applyMatrix4(wl),n/=(this.scale.x+this.scale.y+this.scale.z)/3,n*=n,i.isBufferGeometry){var a=i.index;if(i=i.attributes.position.array,null!==a){var o=a.array;a=0;for(var s=o.length;a<s;a++){var l=o[a];Sl.fromArray(i,3*l),ii(Sl,l,n,r,e,t,this)}}else for(a=0,o=i.length/3;a<o;a++)Sl.fromArray(i,3*a),ii(Sl,a,n,r,e,t,this)}else for(a=0,o=(i=i.vertices).length;a<o;a++)ii(i[a],a,n,r,e,t,this)},updateMorphTargets:function(){var e=this.geometry;if(e.isBufferGeometry){e=e.morphAttributes;var t=Object.keys(e);if(0<t.length){var i=e[t[0]];if(void 0!==i)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=i.length;e<t;e++){var r=i[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e}}}else void 0!==(e=e.morphTargets)&&0<e.length&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),ri.prototype=Object.assign(Object.create(n.prototype),{constructor:ri,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),ni.prototype=Object.create(n.prototype),ni.prototype.constructor=ni,ni.prototype.isCompressedTexture=!0,ai.prototype=Object.create(n.prototype),ai.prototype.constructor=ai,ai.prototype.isCanvasTexture=!0,oi.prototype=Object.create(n.prototype),oi.prototype.constructor=oi,oi.prototype.isDepthTexture=!0,si.prototype=Object.create(U.prototype),si.prototype.constructor=si,li.prototype=Object.create(H.prototype),li.prototype.constructor=li,ci.prototype=Object.create(U.prototype),ci.prototype.constructor=ci,hi.prototype=Object.create(H.prototype),hi.prototype.constructor=hi,ui.prototype=Object.create(U.prototype),ui.prototype.constructor=ui,di.prototype=Object.create(H.prototype),di.prototype.constructor=di,pi.prototype=Object.create(ui.prototype),pi.prototype.constructor=pi,fi.prototype=Object.create(H.prototype),fi.prototype.constructor=fi,mi.prototype=Object.create(ui.prototype),mi.prototype.constructor=mi,gi.prototype=Object.create(H.prototype),gi.prototype.constructor=gi,yi.prototype=Object.create(ui.prototype),yi.prototype.constructor=yi,vi.prototype=Object.create(H.prototype),vi.prototype.constructor=vi,_i.prototype=Object.create(ui.prototype),_i.prototype.constructor=_i,xi.prototype=Object.create(H.prototype),xi.prototype.constructor=xi,bi.prototype=Object.create(U.prototype),bi.prototype.constructor=bi,bi.prototype.toJSON=function(){var e=U.prototype.toJSON.call(this);return e.path=this.parameters.path.toJSON(),e},wi.prototype=Object.create(H.prototype),wi.prototype.constructor=wi,Mi.prototype=Object.create(U.prototype),Mi.prototype.constructor=Mi,Ti.prototype=Object.create(H.prototype),Ti.prototype.constructor=Ti,Si.prototype=Object.create(U.prototype),Si.prototype.constructor=Si;var El=function(e,t,i){i=i||2;var r,n=t&&t.length,a=n?t[0]*i:e.length,o=Ei(e,0,a,i,!0),s=[];if(!o||o.next===o.prev)return s;if(n){var l,c=i;n=[];var h=0;for(l=t.length;h<l;h++){var u=t[h]*c;(u=Ei(e,u,h<l-1?t[h+1]*c:e.length,c,!1))===u.next&&(u.steiner=!0),n.push(Di(u))}for(n.sort(Pi),h=0;h<n.length;h++)(t=Ii(c=n[h],t=o))&&(c=ji(t,c),Ai(t,t.next),Ai(c,c.next)),o=Ai(o,o.next)}if(e.length>80*i){var d=r=e[0],p=n=e[1];for(c=i;c<a;c+=i)(h=e[c])<d&&(d=h),(t=e[c+1])<p&&(p=t),h>r&&(r=h),t>n&&(n=t);r=0!==(r=Math.max(r-d,n-p))?1/r:0}return Ci(o,s,i,d,p,r),s},Al={area:function(e){for(var t=e.length,i=0,r=t-1,n=0;n<t;r=n++)i+=e[r].x*e[n].y-e[n].x*e[r].y;return.5*i},isClockWise:function(e){return 0>Al.area(e)},triangulateShape:function(e,t){var i=[],r=[],n=[];Wi(e),qi(i,e);var a=e.length;for(t.forEach(Wi),e=0;e<t.length;e++)r.push(a),a+=t[e].length,qi(i,t[e]);for(t=El(i,r),e=0;e<t.length;e+=3)n.push(t.slice(e,e+3));return n}};Zi.prototype=Object.create(H.prototype),Zi.prototype.constructor=Zi,Zi.prototype.toJSON=function(){var e=H.prototype.toJSON.call(this);return $i(this.parameters.shapes,this.parameters.options,e)},Xi.prototype=Object.create(U.prototype),Xi.prototype.constructor=Xi,Xi.prototype.toJSON=function(){var e=U.prototype.toJSON.call(this);return $i(this.parameters.shapes,this.parameters.options,e)};var Cl={generateTopUV:function(e,t,r,n,a){e=t[3*n],n=t[3*n+1];var o=t[3*a];return a=t[3*a+1],[new i(t[3*r],t[3*r+1]),new i(e,n),new i(o,a)]},generateSideWallUV:function(e,t,r,n,a,o){e=t[3*r];var s=t[3*r+1];r=t[3*r+2];var l=t[3*n],c=t[3*n+1];n=t[3*n+2];var h=t[3*a],u=t[3*a+1];a=t[3*a+2];var d=t[3*o],p=t[3*o+1];return t=t[3*o+2],.01>Math.abs(s-c)?[new i(e,1-r),new i(l,1-n),new i(h,1-a),new i(d,1-t)]:[new i(s,1-r),new i(c,1-n),new i(u,1-a),new i(p,1-t)]}};Yi.prototype=Object.create(H.prototype),Yi.prototype.constructor=Yi,Ji.prototype=Object.create(Xi.prototype),Ji.prototype.constructor=Ji,Ki.prototype=Object.create(H.prototype),Ki.prototype.constructor=Ki,Qi.prototype=Object.create(U.prototype),Qi.prototype.constructor=Qi,er.prototype=Object.create(H.prototype),er.prototype.constructor=er,tr.prototype=Object.create(U.prototype),tr.prototype.constructor=tr,ir.prototype=Object.create(H.prototype),ir.prototype.constructor=ir,rr.prototype=Object.create(U.prototype),rr.prototype.constructor=rr,nr.prototype=Object.create(H.prototype),nr.prototype.constructor=nr,nr.prototype.toJSON=function(){var e=H.prototype.toJSON.call(this);return or(this.parameters.shapes,e)},ar.prototype=Object.create(U.prototype),ar.prototype.constructor=ar,ar.prototype.toJSON=function(){var e=U.prototype.toJSON.call(this);return or(this.parameters.shapes,e)},sr.prototype=Object.create(U.prototype),sr.prototype.constructor=sr,lr.prototype=Object.create(H.prototype),lr.prototype.constructor=lr,cr.prototype=Object.create(U.prototype),cr.prototype.constructor=cr,hr.prototype=Object.create(lr.prototype),hr.prototype.constructor=hr,ur.prototype=Object.create(cr.prototype),ur.prototype.constructor=ur,dr.prototype=Object.create(H.prototype),dr.prototype.constructor=dr,pr.prototype=Object.create(U.prototype),pr.prototype.constructor=pr;var Ll=Object.freeze({__proto__:null,WireframeGeometry:si,ParametricGeometry:li,ParametricBufferGeometry:ci,TetrahedronGeometry:di,TetrahedronBufferGeometry:pi,OctahedronGeometry:fi,OctahedronBufferGeometry:mi,IcosahedronGeometry:gi,IcosahedronBufferGeometry:yi,DodecahedronGeometry:vi,DodecahedronBufferGeometry:_i,PolyhedronGeometry:hi,PolyhedronBufferGeometry:ui,TubeGeometry:xi,TubeBufferGeometry:bi,TorusKnotGeometry:wi,TorusKnotBufferGeometry:Mi,TorusGeometry:Ti,TorusBufferGeometry:Si,TextGeometry:Yi,TextBufferGeometry:Ji,SphereGeometry:Ki,SphereBufferGeometry:Qi,RingGeometry:er,RingBufferGeometry:tr,PlaneGeometry:ie,PlaneBufferGeometry:re,LatheGeometry:ir,LatheBufferGeometry:rr,ShapeGeometry:nr,ShapeBufferGeometry:ar,ExtrudeGeometry:Zi,ExtrudeBufferGeometry:Xi,EdgesGeometry:sr,ConeGeometry:hr,ConeBufferGeometry:ur,CylinderGeometry:lr,CylinderBufferGeometry:cr,CircleGeometry:dr,CircleBufferGeometry:pr,BoxGeometry:_s,BoxBufferGeometry:xs});fr.prototype=Object.create(E.prototype),fr.prototype.constructor=fr,fr.prototype.isShadowMaterial=!0,fr.prototype.copy=function(e){return E.prototype.copy.call(this,e),this.color.copy(e.color),this},mr.prototype=Object.create(Z.prototype),mr.prototype.constructor=mr,mr.prototype.isRawShaderMaterial=!0,gr.prototype=Object.create(E.prototype),gr.prototype.constructor=gr,gr.prototype.isMeshStandardMaterial=!0,gr.prototype.copy=function(e){return E.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.vertexTangents=e.vertexTangents,this},yr.prototype=Object.create(gr.prototype),yr.prototype.constructor=yr,yr.prototype.isMeshPhysicalMaterial=!0,yr.prototype.copy=function(e){return gr.prototype.copy.call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.reflectivity=e.reflectivity,this.sheen=e.sheen?(this.sheen||new b).copy(e.sheen):null,this.transparency=e.transparency,this},vr.prototype=Object.create(E.prototype),vr.prototype.constructor=vr,vr.prototype.isMeshPhongMaterial=!0,vr.prototype.copy=function(e){return E.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},_r.prototype=Object.create(E.prototype),_r.prototype.constructor=_r,_r.prototype.isMeshToonMaterial=!0,_r.prototype.copy=function(e){return E.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},xr.prototype=Object.create(E.prototype),xr.prototype.constructor=xr,xr.prototype.isMeshNormalMaterial=!0,xr.prototype.copy=function(e){return E.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},br.prototype=Object.create(E.prototype),br.prototype.constructor=br,br.prototype.isMeshLambertMaterial=!0,br.prototype.copy=function(e){return E.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},wr.prototype=Object.create(E.prototype),wr.prototype.constructor=wr,wr.prototype.isMeshMatcapMaterial=!0,wr.prototype.copy=function(e){return E.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Mr.prototype=Object.create(Yt.prototype),Mr.prototype.constructor=Mr,Mr.prototype.isLineDashedMaterial=!0,Mr.prototype.copy=function(e){return Yt.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var Pl=Object.freeze({__proto__:null,ShadowMaterial:fr,SpriteMaterial:Vt,RawShaderMaterial:mr,ShaderMaterial:Z,PointsMaterial:ei,MeshPhysicalMaterial:yr,MeshStandardMaterial:gr,MeshPhongMaterial:vr,MeshToonMaterial:_r,MeshNormalMaterial:xr,MeshLambertMaterial:br,MeshDepthMaterial:Et,MeshDistanceMaterial:At,MeshBasicMaterial:A,MeshMatcapMaterial:wr,LineDashedMaterial:Mr,LineBasicMaterial:Yt,Material:E}),Il={arraySlice:function(e,t,i){return Il.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==i?i:e.length)):e.slice(t,i)},convertArray:function(e,t,i){return!e||!i&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,i=Array(t),r=0;r!==t;++r)i[r]=r;return i.sort((function(t,i){return e[t]-e[i]})),i},sortedArray:function(e,t,i){for(var r=e.length,n=new e.constructor(r),a=0,o=0;o!==r;++a)for(var s=i[a]*t,l=0;l!==t;++l)n[o++]=e[s+l];return n},flattenJSON:function(e,t,i,r){for(var n=1,a=e[0];void 0!==a&&void 0===a[r];)a=e[n++];if(void 0!==a){var o=a[r];if(void 0!==o)if(Array.isArray(o))do{void 0!==(o=a[r])&&(t.push(a.time),i.push.apply(i,o)),a=e[n++]}while(void 0!==a);else if(void 0!==o.toArray)do{void 0!==(o=a[r])&&(t.push(a.time),o.toArray(i,i.length)),a=e[n++]}while(void 0!==a);else do{void 0!==(o=a[r])&&(t.push(a.time),i.push(o)),a=e[n++]}while(void 0!==a)}},subclip:function(e,t,i,r,n){n=n||30,(e=e.clone()).name=t;var a=[];for(t=0;t<e.tracks.length;++t){for(var o=e.tracks[t],s=o.getValueSize(),l=[],c=[],h=0;h<o.times.length;++h){var u=o.times[h]*n;if(!(u<i||u>=r))for(l.push(o.times[h]),u=0;u<s;++u)c.push(o.values[h*s+u])}0!==l.length&&(o.times=Il.convertArray(l,o.times.constructor),o.values=Il.convertArray(c,o.values.constructor),a.push(o))}for(e.tracks=a,i=1/0,t=0;t<e.tracks.length;++t)i>e.tracks[t].times[0]&&(i=e.tracks[t].times[0]);for(t=0;t<e.tracks.length;++t)e.tracks[t].shift(-1*i);return e.resetDuration(),e},makeClipAdditive:function(e,t,i,r){void 0===t&&(t=0),void 0===i&&(i=e),(void 0===r||0>=r)&&(r=30);var n=e.tracks.length;for(t/=r,r=0;r<n;++r){var a=i.tracks[r],o=a.ValueTypeName;if("bool"!==o&&"string"!==o){var s=e.tracks.find((function(e){return e.name===a.name&&e.ValueTypeName===o}));if(void 0!==s){var c=a.getValueSize(),h=a.times.length-1;t<=a.times[0]?h=Il.arraySlice(a.values,0,a.valueSize):t>=a.times[h]?h=Il.arraySlice(a.values,h*c):((h=a.createInterpolant()).evaluate(t),h=h.resultBuffer),"quaternion"===o&&new l(h[0],h[1],h[2],h[3]).normalize().conjugate().toArray(h);for(var u=s.times.length,d=0;d<u;++d){var p=d*c;if("quaternion"===o)l.multiplyQuaternionsFlat(s.values,p,h,0,s.values,p);else for(var f=0;f<c;++f)s.values[p+f]-=h[f]}}}}return e.blendMode=2501,e}};Object.assign(Tr.prototype,{evaluate:function(e){var t=this.parameterPositions,i=this._cachedIndex,r=t[i],n=t[i-1];e:{t:{i:{r:if(!(e<r)){for(var a=i+2;;){if(void 0===r){if(e<n)break r;return this._cachedIndex=i=t.length,this.afterEnd_(i-1,e,n)}if(i===a)break;if(n=r,e<(r=t[++i]))break t}r=t.length;break i}if(e>=n)break e;for(e<(a=t[1])&&(i=2,n=a),a=i-2;;){if(void 0===n)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(i===a)break;if(r=n,e>=(n=t[--i-1]))break t}r=i,i=0}for(;i<r;)e<t[n=i+r>>>1]?r=n:i=n+1;if(r=t[i],void 0===(n=t[i-1]))return this._cachedIndex=0,this.beforeStart_(0,e,r);if(void 0===r)return this._cachedIndex=i=t.length,this.afterEnd_(i-1,n,e)}this._cachedIndex=i,this.intervalChanged_(i,n,r)}return this.interpolate_(i,n,e,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){var t=this.resultBuffer,i=this.sampleValues,r=this.valueSize;e*=r;for(var n=0;n!==r;++n)t[n]=i[e+n];return t},interpolate_:function(){throw Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(Tr.prototype,{beforeStart_:Tr.prototype.copySampleValue_,afterEnd_:Tr.prototype.copySampleValue_}),Sr.prototype=Object.assign(Object.create(Tr.prototype),{constructor:Sr,DefaultSettings_:{endingStart:2400,endingEnd:2400},intervalChanged_:function(e,t,i){var r=this.parameterPositions,n=e-2,a=e+1,o=r[n],s=r[a];if(void 0===o)switch(this.getSettings_().endingStart){case 2401:n=e,o=2*t-i;break;case 2402:o=t+r[n=r.length-2]-r[n+1];break;default:n=e,o=i}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:a=e,s=2*i-t;break;case 2402:a=1,s=i+r[1]-r[0];break;default:a=e-1,s=t}e=.5*(i-t),r=this.valueSize,this._weightPrev=e/(t-o),this._weightNext=e/(s-i),this._offsetPrev=n*r,this._offsetNext=a*r},interpolate_:function(e,t,i,r){var n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=(e*=o)-o,l=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,u=this._weightNext,d=(i-t)/(r-t);for(t=-h*(r=(i=d*d)*d)+2*h*i-h*d,h=(1+h)*r+(-1.5-2*h)*i+(-.5+h)*d+1,d=(-1-u)*r+(1.5+u)*i+.5*d,u=u*r-u*i,i=0;i!==o;++i)n[i]=t*a[l+i]+h*a[s+i]+d*a[e+i]+u*a[c+i];return n}}),Er.prototype=Object.assign(Object.create(Tr.prototype),{constructor:Er,interpolate_:function(e,t,i,r){var n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=(e*=o)-o;for(i=1-(t=(i-t)/(r-t)),r=0;r!==o;++r)n[r]=a[s+r]*i+a[e+r]*t;return n}}),Ar.prototype=Object.assign(Object.create(Tr.prototype),{constructor:Ar,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(Cr,{toJSON:function(e){var t=e.constructor;if(void 0!==t.toJSON)t=t.toJSON(e);else{t={name:e.name,times:Il.convertArray(e.times,Array),values:Il.convertArray(e.values,Array)};var i=e.getInterpolation();i!==e.DefaultInterpolation&&(t.interpolation=i)}return t.type=e.ValueTypeName,t}}),Object.assign(Cr.prototype,{constructor:Cr,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(e){return new Ar(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new Er(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new Sr(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){switch(e){case 2300:var t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){if(t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name,void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,i=0,r=t.length;i!==r;++i)t[i]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,i=0,r=t.length;i!==r;++i)t[i]*=e;return this},trim:function(e,t){for(var i=this.times,r=i.length,n=0,a=r-1;n!==r&&i[n]<e;)++n;for(;-1!==a&&i[a]>t;)--a;return++a,0===n&&a===r||(n>=a&&(n=(a=Math.max(a,1))-1),e=this.getValueSize(),this.times=Il.arraySlice(i,n,a),this.values=Il.arraySlice(this.values,n*e,a*e)),this},validate:function(){var e=!0,t=this.getValueSize();0!=t-Math.floor(t)&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var i=this.times;t=this.values;var r=i.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var n=null,a=0;a!==r;a++){var o=i[a];if("number"==typeof o&&isNaN(o)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,o),e=!1;break}if(null!==n&&n>o){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,o,n),e=!1;break}n=o}if(void 0!==t&&Il.isTypedArray(t))for(a=0,i=t.length;a!==i;++a)if(r=t[a],isNaN(r)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,r),e=!1;break}return e},optimize:function(){for(var e=Il.arraySlice(this.times),t=Il.arraySlice(this.values),i=this.getValueSize(),r=2302===this.getInterpolation(),n=1,a=e.length-1,o=1;o<a;++o){var s=!1,l=e[o];if(l!==e[o+1]&&(1!==o||l!==l[0]))if(r)s=!0;else{var c=o*i,h=c-i,u=c+i;for(l=0;l!==i;++l){var d=t[c+l];if(d!==t[h+l]||d!==t[u+l]){s=!0;break}}}if(s){if(o!==n)for(e[n]=e[o],s=o*i,c=n*i,l=0;l!==i;++l)t[c+l]=t[s+l];++n}}if(0<a){for(e[n]=e[a],s=a*i,c=n*i,l=0;l!==i;++l)t[c+l]=t[s+l];++n}return n!==e.length?(this.times=Il.arraySlice(e,0,n),this.values=Il.arraySlice(t,0,n*i)):(this.times=e,this.values=t),this},clone:function(){var e=Il.arraySlice(this.times,0),t=Il.arraySlice(this.values,0);return(e=new this.constructor(this.name,e,t)).createInterpolant=this.createInterpolant,e}}),Lr.prototype=Object.assign(Object.create(Cr.prototype),{constructor:Lr,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Pr.prototype=Object.assign(Object.create(Cr.prototype),{constructor:Pr,ValueTypeName:"color"}),Ir.prototype=Object.assign(Object.create(Cr.prototype),{constructor:Ir,ValueTypeName:"number"}),Rr.prototype=Object.assign(Object.create(Tr.prototype),{constructor:Rr,interpolate_:function(e,t,i,r){var n=this.resultBuffer,a=this.sampleValues,o=this.valueSize;for(t=(i-t)/(r-t),i=(e*=o)+o;e!==i;e+=4)l.slerpFlat(n,0,a,e-o,a,e,t);return n}}),Dr.prototype=Object.assign(Object.create(Cr.prototype),{constructor:Dr,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(e){return new Rr(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),kr.prototype=Object.assign(Object.create(Cr.prototype),{constructor:kr,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),zr.prototype=Object.assign(Object.create(Cr.prototype),{constructor:zr,ValueTypeName:"vector"}),Object.assign(Or,{parse:function(e){for(var t=[],i=e.tracks,r=1/(e.fps||1),n=0,a=i.length;n!==a;++n)t.push(Br(i[n]).scale(r));return new Or(e.name,e.duration,t,e.blendMode)},toJSON:function(e){var t=[],i=e.tracks;e={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(var r=0,n=i.length;r!==n;++r)t.push(Cr.toJSON(i[r]));return e},CreateFromMorphTargetSequence:function(e,t,i,r){for(var n=t.length,a=[],o=0;o<n;o++){var s=[],l=[];s.push((o+n-1)%n,o,(o+1)%n),l.push(0,1,0);var c=Il.getKeyframeOrder(s);s=Il.sortedArray(s,1,c),l=Il.sortedArray(l,1,c),r||0!==s[0]||(s.push(n),l.push(l[0])),a.push(new Ir(".morphTargetInfluences["+t[o].name+"]",s,l).scale(1/i))}return new Or(e,-1,a)},findByName:function(e,t){var i=e;for(Array.isArray(e)||(i=e.geometry&&e.geometry.animations||e.animations),e=0;e<i.length;e++)if(i[e].name===t)return i[e];return null},CreateClipsFromMorphTargetSequences:function(e,t,i){for(var r={},n=/^([\w-]*?)([\d]+)$/,a=0,o=e.length;a<o;a++){var s=e[a],l=s.name.match(n);if(l&&1<l.length){var c=l[1];(l=r[c])||(r[c]=l=[]),l.push(s)}}for(c in e=[],r)e.push(Or.CreateFromMorphTargetSequence(c,r[c],t,i));return e},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;var i=function(e,t,i,r,n){if(0!==i.length){var a=[],o=[];Il.flattenJSON(i,a,o,r),0!==a.length&&n.push(new e(t,a,o))}},r=[],n=e.name||"default",a=e.length||-1,o=e.fps||30,s=e.blendMode;e=e.hierarchy||[];for(var l=0;l<e.length;l++){var c=e[l].keys;if(c&&0!==c.length)if(c[0].morphTargets){a={};for(var h=0;h<c.length;h++)if(c[h].morphTargets)for(var u=0;u<c[h].morphTargets.length;u++)a[c[h].morphTargets[u]]=-1;for(var d in a){var p=[],f=[];for(u=0;u!==c[h].morphTargets.length;++u){var m=c[h];p.push(m.time),f.push(m.morphTarget===d?1:0)}r.push(new Ir(".morphTargetInfluence["+d+"]",p,f))}a=a.length*(o||1)}else i(zr,(h=".bones["+t[l].name+"]")+".position",c,"pos",r),i(Dr,h+".quaternion",c,"rot",r),i(zr,h+".scale",c,"scl",r)}return 0===r.length?null:new Or(n,a,r,s)}}),Object.assign(Or.prototype,{resetDuration:function(){for(var e=0,t=0,i=this.tracks.length;t!==i;++t){var r=this.tracks[t];e=Math.max(e,r.times[r.times.length-1])}return this.duration=e,this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new Or(this.name,this.duration,e,this.blendMode)}});var Rl={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},Dl=new Fr;Object.assign(Nr.prototype,{load:function(){},loadAsync:function(e,t){var i=this;return new Promise((function(r,n){i.load(e,r,t,n)}))},parse:function(){},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}});var kl={};Ur.prototype=Object.assign(Object.create(Nr.prototype),{constructor:Ur,load:function(e,t,i,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var n=this,a=Rl.get(e);if(void 0!==a)return n.manager.itemStart(e),setTimeout((function(){t&&t(a),n.manager.itemEnd(e)}),0),a;if(void 0===kl[e]){var o=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(o){i=o[1];var s=!!o[2];o=o[3],o=decodeURIComponent(o),s&&(o=atob(o));try{var l=(this.responseType||"").toLowerCase();switch(l){case"arraybuffer":case"blob":var c=new Uint8Array(o.length);for(s=0;s<o.length;s++)c[s]=o.charCodeAt(s);var h="blob"===l?new Blob([c.buffer],{type:i}):c.buffer;break;case"document":h=(new DOMParser).parseFromString(o,i);break;case"json":h=JSON.parse(o);break;default:h=o}setTimeout((function(){t&&t(h),n.manager.itemEnd(e)}),0)}catch(t){setTimeout((function(){r&&r(t),n.manager.itemError(e),n.manager.itemEnd(e)}),0)}}else{kl[e]=[],kl[e].push({onLoad:t,onProgress:i,onError:r});var u=new XMLHttpRequest;for(s in u.open("GET",e,!0),u.addEventListener("load",(function(t){var i=this.response,r=kl[e];if(delete kl[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Rl.add(e,i);for(var a=0,o=r.length;a<o;a++){var s=r[a];s.onLoad&&s.onLoad(i)}}else{for(a=0,o=r.length;a<o;a++)(s=r[a]).onError&&s.onError(t);n.manager.itemError(e)}n.manager.itemEnd(e)}),!1),u.addEventListener("progress",(function(t){for(var i=kl[e],r=0,n=i.length;r<n;r++){var a=i[r];a.onProgress&&a.onProgress(t)}}),!1),u.addEventListener("error",(function(t){var i=kl[e];delete kl[e];for(var r=0,a=i.length;r<a;r++){var o=i[r];o.onError&&o.onError(t)}n.manager.itemError(e),n.manager.itemEnd(e)}),!1),u.addEventListener("abort",(function(t){var i=kl[e];delete kl[e];for(var r=0,a=i.length;r<a;r++){var o=i[r];o.onError&&o.onError(t)}n.manager.itemError(e),n.manager.itemEnd(e)}),!1),void 0!==this.responseType&&(u.responseType=this.responseType),void 0!==this.withCredentials&&(u.withCredentials=this.withCredentials),u.overrideMimeType&&u.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)u.setRequestHeader(s,this.requestHeader[s]);u.send(null)}return n.manager.itemStart(e),u}kl[e].push({onLoad:t,onProgress:i,onError:r})},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this}}),jr.prototype=Object.assign(Object.create(Nr.prototype),{constructor:jr,load:function(e,t,i,r){var n=this,a=new Ur(n.manager);a.setPath(n.path),a.load(e,(function(i){try{t(n.parse(JSON.parse(i)))}catch(t){r?r(t):console.error(t),n.manager.itemError(e)}}),i,r)},parse:function(e){for(var t=[],i=0;i<e.length;i++){var r=Or.parse(e[i]);t.push(r)}return t}}),Vr.prototype=Object.assign(Object.create(Nr.prototype),{constructor:Vr,load:function(e,t,i,r){function n(n){l.load(e[n],(function(e){e=a.parse(e,!0),o[n]={width:e.width,height:e.height,format:e.format,mipmaps:e.mipmaps},6===(c+=1)&&(1===e.mipmapCount&&(s.minFilter=1006),s.format=e.format,s.needsUpdate=!0,t&&t(s))}),i,r)}var a=this,o=[],s=new ni;s.image=o;var l=new Ur(this.manager);if(l.setPath(this.path),l.setResponseType("arraybuffer"),Array.isArray(e))for(var c=0,h=0,u=e.length;h<u;++h)n(h);else l.load(e,(function(e){if((e=a.parse(e,!0)).isCubemap)for(var i=e.mipmaps.length/e.mipmapCount,r=0;r<i;r++){o[r]={mipmaps:[]};for(var n=0;n<e.mipmapCount;n++)o[r].mipmaps.push(e.mipmaps[r*e.mipmapCount+n]),o[r].format=e.format,o[r].width=e.width,o[r].height=e.height}else s.image.width=e.width,s.image.height=e.height,s.mipmaps=e.mipmaps;1===e.mipmapCount&&(s.minFilter=1006),s.format=e.format,s.needsUpdate=!0,t&&t(s)}),i,r);return s}}),Gr.prototype=Object.assign(Object.create(Nr.prototype),{constructor:Gr,load:function(e,t,i,r){var n=this,a=new K,o=new Ur(this.manager);return o.setResponseType("arraybuffer"),o.setPath(this.path),o.load(e,(function(e){(e=n.parse(e))&&(void 0!==e.image?a.image=e.image:void 0!==e.data&&(a.image.width=e.width,a.image.height=e.height,a.image.data=e.data),a.wrapS=void 0!==e.wrapS?e.wrapS:1001,a.wrapT=void 0!==e.wrapT?e.wrapT:1001,a.magFilter=void 0!==e.magFilter?e.magFilter:1006,a.minFilter=void 0!==e.minFilter?e.minFilter:1006,a.anisotropy=void 0!==e.anisotropy?e.anisotropy:1,void 0!==e.format&&(a.format=e.format),void 0!==e.type&&(a.type=e.type),void 0!==e.mipmaps&&(a.mipmaps=e.mipmaps,a.minFilter=1008),1===e.mipmapCount&&(a.minFilter=1006),a.needsUpdate=!0,t&&t(a,e))}),i,r),a}}),Hr.prototype=Object.assign(Object.create(Nr.prototype),{constructor:Hr,load:function(e,t,i,r){function n(){l.removeEventListener("load",n,!1),l.removeEventListener("error",a,!1),Rl.add(e,this),t&&t(this),o.manager.itemEnd(e)}function a(t){l.removeEventListener("load",n,!1),l.removeEventListener("error",a,!1),r&&r(t),o.manager.itemError(e),o.manager.itemEnd(e)}void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var o=this,s=Rl.get(e);if(void 0!==s)return o.manager.itemStart(e),setTimeout((function(){t&&t(s),o.manager.itemEnd(e)}),0),s;var l=document.createElementNS("http://www.w3.org/1999/xhtml","img");return l.addEventListener("load",n,!1),l.addEventListener("error",a,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(l.crossOrigin=this.crossOrigin),o.manager.itemStart(e),l.src=e,l}}),Wr.prototype=Object.assign(Object.create(Nr.prototype),{constructor:Wr,load:function(e,t,i,r){function n(i){o.load(e[i],(function(e){a.images[i]=e,6==++s&&(a.needsUpdate=!0,t&&t(a))}),void 0,r)}var a=new me,o=new Hr(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);var s=0;for(i=0;i<e.length;++i)n(i);return a}}),qr.prototype=Object.assign(Object.create(Nr.prototype),{constructor:qr,load:function(e,t,i,r){var a=new n,o=new Hr(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,(function(i){a.image=i,i=0<e.search(/\.jpe?g($|\?)/i)||0===e.search(/^data:image\/jpeg/),a.format=i?1022:1023,a.needsUpdate=!0,void 0!==t&&t(a)}),i,r),a}}),Object.assign(Zr.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){return e=this.getUtoTmapping(e),this.getPoint(e,t)},getPoints:function(e){void 0===e&&(e=5);for(var t=[],i=0;i<=e;i++)t.push(this.getPoint(i/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,i=[],r=this.getPoint(0),n=0;for(i.push(0),t=1;t<=e;t++){var a=this.getPoint(t/e);n+=a.distanceTo(r),i.push(n),r=a}return this.cacheArcLengths=i},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var i=this.getLengths(),r=i.length;t=t||e*i[r-1];for(var n,a=0,o=r-1;a<=o;)if(0>(n=i[e=Math.floor(a+(o-a)/2)]-t))a=e+1;else{if(!(0<n)){o=e;break}o=e-1}return i[e=o]===t?e/(r-1):(e+(t-(a=i[e]))/(i[e+1]-a))/(r-1)},getTangent:function(e,t){var r=e-1e-4;return 0>r&&(r=0),1<(e+=1e-4)&&(e=1),r=this.getPoint(r),e=this.getPoint(e),(t=t||(r.isVector2?new i:new c)).copy(e).sub(r).normalize(),t},getTangentAt:function(e,t){return e=this.getUtoTmapping(e),this.getTangent(e,t)},computeFrenetFrames:function(e,t){var i,r=new c,n=[],a=[],o=[],s=new c,l=new h;for(i=0;i<=e;i++){var u=i/e;n[i]=this.getTangentAt(u,new c),n[i].normalize()}a[0]=new c,o[0]=new c,i=Number.MAX_VALUE,u=Math.abs(n[0].x);var d=Math.abs(n[0].y),p=Math.abs(n[0].z);for(u<=i&&(i=u,r.set(1,0,0)),d<=i&&(i=d,r.set(0,1,0)),p<=i&&r.set(0,0,1),s.crossVectors(n[0],r).normalize(),a[0].crossVectors(n[0],s),o[0].crossVectors(n[0],a[0]),i=1;i<=e;i++)a[i]=a[i-1].clone(),o[i]=o[i-1].clone(),s.crossVectors(n[i-1],n[i]),s.length()>Number.EPSILON&&(s.normalize(),r=Math.acos(Ia.clamp(n[i-1].dot(n[i]),-1,1)),a[i].applyMatrix4(l.makeRotationAxis(s,r))),o[i].crossVectors(n[i],a[i]);if(!0===t)for(r=Math.acos(Ia.clamp(a[0].dot(a[e]),-1,1)),r/=e,0<n[0].dot(s.crossVectors(a[0],a[e]))&&(r=-r),i=1;i<=e;i++)a[i].applyMatrix4(l.makeRotationAxis(n[i],r*i)),o[i].crossVectors(n[i],a[i]);return{tangents:n,normals:a,binormals:o}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),Xr.prototype=Object.create(Zr.prototype),Xr.prototype.constructor=Xr,Xr.prototype.isEllipseCurve=!0,Xr.prototype.getPoint=function(e,t){t=t||new i;for(var r=2*Math.PI,n=this.aEndAngle-this.aStartAngle,a=Math.abs(n)<Number.EPSILON;0>n;)n+=r;for(;n>r;)n-=r;n<Number.EPSILON&&(n=a?0:r),!0!==this.aClockwise||a||(n=n===r?-r:n-r),r=this.aStartAngle+e*n,e=this.aX+this.xRadius*Math.cos(r);var o=this.aY+this.yRadius*Math.sin(r);return 0!==this.aRotation&&(r=Math.cos(this.aRotation),n=Math.sin(this.aRotation),e=(a=e-this.aX)*r-(o-=this.aY)*n+this.aX,o=a*n+o*r+this.aY),t.set(e,o)},Xr.prototype.copy=function(e){return Zr.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Xr.prototype.toJSON=function(){var e=Zr.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},Xr.prototype.fromJSON=function(e){return Zr.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},$r.prototype=Object.create(Xr.prototype),$r.prototype.constructor=$r,$r.prototype.isArcCurve=!0;var zl=new c,Ol=new Yr,Bl=new Yr,Fl=new Yr;Jr.prototype=Object.create(Zr.prototype),Jr.prototype.constructor=Jr,Jr.prototype.isCatmullRomCurve3=!0,Jr.prototype.getPoint=function(e,t){t=t||new c;var i=this.points,r=i.length;e*=r-(this.closed?0:1);var n=Math.floor(e);if(e-=n,this.closed?n+=0<n?0:(Math.floor(Math.abs(n)/r)+1)*r:0===e&&n===r-1&&(n=r-2,e=1),this.closed||0<n)var a=i[(n-1)%r];else zl.subVectors(i[0],i[1]).add(i[0]),a=zl;var o=i[n%r],s=i[(n+1)%r];if(this.closed||n+2<r?i=i[(n+2)%r]:(zl.subVectors(i[r-1],i[r-2]).add(i[r-1]),i=zl),"centripetal"===this.curveType||"chordal"===this.curveType){var l="chordal"===this.curveType?.5:.25;r=Math.pow(a.distanceToSquared(o),l),1e-4>(n=Math.pow(o.distanceToSquared(s),l))&&(n=1),1e-4>r&&(r=n),1e-4>(l=Math.pow(s.distanceToSquared(i),l))&&(l=n),Ol.initNonuniformCatmullRom(a.x,o.x,s.x,i.x,r,n,l),Bl.initNonuniformCatmullRom(a.y,o.y,s.y,i.y,r,n,l),Fl.initNonuniformCatmullRom(a.z,o.z,s.z,i.z,r,n,l)}else"catmullrom"===this.curveType&&(Ol.initCatmullRom(a.x,o.x,s.x,i.x,this.tension),Bl.initCatmullRom(a.y,o.y,s.y,i.y,this.tension),Fl.initCatmullRom(a.z,o.z,s.z,i.z,this.tension));return t.set(Ol.calc(e),Bl.calc(e),Fl.calc(e)),t},Jr.prototype.copy=function(e){Zr.prototype.copy.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++)this.points.push(e.points[t].clone());return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Jr.prototype.toJSON=function(){var e=Zr.prototype.toJSON.call(this);e.points=[];for(var t=0,i=this.points.length;t<i;t++)e.points.push(this.points[t].toArray());return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},Jr.prototype.fromJSON=function(e){Zr.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push((new c).fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},tn.prototype=Object.create(Zr.prototype),tn.prototype.constructor=tn,tn.prototype.isCubicBezierCurve=!0,tn.prototype.getPoint=function(e,t){t=t||new i;var r=this.v0,n=this.v1,a=this.v2,o=this.v3;return t.set(en(e,r.x,n.x,a.x,o.x),en(e,r.y,n.y,a.y,o.y)),t},tn.prototype.copy=function(e){return Zr.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},tn.prototype.toJSON=function(){var e=Zr.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},tn.prototype.fromJSON=function(e){return Zr.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},rn.prototype=Object.create(Zr.prototype),rn.prototype.constructor=rn,rn.prototype.isCubicBezierCurve3=!0,rn.prototype.getPoint=function(e,t){t=t||new c;var i=this.v0,r=this.v1,n=this.v2,a=this.v3;return t.set(en(e,i.x,r.x,n.x,a.x),en(e,i.y,r.y,n.y,a.y),en(e,i.z,r.z,n.z,a.z)),t},rn.prototype.copy=function(e){return Zr.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},rn.prototype.toJSON=function(){var e=Zr.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},rn.prototype.fromJSON=function(e){return Zr.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},nn.prototype=Object.create(Zr.prototype),nn.prototype.constructor=nn,nn.prototype.isLineCurve=!0,nn.prototype.getPoint=function(e,t){return t=t||new i,1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t},nn.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},nn.prototype.getTangent=function(e,t){return(t||new i).copy(this.v2).sub(this.v1).normalize()},nn.prototype.copy=function(e){return Zr.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},nn.prototype.toJSON=function(){var e=Zr.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},nn.prototype.fromJSON=function(e){return Zr.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},an.prototype=Object.create(Zr.prototype),an.prototype.constructor=an,an.prototype.isLineCurve3=!0,an.prototype.getPoint=function(e,t){return t=t||new c,1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t},an.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},an.prototype.copy=function(e){return Zr.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},an.prototype.toJSON=function(){var e=Zr.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},an.prototype.fromJSON=function(e){return Zr.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},on.prototype=Object.create(Zr.prototype),on.prototype.constructor=on,on.prototype.isQuadraticBezierCurve=!0,on.prototype.getPoint=function(e,t){t=t||new i;var r=this.v0,n=this.v1,a=this.v2;return t.set(Qr(e,r.x,n.x,a.x),Qr(e,r.y,n.y,a.y)),t},on.prototype.copy=function(e){return Zr.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},on.prototype.toJSON=function(){var e=Zr.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},on.prototype.fromJSON=function(e){return Zr.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},sn.prototype=Object.create(Zr.prototype),sn.prototype.constructor=sn,sn.prototype.isQuadraticBezierCurve3=!0,sn.prototype.getPoint=function(e,t){t=t||new c;var i=this.v0,r=this.v1,n=this.v2;return t.set(Qr(e,i.x,r.x,n.x),Qr(e,i.y,r.y,n.y),Qr(e,i.z,r.z,n.z)),t},sn.prototype.copy=function(e){return Zr.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},sn.prototype.toJSON=function(){var e=Zr.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},sn.prototype.fromJSON=function(e){return Zr.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},ln.prototype=Object.create(Zr.prototype),ln.prototype.constructor=ln,ln.prototype.isSplineCurve=!0,ln.prototype.getPoint=function(e,t){t=t||new i;var r=this.points,n=(r.length-1)*e;n-=e=Math.floor(n);var a=r[0===e?e:e-1],o=r[e],s=r[e>r.length-2?r.length-1:e+1];return r=r[e>r.length-3?r.length-1:e+2],t.set(Kr(n,a.x,o.x,s.x,r.x),Kr(n,a.y,o.y,s.y,r.y)),t},ln.prototype.copy=function(e){Zr.prototype.copy.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++)this.points.push(e.points[t].clone());return this},ln.prototype.toJSON=function(){var e=Zr.prototype.toJSON.call(this);e.points=[];for(var t=0,i=this.points.length;t<i;t++)e.points.push(this.points[t].toArray());return e},ln.prototype.fromJSON=function(e){Zr.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push((new i).fromArray(n))}return this};var Nl=Object.freeze({__proto__:null,ArcCurve:$r,CatmullRomCurve3:Jr,CubicBezierCurve:tn,CubicBezierCurve3:rn,EllipseCurve:Xr,LineCurve:nn,LineCurve3:an,QuadraticBezierCurve:on,QuadraticBezierCurve3:sn,SplineCurve:ln});cn.prototype=Object.assign(Object.create(Zr.prototype),{constructor:cn,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new nn(t,e))},getPoint:function(e){var t=e*this.getLength(),i=this.getCurveLengths();for(e=0;e<i.length;){if(i[e]>=t)return t=i[e]-t,i=(e=this.curves[e]).getLength(),e.getPointAt(0===i?0:1-t/i);e++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,i=0,r=this.curves.length;i<r;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,i=[],r=0,n=this.curves;r<n.length;r++){var a=n[r];a=a.getPoints(a&&a.isEllipseCurve?2*e:a&&(a.isLineCurve||a.isLineCurve3)?1:a&&a.isSplineCurve?e*a.points.length:e);for(var o=0;o<a.length;o++){var s=a[o];t&&t.equals(s)||(i.push(s),t=s)}}return this.autoClose&&1<i.length&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i},copy:function(e){Zr.prototype.copy.call(this,e),this.curves=[];for(var t=0,i=e.curves.length;t<i;t++)this.curves.push(e.curves[t].clone());return this.autoClose=e.autoClose,this},toJSON:function(){var e=Zr.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,i=this.curves.length;t<i;t++)e.curves.push(this.curves[t].toJSON());return e},fromJSON:function(e){Zr.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,i=e.curves.length;t<i;t++){var r=e.curves[t];this.curves.push((new Nl[r.type]).fromJSON(r))}return this}}),hn.prototype=Object.assign(Object.create(cn.prototype),{constructor:hn,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this},moveTo:function(e,t){return this.currentPoint.set(e,t),this},lineTo:function(e,t){var r=new nn(this.currentPoint.clone(),new i(e,t));return this.curves.push(r),this.currentPoint.set(e,t),this},quadraticCurveTo:function(e,t,r,n){return e=new on(this.currentPoint.clone(),new i(e,t),new i(r,n)),this.curves.push(e),this.currentPoint.set(r,n),this},bezierCurveTo:function(e,t,r,n,a,o){return e=new tn(this.currentPoint.clone(),new i(e,t),new i(r,n),new i(a,o)),this.curves.push(e),this.currentPoint.set(a,o),this},splineThru:function(e){var t=[this.currentPoint.clone()].concat(e);return t=new ln(t),this.curves.push(t),this.currentPoint.copy(e[e.length-1]),this},arc:function(e,t,i,r,n,a){return this.absarc(e+this.currentPoint.x,t+this.currentPoint.y,i,r,n,a),this},absarc:function(e,t,i,r,n,a){return this.absellipse(e,t,i,i,r,n,a),this},ellipse:function(e,t,i,r,n,a,o,s){return this.absellipse(e+this.currentPoint.x,t+this.currentPoint.y,i,r,n,a,o,s),this},absellipse:function(e,t,i,r,n,a,o,s){return e=new Xr(e,t,i,r,n,a,o,s),0<this.curves.length&&((t=e.getPoint(0)).equals(this.currentPoint)||this.lineTo(t.x,t.y)),this.curves.push(e),e=e.getPoint(1),this.currentPoint.copy(e),this},copy:function(e){return cn.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=cn.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return cn.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),un.prototype=Object.assign(Object.create(hn.prototype),{constructor:un,getPointsHoles:function(e){for(var t=[],i=0,r=this.holes.length;i<r;i++)t[i]=this.holes[i].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){hn.prototype.copy.call(this,e),this.holes=[];for(var t=0,i=e.holes.length;t<i;t++)this.holes.push(e.holes[t].clone());return this},toJSON:function(){var e=hn.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,i=this.holes.length;t<i;t++)e.holes.push(this.holes[t].toJSON());return e},fromJSON:function(e){hn.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,i=e.holes.length;t<i;t++){var r=e.holes[t];this.holes.push((new hn).fromJSON(r))}return this}}),dn.prototype=Object.assign(Object.create(p.prototype),{constructor:dn,isLight:!0,copy:function(e){return p.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){return(e=p.prototype.toJSON.call(this,e)).object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}),pn.prototype=Object.assign(Object.create(dn.prototype),{constructor:pn,isHemisphereLight:!0,copy:function(e){return dn.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(fn.prototype,{_projScreenMatrix:new h,_lightPositionWorld:new c,_lookTarget:new c,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(e){var t=this.camera,i=this.matrix,r=this._projScreenMatrix,n=this._lookTarget,a=this._lightPositionWorld;a.setFromMatrixPosition(e.matrixWorld),t.position.copy(a),n.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(n),t.updateMatrixWorld(),r.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(r),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(t.projectionMatrix),i.multiply(t.matrixWorldInverse)},getViewport:function(e){return this._viewports[e]},getFrameExtents:function(){return this._frameExtents},copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),mn.prototype=Object.assign(Object.create(fn.prototype),{constructor:mn,isSpotLightShadow:!0,updateMatrices:function(e){var t=this.camera,i=2*Ia.RAD2DEG*e.angle,r=this.mapSize.width/this.mapSize.height,n=e.distance||t.far;i===t.fov&&r===t.aspect&&n===t.far||(t.fov=i,t.aspect=r,t.far=n,t.updateProjectionMatrix()),fn.prototype.updateMatrices.call(this,e)}}),gn.prototype=Object.assign(Object.create(dn.prototype),{constructor:gn,isSpotLight:!0,copy:function(e){return dn.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),yn.prototype=Object.assign(Object.create(fn.prototype),{constructor:yn,isPointLightShadow:!0,updateMatrices:function(e,t){void 0===t&&(t=0);var i=this.camera,r=this.matrix,n=this._lightPositionWorld,a=this._lookTarget,o=this._projScreenMatrix;n.setFromMatrixPosition(e.matrixWorld),i.position.copy(n),a.copy(i.position),a.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(a),i.updateMatrixWorld(),r.makeTranslation(-n.x,-n.y,-n.z),o.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(o)}}),vn.prototype=Object.assign(Object.create(dn.prototype),{constructor:vn,isPointLight:!0,copy:function(e){return dn.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),_n.prototype=Object.assign(Object.create(X.prototype),{constructor:_n,isOrthographicCamera:!0,copy:function(e,t){return X.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,i,r,n,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2,n=i-e;i+=e,e=r+t,t=r-t,null!==this.view&&this.view.enabled&&(r=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom,i=(n+=r*this.view.offsetX)+r*this.view.width,t=(e-=t*this.view.offsetY)-t*this.view.height),this.projectionMatrix.makeOrthographic(n,i,e,t,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){return(e=p.prototype.toJSON.call(this,e)).object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}),xn.prototype=Object.assign(Object.create(fn.prototype),{constructor:xn,isDirectionalLightShadow:!0,updateMatrices:function(e){fn.prototype.updateMatrices.call(this,e)}}),bn.prototype=Object.assign(Object.create(dn.prototype),{constructor:bn,isDirectionalLight:!0,copy:function(e){return dn.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),wn.prototype=Object.assign(Object.create(dn.prototype),{constructor:wn,isAmbientLight:!0}),Mn.prototype=Object.assign(Object.create(dn.prototype),{constructor:Mn,isRectAreaLight:!0,copy:function(e){return dn.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){return(e=dn.prototype.toJSON.call(this,e)).object.width=this.width,e.object.height=this.height,e}}),Object.assign(Tn.prototype,{isSphericalHarmonics3:!0,set:function(e){for(var t=0;9>t;t++)this.coefficients[t].copy(e[t]);return this},zero:function(){for(var e=0;9>e;e++)this.coefficients[e].set(0,0,0);return this},getAt:function(e,t){var i=e.x,r=e.y;e=e.z;var n=this.coefficients;return t.copy(n[0]).multiplyScalar(.282095),t.addScaledVector(n[1],.488603*r),t.addScaledVector(n[2],.488603*e),t.addScaledVector(n[3],.488603*i),t.addScaledVector(n[4],1.092548*i*r),t.addScaledVector(n[5],1.092548*r*e),t.addScaledVector(n[6],.315392*(3*e*e-1)),t.addScaledVector(n[7],1.092548*i*e),t.addScaledVector(n[8],.546274*(i*i-r*r)),t},getIrradianceAt:function(e,t){var i=e.x,r=e.y;e=e.z;var n=this.coefficients;return t.copy(n[0]).multiplyScalar(.886227),t.addScaledVector(n[1],1.023328*r),t.addScaledVector(n[2],1.023328*e),t.addScaledVector(n[3],1.023328*i),t.addScaledVector(n[4],.858086*i*r),t.addScaledVector(n[5],.858086*r*e),t.addScaledVector(n[6],.743125*e*e-.247708),t.addScaledVector(n[7],.858086*i*e),t.addScaledVector(n[8],.429043*(i*i-r*r)),t},add:function(e){for(var t=0;9>t;t++)this.coefficients[t].add(e.coefficients[t]);return this},addScaledSH:function(e,t){for(var i=0;9>i;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this},scale:function(e){for(var t=0;9>t;t++)this.coefficients[t].multiplyScalar(e);return this},lerp:function(e,t){for(var i=0;9>i;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this},equals:function(e){for(var t=0;9>t;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0},copy:function(e){return this.set(e.coefficients)},clone:function(){return(new this.constructor).copy(this)},fromArray:function(e,t){void 0===t&&(t=0);for(var i=this.coefficients,r=0;9>r;r++)i[r].fromArray(e,t+3*r);return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);for(var i=this.coefficients,r=0;9>r;r++)i[r].toArray(e,t+3*r);return e}}),Object.assign(Tn,{getBasisAt:function(e,t){var i=e.x,r=e.y;e=e.z,t[0]=.282095,t[1]=.488603*r,t[2]=.488603*e,t[3]=.488603*i,t[4]=1.092548*i*r,t[5]=1.092548*r*e,t[6]=.315392*(3*e*e-1),t[7]=1.092548*i*e,t[8]=.546274*(i*i-r*r)}}),Sn.prototype=Object.assign(Object.create(dn.prototype),{constructor:Sn,isLightProbe:!0,copy:function(e){return dn.prototype.copy.call(this,e),this.sh.copy(e.sh),this},fromJSON:function(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this},toJSON:function(e){return(e=dn.prototype.toJSON.call(this,e)).object.sh=this.sh.toArray(),e}}),En.prototype=Object.assign(Object.create(Nr.prototype),{constructor:En,load:function(e,t,i,r){var n=this,a=new Ur(n.manager);a.setPath(n.path),a.load(e,(function(i){try{t(n.parse(JSON.parse(i)))}catch(t){r?r(t):console.error(t),n.manager.itemError(e)}}),i,r)},parse:function(e){function t(e){return void 0===n[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),n[e]}var n=this.textures,o=new Pl[e.type];if(void 0!==e.uuid&&(o.uuid=e.uuid),void 0!==e.name&&(o.name=e.name),void 0!==e.color&&o.color.setHex(e.color),void 0!==e.roughness&&(o.roughness=e.roughness),void 0!==e.metalness&&(o.metalness=e.metalness),void 0!==e.sheen&&(o.sheen=(new b).setHex(e.sheen)),void 0!==e.emissive&&o.emissive.setHex(e.emissive),void 0!==e.specular&&o.specular.setHex(e.specular),void 0!==e.shininess&&(o.shininess=e.shininess),void 0!==e.clearcoat&&(o.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(o.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.fog&&(o.fog=e.fog),void 0!==e.flatShading&&(o.flatShading=e.flatShading),void 0!==e.blending&&(o.blending=e.blending),void 0!==e.combine&&(o.combine=e.combine),void 0!==e.side&&(o.side=e.side),void 0!==e.opacity&&(o.opacity=e.opacity),void 0!==e.transparent&&(o.transparent=e.transparent),void 0!==e.alphaTest&&(o.alphaTest=e.alphaTest),void 0!==e.depthTest&&(o.depthTest=e.depthTest),void 0!==e.depthWrite&&(o.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(o.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(o.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(o.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(o.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(o.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(o.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(o.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(o.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(o.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(o.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(o.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(o.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(o.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(o.rotation=e.rotation),1!==e.linewidth&&(o.linewidth=e.linewidth),void 0!==e.dashSize&&(o.dashSize=e.dashSize),void 0!==e.gapSize&&(o.gapSize=e.gapSize),void 0!==e.scale&&(o.scale=e.scale),void 0!==e.polygonOffset&&(o.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(o.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(o.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(o.skinning=e.skinning),void 0!==e.morphTargets&&(o.morphTargets=e.morphTargets),void 0!==e.morphNormals&&(o.morphNormals=e.morphNormals),void 0!==e.dithering&&(o.dithering=e.dithering),void 0!==e.vertexTangents&&(o.vertexTangents=e.vertexTangents),void 0!==e.visible&&(o.visible=e.visible),void 0!==e.toneMapped&&(o.toneMapped=e.toneMapped),void 0!==e.userData&&(o.userData=e.userData),void 0!==e.vertexColors&&(o.vertexColors="number"==typeof e.vertexColors?0<e.vertexColors:e.vertexColors),void 0!==e.uniforms)for(var s in e.uniforms){var l=e.uniforms[s];switch(o.uniforms[s]={},l.type){case"t":o.uniforms[s].value=t(l.value);break;case"c":o.uniforms[s].value=(new b).setHex(l.value);break;case"v2":o.uniforms[s].value=(new i).fromArray(l.value);break;case"v3":o.uniforms[s].value=(new c).fromArray(l.value);break;case"v4":o.uniforms[s].value=(new a).fromArray(l.value);break;case"m3":o.uniforms[s].value=(new r).fromArray(l.value);case"m4":o.uniforms[s].value=(new h).fromArray(l.value);break;default:o.uniforms[s].value=l.value}}if(void 0!==e.defines&&(o.defines=e.defines),void 0!==e.vertexShader&&(o.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(o.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(var u in e.extensions)o.extensions[u]=e.extensions[u];return void 0!==e.shading&&(o.flatShading=1===e.shading),void 0!==e.size&&(o.size=e.size),void 0!==e.sizeAttenuation&&(o.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(o.map=t(e.map)),void 0!==e.matcap&&(o.matcap=t(e.matcap)),void 0!==e.alphaMap&&(o.alphaMap=t(e.alphaMap)),void 0!==e.bumpMap&&(o.bumpMap=t(e.bumpMap)),void 0!==e.bumpScale&&(o.bumpScale=e.bumpScale),void 0!==e.normalMap&&(o.normalMap=t(e.normalMap)),void 0!==e.normalMapType&&(o.normalMapType=e.normalMapType),void 0!==e.normalScale&&(s=e.normalScale,!1===Array.isArray(s)&&(s=[s,s]),o.normalScale=(new i).fromArray(s)),void 0!==e.displacementMap&&(o.displacementMap=t(e.displacementMap)),void 0!==e.displacementScale&&(o.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(o.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(o.roughnessMap=t(e.roughnessMap)),void 0!==e.metalnessMap&&(o.metalnessMap=t(e.metalnessMap)),void 0!==e.emissiveMap&&(o.emissiveMap=t(e.emissiveMap)),void 0!==e.emissiveIntensity&&(o.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(o.specularMap=t(e.specularMap)),void 0!==e.envMap&&(o.envMap=t(e.envMap)),void 0!==e.envMapIntensity&&(o.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(o.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(o.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(o.lightMap=t(e.lightMap)),void 0!==e.lightMapIntensity&&(o.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(o.aoMap=t(e.aoMap)),void 0!==e.aoMapIntensity&&(o.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(o.gradientMap=t(e.gradientMap)),void 0!==e.clearcoatMap&&(o.clearcoatMap=t(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(o.clearcoatRoughnessMap=t(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(o.clearcoatNormalMap=t(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(o.clearcoatNormalScale=(new i).fromArray(e.clearcoatNormalScale)),o},setTextures:function(e){return this.textures=e,this}});var Ul={decodeText:function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",i=0,r=e.length;i<r;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch(e){return t}},extractUrlBase:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}};An.prototype=Object.assign(Object.create(U.prototype),{constructor:An,isInstancedBufferGeometry:!0,copy:function(e){return U.prototype.copy.call(this,e),this.instanceCount=e.instanceCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e=U.prototype.toJSON.call(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}),Cn.prototype=Object.assign(Object.create(C.prototype),{constructor:Cn,isInstancedBufferAttribute:!0,copy:function(e){return C.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:function(){var e=C.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}),Ln.prototype=Object.assign(Object.create(Nr.prototype),{constructor:Ln,load:function(e,t,i,r){var n=this,a=new Ur(n.manager);a.setPath(n.path),a.load(e,(function(i){try{t(n.parse(JSON.parse(i)))}catch(t){r?r(t):console.error(t),n.manager.itemError(e)}}),i,r)},parse:function(e){var t=e.isInstancedBufferGeometry?new An:new U,i=e.data.index;if(void 0!==i){var r=new jl[i.type](i.array);t.setIndex(new C(r,1))}for(var n in i=e.data.attributes){var a=i[n];r=new jl[a.type](a.array),r=new(a.isInstancedBufferAttribute?Cn:C)(r,a.itemSize,a.normalized),void 0!==a.name&&(r.name=a.name),t.setAttribute(n,r)}var o=e.data.morphAttributes;if(o)for(n in o){var s=o[n],l=[];i=0;for(var h=s.length;i<h;i++)a=s[i],r=new C(r=new jl[a.type](a.array),a.itemSize,a.normalized),void 0!==a.name&&(r.name=a.name),l.push(r);t.morphAttributes[n]=l}if(e.data.morphTargetsRelative&&(t.morphTargetsRelative=!0),void 0!==(n=e.data.groups||e.data.drawcalls||e.data.offsets))for(i=0,a=n.length;i!==a;++i)r=n[i],t.addGroup(r.start,r.count,r.materialIndex);return void 0!==(i=e.data.boundingSphere)&&(n=new c,void 0!==i.center&&n.fromArray(i.center),t.boundingSphere=new y(n,i.radius)),e.name&&(t.name=e.name),e.userData&&(t.userData=e.userData),t}});var jl={Int8Array,Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};Pn.prototype=Object.assign(Object.create(Nr.prototype),{constructor:Pn,load:function(e,t,i,r){var n=this,a=""===this.path?Ul.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a,(a=new Ur(n.manager)).setPath(this.path),a.load(e,(function(i){var a=null;try{a=JSON.parse(i)}catch(t){return void 0!==r&&r(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}void 0===(i=a.metadata)||void 0===i.type||"geometry"===i.type.toLowerCase()?console.error("THREE.ObjectLoader: Can't load "+e):n.parse(a,t)}),i,r)},parse:function(e,t){var i=this.parseShape(e.shapes);i=this.parseGeometries(e.geometries,i);var r=this.parseImages(e.images,(function(){void 0!==t&&t(n)}));r=this.parseTextures(e.textures,r),r=this.parseMaterials(e.materials,r);var n=this.parseObject(e.object,i,r);return e.animations&&(n.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0===t||t(n),n},parseShape:function(e){var t={};if(void 0!==e)for(var i=0,r=e.length;i<r;i++){var n=(new un).fromJSON(e[i]);t[n.uuid]=n}return t},parseGeometries:function(e,t){var i={};if(void 0!==e)for(var r=new Ln,n=0,a=e.length;n<a;n++){var o=e[n];switch(o.type){case"PlaneGeometry":case"PlaneBufferGeometry":var s=new Ll[o.type](o.width,o.height,o.widthSegments,o.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":s=new Ll[o.type](o.width,o.height,o.depth,o.widthSegments,o.heightSegments,o.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":s=new Ll[o.type](o.radius,o.segments,o.thetaStart,o.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":s=new Ll[o.type](o.radiusTop,o.radiusBottom,o.height,o.radialSegments,o.heightSegments,o.openEnded,o.thetaStart,o.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":s=new Ll[o.type](o.radius,o.height,o.radialSegments,o.heightSegments,o.openEnded,o.thetaStart,o.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":s=new Ll[o.type](o.radius,o.widthSegments,o.heightSegments,o.phiStart,o.phiLength,o.thetaStart,o.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":s=new Ll[o.type](o.radius,o.detail);break;case"RingGeometry":case"RingBufferGeometry":s=new Ll[o.type](o.innerRadius,o.outerRadius,o.thetaSegments,o.phiSegments,o.thetaStart,o.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":s=new Ll[o.type](o.radius,o.tube,o.radialSegments,o.tubularSegments,o.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":s=new Ll[o.type](o.radius,o.tube,o.tubularSegments,o.radialSegments,o.p,o.q);break;case"TubeGeometry":case"TubeBufferGeometry":s=new Ll[o.type]((new Nl[o.path.type]).fromJSON(o.path),o.tubularSegments,o.radius,o.radialSegments,o.closed);break;case"LatheGeometry":case"LatheBufferGeometry":s=new Ll[o.type](o.points,o.segments,o.phiStart,o.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":s=new Ll[o.type](o.vertices,o.indices,o.radius,o.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":s=[];for(var l=0,c=o.shapes.length;l<c;l++){var h=t[o.shapes[l]];s.push(h)}s=new Ll[o.type](s,o.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(s=[],l=0,c=o.shapes.length;l<c;l++)h=t[o.shapes[l]],s.push(h);void 0!==(l=o.options.extrudePath)&&(o.options.extrudePath=(new Nl[l.type]).fromJSON(l)),s=new Ll[o.type](s,o.options);break;case"BufferGeometry":case"InstancedBufferGeometry":s=r.parse(o);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+o.type+'"');continue}s.uuid=o.uuid,void 0!==o.name&&(s.name=o.name),!0===s.isBufferGeometry&&void 0!==o.userData&&(s.userData=o.userData),i[o.uuid]=s}return i},parseMaterials:function(e,t){var i={},r={};if(void 0!==e){var n=new En;n.setTextures(t),t=0;for(var a=e.length;t<a;t++){var o=e[t];if("MultiMaterial"===o.type){for(var s=[],l=0;l<o.materials.length;l++){var c=o.materials[l];void 0===i[c.uuid]&&(i[c.uuid]=n.parse(c)),s.push(i[c.uuid])}r[o.uuid]=s}else void 0===i[o.uuid]&&(i[o.uuid]=n.parse(o)),r[o.uuid]=i[o.uuid]}}return r},parseAnimations:function(e){for(var t=[],i=0;i<e.length;i++){var r=e[i],n=Or.parse(r);void 0!==r.uuid&&(n.uuid=r.uuid),t.push(n)}return t},parseImages:function(e,t){function i(e){return r.manager.itemStart(e),a.load(e,(function(){r.manager.itemEnd(e)}),void 0,(function(){r.manager.itemError(e),r.manager.itemEnd(e)}))}var r=this,n={};if(void 0!==e&&0<e.length){var a=new Hr(t=new Fr(t));a.setCrossOrigin(this.crossOrigin),t=0;for(var o=e.length;t<o;t++){var s=e[t],l=s.url;if(Array.isArray(l)){n[s.uuid]=[];for(var c=0,h=l.length;c<h;c++){var u=l[c];u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(u)?u:r.resourcePath+u,n[s.uuid].push(i(u))}}else u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(s.url)?s.url:r.resourcePath+s.url,n[s.uuid]=i(u)}}return n},parseTextures:function(e,t){function i(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var r={};if(void 0!==e)for(var a=0,o=e.length;a<o;a++){var s=e[a];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===t[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);var l=Array.isArray(t[s.image])?new me(t[s.image]):new n(t[s.image]);l.needsUpdate=!0,l.uuid=s.uuid,void 0!==s.name&&(l.name=s.name),void 0!==s.mapping&&(l.mapping=i(s.mapping,Vl)),void 0!==s.offset&&l.offset.fromArray(s.offset),void 0!==s.repeat&&l.repeat.fromArray(s.repeat),void 0!==s.center&&l.center.fromArray(s.center),void 0!==s.rotation&&(l.rotation=s.rotation),void 0!==s.wrap&&(l.wrapS=i(s.wrap[0],Gl),l.wrapT=i(s.wrap[1],Gl)),void 0!==s.format&&(l.format=s.format),void 0!==s.type&&(l.type=s.type),void 0!==s.encoding&&(l.encoding=s.encoding),void 0!==s.minFilter&&(l.minFilter=i(s.minFilter,Hl)),void 0!==s.magFilter&&(l.magFilter=i(s.magFilter,Hl)),void 0!==s.anisotropy&&(l.anisotropy=s.anisotropy),void 0!==s.flipY&&(l.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(l.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(l.unpackAlignment=s.unpackAlignment),r[s.uuid]=l}return r},parseObject:function(e,t,i){function r(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function n(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],r=0,n=e.length;r<n;r++){var a=e[r];void 0===i[a]&&console.warn("THREE.ObjectLoader: Undefined material",a),t.push(i[a])}return t}return void 0===i[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),i[e]}}switch(e.type){case"Scene":var a=new f;void 0!==e.background&&Number.isInteger(e.background)&&(a.background=new b(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?a.fog=new Nt(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(a.fog=new Ft(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":a=new $(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(a.focus=e.focus),void 0!==e.zoom&&(a.zoom=e.zoom),void 0!==e.filmGauge&&(a.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(a.filmOffset=e.filmOffset),void 0!==e.view&&(a.view=Object.assign({},e.view));break;case"OrthographicCamera":a=new _n(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(a.zoom=e.zoom),void 0!==e.view&&(a.view=Object.assign({},e.view));break;case"AmbientLight":a=new wn(e.color,e.intensity);break;case"DirectionalLight":a=new bn(e.color,e.intensity);break;case"PointLight":a=new vn(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":a=new Mn(e.color,e.intensity,e.width,e.height);break;case"SpotLight":a=new gn(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":a=new pn(e.color,e.groundColor,e.intensity);break;case"LightProbe":a=(new Sn).fromJSON(e);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":a=r(e.geometry);var o=n(e.material);a=new j(a,o);break;case"InstancedMesh":a=r(e.geometry),o=n(e.material);var s=e.instanceMatrix;(a=new $t(a,o,e.count)).instanceMatrix=new C(new Float32Array(s.array),16);break;case"LOD":a=new Wt;break;case"Line":a=new Jt(r(e.geometry),n(e.material),e.mode);break;case"LineLoop":a=new Qt(r(e.geometry),n(e.material));break;case"LineSegments":a=new Kt(r(e.geometry),n(e.material));break;case"PointCloud":case"Points":a=new ti(r(e.geometry),n(e.material));break;case"Sprite":a=new Gt(n(e.material));break;case"Group":a=new Dt;break;default:a=new p}if(a.uuid=e.uuid,void 0!==e.name&&(a.name=e.name),void 0!==e.matrix?(a.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(a.matrixAutoUpdate=e.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(void 0!==e.position&&a.position.fromArray(e.position),void 0!==e.rotation&&a.rotation.fromArray(e.rotation),void 0!==e.quaternion&&a.quaternion.fromArray(e.quaternion),void 0!==e.scale&&a.scale.fromArray(e.scale)),void 0!==e.castShadow&&(a.castShadow=e.castShadow),void 0!==e.receiveShadow&&(a.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(a.shadow.bias=e.shadow.bias),void 0!==e.shadow.radius&&(a.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&a.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(a.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(a.visible=e.visible),void 0!==e.frustumCulled&&(a.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(a.renderOrder=e.renderOrder),void 0!==e.userData&&(a.userData=e.userData),void 0!==e.layers&&(a.layers.mask=e.layers),void 0!==e.children)for(s=e.children,o=0;o<s.length;o++)a.add(this.parseObject(s[o],t,i));if("LOD"===e.type)for(void 0!==e.autoUpdate&&(a.autoUpdate=e.autoUpdate),e=e.levels,s=0;s<e.length;s++){o=e[s];var l=a.getObjectByProperty("uuid",o.object);void 0!==l&&a.addLevel(l,o.distance)}return a}});var Vl={UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,SphericalReflectionMapping:305,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},Gl={RepeatWrapping:1e3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002},Hl={NearestFilter:1003,NearestMipmapNearestFilter:1004,NearestMipmapLinearFilter:1005,LinearFilter:1006,LinearMipmapNearestFilter:1007,LinearMipmapLinearFilter:1008};In.prototype=Object.assign(Object.create(Nr.prototype),{constructor:In,setOptions:function(e){return this.options=e,this},load:function(e,t,i,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var n=this,a=Rl.get(e);if(void 0!==a)return n.manager.itemStart(e),setTimeout((function(){t&&t(a),n.manager.itemEnd(e)}),0),a;fetch(e).then((function(e){return e.blob()})).then((function(e){return void 0===n.options?createImageBitmap(e):createImageBitmap(e,n.options)})).then((function(i){Rl.add(e,i),t&&t(i),n.manager.itemEnd(e)})).catch((function(t){r&&r(t),n.manager.itemError(e),n.manager.itemEnd(e)})),n.manager.itemStart(e)}}),Object.assign(Rn.prototype,{moveTo:function(e,t){return this.currentPath=new hn,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this},lineTo:function(e,t){return this.currentPath.lineTo(e,t),this},quadraticCurveTo:function(e,t,i,r){return this.currentPath.quadraticCurveTo(e,t,i,r),this},bezierCurveTo:function(e,t,i,r,n,a){return this.currentPath.bezierCurveTo(e,t,i,r,n,a),this},splineThru:function(e){return this.currentPath.splineThru(e),this},toShapes:function(e,t){function i(e){for(var t=[],i=0,r=e.length;i<r;i++){var n=e[i],a=new un;a.curves=n.curves,t.push(a)}return t}function r(e,t){for(var i=t.length,r=!1,n=i-1,a=0;a<i;n=a++){var o=t[n],s=t[a],l=s.x-o.x,c=s.y-o.y;if(Math.abs(c)>Number.EPSILON){if(0>c&&(o=t[a],l=-l,s=t[n],c=-c),!(e.y<o.y||e.y>s.y))if(e.y===o.y){if(e.x===o.x)return!0}else{if(0==(n=c*(e.x-o.x)-l*(e.y-o.y)))return!0;0>n||(r=!r)}}else if(e.y===o.y&&(s.x<=e.x&&e.x<=o.x||o.x<=e.x&&e.x<=s.x))return!0}return r}var n=Al.isClockWise,a=this.subPaths;if(0===a.length)return[];if(!0===t)return i(a);if(t=[],1===a.length){var o=a[0],s=new un;return s.curves=o.curves,t.push(s),t}var l=!n(a[0].getPoints());l=e?!l:l,s=[];var c=[],h=[],u=0;c[u]=void 0,h[u]=[];for(var d=0,p=a.length;d<p;d++){var f=(o=a[d]).getPoints(),m=n(f);(m=e?!m:m)?(!l&&c[u]&&u++,c[u]={s:new un,p:f},c[u].s.curves=o.curves,l&&u++,h[u]=[]):h[u].push({h:o,p:f[0]})}if(!c[0])return i(a);if(1<c.length){for(d=!1,e=[],n=0,a=c.length;n<a;n++)s[n]=[];for(n=0,a=c.length;n<a;n++)for(o=h[n],m=0;m<o.length;m++){for(l=o[m],u=!0,f=0;f<c.length;f++)r(l.p,c[f].p)&&(n!==f&&e.push({froms:n,tos:f,hole:m}),u?(u=!1,s[f].push(l)):d=!0);u&&s[n].push(l)}0<e.length&&(d||(h=s))}for(d=0,n=c.length;d<n;d++)for(s=c[d].s,t.push(s),a=0,o=(e=h[d]).length;a<o;a++)s.holes.push(e[a].h);return t}}),Object.assign(Dn.prototype,{isFont:!0,generateShapes:function(e,t){void 0===t&&(t=100);var i=[],r=t;t=this.data;var n=Array.from?Array.from(e):String(e).split("");r/=t.resolution;var a=(t.boundingBox.yMax-t.boundingBox.yMin+t.underlineThickness)*r;e=[];for(var o=0,s=0,l=0;l<n.length;l++){var c=n[l];if("\n"===c)o=0,s-=a;else{var h=c;c=r;var u=o,d=s,p=t,f=p.glyphs[h]||p.glyphs["?"];if(f){if(h=new Rn,f.o)for(var m=0,g=(p=f._cachedOutline||(f._cachedOutline=f.o.split(" "))).length;m<g;)switch(p[m++]){case"m":var y=p[m++]*c+u,v=p[m++]*c+d;h.moveTo(y,v);break;case"l":y=p[m++]*c+u,v=p[m++]*c+d,h.lineTo(y,v);break;case"q":var _=p[m++]*c+u,x=p[m++]*c+d,b=p[m++]*c+u,w=p[m++]*c+d;h.quadraticCurveTo(b,w,_,x);break;case"b":_=p[m++]*c+u,x=p[m++]*c+d,b=p[m++]*c+u,w=p[m++]*c+d,y=p[m++]*c+u,v=p[m++]*c+d,h.bezierCurveTo(b,w,y,v,_,x)}c={offsetX:f.ha*c,path:h}}else console.error('THREE.Font: character "'+h+'" does not exists in font family '+p.familyName+"."),c=void 0;o+=c.offsetX,e.push(c.path)}}for(t=0,n=e.length;t<n;t++)Array.prototype.push.apply(i,e[t].toShapes());return i}}),kn.prototype=Object.assign(Object.create(Nr.prototype),{constructor:kn,load:function(e,t,i,r){var n=this,a=new Ur(this.manager);a.setPath(this.path),a.load(e,(function(e){try{var i=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),i=JSON.parse(e.substring(65,e.length-2))}e=n.parse(i),t&&t(e)}),i,r)},parse:function(e){return new Dn(e)}});var Wl,ql={getContext:function(){return void 0===Wl&&(Wl=new(window.AudioContext||window.webkitAudioContext)),Wl},setContext:function(e){Wl=e}};zn.prototype=Object.assign(Object.create(Nr.prototype),{constructor:zn,load:function(e,t,i,r){var n=this,a=new Ur(n.manager);a.setResponseType("arraybuffer"),a.setPath(n.path),a.load(e,(function(i){try{var a=i.slice(0);ql.getContext().decodeAudioData(a,(function(e){t(e)}))}catch(t){r?r(t):console.error(t),n.manager.itemError(e)}}),i,r)}}),On.prototype=Object.assign(Object.create(Sn.prototype),{constructor:On,isHemisphereLightProbe:!0,copy:function(e){return Sn.prototype.copy.call(this,e),this},toJSON:function(e){return Sn.prototype.toJSON.call(this,e)}}),Bn.prototype=Object.assign(Object.create(Sn.prototype),{constructor:Bn,isAmbientLightProbe:!0,copy:function(e){return Sn.prototype.copy.call(this,e),this},toJSON:function(e){return Sn.prototype.toJSON.call(this,e)}});var Zl=new h,Xl=new h;Object.assign(Fn.prototype,{update:function(e){var t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;var i=e.projectionMatrix.clone(),r=t.eyeSep/2,n=r*t.near/t.focus,a=t.near*Math.tan(Ia.DEG2RAD*t.fov*.5)/t.zoom;Xl.elements[12]=-r,Zl.elements[12]=r,r=-a*t.aspect+n;var o=a*t.aspect+n;i.elements[0]=2*t.near/(o-r),i.elements[8]=(o+r)/(o-r),this.cameraL.projectionMatrix.copy(i),r=-a*t.aspect-n,o=a*t.aspect-n,i.elements[0]=2*t.near/(o-r),i.elements[8]=(o+r)/(o-r),this.cameraR.projectionMatrix.copy(i)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Xl),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Zl)}}),Object.assign(Nn.prototype,{start:function(){this.oldTime=this.startTime=("undefined"==typeof performance?Date:performance).now(),this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.autoStart=this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}});var $l=new c,Yl=new l,Jl=new c,Kl=new c;Un.prototype=Object.assign(Object.create(p.prototype),{constructor:Un,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},updateMatrixWorld:function(e){p.prototype.updateMatrixWorld.call(this,e),e=this.context.listener;var t=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose($l,Yl,Jl),Kl.set(0,0,-1).applyQuaternion(Yl),e.positionX){var i=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime($l.x,i),e.positionY.linearRampToValueAtTime($l.y,i),e.positionZ.linearRampToValueAtTime($l.z,i),e.forwardX.linearRampToValueAtTime(Kl.x,i),e.forwardY.linearRampToValueAtTime(Kl.y,i),e.forwardZ.linearRampToValueAtTime(Kl.z,i),e.upX.linearRampToValueAtTime(t.x,i),e.upY.linearRampToValueAtTime(t.y,i),e.upZ.linearRampToValueAtTime(t.z,i)}else e.setPosition($l.x,$l.y,$l.z),e.setOrientation(Kl.x,Kl.y,Kl.z,t.x,t.y,t.z)}}),jn.prototype=Object.assign(Object.create(p.prototype),{constructor:jn,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setMediaElementSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},setMediaStreamSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(e){if(void 0===e&&(e=0),!0===this.isPlaying)console.warn("THREE.Audio: Audio is already playing.");else{if(!1!==this.hasPlaybackControl)return this._startedAt=this.context.currentTime+e,(e=this.context.createBufferSource()).buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect();console.warn("THREE.Audio: this Audio has no playback control.")}},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress%=this.duration||this.buffer.duration),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},setDetune:function(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},setLoopStart:function(e){return this.loopStart=e,this},setLoopEnd:function(e){return this.loopEnd=e,this},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}});var Ql=new c,ec=new l,tc=new c,ic=new c;Vn.prototype=Object.assign(Object.create(jn.prototype),{constructor:Vn,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){return this.panner.refDistance=e,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){return this.panner.rolloffFactor=e,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){return this.panner.distanceModel=e,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){return this.panner.maxDistance=e,this},setDirectionalCone:function(e,t,i){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=i,this},updateMatrixWorld:function(e){if(p.prototype.updateMatrixWorld.call(this,e),!0!==this.hasPlaybackControl||!1!==this.isPlaying)if(this.matrixWorld.decompose(Ql,ec,tc),ic.set(0,0,1).applyQuaternion(ec),(e=this.panner).positionX){var t=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(Ql.x,t),e.positionY.linearRampToValueAtTime(Ql.y,t),e.positionZ.linearRampToValueAtTime(Ql.z,t),e.orientationX.linearRampToValueAtTime(ic.x,t),e.orientationY.linearRampToValueAtTime(ic.y,t),e.orientationZ.linearRampToValueAtTime(ic.z,t)}else e.setPosition(Ql.x,Ql.y,Ql.z),e.setOrientation(ic.x,ic.y,ic.z)}}),Object.assign(Gn.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),i=0;i<t.length;i++)e+=t[i];return e/t.length}}),Object.assign(Hn.prototype,{accumulate:function(e,t){var i=this.buffer,r=this.valueSize;e=e*r+r;var n=this.cumulativeWeight;if(0===n){for(n=0;n!==r;++n)i[e+n]=i[n];n=t}else n+=t,this._mixBufferRegion(i,e,0,t/n,r);this.cumulativeWeight=n},accumulateAdditive:function(e){var t=this.buffer,i=this.valueSize,r=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,i),this.cumulativeWeightAdditive+=e},apply:function(e){var t=this.valueSize,i=this.buffer;e=e*t+t;var r=this.cumulativeWeight,n=this.cumulativeWeightAdditive,a=this.binding;for(this.cumulativeWeightAdditive=this.cumulativeWeight=0,1>r&&this._mixBufferRegion(i,e,t*this._origIndex,1-r,t),0<n&&this._mixBufferRegionAdditive(i,e,this._addIndex*t,1,t),r=t,n=t+t;r!==n;++r)if(i[r]!==i[r+t]){a.setValue(i,e);break}},saveOriginalState:function(){var e=this.buffer,t=this.valueSize,i=t*this._origIndex;this.binding.getValue(e,i);for(var r=t;r!==i;++r)e[r]=e[i+r%t];this._setIdentity(),this.cumulativeWeightAdditive=this.cumulativeWeight=0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_setAdditiveIdentityNumeric:function(){for(var e=this._addIndex*this.valueSize,t=e+this.valueSize;e<t;e++)this.buffer[e]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[4*this._addIndex+3]=1},_setAdditiveIdentityOther:function(){for(var e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize,i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]},_select:function(e,t,i,r,n){if(.5<=r)for(r=0;r!==n;++r)e[t+r]=e[i+r]},_slerp:function(e,t,i,r){l.slerpFlat(e,t,e,t,e,i,r)},_slerpAdditive:function(e,t,i,r,n){n*=this._workIndex,l.multiplyQuaternionsFlat(e,n,e,t,e,i),l.slerpFlat(e,t,e,t,e,n,r)},_lerp:function(e,t,i,r,n){for(var a=1-r,o=0;o!==n;++o){var s=t+o;e[s]=e[s]*a+e[i+o]*r}},_lerpAdditive:function(e,t,i,r,n){for(var a=0;a!==n;++a)e[t+a]+=e[i+a]*r}});var rc=/[\[\]\.:\/]/g,nc="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",ac=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),oc=/(WCOD+)?/.source.replace("WCOD",nc),sc=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),lc=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),cc=new RegExp("^"+ac+oc+sc+lc+"$"),hc=["material","materials","bones"];Object.assign(Wn.prototype,{getValue:function(e,t){this.bind();var i=this._bindings[this._targetGroup.nCachedObjects_];void 0!==i&&i.getValue(e,t)},setValue:function(e,t){for(var i=this._bindings,r=this._targetGroup.nCachedObjects_,n=i.length;r!==n;++r)i[r].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}),Object.assign(qn,{Composite:Wn,create:function(e,t,i){return e&&e.isAnimationObjectGroup?new qn.Composite(e,t,i):new qn(e,t,i)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(rc,"")},parseTrackName:function(e){var t=cc.exec(e);if(!t)throw Error("PropertyBinding: Cannot parse trackName: "+e);var i=(t={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]}).nodeName&&t.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){var r=t.nodeName.substring(i+1);-1!==hc.indexOf(r)&&(t.nodeName=t.nodeName.substring(0,i),t.objectName=r)}if(null===t.propertyName||0===t.propertyName.length)throw Error("PropertyBinding: can not parse propertyName from trackName: "+e);return t},findNode:function(e,t){if(!t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var i=e.skeleton.getBoneByName(t);if(void 0!==i)return i}if(e.children){var r=function(e){for(var i=0;i<e.length;i++){var n=e[i];if(n.name===t||n.uuid===t||(n=r(n.children)))return n}return null};if(e=r(e.children))return e}return null}}),Object.assign(qn.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)e[t++]=i[r]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)i[r]=e[t++]},function(e,t){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)i[r]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)i[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,i=t.objectName,r=t.propertyName,n=t.propertyIndex;if(e||(this.node=e=qn.findNode(this.rootNode,t.nodeName)||this.rootNode),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(i){var a=t.objectIndex;switch(i){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);for(e=e.skeleton.bones,i=0;i<e.length;i++)if(e[i].name===a){a=i;break}break;default:if(void 0===e[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[i]}if(void 0!==a){if(void 0===e[a])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[a]}}if(void 0===(a=e[r]))console.error("THREE.PropertyBinding: Trying to update property for track: "+t.nodeName+"."+r+" but it wasn't found.",e);else{if(t=this.Versioning.None,this.targetObject=e,void 0!==e.needsUpdate?t=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(t=this.Versioning.MatrixWorldNeedsUpdate),i=this.BindingType.Direct,void 0!==n){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[n]&&(n=e.morphTargetDictionary[n])}i=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=n}else void 0!==a.fromArray&&void 0!==a.toArray?(i=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(i=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=r;this.getValue=this.GetterByBindingType[i],this.setValue=this.SetterByBindingTypeAndVersioning[i][t]}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(qn.prototype,{_getValue_unbound:qn.prototype.getValue,_setValue_unbound:qn.prototype.setValue}),Object.assign(Zn.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=e.length,i=this.nCachedObjects_,r=this._indicesByUUID,n=this._paths,a=this._parsedPaths,o=this._bindings,s=o.length,l=void 0,c=0,h=arguments.length;c!==h;++c){var u=arguments[c],d=u.uuid,p=r[d];if(void 0===p){p=t++,r[d]=p,e.push(u),d=0;for(var f=s;d!==f;++d)o[d].push(new qn(u,n[d],a[d]))}else if(p<i){l=e[p];var m=--i;for(r[(f=e[m]).uuid]=p,e[p]=f,r[d]=m,e[m]=u,d=0,f=s;d!==f;++d){var g=o[d],y=g[p];g[p]=g[m],void 0===y&&(y=new qn(u,n[d],a[d])),g[m]=y}}else e[p]!==l&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=i},remove:function(){for(var e=this._objects,t=this.nCachedObjects_,i=this._indicesByUUID,r=this._bindings,n=r.length,a=0,o=arguments.length;a!==o;++a){var s=arguments[a],l=s.uuid,c=i[l];if(void 0!==c&&c>=t){var h=t++,u=e[h];for(i[u.uuid]=c,e[c]=u,i[l]=h,e[h]=s,s=0,l=n;s!==l;++s){var d=(u=r[s])[c];u[c]=u[h],u[h]=d}}}this.nCachedObjects_=t},uncache:function(){for(var e=this._objects,t=e.length,i=this.nCachedObjects_,r=this._indicesByUUID,n=this._bindings,a=n.length,o=0,s=arguments.length;o!==s;++o){var l=arguments[o].uuid,c=r[l];if(void 0!==c)if(delete r[l],c<i){var h=e[l=--i],u=--t,d=e[u];for(r[h.uuid]=c,e[c]=h,r[d.uuid]=l,e[l]=d,e.pop(),h=0,d=a;h!==d;++h){var p=n[h],f=p[u];p[c]=p[l],p[l]=f,p.pop()}}else for(r[(d=e[u=--t]).uuid]=c,e[c]=d,e.pop(),h=0,d=a;h!==d;++h)(p=n[h])[c]=p[u],p.pop()}this.nCachedObjects_=i},subscribe_:function(e,t){var i=this._bindingsIndicesByPath,r=i[e],n=this._bindings;if(void 0!==r)return n[r];var a=this._paths,o=this._parsedPaths,s=this._objects,l=this.nCachedObjects_,c=Array(s.length);for(r=n.length,i[e]=r,a.push(e),o.push(t),n.push(c),i=l,r=s.length;i!==r;++i)c[i]=new qn(s[i],e,t);return c},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,i=t[e];if(void 0!==i){var r=this._paths,n=this._parsedPaths,a=this._bindings,o=a.length-1,s=a[o];t[e[o]]=i,a[i]=s,a.pop(),n[i]=n[o],n.pop(),r[i]=r[o],r.pop()}}}),Object.assign(Xn.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){i=this._clip.duration;var r=e._clip.duration,n=i/r;e.warp(1,r/i,t),this.warp(n,1,t)}return this},crossFadeTo:function(e,t,i){return e.crossFadeFrom(this,t,i)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,i){var r=this._mixer,n=r.time,a=this._timeScaleInterpolant,o=this.timeScale;return null===a&&(this._timeScaleInterpolant=a=r._lendControlInterpolant()),r=a.parameterPositions,a=a.sampleValues,r[0]=n,r[1]=n+i,a[0]=e/o,a[1]=t/o,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,i,r){if(this.enabled){var n=this._startTime;if(null!==n){if(0>(t=(e-n)*i)||0===i)return;this._startTime=null,t*=i}if(t*=this._updateTimeScale(e),i=this._updateTime(t),0<(e=this._updateWeight(e)))switch(t=this._interpolants,n=this._propertyBindings,this.blendMode){case 2501:for(var a=0,o=t.length;a!==o;++a)t[a].evaluate(i),n[a].accumulateAdditive(e);break;default:for(a=0,o=t.length;a!==o;++a)t[a].evaluate(i),n[a].accumulate(r,e)}}else this._updateWeight(e)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var i=this._weightInterpolant;if(null!==i){var r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var i=this._timeScaleInterpolant;null!==i&&(t*=i.evaluate(e)[0],e>i.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t},_updateTime:function(e){var t=this.time+e,i=this._clip.duration,r=this.loop,n=this._loopCount,a=2202===r;if(0===e)return-1===n?t:a&&1==(1&n)?i-t:t;if(2200===r)e:{if(-1===n&&(this._loopCount=0,this._setEndings(!0,!0,!1)),t>=i)t=i;else{if(!(0>t)){this.time=t;break e}t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:0>e?-1:1})}else{if(-1===n&&(0<=e?(n=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),t>=i||0>t){t-=i*(r=Math.floor(t/i)),n+=Math.abs(r);var o=this.repetitions-n;0>=o?(this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=t=0<e?i:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:0<e?1:-1})):(1===o?(e=0>e,this._setEndings(e,!e,a)):this._setEndings(!1,!1,a),this._loopCount=n,this.time=t,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:r}))}else this.time=t;if(a&&1==(1&n))return i-t}return t},_setEndings:function(e,t,i){var r=this._interpolantSettings;i?(r.endingStart=2401,r.endingEnd=2401):(r.endingStart=e?this.zeroSlopeAtStart?2401:2400:2402,r.endingEnd=t?this.zeroSlopeAtEnd?2401:2400:2402)},_scheduleFading:function(e,t,i){var r=this._mixer,n=r.time,a=this._weightInterpolant;return null===a&&(this._weightInterpolant=a=r._lendControlInterpolant()),r=a.parameterPositions,a=a.sampleValues,r[0]=n,a[0]=t,r[1]=n+e,a[1]=i,this}}),$n.prototype=Object.assign(Object.create(t.prototype),{constructor:$n,_bindAction:function(e,t){var i=e._localRoot||this._root,r=e._clip.tracks,n=r.length,a=e._propertyBindings;e=e._interpolants;var o=i.uuid,s=this._bindingsByRootAndName,l=s[o];for(void 0===l&&(l={},s[o]=l),s=0;s!==n;++s){var c=r[s],h=c.name,u=l[h];if(void 0===u){if(void 0!==(u=a[s])){null===u._cacheIndex&&(++u.referenceCount,this._addInactiveBinding(u,o,h));continue}++(u=new Hn(qn.create(i,h,t&&t._propertyBindings[s].binding.parsedPath),c.ValueTypeName,c.getValueSize())).referenceCount,this._addInactiveBinding(u,o,h)}a[s]=u,e[s].resultBuffer=u.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,i=e._clip.uuid,r=this._actionsByClip[i];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,i,t)}for(i=0,r=(t=e._propertyBindings).length;i!==r;++i){var n=t[i];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,i=0,r=t.length;i!==r;++i){var n=t[i];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){return null!==(e=e._cacheIndex)&&e<this._nActiveActions},_addInactiveAction:function(e,t,i){var r=this._actions,n=this._actionsByClip,a=n[t];void 0===a?(a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,n[t]=a):(t=a.knownActions,e._byClipCacheIndex=t.length,t.push(e)),e._cacheIndex=r.length,r.push(e),a.actionByRoot[i]=e},_removeInactiveAction:function(e){var t=this._actions,i=t[t.length-1],r=e._cacheIndex;i._cacheIndex=r,t[r]=i,t.pop(),e._cacheIndex=null,t=e._clip.uuid;var n=(r=(i=this._actionsByClip)[t]).knownActions,a=n[n.length-1],o=e._byClipCacheIndex;a._byClipCacheIndex=o,n[o]=a,n.pop(),e._byClipCacheIndex=null,delete r.actionByRoot[(e._localRoot||this._root).uuid],0===n.length&&delete i[t],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=0,i=(e=e._propertyBindings).length;t!==i;++t){var r=e[t];0==--r.referenceCount&&this._removeInactiveBinding(r)}},_lendAction:function(e){var t=this._actions,i=e._cacheIndex,r=this._nActiveActions++,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n},_takeBackAction:function(e){var t=this._actions,i=e._cacheIndex,r=--this._nActiveActions,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n},_addInactiveBinding:function(e,t,i){var r=this._bindingsByRootAndName,n=r[t],a=this._bindings;void 0===n&&(n={},r[t]=n),n[i]=e,e._cacheIndex=a.length,a.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,i=e.binding,r=i.rootNode.uuid;i=i.path;var n=this._bindingsByRootAndName,a=n[r],o=t[t.length-1];e=e._cacheIndex,o._cacheIndex=e,t[e]=o,t.pop(),delete a[i],0===Object.keys(a).length&&delete n[r]},_lendBinding:function(e){var t=this._bindings,i=e._cacheIndex,r=this._nActiveBindings++,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n},_takeBackBinding:function(e){var t=this._bindings,i=e._cacheIndex,r=--this._nActiveBindings,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,i=e[t];return void 0===i&&((i=new Er(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=i),i},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,i=e.__cacheIndex,r=--this._nActiveControlInterpolants,n=t[r];e.__cacheIndex=r,t[r]=e,n.__cacheIndex=i,t[i]=n},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t,i){var r=t||this._root,n=r.uuid;e=null!==(r="string"==typeof e?Or.findByName(r,e):e)?r.uuid:e;var a=this._actionsByClip[e],o=null;if(void 0===i&&(i=null!==r?r.blendMode:2500),void 0!==a){if(void 0!==(o=a.actionByRoot[n])&&o.blendMode===i)return o;o=a.knownActions[0],null===r&&(r=o._clip)}return null===r?null:(t=new Xn(this,r,t,i),this._bindAction(t,o),this._addInactiveAction(t,e,n),t)},existingAction:function(e,t){var i=t||this._root;return t=i.uuid,i="string"==typeof e?Or.findByName(i,e):e,void 0!==(e=this._actionsByClip[i?i.uuid:e])&&e.actionByRoot[t]||null},stopAllAction:function(){for(var e=this._actions,t=this._nActiveActions-1;0<=t;--t)e[t].stop();return this},update:function(e){e*=this.timeScale;for(var t=this._actions,i=this._nActiveActions,r=this.time+=e,n=Math.sign(e),a=this._accuIndex^=1,o=0;o!==i;++o)t[o]._update(r,e,n,a);for(e=this._bindings,t=this._nActiveBindings,o=0;o!==t;++o)e[o].apply(a);return this},setTime:function(e){for(var t=this.time=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions;e=e.uuid;var i=this._actionsByClip,r=i[e];if(void 0!==r){for(var n=0,a=(r=r.knownActions).length;n!==a;++n){var o=r[n];this._deactivateAction(o);var s=o._cacheIndex,l=t[t.length-1];o._cacheIndex=null,o._byClipCacheIndex=null,l._cacheIndex=s,t[s]=l,t.pop(),this._removeInactiveBindingsForAction(o)}delete i[e]}},uncacheRoot:function(e){e=e.uuid;var t=this._actionsByClip;for(r in t){var i=t[r].actionByRoot[e];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}var r=this._bindingsByRootAndName[e];if(void 0!==r)for(var n in r)(e=r[n]).restoreOriginalState(),this._removeInactiveBinding(e)},uncacheAction:function(e,t){null!==(e=this.existingAction(e,t))&&(this._deactivateAction(e),this._removeInactiveAction(e))}}),Yn.prototype.clone=function(){return new Yn(void 0===this.value.clone?this.value:this.value.clone())},Jn.prototype=Object.assign(Object.create(Ut.prototype),{constructor:Jn,isInstancedInterleavedBuffer:!0,copy:function(e){return Ut.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign(Kn.prototype,{set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t,i){return ea(e,this,i=i||[],t),i.sort(Qn),i},intersectObjects:function(e,t,i){if(i=i||[],!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),i;for(var r=0,n=e.length;r<n;r++)ea(e[r],this,i,t);return i.sort(Qn),i}}),Object.assign(ta.prototype,{set:function(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),0===this.radius?this.phi=this.theta=0:(this.theta=Math.atan2(e,i),this.phi=Math.acos(Ia.clamp(t/this.radius,-1,1))),this}}),Object.assign(ia.prototype,{set:function(e,t,i){return this.radius=e,this.theta=t,this.y=i,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,i){return this.radius=Math.sqrt(e*e+i*i),this.theta=Math.atan2(e,i),this.y=t,this}});var uc=new i;Object.assign(ra.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){return t=uc.copy(t).multiplyScalar(.5),this.min.copy(e).sub(t),this.max.copy(e).add(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new i),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new i),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new i),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new i),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return uc.copy(e).clamp(this.min,this.max).sub(e).length()},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var dc=new c,pc=new c;Object.assign(na.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new c),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new c),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new c),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(e,t){return dc.subVectors(e,this.start),pc.subVectors(this.end,this.start),e=pc.dot(pc),e=pc.dot(dc)/e,t&&(e=Ia.clamp(e,0,1)),e},closestPointToPoint:function(e,t,i){return e=this.closestPointToPointParameter(e,t),void 0===i&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),i=new c),this.delta(i).multiplyScalar(e).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),aa.prototype=Object.create(p.prototype),aa.prototype.constructor=aa,aa.prototype.isImmediateRenderObject=!0;var fc=new c;oa.prototype=Object.create(p.prototype),oa.prototype.constructor=oa,oa.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},oa.prototype.update=function(){this.light.updateMatrixWorld();var e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),fc.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(fc),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)};var mc=new c,gc=new h,yc=new h;la.prototype=Object.create(Kt.prototype),la.prototype.constructor=la,la.prototype.isSkeletonHelper=!0,la.prototype.updateMatrixWorld=function(e){var t=this.bones,i=this.geometry,r=i.getAttribute("position");yc.getInverse(this.root.matrixWorld);for(var n=0,a=0;n<t.length;n++){var o=t[n];o.parent&&o.parent.isBone&&(gc.multiplyMatrices(yc,o.matrixWorld),mc.setFromMatrixPosition(gc),r.setXYZ(a,mc.x,mc.y,mc.z),gc.multiplyMatrices(yc,o.parent.matrixWorld),mc.setFromMatrixPosition(gc),r.setXYZ(a+1,mc.x,mc.y,mc.z),a+=2)}i.getAttribute("position").needsUpdate=!0,p.prototype.updateMatrixWorld.call(this,e)},ca.prototype=Object.create(j.prototype),ca.prototype.constructor=ca,ca.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},ca.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)};var vc=new c,_c=new b,xc=new b;ha.prototype=Object.create(p.prototype),ha.prototype.constructor=ha,ha.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},ha.prototype.update=function(){var e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var t=e.geometry.getAttribute("color");_c.copy(this.light.color),xc.copy(this.light.groundColor);for(var i=0,r=t.count;i<r;i++){var n=i<r/2?_c:xc;t.setXYZ(i,n.r,n.g,n.b)}t.needsUpdate=!0}e.lookAt(vc.setFromMatrixPosition(this.light.matrixWorld).negate())},ua.prototype=Object.assign(Object.create(Kt.prototype),{constructor:ua,copy:function(e){return Kt.prototype.copy.call(this,e),this.geometry.copy(e.geometry),this.material.copy(e.material),this},clone:function(){return(new this.constructor).copy(this)}}),da.prototype=Object.create(Kt.prototype),da.prototype.constructor=da;var bc=new c,wc=new c,Mc=new c;pa.prototype=Object.create(p.prototype),pa.prototype.constructor=pa,pa.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},pa.prototype.update=function(){bc.setFromMatrixPosition(this.light.matrixWorld),wc.setFromMatrixPosition(this.light.target.matrixWorld),Mc.subVectors(wc,bc),this.lightPlane.lookAt(wc),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(wc),this.targetLine.scale.z=Mc.length()};var Tc=new c,Sc=new X;fa.prototype=Object.create(Kt.prototype),fa.prototype.constructor=fa,fa.prototype.update=function(){var e=this.geometry,t=this.pointMap;Sc.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),ma("c",t,e,Sc,0,0,-1),ma("t",t,e,Sc,0,0,1),ma("n1",t,e,Sc,-1,-1,-1),ma("n2",t,e,Sc,1,-1,-1),ma("n3",t,e,Sc,-1,1,-1),ma("n4",t,e,Sc,1,1,-1),ma("f1",t,e,Sc,-1,-1,1),ma("f2",t,e,Sc,1,-1,1),ma("f3",t,e,Sc,-1,1,1),ma("f4",t,e,Sc,1,1,1),ma("u1",t,e,Sc,.7,1.1,-1),ma("u2",t,e,Sc,-.7,1.1,-1),ma("u3",t,e,Sc,0,2,-1),ma("cf1",t,e,Sc,-1,0,1),ma("cf2",t,e,Sc,1,0,1),ma("cf3",t,e,Sc,0,-1,1),ma("cf4",t,e,Sc,0,1,1),ma("cn1",t,e,Sc,-1,0,-1),ma("cn2",t,e,Sc,1,0,-1),ma("cn3",t,e,Sc,0,-1,-1),ma("cn4",t,e,Sc,0,1,-1),e.getAttribute("position").needsUpdate=!0};var Ec=new m;ga.prototype=Object.create(Kt.prototype),ga.prototype.constructor=ga,ga.prototype.update=function(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Ec.setFromObject(this.object),!Ec.isEmpty()){e=Ec.min;var t=Ec.max,i=this.geometry.attributes.position,r=i.array;r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=e.x,r[4]=t.y,r[5]=t.z,r[6]=e.x,r[7]=e.y,r[8]=t.z,r[9]=t.x,r[10]=e.y,r[11]=t.z,r[12]=t.x,r[13]=t.y,r[14]=e.z,r[15]=e.x,r[16]=t.y,r[17]=e.z,r[18]=e.x,r[19]=e.y,r[20]=e.z,r[21]=t.x,r[22]=e.y,r[23]=e.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}},ga.prototype.setFromObject=function(e){return this.object=e,this.update(),this},ga.prototype.copy=function(e){return Kt.prototype.copy.call(this,e),this.object=e.object,this},ga.prototype.clone=function(){return(new this.constructor).copy(this)},ya.prototype=Object.create(Kt.prototype),ya.prototype=Object.assign(Object.create(Kt.prototype),{constructor:ya,copy:function(e){return Kt.prototype.copy.call(this,e),this.box=e.box.clone(),this}}),ya.prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),p.prototype.updateMatrixWorld.call(this,e))},va.prototype=Object.create(Jt.prototype),va.prototype.constructor=va,va.prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;1e-8>Math.abs(t)&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=0>t?1:0,this.lookAt(this.plane.normal),p.prototype.updateMatrixWorld.call(this,e)};var Ac,Cc,Lc=new c;_a.prototype=Object.create(p.prototype),_a.prototype.constructor=_a,_a.prototype.setDirection=function(e){.99999<e.y?this.quaternion.set(0,0,0,1):-.99999>e.y?this.quaternion.set(1,0,0,0):(Lc.set(e.z,0,-e.x).normalize(),this.quaternion.setFromAxisAngle(Lc,Math.acos(e.y)))},_a.prototype.setLength=function(e,t,i){void 0===t&&(t=.2*e),void 0===i&&(i=.2*t),this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()},_a.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},_a.prototype.copy=function(e){return p.prototype.copy.call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this},_a.prototype.clone=function(){return(new this.constructor).copy(this)},xa.prototype=Object.create(Kt.prototype),xa.prototype.constructor=xa;var Pc=Math.pow(2,8),Ic=[.125,.215,.35,.446,.526,.582],Rc=5+Ic.length,Dc={3e3:0,3001:1,3002:2,3004:3,3005:4,3006:5,3007:6},kc=new _n,zc=function(){for(var e=[],t=[],i=[],r=8,n=0;n<Rc;n++){var a=Math.pow(2,r);t.push(a);var o=1/a;4<n?o=Ic[n-8+4-1]:0==n&&(o=0),i.push(o);var s=[a=-(o=1/(a-1))/2,a,o=1+o/2,a,o,o,a,a,o,o,a,o];a=new Float32Array(108),o=new Float32Array(72);for(var l=new Float32Array(36),c=0;6>c;c++){var h=c%3*2/3-1,u=2<c?0:-1;a.set([h,u,0,h+2/3,u,0,h+2/3,u+1,0,h,u,0,h+2/3,u+1,0,h,u+1,0],18*c),o.set(s,12*c),l.set([c,c,c,c,c,c],6*c)}(s=new U).setAttribute("position",new C(a,3)),s.setAttribute("uv",new C(o,2)),s.setAttribute("faceIndex",new C(l,1)),e.push(s),4<r&&r--}return{_lodPlanes:e,_sizeLods:t,_sigmas:i}}(),Oc=zc._lodPlanes,Bc=zc._sizeLods,Fc=zc._sigmas,Nc=null,Uc=(1+Math.sqrt(5))/2,jc=1/Uc,Vc=[new c(1,1,1),new c(-1,1,1),new c(1,1,-1),new c(-1,1,-1),new c(0,Uc,jc),new c(0,Uc,-jc),new c(jc,0,Uc),new c(-jc,0,Uc),new c(Uc,jc,0),new c(-Uc,jc,0)];ba.prototype={constructor:ba,fromScene:function(e,t,i,r){void 0===t&&(t=0),void 0===i&&(i=.1),void 0===r&&(r=100),Nc=this._renderer.getRenderTarget();var n=this._allocateTargets();return this._sceneToCubeUV(e,i,r,n),0<t&&this._blur(n,0,0,t),this._applyPMREM(n),this._cleanup(n),n},fromEquirectangular:function(e){return e.magFilter=1003,e.minFilter=1003,e.generateMipmaps=!1,this.fromCubemap(e)},fromCubemap:function(e){Nc=this._renderer.getRenderTarget();var t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t},compileCubemapShader:function(){null===this._cubemapShader&&(this._cubemapShader=Sa(),this._compileMaterial(this._cubemapShader))},compileEquirectangularShader:function(){null===this._equirectShader&&(this._equirectShader=Ta(),this._compileMaterial(this._equirectShader))},dispose:function(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(var e=0;e<Oc.length;e++)Oc[e].dispose()},_cleanup:function(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(Nc),e.scissorTest=!1,e.setSize(e.width,e.height)},_allocateTargets:function(e){var t=void 0!==e&&1009===e.type&&(3e3===e.encoding||3001===e.encoding||3007===e.encoding),i=wa(t={magFilter:1003,minFilter:1003,generateMipmaps:!1,type:1009,format:1023,encoding:t?e.encoding:3002,depthBuffer:!1,stencilBuffer:!1});return i.depthBuffer=!e,this._pingPongRenderTarget=wa(t),i},_compileMaterial:function(e){e=new j(Oc[0],e),this._renderer.compile(e,kc)},_sceneToCubeUV:function(e,t,i,r){t=new $(90,1,t,i),i=[1,-1,1,1,1,1];var n=[1,1,1,-1,-1,-1],a=this._renderer,o=a.outputEncoding,s=a.toneMapping,l=a.toneMappingExposure,c=a.getClearColor(),h=a.getClearAlpha();a.toneMapping=1,a.toneMappingExposure=1,a.outputEncoding=3e3;var u=e.background;if(u&&u.isColor){u.convertSRGBToLinear();var d=Math.min(Math.max(Math.ceil(Math.log2(Math.max(u.r,u.g,u.b))),-128),127);u=u.multiplyScalar(Math.pow(2,-d)),a.setClearColor(u,(d+128)/255),e.background=null}for(u=0;6>u;u++)0==(d=u%3)?(t.up.set(0,i[u],0),t.lookAt(n[u],0,0)):1==d?(t.up.set(0,0,i[u]),t.lookAt(0,n[u],0)):(t.up.set(0,i[u],0),t.lookAt(0,0,n[u])),Ma(r,d*Pc,2<u?Pc:0,Pc,Pc),a.setRenderTarget(r),a.render(e,t);a.toneMapping=s,a.toneMappingExposure=l,a.outputEncoding=o,a.setClearColor(c,h)},_textureToCubeUV:function(e,t){var i=this._renderer;e.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=Sa()):null==this._equirectShader&&(this._equirectShader=Ta());var r=e.isCubeTexture?this._cubemapShader:this._equirectShader,n=new j(Oc[0],r);(r=r.uniforms).envMap.value=e,e.isCubeTexture||r.texelSize.value.set(1/e.image.width,1/e.image.height),r.inputEncoding.value=Dc[e.encoding],r.outputEncoding.value=Dc[t.texture.encoding],Ma(t,0,0,3*Pc,2*Pc),i.setRenderTarget(t),i.render(n,kc)},_applyPMREM:function(e){var t=this._renderer,i=t.autoClear;t.autoClear=!1;for(var r=1;r<Rc;r++)this._blur(e,r-1,r,Math.sqrt(Fc[r]*Fc[r]-Fc[r-1]*Fc[r-1]),Vc[(r-1)%Vc.length]);t.autoClear=i},_blur:function(e,t,i,r,n){var a=this._pingPongRenderTarget;this._halfBlur(e,a,t,i,r,"latitudinal",n),this._halfBlur(a,e,i,i,r,"longitudinal",n)},_halfBlur:function(e,t,i,r,n,a,o){var s=this._renderer,l=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");var c=new j(Oc[r],l);l=l.uniforms;var h=Bc[i]-1,u=n/(h=isFinite(n)?Math.PI/(2*h):2*Math.PI/39),d=isFinite(n)?1+Math.floor(3*u):20;20<d&&console.warn("sigmaRadians, "+n+", is too large and will clip, as it requested "+d+" samples when the maximum is set to 20"),n=[];for(var p=0,f=0;20>f;++f){var m=f/u;m=Math.exp(-m*m/2),n.push(m),0==f?p+=m:f<d&&(p+=2*m)}for(f=0;f<n.length;f++)n[f]/=p;l.envMap.value=e.texture,l.samples.value=d,l.weights.value=n,l.latitudinal.value="latitudinal"===a,o&&(l.poleAxis.value=o),l.dTheta.value=h,l.mipInt.value=8-i,l.inputEncoding.value=Dc[e.texture.encoding],l.outputEncoding.value=Dc[e.texture.encoding],e=Bc[r],Ma(t,m=3*Math.max(0,Pc-2*e),(0===r?0:2*Pc)+2*e*(4<r?r-8+4:0),3*e,2*e),s.setRenderTarget(t),s.render(c,kc)}},Zr.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Zr.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign(cn.prototype,{createPointsGeometry:function(e){return console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead."),e=this.getPoints(e),this.createGeometry(e)},createSpacedPointsGeometry:function(e){return console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead."),e=this.getSpacedPoints(e),this.createGeometry(e)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var t=new H,i=0,r=e.length;i<r;i++){var n=e[i];t.vertices.push(new c(n.x,n.y,n.z||0))}return t}}),Object.assign(hn.prototype,{fromPoints:function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),Ea.prototype=Object.create(Jr.prototype),Aa.prototype=Object.create(Jr.prototype),Ca.prototype=Object.create(Jr.prototype),Object.assign(Ca.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),ua.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},la.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(Nr.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Ul.extractUrlBase(e)}}),Nr.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(Pn.prototype,{setTexturePath:function(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}),Object.assign(ra.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(m.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(y.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}}),Q.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},na.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(Ia,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Ia.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Ia.ceilPowerOfTwo(e)}}),Object.assign(r.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(h.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new c).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,i,r,n,a){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,r,i,n,a)}}),_.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},l.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(v.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(x.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(x,{barycoordFromPoint:function(e,t,i,r,n){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),x.getBarycoord(e,t,i,r,n)},normal:function(e,t,i,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),x.getNormal(e,t,i,r)}}),Object.assign(un.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Zi(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new nr(this,e)}}),Object.assign(i.prototype,{fromAttribute:function(e,t,i){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(c.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,i){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(a.prototype,{fromAttribute:function(e,t,i){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(H.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.assign(p.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(p.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(j.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(j.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(Wt.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(Zt.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),qt.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Zr.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),$.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(dn.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(C.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),35048===this.usage},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(35048)}}}),Object.assign(C.prototype,{setDynamic:function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?35048:35044),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(U.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addAttribute:function(e,t,i){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new C(t,i)))},addDrawCall:function(e,t,i){void 0!==i&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},applyMatrix:function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(U.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(An.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(e){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=e}}}),Object.defineProperties(Kn.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(e){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=e}}}),Object.defineProperties(Ut.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),35048===this.usage},set:function(e){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(e)}}}),Object.assign(Ut.prototype,{setDynamic:function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?35048:35044),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(Xi.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(Yn.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(E.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new b}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}}}),Object.defineProperties(vr.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(Z.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(Bt.prototype,{clearTarget:function(e,t,i,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,i,r)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(Bt.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?3001:3e3}}}),Object.defineProperties(Ct.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(o.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties(jn.prototype,{load:{value:function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return(new zn).load(e,(function(e){t.setBuffer(e)})),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),Gn.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Y.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},Da.crossOrigin=void 0,Da.loadTexture=function(e,t,i,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var n=new qr;return n.setCrossOrigin(this.crossOrigin),e=n.load(e,i,void 0,r),t&&(e.mapping=t),e},Da.loadTextureCube=function(e,t,i,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var n=new Wr;return n.setCrossOrigin(this.crossOrigin),e=n.load(e,i,void 0,r),t&&(e.mapping=t),e},Da.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Da.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"117"}})),e.ACESFilmicToneMapping=5,e.AddEquation=100,e.AddOperation=2,e.AdditiveAnimationBlendMode=2501,e.AdditiveBlending=2,e.AlphaFormat=1021,e.AlwaysDepth=1,e.AlwaysStencilFunc=519,e.AmbientLight=wn,e.AmbientLightProbe=Bn,e.AnimationClip=Or,e.AnimationLoader=jr,e.AnimationMixer=$n,e.AnimationObjectGroup=Zn,e.AnimationUtils=Il,e.ArcCurve=$r,e.ArrayCamera=Rt,e.ArrowHelper=_a,e.Audio=jn,e.AudioAnalyser=Gn,e.AudioContext=ql,e.AudioListener=Un,e.AudioLoader=zn,e.AxesHelper=xa,e.AxisHelper=function(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new xa(e)},e.BackSide=1,e.BasicDepthPacking=3200,e.BasicShadowMap=0,e.BinaryTextureLoader=function(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Gr(e)},e.Bone=Xt,e.BooleanKeyframeTrack=Lr,e.BoundingBoxHelper=function(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new ga(e,t)},e.Box2=ra,e.Box3=m,e.Box3Helper=ya,e.BoxBufferGeometry=xs,e.BoxGeometry=_s,e.BoxHelper=ga,e.BufferAttribute=C,e.BufferGeometry=U,e.BufferGeometryLoader=Ln,e.ByteType=1010,e.Cache=Rl,e.Camera=X,e.CameraHelper=fa,e.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been removed")},e.CanvasTexture=ai,e.CatmullRomCurve3=Jr,e.CineonToneMapping=4,e.CircleBufferGeometry=pr,e.CircleGeometry=dr,e.ClampToEdgeWrapping=1001,e.Clock=Nn,e.ClosedSplineCurve3=Ea,e.Color=b,e.ColorKeyframeTrack=Pr,e.CompressedTexture=ni,e.CompressedTextureLoader=Vr,e.ConeBufferGeometry=ur,e.ConeGeometry=hr,e.CubeCamera=Y,e.CubeGeometry=_s,e.CubeReflectionMapping=301,e.CubeRefractionMapping=302,e.CubeTexture=me,e.CubeTextureLoader=Wr,e.CubeUVReflectionMapping=306,e.CubeUVRefractionMapping=307,e.CubicBezierCurve=tn,e.CubicBezierCurve3=rn,e.CubicInterpolant=Sr,e.CullFaceBack=1,e.CullFaceFront=2,e.CullFaceFrontBack=3,e.CullFaceNone=0,e.Curve=Zr,e.CurvePath=cn,e.CustomBlending=5,e.CylinderBufferGeometry=cr,e.CylinderGeometry=lr,e.Cylindrical=ia,e.DataTexture=K,e.DataTexture2DArray=ge,e.DataTexture3D=ye,e.DataTextureLoader=Gr,e.DecrementStencilOp=7683,e.DecrementWrapStencilOp=34056,e.DefaultLoadingManager=Dl,e.DepthFormat=1026,e.DepthStencilFormat=1027,e.DepthTexture=oi,e.DirectionalLight=bn,e.DirectionalLightHelper=pa,e.DirectionalLightShadow=xn,e.DiscreteInterpolant=Ar,e.DodecahedronBufferGeometry=_i,e.DodecahedronGeometry=vi,e.DoubleSide=2,e.DstAlphaFactor=206,e.DstColorFactor=208,e.DynamicBufferAttribute=function(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new C(e,t).setUsage(35048)},e.DynamicCopyUsage=35050,e.DynamicDrawUsage=35048,e.DynamicReadUsage=35049,e.EdgesGeometry=sr,e.EdgesHelper=function(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Kt(new sr(e.geometry),new Yt({color:void 0!==t?t:16777215}))},e.EllipseCurve=Xr,e.EqualDepth=4,e.EqualStencilFunc=514,e.EquirectangularReflectionMapping=303,e.EquirectangularRefractionMapping=304,e.Euler=u,e.EventDispatcher=t,e.ExtrudeBufferGeometry=Xi,e.ExtrudeGeometry=Zi,e.Face3=S,e.Face4=function(e,t,i,r,n,a,o){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new S(e,t,i,n,a,o)},e.FaceColors=1,e.FileLoader=Ur,e.FlatShading=1,e.Float32Attribute=function(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new O(e,t)},e.Float32BufferAttribute=O,e.Float64Attribute=function(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new B(e,t)},e.Float64BufferAttribute=B,e.FloatType=1015,e.Fog=Nt,e.FogExp2=Ft,e.Font=Dn,e.FontLoader=kn,e.FrontFaceDirectionCCW=1,e.FrontFaceDirectionCW=0,e.FrontSide=0,e.Frustum=Q,e.GammaEncoding=3007,e.Geometry=H,e.GeometryUtils={merge:function(e,t,i){if(console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t.isMesh){t.matrixAutoUpdate&&t.updateMatrix();var r=t.matrix;t=t.geometry}e.merge(t,r,i)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}},e.GreaterDepth=6,e.GreaterEqualDepth=5,e.GreaterEqualStencilFunc=518,e.GreaterStencilFunc=516,e.GridHelper=ua,e.Group=Dt,e.HalfFloatType=1016,e.HemisphereLight=pn,e.HemisphereLightHelper=ha,e.HemisphereLightProbe=On,e.IcosahedronBufferGeometry=yi,e.IcosahedronGeometry=gi,e.ImageBitmapLoader=In,e.ImageLoader=Hr,e.ImageUtils=Da,e.ImmediateRenderObject=aa,e.IncrementStencilOp=7682,e.IncrementWrapStencilOp=34055,e.InstancedBufferAttribute=Cn,e.InstancedBufferGeometry=An,e.InstancedInterleavedBuffer=Jn,e.InstancedMesh=$t,e.Int16Attribute=function(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new R(e,t)},e.Int16BufferAttribute=R,e.Int32Attribute=function(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new k(e,t)},e.Int32BufferAttribute=k,e.Int8Attribute=function(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new L(e,t)},e.Int8BufferAttribute=L,e.IntType=1013,e.InterleavedBuffer=Ut,e.InterleavedBufferAttribute=jt,e.Interpolant=Tr,e.InterpolateDiscrete=2300,e.InterpolateLinear=2301,e.InterpolateSmooth=2302,e.InvertStencilOp=5386,e.JSONLoader=function(){console.error("THREE.JSONLoader has been removed.")},e.KeepStencilOp=7680,e.KeyframeTrack=Cr,e.LOD=Wt,e.LatheBufferGeometry=rr,e.LatheGeometry=ir,e.Layers=d,e.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")},e.LessDepth=2,e.LessEqualDepth=3,e.LessEqualStencilFunc=515,e.LessStencilFunc=513,e.Light=dn,e.LightProbe=Sn,e.LightShadow=fn,e.Line=Jt,e.Line3=na,e.LineBasicMaterial=Yt,e.LineCurve=nn,e.LineCurve3=an,e.LineDashedMaterial=Mr,e.LineLoop=Qt,e.LinePieces=1,e.LineSegments=Kt,e.LineStrip=0,e.LinearEncoding=3e3,e.LinearFilter=1006,e.LinearInterpolant=Er,e.LinearMipMapLinearFilter=1008,e.LinearMipMapNearestFilter=1007,e.LinearMipmapLinearFilter=1008,e.LinearMipmapNearestFilter=1007,e.LinearToneMapping=1,e.Loader=Nr,e.LoaderUtils=Ul,e.LoadingManager=Fr,e.LogLuvEncoding=3003,e.LoopOnce=2200,e.LoopPingPong=2202,e.LoopRepeat=2201,e.LuminanceAlphaFormat=1025,e.LuminanceFormat=1024,e.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},e.Material=E,e.MaterialLoader=En,e.Math=Ia,e.MathUtils=Ia,e.Matrix3=r,e.Matrix4=h,e.MaxEquation=104,e.Mesh=j,e.MeshBasicMaterial=A,e.MeshDepthMaterial=Et,e.MeshDistanceMaterial=At,e.MeshFaceMaterial=function(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e},e.MeshLambertMaterial=br,e.MeshMatcapMaterial=wr,e.MeshNormalMaterial=xr,e.MeshPhongMaterial=vr,e.MeshPhysicalMaterial=yr,e.MeshStandardMaterial=gr,e.MeshToonMaterial=_r,e.MinEquation=103,e.MirroredRepeatWrapping=1002,e.MixOperation=1,e.MultiMaterial=function(e){return void 0===e&&(e=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e},e.MultiplyBlending=4,e.MultiplyOperation=0,e.NearestFilter=1003,e.NearestMipMapLinearFilter=1005,e.NearestMipMapNearestFilter=1004,e.NearestMipmapLinearFilter=1005,e.NearestMipmapNearestFilter=1004,e.NeverDepth=0,e.NeverStencilFunc=512,e.NoBlending=0,e.NoColors=0,e.NoToneMapping=0,e.NormalAnimationBlendMode=2500,e.NormalBlending=1,e.NotEqualDepth=7,e.NotEqualStencilFunc=517,e.NumberKeyframeTrack=Ir,e.Object3D=p,e.ObjectLoader=Pn,e.ObjectSpaceNormalMap=1,e.OctahedronBufferGeometry=mi,e.OctahedronGeometry=fi,e.OneFactor=201,e.OneMinusDstAlphaFactor=207,e.OneMinusDstColorFactor=209,e.OneMinusSrcAlphaFactor=205,e.OneMinusSrcColorFactor=203,e.OrthographicCamera=_n,e.PCFShadowMap=1,e.PCFSoftShadowMap=2,e.PMREMGenerator=ba,e.ParametricBufferGeometry=ci,e.ParametricGeometry=li,e.Particle=function(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Gt(e)},e.ParticleBasicMaterial=function(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new ei(e)},e.ParticleSystem=function(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new ti(e,t)},e.ParticleSystemMaterial=function(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new ei(e)},e.Path=hn,e.PerspectiveCamera=$,e.Plane=_,e.PlaneBufferGeometry=re,e.PlaneGeometry=ie,e.PlaneHelper=va,e.PointCloud=function(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new ti(e,t)},e.PointCloudMaterial=function(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new ei(e)},e.PointLight=vn,e.PointLightHelper=ca,e.Points=ti,e.PointsMaterial=ei,e.PolarGridHelper=da,e.PolyhedronBufferGeometry=ui,e.PolyhedronGeometry=hi,e.PositionalAudio=Vn,e.PropertyBinding=qn,e.PropertyMixer=Hn,e.QuadraticBezierCurve=on,e.QuadraticBezierCurve3=sn,e.Quaternion=l,e.QuaternionKeyframeTrack=Dr,e.QuaternionLinearInterpolant=Rr,e.REVISION="117",e.RGBADepthPacking=3201,e.RGBAFormat=1023,e.RGBAIntegerFormat=1033,e.RGBA_ASTC_10x10_Format=37819,e.RGBA_ASTC_10x5_Format=37816,e.RGBA_ASTC_10x6_Format=37817,e.RGBA_ASTC_10x8_Format=37818,e.RGBA_ASTC_12x10_Format=37820,e.RGBA_ASTC_12x12_Format=37821,e.RGBA_ASTC_4x4_Format=37808,e.RGBA_ASTC_5x4_Format=37809,e.RGBA_ASTC_5x5_Format=37810,e.RGBA_ASTC_6x5_Format=37811,e.RGBA_ASTC_6x6_Format=37812,e.RGBA_ASTC_8x5_Format=37813,e.RGBA_ASTC_8x6_Format=37814,e.RGBA_ASTC_8x8_Format=37815,e.RGBA_BPTC_Format=36492,e.RGBA_ETC2_EAC_Format=37496,e.RGBA_PVRTC_2BPPV1_Format=35843,e.RGBA_PVRTC_4BPPV1_Format=35842,e.RGBA_S3TC_DXT1_Format=33777,e.RGBA_S3TC_DXT3_Format=33778,e.RGBA_S3TC_DXT5_Format=33779,e.RGBDEncoding=3006,e.RGBEEncoding=3002,e.RGBEFormat=1023,e.RGBFormat=1022,e.RGBIntegerFormat=1032,e.RGBM16Encoding=3005,e.RGBM7Encoding=3004,e.RGB_ETC1_Format=36196,e.RGB_ETC2_Format=37492,e.RGB_PVRTC_2BPPV1_Format=35841,e.RGB_PVRTC_4BPPV1_Format=35840,e.RGB_S3TC_DXT1_Format=33776,e.RGFormat=1030,e.RGIntegerFormat=1031,e.RawShaderMaterial=mr,e.Ray=v,e.Raycaster=Kn,e.RectAreaLight=Mn,e.RedFormat=1028,e.RedIntegerFormat=1029,e.ReinhardToneMapping=2,e.RepeatWrapping=1e3,e.ReplaceStencilOp=7681,e.ReverseSubtractEquation=102,e.RingBufferGeometry=tr,e.RingGeometry=er,e.SRGB8_ALPHA8_ASTC_10x10_Format=37851,e.SRGB8_ALPHA8_ASTC_10x5_Format=37848,e.SRGB8_ALPHA8_ASTC_10x6_Format=37849,e.SRGB8_ALPHA8_ASTC_10x8_Format=37850,e.SRGB8_ALPHA8_ASTC_12x10_Format=37852,e.SRGB8_ALPHA8_ASTC_12x12_Format=37853,e.SRGB8_ALPHA8_ASTC_4x4_Format=37840,e.SRGB8_ALPHA8_ASTC_5x4_Format=37841,e.SRGB8_ALPHA8_ASTC_5x5_Format=37842,e.SRGB8_ALPHA8_ASTC_6x5_Format=37843,e.SRGB8_ALPHA8_ASTC_6x6_Format=37844,e.SRGB8_ALPHA8_ASTC_8x5_Format=37845,e.SRGB8_ALPHA8_ASTC_8x6_Format=37846,e.SRGB8_ALPHA8_ASTC_8x8_Format=37847,e.Scene=f,e.SceneUtils={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}},e.ShaderChunk=Ss,e.ShaderLib=Es,e.ShaderMaterial=Z,e.ShadowMaterial=fr,e.Shape=un,e.ShapeBufferGeometry=ar,e.ShapeGeometry=nr,e.ShapePath=Rn,e.ShapeUtils=Al,e.ShortType=1011,e.Skeleton=Zt,e.SkeletonHelper=la,e.SkinnedMesh=qt,e.SmoothShading=2,e.Sphere=y,e.SphereBufferGeometry=Qi,e.SphereGeometry=Ki,e.Spherical=ta,e.SphericalHarmonics3=Tn,e.SphericalReflectionMapping=305,e.Spline=Ca,e.SplineCurve=ln,e.SplineCurve3=Aa,e.SpotLight=gn,e.SpotLightHelper=oa,e.SpotLightShadow=mn,e.Sprite=Gt,e.SpriteMaterial=Vt,e.SrcAlphaFactor=204,e.SrcAlphaSaturateFactor=210,e.SrcColorFactor=202,e.StaticCopyUsage=35046,e.StaticDrawUsage=35044,e.StaticReadUsage=35045,e.StereoCamera=Fn,e.StreamCopyUsage=35042,e.StreamDrawUsage=35040,e.StreamReadUsage=35041,e.StringKeyframeTrack=kr,e.SubtractEquation=101,e.SubtractiveBlending=3,e.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},e.TangentSpaceNormalMap=0,e.TetrahedronBufferGeometry=pi,e.TetrahedronGeometry=di,e.TextBufferGeometry=Ji,e.TextGeometry=Yi,e.Texture=n,e.TextureLoader=qr,e.TorusBufferGeometry=Si,e.TorusGeometry=Ti,e.TorusKnotBufferGeometry=Mi,e.TorusKnotGeometry=wi,e.Triangle=x,e.TriangleFanDrawMode=2,e.TriangleStripDrawMode=1,e.TrianglesDrawMode=0,e.TubeBufferGeometry=bi,e.TubeGeometry=xi,e.UVMapping=300,e.Uint16Attribute=function(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new D(e,t)},e.Uint16BufferAttribute=D,e.Uint32Attribute=function(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new z(e,t)},e.Uint32BufferAttribute=z,e.Uint8Attribute=function(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new P(e,t)},e.Uint8BufferAttribute=P,e.Uint8ClampedAttribute=function(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new I(e,t)},e.Uint8ClampedBufferAttribute=I,e.Uncharted2ToneMapping=3,e.Uniform=Yn,e.UniformsLib=Ts,e.UniformsUtils=bs,e.UnsignedByteType=1009,e.UnsignedInt248Type=1020,e.UnsignedIntType=1014,e.UnsignedShort4444Type=1017,e.UnsignedShort5551Type=1018,e.UnsignedShort565Type=1019,e.UnsignedShortType=1012,e.VSMShadowMap=3,e.Vector2=i,e.Vector3=c,e.Vector4=a,e.VectorKeyframeTrack=zr,e.Vertex=function(e,t,i){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new c(e,t,i)},e.VertexColors=2,e.VideoTexture=ri,e.WebGLCubeRenderTarget=J,e.WebGLMultisampleRenderTarget=s,e.WebGLRenderTarget=o,e.WebGLRenderTargetCube=function(e,t,i){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new J(e,i)},e.WebGLRenderer=Bt,e.WebGLUtils=It,e.WireframeGeometry=si,e.WireframeHelper=function(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Kt(new si(e.geometry),new Yt({color:void 0!==t?t:16777215}))},e.WrapAroundEnding=2402,e.XHRLoader=function(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new Ur(e)},e.ZeroCurvatureEnding=2400,e.ZeroFactor=200,e.ZeroSlopeEnding=2401,e.ZeroStencilOp=0,e.sRGBEncoding=3001,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof i&&void 0!==t?o(i):(n=[i],void 0===(a="function"==typeof(r=o)?r.apply(i,n):r)||(t.exports=a))},{}],24:[function(e,t,i){const r=1024e3,n=.1/180*Math.PI,a=Math.atan(3/4),o=6371008.8;t.exports={WORLD_SIZE:r,PROJECTION_WORLD_SIZE:r/(o*Math.PI*2),MERCATOR_A:o,DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,EARTH_RADIUS:o,EARTH_CIRCUMFERENCE:2*Math.PI*o,EARTH_CIRCUMFERENCE_EQUATOR:40075017,FOV_ORTHO:n,FOV:a,FOV_DEGREES:180*a/Math.PI,TILE_SIZE:512}},{}],25:[function(e,t,i){var r=e("../utils/utils.js"),n=e("../three.js"),a={material:"MeshBasicMaterial",color:"black",opacity:1};t.exports=function(e){var t;function i(){return new n[a.material]({color:a.color})}return e?(t=(e=r._validate(e,a)).material&&e.material.isMaterial?e.material:e.material||e.color||e.opacity?new n[e.material]({color:e.color,transparent:e.opacity<1}):i()).opacity=e.opacity:t=i(),t}},{"../three.js":23,"../utils/utils.js":27}],26:[function(e,t,i){!function(){"use strict";var e=Math.PI,i=Math.sin,r=Math.cos,n=Math.tan,a=Math.asin,o=Math.atan2,s=Math.acos,l=e/180,c=864e5,h=2440588,u=2451545;function d(e){return e.valueOf()/c-.5+h}function p(e){return new Date((e+.5-h)*c)}function f(e){return d(e)-u}var m=23.4397*l;function g(e,t){return o(i(e)*r(m)-n(t)*i(m),r(e))}function y(e,t){return a(i(t)*r(m)+r(t)*i(m)*i(e))}function v(e,t,a){return o(i(e),r(e)*i(t)-n(a)*r(t))}function _(e,t,n){return a(i(t)*i(n)+r(t)*r(n)*r(e))}function x(e,t){return l*(280.16+360.9856235*e)-t}function b(e){return l*(357.5291+.98560028*e)}function w(t){return t+l*(1.9148*i(t)+.02*i(2*t)+3e-4*i(3*t))+102.9372*l+e}function M(e){var t=w(b(e));return{dec:y(t,0),ra:g(t,0)}}var T={getPosition:function(e,t,i){var r=l*-i,n=l*t,a=f(e),o=M(a),s=x(a,r)-o.ra;return{azimuth:v(s,n,o.dec),altitude:_(s,n,o.dec)}},toJulian:function(e){return d(e)}},S=T.times=[[-.833,"sunrise","sunset"],[-.3,"sunriseEnd","sunsetStart"],[-6,"dawn","dusk"],[-12,"nauticalDawn","nauticalDusk"],[-18,"nightEnd","night"],[6,"goldenHourEnd","goldenHour"]];T.addTime=function(e,t,i){S.push([e,t,i])};var E=9e-4;function A(t,i,r){return E+(t+i)/(2*e)+r}function C(e,t,r){return u+e+.0053*i(t)-.0069*i(2*r)}function L(e,t,n,a,o,l,c){return C(A(function(e,t,n){return s((i(e)-i(t)*i(n))/(r(t)*r(n)))}(e,n,a),t,o),l,c)}function P(e){var t=l*(134.963+13.064993*e),n=l*(93.272+13.22935*e),a=l*(218.316+13.176396*e)+6.289*l*i(t),o=5.128*l*i(n),s=385001-20905*r(t);return{ra:g(a,o),dec:y(a,o),dist:s}}function I(e,t){return new Date(e.valueOf()+t*c/24)}T.getTimes=function(t,i,r,n){var a,o,s,c,h,u=l*-r,d=l*i,m=function(e){return-2.076*Math.sqrt(e)/60}(n=n||0),g=function(t,i){return Math.round(t-E-i/(2*e))}(f(t),u),v=A(0,u,g),_=b(v),x=w(_),M=y(x,0),T=C(v,_,x),P={solarNoon:p(T),nadir:p(T-.5)};for(a=0,o=S.length;a<o;a+=1)h=T-((c=L(((s=S[a])[0]+m)*l,u,d,M,g,_,x))-T),P[s[1]]=p(h),P[s[2]]=p(c);return P},T.getMoonPosition=function(e,t,a){var s=l*-a,c=l*t,h=f(e),u=P(h),d=x(h,s)-u.ra,p=_(d,c,u.dec),m=o(i(d),n(c)*r(u.dec)-i(u.dec)*r(d));return p+=function(e){return e<0&&(e=0),2967e-7/Math.tan(e+.00312536/(e+.08901179))}(p),{azimuth:v(d,c,u.dec),altitude:p,distance:u.dist,parallacticAngle:m}},T.getMoonIllumination=function(e){var t=f(e||new Date),n=M(t),a=P(t),l=149598e3,c=s(i(n.dec)*i(a.dec)+r(n.dec)*r(a.dec)*r(n.ra-a.ra)),h=o(l*i(c),a.dist-l*r(c)),u=o(r(n.dec)*i(n.ra-a.ra),i(n.dec)*r(a.dec)-r(n.dec)*i(a.dec)*r(n.ra-a.ra));return{fraction:(1+r(h))/2,phase:.5+.5*h*(u<0?-1:1)/Math.PI,angle:u}},T.getMoonTimes=function(e,t,i,r){var n=new Date(e);r?n.setUTCHours(0,0,0,0):n.setHours(0,0,0,0);for(var a,o,s,c,h,u,d,p,f,m,g,y,v,_=.133*l,x=T.getMoonPosition(n,t,i).altitude-_,b=1;b<=24&&(a=T.getMoonPosition(I(n,b),t,i).altitude-_,p=((h=(x+(o=T.getMoonPosition(I(n,b+1),t,i).altitude-_))/2-a)*(d=-(u=(o-x)/2)/(2*h))+u)*d+a,m=0,(f=u*u-4*h*a)>=0&&(g=d-(v=Math.sqrt(f)/(2*Math.abs(h))),y=d+v,Math.abs(g)<=1&&m++,Math.abs(y)<=1&&m++,g<-1&&(g=y)),1===m?x<0?s=b+g:c=b+g:2===m&&(s=b+(p<0?y:g),c=b+(p<0?g:y)),!s||!c);b+=2)x=o;var w={};return s&&(w.rise=I(n,s)),c&&(w.set=I(n,c)),s||c||(w[p>0?"alwaysUp":"alwaysDown"]=!0),w},t.exports=T}()},{}],27:[function(e,t,i){var r=e("../three.js"),n=e("./constants.js"),a={prettyPrintMatrix:function(e){for(var t=0;t<4;t++){var i=[e[t],e[t+4],e[t+8],e[t+12]];console.log(i.map((function(e){return e.toFixed(4)})))}},makePerspectiveMatrix:function(e,t,i,n){var a=new r.Matrix4,o=1/Math.tan(e/2),s=1/(i-n),l=[o/t,0,0,0,0,o,0,0,0,0,(n+i)*s,-1,0,0,2*n*i*s,0];return a.elements=l,a},makeOrthographicMatrix:function(e,t,i,n,a,o){var s=new r.Matrix4;const l=1/(t-e),c=1/(i-n),h=1/(o-a);var u=[2*l,0,0,0,0,2*c,0,0,0,0,-1*h,0,-(t+e)*l,-(i+n)*c,-a*h,1];return s.elements=u,s},radify:function(e){function t(e){return e=e||0,2*Math.PI*e/360}return"object"==typeof e?e.length>0?e.map((function(e){return t(e)})):[t(e.x),t(e.y),t(e.z)]:t(e)},degreeify:function(e){function t(e){return 360*(e=e||0)/(2*Math.PI)}return"object"==typeof e?[t(e.x),t(e.y),t(e.z)]:t(e)},projectToWorld:function(e){var t=[-n.MERCATOR_A*n.DEG2RAD*e[0]*n.PROJECTION_WORLD_SIZE,-n.MERCATOR_A*Math.log(Math.tan(.25*Math.PI+.5*n.DEG2RAD*e[1]))*n.PROJECTION_WORLD_SIZE];if(e[2]){var i=this.projectedUnitsPerMeter(e[1]);t.push(e[2]*i)}else t.push(0);return new r.Vector3(t[0],t[1],t[2])},projectedUnitsPerMeter:function(e){return Math.abs(n.WORLD_SIZE/Math.cos(n.DEG2RAD*e)/n.EARTH_CIRCUMFERENCE)},_circumferenceAtLatitude:function(e){return n.EARTH_CIRCUMFERENCE*Math.cos(e*Math.PI/180)},mercatorZfromAltitude:function(e,t){return e/this._circumferenceAtLatitude(t)},_scaleVerticesToMeters:function(e,t){for(var i=this.projectedUnitsPerMeter(e[1]),r=(this.projectToWorld(e),0);r<t.length;r++)t[r].multiplyScalar(i);return t},projectToScreen:function(e){console.log("WARNING: Projecting to screen coordinates is not yet implemented")},unprojectFromScreen:function(e){console.log("WARNING: unproject is not yet implemented")},unprojectFromWorld:function(e){var t=[-e.x/(n.MERCATOR_A*n.DEG2RAD*n.PROJECTION_WORLD_SIZE),2*(Math.atan(Math.exp(e.y/(n.PROJECTION_WORLD_SIZE*-n.MERCATOR_A)))-Math.PI/4)/n.DEG2RAD],i=this.projectedUnitsPerMeter(t[1]),r=e.z||0;return t.push(r/i),t},toScreenPosition:function(e,t){var i=new r.Vector3,n=.5*renderer.context.canvas.width,a=.5*renderer.context.canvas.height;return e.updateMatrixWorld(),i.setFromMatrixPosition(e.matrixWorld),i.project(t),i.x=i.x*n+n,i.y=-i.y*a+a,{x:i.x,y:i.y}},getFeatureCenter:function(e,t,i){let r=[],n=0,a=0,o=0,s=[];return s.push(...e.geometry.coordinates[0]),"Point"===e.geometry.type?r=s[0]:("MultiPolygon"===e.geometry.type&&(s=s[0]),s.splice(-1,1),s.forEach((function(e){n+=e[0],a+=e[1]})),r=[n/s.length,a/s.length]),o=this.getObjectHeightOnFloor(e,t,i),r.length<3?r.push(o):r[2]=o,r},getObjectHeightOnFloor:function(e,t,i=e.properties.level||0){let r=i*(e.properties.levelHeight||0),n=e.properties.base_height||e.properties.min_height||0;return r+((t&&t.model?0:e.properties.height-n)+n)},_flipMaterialSides:function(e){},normalizeVertices(e){var t=new r.Geometry;for(v3 of e)t.vertices.push(v3);t.computeBoundingSphere();var i=t.boundingSphere.center;return t.boundingSphere.radius,{vertices:e.map((function(e){return e.sub(i)})),position:i}},flattenVectors(e){var t=[];for(vertex of e)t.push(vertex.x,vertex.y,vertex.z);return t},lnglatsToWorld:function(e){return e.map((function(e){var t=a.projectToWorld(e);return new r.Vector3(t.x,t.y,t.z)}))},extend:function(e,t){for(let i in t)e[i]=t[i]},clone:function(e){var t={};for(let i in e)t[i]=e[i];return t},clamp:function(e,t,i){return Math.min(i,Math.max(t,e))},types:{rotation:function(e,t){e||(e=0),"number"==typeof e&&(e={z:e});var i=this.applyDefault([e.x,e.y,e.z],t);return a.radify(i)},scale:function(e,t){return e||(e=1),"number"==typeof e?[e,e,e]:this.applyDefault([e.x,e.y,e.z],t)},applyDefault:function(e,t){return e.map((function(e,i){return e||t[i]}))}},toDecimal:function(e,t){return Number(e.toFixed(t))},equal:function(e,t){const i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;if(0==i.length&&0==r.length&&i!==r)return!1;for(const r of i){const i=e[r],n=t[r],a=this.isObject(i)&&this.isObject(n);if(a&&!equal(i,n)||!a&&i!==n)return!1}return!0},isObject:function(e){return null!=e&&"object"==typeof e},_validate:function(e,t){e=e||{};var i={};a.extend(i,e);for(let r of Object.keys(t))if(void 0===e[r]){if(null===t[r])return void console.error(r+" is required");i[r]=t[r]}else i[r]=e[r];return i},Validator:new(e("./validate.js")),exposedMethods:["projectToWorld","projectedUnitsPerMeter","extend","unprojectFromWorld"]};t.exports=a},{"../three.js":23,"./constants.js":24,"./validate.js":28}],28:[function(e,t,i){function r(){}r.prototype={Coords:function(e){if(e.constructor===Array)if(e.length<2)console.error("Coords length must be at least 2");else{for(const t of e)if(t.constructor!==Number)return void console.error("Coords values must be numbers");if(!(Math.abs(e[1])>90))return e;console.error("Latitude must be between -90 and 90")}else console.error("Coords must be an array")},Line:function(e){if(e.constructor===Array){for(const t of e)if(!this.Coords(t))return void console.error("Each coordinate in a line must be a valid Coords type");return e}console.error("Line must be an array")},Rotation:function(e){if(e.constructor===Number)e={z:e};else{if(e.constructor!==Object)return void console.error("Rotation must be an object or a number");for(const t of Object.keys(e)){if(!["x","y","z"].includes(t))return void console.error("Rotation parameters must be x, y, or z");if(e[t].constructor!==Number)return void console.error("Individual rotation values must be numbers")}}return e},Scale:function(e){if(e.constructor===Number)e={x:e,y:e,z:e};else{if(e.constructor!==Object)return void console.error("Scale must be an object or a number");for(const t of Object.keys(e)){if(!["x","y","z"].includes(t))return void console.error("Scale parameters must be x, y, or z");if(e[t].constructor!==Number)return void console.error("Individual scale values must be numbers")}}return e}},t.exports=r},{}]},{},[1])},281:e=>{"use strict";var t,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),r={},n=0,a=0;function o(e){var t="";do{t=i[e%64]+t,e=Math.floor(e/64)}while(e>0);return t}function s(){var e=o(+new Date);return e!==t?(n=0,t=e):e+"."+o(n++)}for(;a<64;a++)r[i[a]]=a;s.encode=o,s.decode=function(e){var t=0;for(a=0;a<e.length;a++)t=64*t+r[e.charAt(a)];return t},e.exports=s}},t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={exports:{}};return e[i].call(n.exports,n,n.exports,r),n.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r(810),r(108),r(862),r(872)})();